/*! For license information please see 450.a0bf5a4f.chunk.js.LICENSE.txt */
(self.webpackChunkkana=self.webpackChunkkana||[]).push([[450],{7757:function(e,t,r){e.exports=r(9727)},8109:function(e,t,r){"use strict";r.d(t,{FB:function(){return O}});var n=r(5671),a=r(3144),i=r(7757),s=r.n(i);function o(e,t,r,n){return new(r||(r=Promise))((function(a,i){function s(e){try{u(n.next(e))}catch(t){i(t)}}function o(e){try{u(n.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,o)}u((n=n.apply(e,t||[])).next())}))}var u,l=function(){function e(){(0,n.Z)(this,e),this.mutex=Promise.resolve()}return(0,a.Z)(e,[{key:"lock",value:function(){var e=function(){};return this.mutex=this.mutex.then((function(){return new Promise(e)})),new Promise((function(t){e=t}))}},{key:"dispatch",value:function(e){return o(this,void 0,void 0,s().mark((function t(){var r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.lock();case 2:return r=t.sent,t.prev=3,t.next=6,Promise.resolve(e());case 6:return t.abrupt("return",t.sent);case 7:return t.prev=7,r(),t.finish(7);case 10:case"end":return t.stop()}}),t,this,[[3,,7,10]])})))}}]),e}();var c="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:r.g,h=null!==(u=c.Buffer)&&void 0!==u?u:null,f=c.TextEncoder?new c.TextEncoder:null;function d(e,t){return(15&e)+(e>>6|e>>3&8)<<4|(15&t)+(t>>6|t>>3&8)}function v(e,t){for(var r=t.length>>1,n=0;n<r;n++){var a=n<<1;e[n]=d(t.charCodeAt(a),t.charCodeAt(a+1))}}function p(e,t){if(e.length!==2*t.length)return!1;for(var r=0;r<t.length;r++){var n=r<<1;if(t[r]!==d(e.charCodeAt(n),e.charCodeAt(n+1)))return!1}return!0}var m="a".charCodeAt(0)-10,g="0".charCodeAt(0);function y(e,t,r){for(var n=0,a=0;a<r;a++){var i=t[a]>>>4;e[n++]=i>9?i+m:i+g,i=15&t[a],e[n++]=i>9?i+m:i+g}return String.fromCharCode.apply(null,e)}for(var w=null!==h?function(e){if("string"===typeof e){var t=h.from(e,"utf8");return new Uint8Array(t.buffer,t.byteOffset,t.length)}if(h.isBuffer(e))return new Uint8Array(e.buffer,e.byteOffset,e.length);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")}:function(e){if("string"===typeof e)return f.encode(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")},b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_=new Uint8Array(256),k=0;k<b.length;k++)_[b.charCodeAt(k)]=k;function Z(e){var t=Math.floor(.75*e.length),r=e.length;return"="===e[r-1]&&(t-=1,"="===e[r-2]&&(t-=1)),t}function A(e){for(var t=Z(e),r=e.length,n=new Uint8Array(t),a=0,i=0;i<r;i+=4){var s=_[e.charCodeAt(i)],o=_[e.charCodeAt(i+1)],u=_[e.charCodeAt(i+2)],l=_[e.charCodeAt(i+3)];n[a]=s<<2|o>>4,n[a+=1]=(15&o)<<4|u>>2,n[a+=1]=(3&u)<<6|63&l,a+=1}return n}var x=16384,E=new l,S=new Map;function I(e,t){return o(this,void 0,void 0,s().mark((function r(){var n,a,i,u,l,c,h,f,d,m,g,b,_,k,Z,I,B,z,G,F,O=this;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=null,a=null,i=!1,"undefined"!==typeof WebAssembly){r.next=5;break}throw new Error("WebAssembly is not supported in this environment!");case 5:u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;a.set(e,t)},l=function(){return a},c=function(){return n.exports},h=function(e){n.exports.Hash_SetMemorySize(e);var t=n.exports.Hash_GetBuffer(),r=n.exports.memory.buffer;a=new Uint8Array(r,t,e)},f=function(){return new DataView(n.exports.memory.buffer).getUint32(n.exports.STATE_SIZE,!0)},d=E.dispatch((function(){return o(O,void 0,void 0,s().mark((function t(){var r,a,i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return S.has(e.name)||(r=A(e.data),a=WebAssembly.compile(r),S.set(e.name,a)),t.next=3,S.get(e.name);case 3:return i=t.sent,t.next=6,WebAssembly.instantiate(i,{});case 6:n=t.sent;case 7:case"end":return t.stop()}}),t)})))})),m=function(){return o(O,void 0,void 0,s().mark((function e(){var t,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}return e.next=3,d;case 3:t=n.exports.Hash_GetBuffer(),r=n.exports.memory.buffer,a=new Uint8Array(r,t,x);case 6:case"end":return e.stop()}}),e)})))},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;i=!0,n.exports.Hash_Init(e)},b=function(e){for(var t=0;t<e.length;){var r=e.subarray(t,t+x);t+=r.length,a.set(r),n.exports.Hash_Update(r.length)}},_=function(e){if(!i)throw new Error("update() called before init()");var t=w(e);b(t)},k=new Uint8Array(2*t),Z=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!i)throw new Error("digest() called before init()");return i=!1,n.exports.Hash_Final(r),"binary"===e?a.slice(0,t):y(k,a,t)},I=function(){if(!i)throw new Error("save() can only be called after init() and before digest()");var t=n.exports.Hash_GetState(),r=f(),a=n.exports.memory.buffer,s=new Uint8Array(a,t,r),o=new Uint8Array(4+r);return v(o,e.hash),o.set(s,4),o},B=function(t){if(!(t instanceof Uint8Array))throw new Error("load() expects an Uint8Array generated by save()");var r=n.exports.Hash_GetState(),a=f(),s=4+a,o=n.exports.memory.buffer;if(t.length!==s)throw new Error("Bad state length (expected ".concat(s," bytes, got ").concat(t.length,")"));if(!p(e.hash,t.subarray(0,4)))throw new Error("This state was written by an incompatible hash implementation");var u=t.subarray(4);new Uint8Array(o,r,a).set(u),i=!0},z=function(e){return"string"===typeof e?e.length<4096:e.byteLength<x},G=z,r.t0=e.name,r.next="argon2"===r.t0||"scrypt"===r.t0?24:"blake2b"===r.t0||"blake2s"===r.t0?26:"blake3"===r.t0?28:"xxhash64"===r.t0||"xxhash3"===r.t0||"xxhash128"===r.t0?30:32;break;case 24:return G=function(){return!0},r.abrupt("break",32);case 26:return G=function(e,t){return t<=512&&z(e)},r.abrupt("break",32);case 28:return G=function(e,t){return 0===t&&z(e)},r.abrupt("break",32);case 30:return G=function(){return!1},r.abrupt("break",32);case 32:return F=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!G(e,r))return g(r),_(e),Z("hex",i);var s=w(e);return a.set(s),n.exports.Hash_Calculate(s.length,r,i),y(k,a,t)},r.next=35,m();case 35:return r.abrupt("return",{getMemory:l,writeMemory:u,getExports:c,setMemorySize:h,init:g,update:_,digest:Z,save:I,load:B,calculate:F,hashLength:t});case 36:case"end":return r.stop()}}),r)})))}function B(e,t,r){return o(this,void 0,void 0,s().mark((function n(){var a,i;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.lock();case 2:return a=n.sent,n.next=5,I(t,r);case 5:return i=n.sent,a(),n.abrupt("return",i);case 8:case"end":return n.stop()}}),n)})))}new l;new l;new DataView(new ArrayBuffer(4));new l;new l;new l;new l;new l;var z={name:"md5",data:"AGFzbQEAAAABEgRgAAF/YAAAYAF/AGACf38BfwMIBwABAgMBAAIEBQFwAQEBBQQBAQICBg4CfwFBoIoFC38AQYAICwdwCAZtZW1vcnkCAA5IYXNoX0dldEJ1ZmZlcgAACUhhc2hfSW5pdAABC0hhc2hfVXBkYXRlAAIKSGFzaF9GaW5hbAAEDUhhc2hfR2V0U3RhdGUABQ5IYXNoX0NhbGN1bGF0ZQAGClNUQVRFX1NJWkUDAQqzFgcFAEGACQstAEEAQv6568XpjpWZEDcCkIkBQQBCgcaUupbx6uZvNwKIiQFBAEIANwKAiQEL6AIBA39BAEEAKAKAiQEiASAAakH/////AXEiAjYCgIkBQQAoAoSJASEDAkAgAiABTw0AQQAgA0EBaiIDNgKEiQELQQAgAyAAQR12ajYChIkBAkACQAJAAkACQAJAIAFBP3EiAw0AQYAJIQIMAQtBwAAgA2siAiAASw0BIANBGGohA0EAIQEDQCADIAFqQYCJAWogAUGACWotAAA6AAAgAyABQQFqIgFqQdgARw0AC0GYiQFBwAAQAxogACACayEAIAJBgAlqIQILIABBwABPDQEgACEDDAILIABFDQJBACEBIANBmIkBakEALQCACToAACAAQQFGDQIgA0GZiQFqIQMgAEF/aiECA0AgAyABaiABQYEJai0AADoAACACIAFBAWoiAUcNAAwDCwsgAEE/cSEDIAIgAEFAcRADIQILIANFDQBBACEBA0AgAUGYiQFqIAIgAWotAAA6AAAgAyABQQFqIgFHDQALCwu0EAEZf0EAKAKUiQEhAkEAKAKQiQEhA0EAKAKMiQEhBEEAKAKIiQEhBQNAIABBCGooAgAiBiAAQRhqKAIAIgcgAEEoaigCACIIIABBOGooAgAiCSAAQTxqKAIAIgogAEEMaigCACILIABBHGooAgAiDCAAQSxqKAIAIg0gDCALIAogDSAJIAggByADIAZqIAIgAEEEaigCACIOaiAFIAQgAiADc3EgAnNqIAAoAgAiD2pB+Miqu31qQQd3IARqIhAgBCADc3EgA3NqQdbunsZ+akEMdyAQaiIRIBAgBHNxIARzakHb4YGhAmpBEXcgEWoiEmogAEEUaigCACITIBFqIABBEGooAgAiFCAQaiAEIAtqIBIgESAQc3EgEHNqQe6d9418akEWdyASaiIQIBIgEXNxIBFzakGvn/Crf2pBB3cgEGoiESAQIBJzcSASc2pBqoyfvARqQQx3IBFqIhIgESAQc3EgEHNqQZOMwcF6akERdyASaiIVaiAAQSRqKAIAIhYgEmogAEEgaigCACIXIBFqIAwgEGogFSASIBFzcSARc2pBgaqaampBFncgFWoiECAVIBJzcSASc2pB2LGCzAZqQQd3IBBqIhEgECAVc3EgFXNqQa/vk9p4akEMdyARaiISIBEgEHNxIBBzakGxt31qQRF3IBJqIhVqIABBNGooAgAiGCASaiAAQTBqKAIAIhkgEWogDSAQaiAVIBIgEXNxIBFzakG+r/PKeGpBFncgFWoiECAVIBJzcSASc2pBoqLA3AZqQQd3IBBqIhEgECAVc3EgFXNqQZPj4WxqQQx3IBFqIhUgESAQc3EgEHNqQY6H5bN6akERdyAVaiISaiAHIBVqIA4gEWogCiAQaiASIBUgEXNxIBFzakGhkNDNBGpBFncgEmoiECAScyAVcSASc2pB4sr4sH9qQQV3IBBqIhEgEHMgEnEgEHNqQcDmgoJ8akEJdyARaiISIBFzIBBxIBFzakHRtPmyAmpBDncgEmoiFWogCCASaiATIBFqIA8gEGogFSAScyARcSASc2pBqo/bzX5qQRR3IBVqIhAgFXMgEnEgFXNqQd2gvLF9akEFdyAQaiIRIBBzIBVxIBBzakHTqJASakEJdyARaiISIBFzIBBxIBFzakGBzYfFfWpBDncgEmoiFWogCSASaiAWIBFqIBQgEGogFSAScyARcSASc2pByPfPvn5qQRR3IBVqIhAgFXMgEnEgFXNqQeabh48CakEFdyAQaiIRIBBzIBVxIBBzakHWj9yZfGpBCXcgEWoiEiARcyAQcSARc2pBh5vUpn9qQQ53IBJqIhVqIAYgEmogGCARaiAXIBBqIBUgEnMgEXEgEnNqQe2p6KoEakEUdyAVaiIQIBVzIBJxIBVzakGF0o/PempBBXcgEGoiESAQcyAVcSAQc2pB+Me+Z2pBCXcgEWoiEiARcyAQcSARc2pB2YW8uwZqQQ53IBJqIhVqIBcgEmogEyARaiAZIBBqIBUgEnMgEXEgEnNqQYqZqel4akEUdyAVaiIQIBVzIhUgEnNqQcLyaGpBBHcgEGoiESAVc2pBge3Hu3hqQQt3IBFqIhIgEXMiGiAQc2pBosL17AZqQRB3IBJqIhVqIBQgEmogDiARaiAJIBBqIBUgGnNqQYzwlG9qQRd3IBVqIhAgFXMiFSASc2pBxNT7pXpqQQR3IBBqIhEgFXNqQamf+94EakELdyARaiISIBFzIgkgEHNqQeCW7bV/akEQdyASaiIVaiAPIBJqIBggEWogCCAQaiAVIAlzakHw+P71e2pBF3cgFWoiECAVcyIVIBJzakHG/e3EAmpBBHcgEGoiESAVc2pB+s+E1X5qQQt3IBFqIhIgEXMiCCAQc2pBheG8p31qQRB3IBJqIhVqIBkgEmogFiARaiAHIBBqIBUgCHNqQYW6oCRqQRd3IBVqIhEgFXMiECASc2pBuaDTzn1qQQR3IBFqIhIgEHNqQeWz7rZ+akELdyASaiIVIBJzIgcgEXNqQfj5if0BakEQdyAVaiIQaiAMIBVqIA8gEmogBiARaiAQIAdzakHlrLGlfGpBF3cgEGoiESAVQX9zciAQc2pBxMSkoX9qQQZ3IBFqIhIgEEF/c3IgEXNqQZf/q5kEakEKdyASaiIQIBFBf3NyIBJzakGnx9DcempBD3cgEGoiFWogCyAQaiAZIBJqIBMgEWogFSASQX9zciAQc2pBucDOZGpBFXcgFWoiESAQQX9zciAVc2pBw7PtqgZqQQZ3IBFqIhAgFUF/c3IgEXNqQZKZs/h4akEKdyAQaiISIBFBf3NyIBBzakH96L9/akEPdyASaiIVaiAKIBJqIBcgEGogDiARaiAVIBBBf3NyIBJzakHRu5GseGpBFXcgFWoiECASQX9zciAVc2pBz/yh/QZqQQZ3IBBqIhEgFUF/c3IgEHNqQeDNs3FqQQp3IBFqIhIgEEF/c3IgEXNqQZSGhZh6akEPdyASaiIVaiANIBJqIBQgEWogGCAQaiAVIBFBf3NyIBJzakGho6DwBGpBFXcgFWoiECASQX9zciAVc2pBgv3Nun9qQQZ3IBBqIhEgFUF/c3IgEHNqQbXk6+l7akEKdyARaiISIBBBf3NyIBFzakG7pd/WAmpBD3cgEmoiFSAEaiAWIBBqIBUgEUF/c3IgEnNqQZGnm9x+akEVd2ohBCAVIANqIQMgEiACaiECIBEgBWohBSAAQcAAaiEAIAFBQGoiAQ0AC0EAIAI2ApSJAUEAIAM2ApCJAUEAIAQ2AoyJAUEAIAU2AoiJASAAC6ECAQN/QQAoAoCJASIAQT9xIgFBmIkBakGAAToAAAJAAkACQCABQT9zIgJBB0sNAAJAIAJFDQAgAUGZiQFqIQADQCAAQQA6AAAgAEEBaiEAIAJBf2oiAg0ACwtBwAAhAkGYiQFBwAAQAxpBACEADAELIAJBCEYNASABQQFqIQALIABBj4kBaiEBA0AgASACakEAOgAAIAJBd2ohACACQX9qIQIgAEEASg0AC0EAKAKAiQEhAAtBACAAQRV2OgDTiQFBACAAQQ12OgDSiQFBACAAQQV2OgDRiQFBACAAQQN0IgI6ANCJAUEAIAI2AoCJAUEAQQAoAoSJATYC1IkBQZiJAUHAABADGkEAQQApAoiJATcDgAlBAEEAKQKQiQE3A4gJCwYAQYCJAQszAEEAQv6568XpjpWZEDcCkIkBQQBCgcaUupbx6uZvNwKIiQFBAEIANwKAiQEgABACEAQLCwsBAEGACAsEmAAAAA==",hash:"9b0fac7d"},G=new l,F=null;function O(e){if(null===F)return B(G,z,16).then((function(t){return(F=t).calculate(e)}));try{var t=F.calculate(e);return Promise.resolve(t)}catch(r){return Promise.reject(r)}}new l;new l;new l;new l;new l;new l;new l;new l;new l,new ArrayBuffer(8);new l,new ArrayBuffer(8);new l,new ArrayBuffer(8);new l;new l;new l},907:function(e,t,r){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}r.d(t,{Z:function(){return n}})},3878:function(e,t,r){"use strict";function n(e){if(Array.isArray(e))return e}r.d(t,{Z:function(){return n}})},7762:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var n=r(181);function a(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=(0,n.Z)(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw s}}}}},1902:function(e,t,r){"use strict";function n(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i=[],s=!0,o=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);s=!0);}catch(u){o=!0,a=u}finally{try{s||null==r.return||r.return()}finally{if(o)throw a}}return i}}r.d(t,{Z:function(){return n}})},5267:function(e,t,r){"use strict";function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}r.d(t,{Z:function(){return n}})},3324:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var n=r(3878),a=r(1902),i=r(181),s=r(5267);function o(e,t){return(0,n.Z)(e)||(0,a.Z)(e,t)||(0,i.Z)(e,t)||(0,s.Z)()}},181:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var n=r(907);function a(e,t){if(e){if("string"===typeof e)return(0,n.Z)(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?(0,n.Z)(e,t):void 0}}},2190:function(e,t,r){"use strict";r.d(t,{TN:function(){return Jo},pY:function(){return nu},Sl:function(){return Vo},j2:function(){return Ho},MM:function(){return tu},ve:function(){return au},t:function(){return iu},x6:function(){return Xo},cN:function(){return $o},v9:function(){return wo},rF:function(){return Qn},ED:function(){return Wn},$p:function(){return ns},gj:function(){return Fa}});var n={};r.r(n),r.d(n,{Reader:function(){return Kn},abbreviate:function(){return Jn},preflight:function(){return Vn},unserialize:function(){return $n}});var a={};r.r(a),r.d(a,{Reader:function(){return sa},abbreviate:function(){return ta},preflight:function(){return aa},unserialize:function(){return oa}});var i={};r.r(i),r.d(i,{Reader:function(){return ma},abbreviate:function(){return la},preflight:function(){return fa},unserialize:function(){return ga}});var s=r(3324),o=r(5861),u=r(7757),l=r(3515),c=r(519),h=r(9390);function f(e,t){var r,n;try{r=l.RE((function(r){return r.read_hdf5_matrix(e,t)})),n=new h.p(r)}catch(a){throw c.gd(r),a}return n}function d(e,t,r){return function(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}(e,t),r}var v=r(7326),p=r(136),m=r(9388),g=r(864);function y(e,t){(0,g.Z)(e,t),t.add(e)}function w(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}var b=r(5671),_=r(3144),k=r(2346),Z=r(6033),A=r(3092),x=r(7762);function E(e,t){var r,n=new TextDecoder,a=[],i=0,s=(0,x.Z)(t);try{for(s.s();!(r=s.n()).done;){var o=r.value,u=e.slice(i,i+o);a.push(n.decode(u)),i+=o}}catch(Xt){s.e(Xt)}finally{s.f()}return a}function S(e){var t,r;try{var n=(r=c.Wf(e.length)).array(),a=0,i=new TextEncoder,s=new Array(e.length);e.forEach((function(e,t){var r=i.encode(e);n[t]=r.length,s[t]=r,a+=r.length}));var o=(t=c.TS(a)).array();a=0,s.forEach((function(e){o.set(e,a),a+=e.length}))}catch(u){throw c.gd(t),c.gd(r),u}return[r,t]}function I(e,t){if(t.length>0){var r=t.reduce((function(e,t){return e*t}));if(e.length!=r)throw new Error("length of 'x' must be equal to the product of 'shape'")}else if(e instanceof Array||ArrayBuffer.isView(e)){if(1!=e.length)throw new Error("length of 'x' should be 1 for a scalar dataset")}else e=[e];return e}var B=new WeakMap,z=new WeakMap,G=function(){function e(t,r){(0,b.Z)(this,e),(0,k.Z)(this,B,{writable:!0,value:void 0}),(0,k.Z)(this,z,{writable:!0,value:void 0}),(0,A.Z)(this,B,t),(0,A.Z)(this,z,r)}return(0,_.Z)(e,[{key:"file",get:function(){return(0,Z.Z)(this,B)}},{key:"name",get:function(){return(0,Z.Z)(this,z)}}]),e}(),F=new WeakMap,O=new WeakSet,C=function(e){(0,p.Z)(r,e);var t=(0,m.Z)(r);function r(e,n){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.children,o=void 0===s?null:s;if((0,b.Z)(this,r),a=t.call(this,e,n),y((0,v.Z)(a),O),(0,k.Z)((0,v.Z)(a),F,{writable:!0,value:void 0}),null===o){var u=l.RE((function(t){return new t.H5GroupDetails(e,n)}));try{var c=E(u.buffer(),u.lengths()),h=u.types(),f=["Group","DataSet","Other"];(0,A.Z)((0,v.Z)(a),F,{});for(var d=0;d<c.length;d++)(0,Z.Z)((0,v.Z)(a),F)[c[d]]=f[h[d]]}finally{u.delete()}}else(0,A.Z)((0,v.Z)(a),F,o);return a}return(0,_.Z)(r,[{key:"children",get:function(){return(0,Z.Z)(this,F)}},{key:"open",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=w(this,O,D).call(this,e);if(e in(0,Z.Z)(this,F)){if("Group"==(0,Z.Z)(this,F)[e])return new r(this.file,n,t);if("DataSet"==(0,Z.Z)(this,F)[e])return new T(this.file,n,t);throw new Error("don't know how to open '"+e+"'")}throw new Error("no '"+e+"' child in this HDF5 Group")}},{key:"createGroup",value:function(e){var t=this,n=w(this,O,D).call(this,e);return l.RE((function(e){return e.create_hdf5_group(t.file,n)})),this.children[e]="Group",new r(this.file,n,{children:{}})}},{key:"createDataSet",value:function(e,t,r){var n,a,i=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=s.maxStringLength,u=void 0===o?10:o,h=s.compression,f=void 0===h?6:h,d=s.chunks,v=void 0===d?null:d,p=w(this,O,D).call(this,e);try{var m=(n=c.de(r,"Int32WasmArray")).offset;if(null!==v){if((a=c.de(v,"Int32WasmArray")).length!=n.length)throw new Error("'chunks' and 'shape' should have the same dimensions");m=a.offset}l.RE((function(e){return e.create_hdf5_dataset(i.file,p,t,n.length,n.offset,u,f,m)}))}finally{n.free()}return this.children[e]="DataSet",new T(this.file,p,{type:t,shape:r})}},{key:"writeDataSet",value:function(e,t,r,n){var a,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=i.compression,u=void 0===o?6:o,h=i.chunks,f=void 0===h?null:h;if(null===r?"string"==typeof n||"number"==typeof n?(n=[n],r=[]):r=[n.length]:n=I(n,r),"String"==t){var d=S(n),v=(0,s.Z)(d,2),p=v[0],m=v[1];try{var g=0;p.array().forEach((function(e){g<e&&(g=e)})),a=this.createDataSet(e,"String",r,{maxStringLength:g,compression:u,chunks:f}),l.RE((function(e){return e.write_string_hdf5_dataset(a.file,a.name,p.length,p.offset,m.offset)}))}finally{c.gd(p),c.gd(m)}}else(a=this.createDataSet(e,t,r,{compression:u,chunks:f})).write(n);return a}}]),r}(G);function D(e){var t=this.name;return"/"!=t&&(t+="/"),t+=e}var N=function(e){(0,p.Z)(r,e);var t=(0,m.Z)(r);function r(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.children,i=void 0===a?null:a;return(0,b.Z)(this,r),t.call(this,e,"/",{children:i})}return(0,_.Z)(r)}(C);function M(e){return l.RE((function(t){return t.create_hdf5_file(e)})),new N(e,{children:{}})}var R=new WeakMap,U=new WeakMap,Q=new WeakMap,W=new WeakMap,T=function(e){(0,p.Z)(r,e);var t=(0,m.Z)(r);function r(e,n){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.load,o=void 0!==s&&s,u=i.shape,c=void 0===u?null:u,h=i.type,f=void 0===h?null:h,p=i.values,m=void 0===p?null:p;if((0,b.Z)(this,r),a=t.call(this,e,n),(0,k.Z)((0,v.Z)(a),R,{writable:!0,value:void 0}),(0,k.Z)((0,v.Z)(a),U,{writable:!0,value:void 0}),(0,k.Z)((0,v.Z)(a),Q,{writable:!0,value:void 0}),(0,k.Z)((0,v.Z)(a),W,{writable:!0,value:void 0}),null===c&&null===f){if(o){var g=d(r,r,j).call(r,e,n);(0,A.Z)((0,v.Z)(a),U,g.type),(0,A.Z)((0,v.Z)(a),R,g.shape),(0,A.Z)((0,v.Z)(a),Q,g.values)}else{var y=l.RE((function(t){return new t.H5DataSetDetails(e,n)}));try{(0,A.Z)((0,v.Z)(a),U,y.type()),(0,A.Z)((0,v.Z)(a),R,Array.from(y.shape())),(0,A.Z)((0,v.Z)(a),Q,null)}finally{y.delete()}}(0,A.Z)((0,v.Z)(a),W,o)}else(0,A.Z)((0,v.Z)(a),R,c),(0,A.Z)((0,v.Z)(a),U,f),(0,A.Z)((0,v.Z)(a),Q,m),(0,A.Z)((0,v.Z)(a),W,null!==m);return a}return(0,_.Z)(r,[{key:"type",get:function(){return(0,Z.Z)(this,U)}},{key:"shape",get:function(){return(0,Z.Z)(this,R)}},{key:"loaded",get:function(){return(0,Z.Z)(this,W)}},{key:"values",get:function(){return(0,Z.Z)(this,Q)}},{key:"load",value:function(){if(!(0,Z.Z)(this,W)){var e=d(r,r,j).call(r,this.file,this.name);(0,A.Z)(this,Q,e.values),(0,A.Z)(this,W,!0)}return(0,Z.Z)(this,Q)}},{key:"write",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.cache,a=void 0!==n&&n;if(e=I(e,this.shape),"String"==this.type){var i=S(e),o=(0,s.Z)(i,2),u=o[0],h=o[1];try{l.RE((function(e){return e.write_string_hdf5_dataset(t.file,t.name,u.length,u.offset,h.offset)}))}finally{c.gd(h),c.gd(u)}a?((0,A.Z)(this,Q,e.slice()),(0,A.Z)(this,W,!0)):((0,A.Z)(this,W,!1),(0,A.Z)(this,Q,null))}else{var f=c.de(e,null);try{l.RE((function(e){return e.write_numeric_hdf5_dataset(t.file,t.name,f.constructor.className,f.offset)})),a?((0,A.Z)(this,Q,f.slice()),(0,A.Z)(this,W,!0)):((0,A.Z)(this,W,!1),(0,A.Z)(this,Q,null))}finally{f.free()}}}}]),r}(G);function j(e,t){var r,n,a,i=l.RE((function(r){return new r.LoadedH5DataSet(e,t)}));try{if("other"==(n=i.type()))throw new Error("cannot load dataset for an unsupported type");r="String"==n?E(i.values(),i.lengths()):i.values().slice(),a=Array.from(i.shape())}finally{i.delete()}return{values:r,type:n,shape:a}}function q(e,t){var r=null;if(e instanceof h.p?e.isReorganized()&&(r=e.identities()):r=e,null!==r){var n=new t.constructor(r.length);return r.forEach((function(e,r){n[r]=t[e]})),n}return t.slice()}function P(e,t){var r,n=null;if(e instanceof h.p){if(r=e.numberOfRows(),e.isReorganized()){if(t.length!=r)throw new Error("number of rows in 'x' should be the same as length of 'old'");n=e.identities()}}else{if(r=e.length,t.length!=r)throw new Error("length of 'x' should be the same as length of 'old'");n=e}if(r!=t.length)throw new Error("mismatch in row identities between 'x' and 'old'");var a=!0;if(null!==n){var i,o=(0,x.Z)(n.entries());try{for(o.s();!(i=o.n()).done;){var u=(0,s.Z)(i.value,2),l=u[0],c=u[1];if(t[l]!=c){a=!1;break}}}catch(Xt){o.e(Xt)}finally{o.f()}}else{var f,d=(0,x.Z)(t.entries());try{for(d.s();!(f=d.n()).done;){var v=(0,s.Z)(f.value,2),p=v[0];if(v[1]!=p){a=!1;break}}}catch(Xt){d.e(Xt)}finally{d.f()}}if(a)return null;var m={};t.forEach((function(e,t){m[e]=t}));var g=new Int32Array(r);if(null!==n)for(var y=0;y<n.length;y++){var w=n[y];if(!(w in m))throw new Error("mismatch in row identities between 'x' and 'old'");g[y]=m[w]}else for(var b=0;b<r;b++){if(!(b in m))throw new Error("mismatch in row identities between 'x' and 'old'");g[b]=m[b]}return g}function L(e,t){for(var r=0,n=Object.entries(t);r<n.length;r++){var a=(0,s.Z)(n[r],2),i=a[0],o=a[1];t[i]=q(e,o)}}function H(e){var t=0;e.forEach((function(e){e&&e.match(/^ENSG[0-9]{11}$/)&&t++}));var r=0;e.forEach((function(e){e&&e.match(/^[A-Z][^a-z]+$/)&&!e.match(/^ENS[A-Z]+[0-9]{11}/)&&r++}));var n=0;e.forEach((function(e){e&&e.match(/^ENSMUSG[0-9]{11}$/)&&n++}));var a=0;e.forEach((function(e){e&&e.match(/^[A-Z][^A-Z]+$/)&&a++}));for(var i=[{species:"human",type:"ensembl",confidence:t},{species:"human",type:"symbol",confidence:r},{species:"mouse",type:"ensembl",confidence:n},{species:"mouse",type:"symbol",confidence:a}],s=i[0],o=1;o<i.length;o++)i[o].confidence>s.confidence&&(s=i[o]);return s.confidence/=e.length,s}function J(e){for(var t=c.GF(e.length),r=t.array(),n=0;n<e.length;n++)r[n]=BigInt(e[n].matrix.$$.ptr);return t}function Y(e,t){var r,n,a,i,s=[],o={};try{var u;!function(){if(t.length!==e.length)throw new Error("length of 'names' should be equal to length of 'x'");var f={},d=[];for(u=0;u<t.length;u++){if(e[u].numberOfRows()!==t[u].length)throw new Error("length of each 'names' must equal number of rows of its corresponding 'x'");t[u].forEach((function(e){e in f||(f[e]=d.length,d.push(e))}))}var v=(n=c.GF(e.length)).array(),p=function(){var e=t[u],r=c.Wf(e.length),n=r.array();e.forEach((function(e,t){n[t]=f[e]})),s.push(r),v[u]=BigInt(r.offset)};for(u=0;u<t.length;u++)p();r=J(e),a=c.Wf(e[0].numberOfRows()),i=l.RE((function(t){return t.cbind_with_rownames(e.length,r.offset,n.offset,a.offset)})),o.matrix=new h.p(i),o.indices=a.slice(0,o.matrix.numberOfRows());var m,g=[],y=(0,x.Z)(o.indices);try{for(y.s();!(m=y.n()).done;){var w=m.value;g.push(t[0][w])}}catch(Xt){y.e(Xt)}finally{y.f()}o.names=g}()}catch(p){throw c.gd(i),p}finally{c.gd(r),c.gd(n),c.gd(a);for(var f=0,d=s;f<d.length;f++){var v=d[f];c.gd(v)}}return o}var V=r(6737),X=function(){function e(t){(0,b.Z)(this,e),this.results=t}return(0,_.Z)(e,[{key:"sums",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return c.Yj(this.results.sums(),r)}},{key:"detected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return c.Yj(this.results.detected(),r)}},{key:"subsetProportions",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.copy,n=void 0===r||r;return c.Yj(this.results.subset_proportions(e),n)}},{key:"isProportion",value:function(){return this.results.is_proportion()}},{key:"numberOfSubsets",value:function(){return this.results.num_subsets()}},{key:"free",value:function(){null!==this.results&&(this.results.delete(),this.results=null)}}]),e}();var K=function(){function e(t){(0,b.Z)(this,e),this.results=t}return(0,_.Z)(e,[{key:"discardSums",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return c.Yj(this.results.discard_sums(),r)}},{key:"discardDetected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return c.Yj(this.results.discard_detected(),r)}},{key:"discardSubsetProportions",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.copy,n=void 0===r||r;return c.Yj(this.results.discard_proportions(e),n)}},{key:"discardOverall",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return c.Yj(this.results.discard_overall(),r)}},{key:"thresholdsSums",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return c.Yj(this.results.thresholds_sums(),r)}},{key:"thresholdsDetected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return c.Yj(this.results.thresholds_detected(),r)}},{key:"thresholdsSubsetProportions",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.copy,n=void 0===r||r;return c.Yj(this.results.thresholds_proportions(e),n)}},{key:"numberOfSubsets",value:function(){return this.results.num_subsets()}},{key:"free",value:function(){null!==this.results&&(this.results.delete(),this.results=null)}}]),e}();r(7242);function $(e){var t,r,n,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=i.sizeFactors,o=void 0===s?null:s,u=i.block,h=void 0===u?null:u;try{var f=0,d=!1;if(null!==o){if((t=c.de(o,"Float64WasmArray")).length!=e.numberOfColumns())throw new Error("length of 'sizeFactors' must be equal to number of columns in 'x'");f=t.offset,d=!0}var v=0,p=!1;if(null!==h){if((r=c.de(h,"Int32WasmArray")).length!=e.numberOfColumns())throw new Error("'block' must be of length equal to the number of columns in 'x'");p=!0,v=r.offset}n=l.RE((function(t){return t.log_norm_counts(e.matrix,d,f,p,v)})),a=new e.constructor(n)}catch(m){throw c.gd(n),m}finally{c.gd(t),c.gd(r)}return a}var ee=r(4657),te=(r(5026),function(){function e(t){(0,b.Z)(this,e),this.results=t}return(0,_.Z)(e,[{key:"principalComponents",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return c.Yj(this.results.pcs(),r)}},{key:"varianceExplained",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return c.Yj(this.results.variance_explained(),r)}},{key:"totalVariance",value:function(){return this.results.total_variance()}},{key:"numberOfPCs",value:function(){return this.results.num_pcs()}},{key:"numberOfCells",value:function(){return this.principalComponents({copy:!1}).length/this.numberOfPCs()}},{key:"free",value:function(){null!==this.results&&(this.results.delete(),this.results=null)}}]),e}());function re(e){var t,r,n,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=i.features,o=void 0===s?null:s,u=i.numberOfPCs,h=void 0===u?25:u,f=i.scale,d=void 0!==f&&f,v=i.block,p=void 0===v?null:v,m=i.blockMethod,g=void 0===m?"block":m;try{var y=!1,w=0;if(null!==o){if((t=c.de(o,"Uint8WasmArray")).length!=e.numberOfRows())throw new Error("length of 'features' should be equal to number of rows in 'x'");y=!0,w=t.offset}if(null===p)n=l.RE((function(t){return t.run_pca(e.matrix,h,y,w,d)}));else{if((r=c.de(p,"Int32WasmArray")).length!=e.numberOfColumns())throw new Error("length of 'block' should be equal to the number of columns in 'x'");n="block"==g?l.RE((function(t){return t.run_blocked_pca(e.matrix,h,y,w,d,r.offset)})):l.RE((function(t){return t.run_multibatch_pca(e.matrix,h,y,w,d,r.offset)}))}a=new te(n)}catch(b){throw c.gd(n),b}finally{c.gd(t),c.gd(r)}return a}var ne=function(){function e(t){(0,b.Z)(this,e),this.index=t}return(0,_.Z)(e,[{key:"numberOfCells",value:function(){return this.index.num_obs()}},{key:"free",value:function(){null!==this.index&&(this.index.delete(),this.index=null)}}]),e}();var ae=function(){function e(t){(0,b.Z)(this,e),this.results=t}return(0,_.Z)(e,[{key:"size",value:function(){return this.results.size()}},{key:"numberOfCells",value:function(){return this.results.num_obs()}},{key:"serialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.runs,r=void 0===t?null:t,n=e.indices,a=void 0===n?null:n,i=e.distances,s=void 0===i?null:i,o=(null===r)+(null===a)+(null===s);if(3!=o&&0!=o)throw new Error("either all or none of 'runs', 'indices' and 'distances' can be 'null'");if(3===o){var u,l,h,f;try{u=c.Wf(this.numberOfCells());var d=this.size();l=c.Wf(d),h=c.RJ(d),this.results.serialize(u.offset,l.offset,h.offset),f={runs:u.slice(),indices:l.slice(),distances:h.slice()}}finally{c.gd(u),c.gd(l),c.gd(h)}return f}this.results.serialize(r.offset,a.offset,s.offset)}},{key:"free",value:function(){null!==this.results&&(this.results.delete(),this.results=null)}}],[{key:"unserialize",value:function(t,r,n){var a,i,s,o,u;try{s=c.de(t,"Int32WasmArray"),o=c.de(r,"Int32WasmArray"),u=c.de(n,"Float64WasmArray"),i=new e(a=l.RE((function(e){return new e.NeighborResults(t.length,s.offset,o.offset,u.offset)})))}catch(h){throw c.gd(a),h}finally{c.gd(s),c.gd(o),c.gd(u)}return i}}]),e}();function ie(e,t){var r,n;try{r=l.RE((function(r){return r.find_nearest_neighbors(e.index,t)})),n=new ae(r)}catch(a){throw c.gd(r),a}return n}var se=function(){function e(t){(0,b.Z)(this,e),this.graph=t}return(0,_.Z)(e,[{key:"free",value:function(){null!==this.graph&&(this.graph.delete(),this.graph=null)}}]),e}();var oe=function(){function e(t){(0,b.Z)(this,e),this.results=t}return(0,_.Z)(e,[{key:"best",value:function(){return this.results.best()}},{key:"numberOfLevels",value:function(){return this.results.number()}},{key:"modularity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.level,r=void 0===t?null:t;return null===r&&(r=this.best()),this.results.modularity(r)}},{key:"membership",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.level,r=void 0===t?null:t,n=e.copy,a=void 0===n||n;return null===r&&(r=this.best()),c.Yj(this.results.membership(r),a)}},{key:"free",value:function(){null!==this.results&&(this.results.delete(),this.results=null)}}]),e}();function ue(e){return l.RE((function(t){return t.perplexity_to_k(e)}))}var le=function(){function e(t){(0,b.Z)(this,e),this.results=t}return(0,_.Z)(e,[{key:"numberOfCells",value:function(){return this.results.num_obs()}},{key:"numberOfClusters",value:function(){return this.results.num_clusters()}},{key:"clusters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return c.Yj(this.results.clusters(),r)}},{key:"clusterSizes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return c.Yj(this.results.cluster_sizes(),r)}},{key:"withinClusterSumSquares",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return c.Yj(this.results.wcss(),r)}},{key:"clusterCenters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return c.Yj(this.results.centers(),r)}},{key:"iterations",value:function(){return this.results.iterations()}},{key:"status",value:function(){return this.results.status()}},{key:"free",value:function(){null!==this.results&&(this.results.delete(),this.results=null)}}]),e}();function ce(e,t){var r,n,a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.numberOfDims,o=void 0===s?null:s,u=i.numberOfCells,h=void 0===u?null:u,f=i.initMethod,d=void 0===f?"pca-part":f,v=i.initSeed,p=void 0===v?5768:v,m=i.initPCASizeAdjust,g=void 0===m?1:m,y=["random","kmeans++","pca-part"],w=y.indexOf(d);if(-1==w)throw new Error("'initMethod' should be one of 'random', 'kmeans++' or 'pca-part'");try{var b;if(e instanceof te){o=e.numberOfPCs(),h=e.numberOfCells();var _=e.principalComponents({copy:!1});b=_.byteOffset}else{if(null===o||null===h)throw new Error("'numberOfDims' and 'numberOfCells' must be specified when 'x' is an Array");if((r=c.de(e,"Float64WasmArray")).length!=o*h)throw new Error("length of 'x' must be the product of 'numberOfDims' and 'numberOfCells'");b=r.offset}n=l.RE((function(e){return e.cluster_kmeans(b,o,h,t,w,p,g)})),a=new le(n)}catch(k){throw c.gd(n),k}finally{c.gd(r)}return a}var he=function(){function e(t){(0,b.Z)(this,e),this.results=t}return(0,_.Z)(e,[{key:"numberOfBlocks",value:function(){return this.results.num_blocks()}},{key:"numberOfGroups",value:function(){return this.results.num_groups()}},{key:"means",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.block,n=void 0===r?-1:r,a=t.copy,i=void 0===a||a;return c.Yj(this.results.means(e,n),i)}},{key:"detected",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.block,n=void 0===r?-1:r,a=t.copy,i=void 0===a||a;return c.Yj(this.results.detected(e,n),i)}},{key:"cohen",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.summary,n=void 0===r?1:r,a=t.copy,i=void 0===a||a;return c.Yj(this.results.cohen(e,n),i)}},{key:"auc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.summary,n=void 0===r?1:r,a=t.copy,i=void 0===a||a;return c.Yj(this.results.auc(e,n),i)}},{key:"lfc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.summary,n=void 0===r?1:r,a=t.copy,i=void 0===a||a;return c.Yj(this.results.lfc(e,n),i)}},{key:"deltaDetected",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.summary,n=void 0===r?1:r,a=t.copy,i=void 0===a||a;return c.Yj(this.results.delta_detected(e,n),i)}},{key:"free",value:function(){null!==this.results&&(this.results.delete(),this.results=null)}}]),e}();function fe(e,t){var r,n,a,i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=s.block,u=void 0===o?null:o;try{if((i=c.de(t,"Int32WasmArray")).length!=e.numberOfColumns())throw new Error("length of 'groups' should be equal to number of columns in 'x'");var h=0,f=!1;if(null!==u){if((a=c.de(u,"Int32WasmArray")).length!=e.numberOfColumns())throw new Error("'block' must be of length equal to the number of columns in 'x'");f=!0,h=a.offset}r=l.RE((function(t){return t.score_markers(e.matrix,i.offset,f,h)})),n=new he(r)}catch(d){throw c.gd(r),d}finally{c.gd(a),c.gd(i)}return n}var de=function(){function e(t){(0,b.Z)(this,e),this.reference=t}return(0,_.Z)(e,[{key:"numberOfSamples",value:function(){return this.reference.num_samples()}},{key:"numberOfFeatures",value:function(){return this.reference.num_features()}},{key:"numberOfLabels",value:function(){return this.reference.num_labels()}},{key:"free",value:function(){null!==this.reference&&(this.reference.delete(),this.reference=null)}}]),e}();function ve(e,t,r){var n,a,i,s,o;try{i=c.de(e,"Uint8WasmArray"),s=c.de(t,"Uint8WasmArray"),o=c.de(r,"Uint8WasmArray"),n=l.RE((function(e){return e.load_singlepp_reference(o.offset,o.length,s.offset,s.length,i.offset,i.length)})),a=new de(n)}catch(u){throw c.gd(n),u}finally{c.gd(i),c.gd(s),c.gd(o)}return a}var pe=function(){function e(t){(0,b.Z)(this,e),this.reference=t}return(0,_.Z)(e,[{key:"sharedFeatures",value:function(){return this.reference.shared_features()}},{key:"free",value:function(){null!==this.reference&&(this.reference.delete(),this.reference=null)}}]),e}();function me(e,t){var r=t.array(),n={},a=0;return e.forEach((function(e){n[e]=a,r[a]=a,a++})),n}function ge(e,t,r){var n=r.array(),a=Object.keys(t).length;e.forEach((function(e,r){e in t?n[r]=t[e]:(n[r]=a,a++)}))}function ye(e,t,r){var n,a,i,s,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=o.top,h=void 0===u?20:u;try{var f=e.length;if(n=c.Wf(f),a=c.Wf(t.numberOfFeatures()),r.length!=a.length)throw new Error("length of 'referenceFeatures' should be equal to the number of features in 'reference'");var d=me(e,n);ge(r,d,a),i=l.RE((function(e){return e.build_singlepp_reference(f,n.offset,t.reference,a.offset,h)})),(s=new pe(i)).expectedNumberOfFeatures=f}catch(v){throw c.gd(i),v}finally{c.gd(n),c.gd(a)}return s}function we(e,t,r,n,a,i,s){var o,u,f,d,v=r instanceof V.do;try{var p,m;if(e instanceof h.p)p=e.matrix;else{if(!(e instanceof V.lt))throw new Error("unknown type for 'x'");if(e.length!==n*a)throw new Error("length of 'x' must be equal to the product of 'numberOfFeatures' and 'numberOfCells'");u=c.de(e,null),p=f=l.RE((function(e){return e.initialize_dense_matrix(n,a,u.offset,"Float64Array")}))}if(p.nrow()!=t)throw new Error("number of rows in 'x' should be equal to length of 'features' used to build '"+s+"'");m=v?r.offset:(d=c.Wf(p.ncol())).offset,i(p,m),o=v?r.array():d.slice()}finally{c.gd(u),c.gd(f),c.gd(d)}return o}function be(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.buffer,a=void 0===n?null:n,i=r.numberOfFeatures,s=void 0===i?null:i,o=r.numberOfCells,u=void 0===o?null:o,c=r.quantile,h=void 0===c?.8:c,f=function(e,r){l.RE((function(n){return n.run_singlepp(e,t.reference,h,r)}))};return we(e,t.expectedNumberOfFeatures,a,s,u,f,"reference")}var _e=function(){function e(t){(0,b.Z)(this,e),this.integrated=t}return(0,_.Z)(e,[{key:"numberOfReferences",value:function(){return this.integrated.num_references()}},{key:"free",value:function(){null!==this.integrated&&(this.integrated.delete(),this.integrated=null)}}]),e}();function ke(e,t,r){var n,a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=i.buffer,o=void 0===s?null:s,u=i.numberOfFeatures,f=void 0===u?null:u,d=i.numberOfCells,v=void 0===d?null:d,p=i.quantile,m=void 0===p?.8:p,g=r.numberOfReferences();if(t.length!=g)throw new Error("length of 'assigned' should be equal to the number of references in 'integrated'");var y=new Array(g);try{for(var w=(a=c.GF(g)).array(),b=0;b<t.length;b++){var _=t[b],k=!1;if(e instanceof h.p?_.length!=e.numberOfColumns()&&(k=!0):_.length!=v&&(k=!0),k)throw new Error("length of each element 'assigned' should be equal to number of columns in 'x'");y[b]=c.de(_,"Int32WasmArray"),w[b]=BigInt(y[b].offset)}var Z=function(e,t){l.RE((function(n){return n.integrate_singlepp(e,w.offset,r.integrated,m,t)}))};n=we(e,r.expectedNumberOfFeatures,o,f,v,Z,"integrated")}finally{c.gd(a);for(var A=0,x=y;A<x.length;A++){var E=x[A];c.gd(E)}}return n}function Ze(e,t){var r,n,a;try{a=c.de(t,"Int32WasmArray"),r=l.RE((function(t){return t.row_subset(e.matrix,a.offset,a.length)})),n=new e.constructor(r)}catch(i){throw c.gd(r),i}finally{c.gd(a)}return n}var Ae=r(907);var xe=r(181);function Ee(e){return function(e){if(Array.isArray(e))return(0,Ae.Z)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||(0,xe.Z)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Se=r(4942);function Ie(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(r),!0).forEach((function(t){(0,Se.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ie(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ze(e,t){if(e instanceof V.PQ)return"view"==t||"hdf5"==t?e.view():t?e.slice():e.array();if(!0===t)return e.slice();if("view"==t)throw new Error("'copy: \"view\"' not supported for mimics");return e}function Ge(e){void 0!==e&&null!==e&&e.free()}function Fe(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"buffer",a=!0;if(n in r){var i=r[n];i.size!=e||i.constructor.className!=t?i.free():a=!1}if(a)switch(t){case"Uint8Array":r[n]=c.TS(e);break;case"Int32Array":r[n]=c.Wf(e);break;case"Float64Array":r[n]=c.RJ(e);break;default:throw"allocating '"+t+"' not yet supported"}return r[n]}function Oe(e){return"object"===typeof e&&!1===Array.isArray(e)}function Ce(e){for(var t=e.length;--t>=0;)e[t]=0}var De=256,Ne=286,Me=30,Re=15,Ue=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Qe=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),We=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Te=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),je=new Array(576);Ce(je);var qe=new Array(60);Ce(qe);var Pe=new Array(512);Ce(Pe);var Le=new Array(256);Ce(Le);var He=new Array(29);Ce(He);var Je,Ye,Ve,Xe=new Array(Me);function Ke(e,t,r,n,a){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=a,this.has_stree=e&&e.length}function $e(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Ce(Xe);var et=function(e){return e<256?Pe[e]:Pe[256+(e>>>7)]},tt=function(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},rt=function(e,t,r){e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,tt(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},nt=function(e,t,r){rt(e,r[2*t],r[2*t+1])},at=function(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},it=function(e,t,r){var n,a,i=new Array(16),s=0;for(n=1;n<=Re;n++)i[n]=s=s+r[n-1]<<1;for(a=0;a<=t;a++){var o=e[2*a+1];0!==o&&(e[2*a]=at(i[o]++,o))}},st=function(e){var t;for(t=0;t<Ne;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Me;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},ot=function(e){e.bi_valid>8?tt(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},ut=function(e,t,r,n){var a=2*t,i=2*r;return e[a]<e[i]||e[a]===e[i]&&n[t]<=n[r]},lt=function(e,t,r){for(var n=e.heap[r],a=r<<1;a<=e.heap_len&&(a<e.heap_len&&ut(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!ut(t,n,e.heap[a],e.depth));)e.heap[r]=e.heap[a],r=a,a<<=1;e.heap[r]=n},ct=function(e,t,r){var n,a,i,s,o=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],a=e.pending_buf[e.l_buf+o],o++,0===n?nt(e,a,t):(i=Le[a],nt(e,i+De+1,t),0!==(s=Ue[i])&&(a-=He[i],rt(e,a,s)),n--,i=et(n),nt(e,i,r),0!==(s=Qe[i])&&(n-=Xe[i],rt(e,n,s)))}while(o<e.last_lit);nt(e,256,t)},ht=function(e,t){var r,n,a,i=t.dyn_tree,s=t.stat_desc.static_tree,o=t.stat_desc.has_stree,u=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<u;r++)0!==i[2*r]?(e.heap[++e.heap_len]=l=r,e.depth[r]=0):i[2*r+1]=0;for(;e.heap_len<2;)i[2*(a=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[a]=0,e.opt_len--,o&&(e.static_len-=s[2*a+1]);for(t.max_code=l,r=e.heap_len>>1;r>=1;r--)lt(e,i,r);a=u;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],lt(e,i,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,i[2*a]=i[2*r]+i[2*n],e.depth[a]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,i[2*r+1]=i[2*n+1]=a,e.heap[1]=a++,lt(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,a,i,s,o,u=t.dyn_tree,l=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,v=t.stat_desc.max_length,p=0;for(i=0;i<=Re;i++)e.bl_count[i]=0;for(u[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<573;r++)(i=u[2*u[2*(n=e.heap[r])+1]+1]+1)>v&&(i=v,p++),u[2*n+1]=i,n>l||(e.bl_count[i]++,s=0,n>=d&&(s=f[n-d]),o=u[2*n],e.opt_len+=o*(i+s),h&&(e.static_len+=o*(c[2*n+1]+s)));if(0!==p){do{for(i=v-1;0===e.bl_count[i];)i--;e.bl_count[i]--,e.bl_count[i+1]+=2,e.bl_count[v]--,p-=2}while(p>0);for(i=v;0!==i;i--)for(n=e.bl_count[i];0!==n;)(a=e.heap[--r])>l||(u[2*a+1]!==i&&(e.opt_len+=(i-u[2*a+1])*u[2*a],u[2*a+1]=i),n--)}}(e,t),it(i,l,e.bl_count)},ft=function(e,t,r){var n,a,i=-1,s=t[1],o=0,u=7,l=4;for(0===s&&(u=138,l=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)a=s,s=t[2*(n+1)+1],++o<u&&a===s||(o<l?e.bl_tree[2*a]+=o:0!==a?(a!==i&&e.bl_tree[2*a]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,i=a,0===s?(u=138,l=3):a===s?(u=6,l=3):(u=7,l=4))},dt=function(e,t,r){var n,a,i=-1,s=t[1],o=0,u=7,l=4;for(0===s&&(u=138,l=3),n=0;n<=r;n++)if(a=s,s=t[2*(n+1)+1],!(++o<u&&a===s)){if(o<l)do{nt(e,a,e.bl_tree)}while(0!==--o);else 0!==a?(a!==i&&(nt(e,a,e.bl_tree),o--),nt(e,16,e.bl_tree),rt(e,o-3,2)):o<=10?(nt(e,17,e.bl_tree),rt(e,o-3,3)):(nt(e,18,e.bl_tree),rt(e,o-11,7));o=0,i=a,0===s?(u=138,l=3):a===s?(u=6,l=3):(u=7,l=4)}},vt=!1,pt=function(e,t,r,n){rt(e,0+(n?1:0),3),function(e,t,r,n){ot(e),n&&(tt(e,r),tt(e,~r)),e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r}(e,t,r,!0)},mt=function(e,t,r,n){var a,i,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<De;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),ht(e,e.l_desc),ht(e,e.d_desc),s=function(e){var t;for(ft(e,e.dyn_ltree,e.l_desc.max_code),ft(e,e.dyn_dtree,e.d_desc.max_code),ht(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Te[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),a=e.opt_len+3+7>>>3,(i=e.static_len+3+7>>>3)<=a&&(a=i)):a=i=r+5,r+4<=a&&-1!==t?pt(e,t,r,n):4===e.strategy||i===a?(rt(e,2+(n?1:0),3),ct(e,je,qe)):(rt(e,4+(n?1:0),3),function(e,t,r,n){var a;for(rt(e,t-257,5),rt(e,r-1,5),rt(e,n-4,4),a=0;a<n;a++)rt(e,e.bl_tree[2*Te[a]+1],3);dt(e,e.dyn_ltree,t-1),dt(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),ct(e,e.dyn_ltree,e.dyn_dtree)),st(e),n&&ot(e)},gt={_tr_init:function(e){vt||(!function(){var e,t,r,n,a,i=new Array(16);for(r=0,n=0;n<28;n++)for(He[n]=r,e=0;e<1<<Ue[n];e++)Le[r++]=n;for(Le[r-1]=n,a=0,n=0;n<16;n++)for(Xe[n]=a,e=0;e<1<<Qe[n];e++)Pe[a++]=n;for(a>>=7;n<Me;n++)for(Xe[n]=a<<7,e=0;e<1<<Qe[n]-7;e++)Pe[256+a++]=n;for(t=0;t<=Re;t++)i[t]=0;for(e=0;e<=143;)je[2*e+1]=8,e++,i[8]++;for(;e<=255;)je[2*e+1]=9,e++,i[9]++;for(;e<=279;)je[2*e+1]=7,e++,i[7]++;for(;e<=287;)je[2*e+1]=8,e++,i[8]++;for(it(je,287,i),e=0;e<Me;e++)qe[2*e+1]=5,qe[2*e]=at(e,5);Je=new Ke(je,Ue,257,Ne,Re),Ye=new Ke(qe,Qe,0,Me,Re),Ve=new Ke(new Array(0),We,0,19,7)}(),vt=!0),e.l_desc=new $e(e.dyn_ltree,Je),e.d_desc=new $e(e.dyn_dtree,Ye),e.bl_desc=new $e(e.bl_tree,Ve),e.bi_buf=0,e.bi_valid=0,st(e)},_tr_stored_block:pt,_tr_flush_block:mt,_tr_tally:function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(Le[r]+De+1)]++,e.dyn_dtree[2*et(t)]++),e.last_lit===e.lit_bufsize-1},_tr_align:function(e){rt(e,2,3),nt(e,256,je),function(e){16===e.bi_valid?(tt(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},yt=function(e,t,r,n){for(var a=65535&e|0,i=e>>>16&65535|0,s=0;0!==r;){r-=s=r>2e3?2e3:r;do{i=i+(a=a+t[n++]|0)|0}while(--s);a%=65521,i%=65521}return a|i<<16|0},wt=new Uint32Array(function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}()),bt=function(e,t,r,n){var a=wt,i=n+r;e^=-1;for(var s=n;s<i;s++)e=e>>>8^a[255&(e^t[s])];return-1^e},_t={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},kt={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Zt=gt._tr_init,At=gt._tr_stored_block,xt=gt._tr_flush_block,Et=gt._tr_tally,St=gt._tr_align,It=kt.Z_NO_FLUSH,Bt=kt.Z_PARTIAL_FLUSH,zt=kt.Z_FULL_FLUSH,Gt=kt.Z_FINISH,Ft=kt.Z_BLOCK,Ot=kt.Z_OK,Ct=kt.Z_STREAM_END,Dt=kt.Z_STREAM_ERROR,Nt=kt.Z_DATA_ERROR,Mt=kt.Z_BUF_ERROR,Rt=kt.Z_DEFAULT_COMPRESSION,Ut=kt.Z_FILTERED,Qt=kt.Z_HUFFMAN_ONLY,Wt=kt.Z_RLE,Tt=kt.Z_FIXED,jt=kt.Z_DEFAULT_STRATEGY,qt=kt.Z_UNKNOWN,Pt=kt.Z_DEFLATED,Lt=258,Ht=262,Jt=103,Yt=113,Vt=666,Xt=function(e,t){return e.msg=_t[t],t},Kt=function(e){return(e<<1)-(e>4?9:0)},$t=function(e){for(var t=e.length;--t>=0;)e[t]=0},er=function(e,t,r){return(t<<e.hash_shift^r)&e.hash_mask},tr=function(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},rr=function(e,t){xt(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,tr(e.strm)},nr=function(e,t){e.pending_buf[e.pending++]=t},ar=function(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},ir=function(e,t,r,n){var a=e.avail_in;return a>n&&(a=n),0===a?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),r),1===e.state.wrap?e.adler=yt(e.adler,t,a,r):2===e.state.wrap&&(e.adler=bt(e.adler,t,a,r)),e.next_in+=a,e.total_in+=a,a)},sr=function(e,t){var r,n,a=e.max_chain_length,i=e.strstart,s=e.prev_length,o=e.nice_match,u=e.strstart>e.w_size-Ht?e.strstart-(e.w_size-Ht):0,l=e.window,c=e.w_mask,h=e.prev,f=e.strstart+Lt,d=l[i+s-1],v=l[i+s];e.prev_length>=e.good_match&&(a>>=2),o>e.lookahead&&(o=e.lookahead);do{if(l[(r=t)+s]===v&&l[r+s-1]===d&&l[r]===l[i]&&l[++r]===l[i+1]){i+=2,r++;do{}while(l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&i<f);if(n=Lt-(f-i),i=f-Lt,n>s){if(e.match_start=t,s=n,n>=o)break;d=l[i+s-1],v=l[i+s]}}}while((t=h[t&c])>u&&0!==--a);return s<=e.lookahead?s:e.lookahead},or=function(e){var t,r,n,a,i,s=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=s+(s-Ht)){e.window.set(e.window.subarray(s,s+s),0),e.match_start-=s,e.strstart-=s,e.block_start-=s,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=s?n-s:0}while(--r);t=r=s;do{n=e.prev[--t],e.prev[t]=n>=s?n-s:0}while(--r);a+=s}if(0===e.strm.avail_in)break;if(r=ir(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=r,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=er(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=er(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ht&&0!==e.strm.avail_in)},ur=function(e,t){for(var r,n;;){if(e.lookahead<Ht){if(or(e),e.lookahead<Ht&&t===It)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=er(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-Ht&&(e.match_length=sr(e,r)),e.match_length>=3)if(n=Et(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=er(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=er(e,e.ins_h,e.window[e.strstart+1]);else n=Et(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(rr(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Gt?(rr(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(rr(e,!1),0===e.strm.avail_out)?1:2},lr=function(e,t){for(var r,n,a;;){if(e.lookahead<Ht){if(or(e),e.lookahead<Ht&&t===It)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=er(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-Ht&&(e.match_length=sr(e,r),e.match_length<=5&&(e.strategy===Ut||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,n=Et(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=er(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(rr(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((n=Et(e,0,e.window[e.strstart-1]))&&rr(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=Et(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Gt?(rr(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(rr(e,!1),0===e.strm.avail_out)?1:2};function cr(e,t,r,n,a){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=a}var hr=[new cr(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(or(e),0===e.lookahead&&t===It)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,rr(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-Ht&&(rr(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Gt?(rr(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(rr(e,!1),e.strm.avail_out),1)})),new cr(4,4,8,4,ur),new cr(4,5,16,8,ur),new cr(4,6,32,32,ur),new cr(4,4,16,16,lr),new cr(8,16,32,32,lr),new cr(8,16,128,128,lr),new cr(8,32,128,256,lr),new cr(32,128,258,1024,lr),new cr(32,258,258,4096,lr)];function fr(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Pt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),$t(this.dyn_ltree),$t(this.dyn_dtree),$t(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),$t(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),$t(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var dr=function(e){if(!e||!e.state)return Xt(e,Dt);e.total_in=e.total_out=0,e.data_type=qt;var t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:Yt,e.adler=2===t.wrap?0:1,t.last_flush=It,Zt(t),Ot},vr=function(e){var t,r=dr(e);return r===Ot&&((t=e.state).window_size=2*t.w_size,$t(t.head),t.max_lazy_match=hr[t.level].max_lazy,t.good_match=hr[t.level].good_length,t.nice_match=hr[t.level].nice_length,t.max_chain_length=hr[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),r},pr=function(e,t,r,n,a,i){if(!e)return Dt;var s=1;if(t===Rt&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),a<1||a>9||r!==Pt||n<8||n>15||t<0||t>9||i<0||i>Tt)return Xt(e,Dt);8===n&&(n=9);var o=new fr;return e.state=o,o.strm=e,o.wrap=s,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=i,o.method=r,vr(e)},mr={deflateInit:function(e,t){return pr(e,t,Pt,15,8,jt)},deflateInit2:pr,deflateReset:vr,deflateResetKeep:dr,deflateSetHeader:function(e,t){return e&&e.state?2!==e.state.wrap?Dt:(e.state.gzhead=t,Ot):Dt},deflate:function(e,t){var r,n;if(!e||!e.state||t>Ft||t<0)return e?Xt(e,Dt):Dt;var a=e.state;if(!e.output||!e.input&&0!==e.avail_in||a.status===Vt&&t!==Gt)return Xt(e,0===e.avail_out?Mt:Dt);a.strm=e;var i=a.last_flush;if(a.last_flush=t,42===a.status)if(2===a.wrap)e.adler=0,nr(a,31),nr(a,139),nr(a,8),a.gzhead?(nr(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),nr(a,255&a.gzhead.time),nr(a,a.gzhead.time>>8&255),nr(a,a.gzhead.time>>16&255),nr(a,a.gzhead.time>>24&255),nr(a,9===a.level?2:a.strategy>=Qt||a.level<2?4:0),nr(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(nr(a,255&a.gzhead.extra.length),nr(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=bt(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69):(nr(a,0),nr(a,0),nr(a,0),nr(a,0),nr(a,0),nr(a,9===a.level?2:a.strategy>=Qt||a.level<2?4:0),nr(a,3),a.status=Yt);else{var s=Pt+(a.w_bits-8<<4)<<8;s|=(a.strategy>=Qt||a.level<2?0:a.level<6?1:6===a.level?2:3)<<6,0!==a.strstart&&(s|=32),s+=31-s%31,a.status=Yt,ar(a,s),0!==a.strstart&&(ar(a,e.adler>>>16),ar(a,65535&e.adler)),e.adler=1}if(69===a.status)if(a.gzhead.extra){for(r=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>r&&(e.adler=bt(e.adler,a.pending_buf,a.pending-r,r)),tr(e),r=a.pending,a.pending!==a.pending_buf_size));)nr(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>r&&(e.adler=bt(e.adler,a.pending_buf,a.pending-r,r)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=73)}else a.status=73;if(73===a.status)if(a.gzhead.name){r=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>r&&(e.adler=bt(e.adler,a.pending_buf,a.pending-r,r)),tr(e),r=a.pending,a.pending===a.pending_buf_size)){n=1;break}n=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,nr(a,n)}while(0!==n);a.gzhead.hcrc&&a.pending>r&&(e.adler=bt(e.adler,a.pending_buf,a.pending-r,r)),0===n&&(a.gzindex=0,a.status=91)}else a.status=91;if(91===a.status)if(a.gzhead.comment){r=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>r&&(e.adler=bt(e.adler,a.pending_buf,a.pending-r,r)),tr(e),r=a.pending,a.pending===a.pending_buf_size)){n=1;break}n=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,nr(a,n)}while(0!==n);a.gzhead.hcrc&&a.pending>r&&(e.adler=bt(e.adler,a.pending_buf,a.pending-r,r)),0===n&&(a.status=Jt)}else a.status=Jt;if(a.status===Jt&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&tr(e),a.pending+2<=a.pending_buf_size&&(nr(a,255&e.adler),nr(a,e.adler>>8&255),e.adler=0,a.status=Yt)):a.status=Yt),0!==a.pending){if(tr(e),0===e.avail_out)return a.last_flush=-1,Ot}else if(0===e.avail_in&&Kt(t)<=Kt(i)&&t!==Gt)return Xt(e,Mt);if(a.status===Vt&&0!==e.avail_in)return Xt(e,Mt);if(0!==e.avail_in||0!==a.lookahead||t!==It&&a.status!==Vt){var o=a.strategy===Qt?function(e,t){for(var r;;){if(0===e.lookahead&&(or(e),0===e.lookahead)){if(t===It)return 1;break}if(e.match_length=0,r=Et(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(rr(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Gt?(rr(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(rr(e,!1),0===e.strm.avail_out)?1:2}(a,t):a.strategy===Wt?function(e,t){for(var r,n,a,i,s=e.window;;){if(e.lookahead<=Lt){if(or(e),e.lookahead<=Lt&&t===It)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=s[a=e.strstart-1])===s[++a]&&n===s[++a]&&n===s[++a]){i=e.strstart+Lt;do{}while(n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&a<i);e.match_length=Lt-(i-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=Et(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=Et(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(rr(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Gt?(rr(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(rr(e,!1),0===e.strm.avail_out)?1:2}(a,t):hr[a.level].func(a,t);if(3!==o&&4!==o||(a.status=Vt),1===o||3===o)return 0===e.avail_out&&(a.last_flush=-1),Ot;if(2===o&&(t===Bt?St(a):t!==Ft&&(At(a,0,0,!1),t===zt&&($t(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),tr(e),0===e.avail_out))return a.last_flush=-1,Ot}return t!==Gt?Ot:a.wrap<=0?Ct:(2===a.wrap?(nr(a,255&e.adler),nr(a,e.adler>>8&255),nr(a,e.adler>>16&255),nr(a,e.adler>>24&255),nr(a,255&e.total_in),nr(a,e.total_in>>8&255),nr(a,e.total_in>>16&255),nr(a,e.total_in>>24&255)):(ar(a,e.adler>>>16),ar(a,65535&e.adler)),tr(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?Ot:Ct)},deflateEnd:function(e){if(!e||!e.state)return Dt;var t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&t!==Jt&&t!==Yt&&t!==Vt?Xt(e,Dt):(e.state=null,t===Yt?Xt(e,Nt):Ot)},deflateSetDictionary:function(e,t){var r=t.length;if(!e||!e.state)return Dt;var n=e.state,a=n.wrap;if(2===a||1===a&&42!==n.status||n.lookahead)return Dt;if(1===a&&(e.adler=yt(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){0===a&&($t(n.head),n.strstart=0,n.block_start=0,n.insert=0);var i=new Uint8Array(n.w_size);i.set(t.subarray(r-n.w_size,r),0),t=i,r=n.w_size}var s=e.avail_in,o=e.next_in,u=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,or(n);n.lookahead>=3;){var l=n.strstart,c=n.lookahead-2;do{n.ins_h=er(n,n.ins_h,n.window[l+3-1]),n.prev[l&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=l,l++}while(--c);n.strstart=l,n.lookahead=2,or(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=o,e.input=u,e.avail_in=s,n.wrap=a,Ot},deflateInfo:"pako deflate (from Nodeca project)"},gr=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},yr=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!==typeof r)throw new TypeError(r+"must be non-object");for(var n in r)gr(r,n)&&(e[n]=r[n])}}return e},wr=function(e){for(var t=0,r=0,n=e.length;r<n;r++)t+=e[r].length;for(var a=new Uint8Array(t),i=0,s=0,o=e.length;i<o;i++){var u=e[i];a.set(u,s),s+=u.length}return a},br=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(su){br=!1}for(var _r=new Uint8Array(256),kr=0;kr<256;kr++)_r[kr]=kr>=252?6:kr>=248?5:kr>=240?4:kr>=224?3:kr>=192?2:1;_r[254]=_r[254]=1;var Zr=function(e){if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);var t,r,n,a,i,s=e.length,o=0;for(a=0;a<s;a++)55296===(64512&(r=e.charCodeAt(a)))&&a+1<s&&56320===(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(o),i=0,a=0;i<o;a++)55296===(64512&(r=e.charCodeAt(a)))&&a+1<s&&56320===(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),r<128?t[i++]=r:r<2048?(t[i++]=192|r>>>6,t[i++]=128|63&r):r<65536?(t[i++]=224|r>>>12,t[i++]=128|r>>>6&63,t[i++]=128|63&r):(t[i++]=240|r>>>18,t[i++]=128|r>>>12&63,t[i++]=128|r>>>6&63,t[i++]=128|63&r);return t},Ar=function(e,t){var r,n,a=t||e.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));var i=new Array(2*a);for(n=0,r=0;r<a;){var s=e[r++];if(s<128)i[n++]=s;else{var o=_r[s];if(o>4)i[n++]=65533,r+=o-1;else{for(s&=2===o?31:3===o?15:7;o>1&&r<a;)s=s<<6|63&e[r++],o--;o>1?i[n++]=65533:s<65536?i[n++]=s:(s-=65536,i[n++]=55296|s>>10&1023,i[n++]=56320|1023&s)}}}return function(e,t){if(t<65534&&e.subarray&&br)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}(i,n)},xr=function(e,t){(t=t||e.length)>e.length&&(t=e.length);for(var r=t-1;r>=0&&128===(192&e[r]);)r--;return r<0||0===r?t:r+_r[e[r]]>t?r:t};var Er=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Sr=Object.prototype.toString,Ir=kt.Z_NO_FLUSH,Br=kt.Z_SYNC_FLUSH,zr=kt.Z_FULL_FLUSH,Gr=kt.Z_FINISH,Fr=kt.Z_OK,Or=kt.Z_STREAM_END,Cr=kt.Z_DEFAULT_COMPRESSION,Dr=kt.Z_DEFAULT_STRATEGY,Nr=kt.Z_DEFLATED;function Mr(e){this.options=yr({level:Cr,method:Nr,chunkSize:16384,windowBits:15,memLevel:8,strategy:Dr},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Er,this.strm.avail_out=0;var r=mr.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Fr)throw new Error(_t[r]);if(t.header&&mr.deflateSetHeader(this.strm,t.header),t.dictionary){var n;if(n="string"===typeof t.dictionary?Zr(t.dictionary):"[object ArrayBuffer]"===Sr.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=mr.deflateSetDictionary(this.strm,n))!==Fr)throw new Error(_t[r]);this._dict_set=!0}}Mr.prototype.push=function(e,t){var r,n,a=this.strm,i=this.options.chunkSize;if(this.ended)return!1;for(n=t===~~t?t:!0===t?Gr:Ir,"string"===typeof e?a.input=Zr(e):"[object ArrayBuffer]"===Sr.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;)if(0===a.avail_out&&(a.output=new Uint8Array(i),a.next_out=0,a.avail_out=i),(n===Br||n===zr)&&a.avail_out<=6)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else{if((r=mr.deflate(a,n))===Or)return a.next_out>0&&this.onData(a.output.subarray(0,a.next_out)),r=mr.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Fr;if(0!==a.avail_out){if(n>0&&a.next_out>0)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else if(0===a.avail_in)break}else this.onData(a.output)}return!0},Mr.prototype.onData=function(e){this.chunks.push(e)},Mr.prototype.onEnd=function(e){e===Fr&&(this.result=wr(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Rr=function(e,t){var r,n,a,i,s,o,u,l,c,h,f,d,v,p,m,g,y,w,b,_,k,Z,A,x,E=e.state;r=e.next_in,A=e.input,n=r+(e.avail_in-5),a=e.next_out,x=e.output,i=a-(t-e.avail_out),s=a+(e.avail_out-257),o=E.dmax,u=E.wsize,l=E.whave,c=E.wnext,h=E.window,f=E.hold,d=E.bits,v=E.lencode,p=E.distcode,m=(1<<E.lenbits)-1,g=(1<<E.distbits)-1;e:do{d<15&&(f+=A[r++]<<d,d+=8,f+=A[r++]<<d,d+=8),y=v[f&m];t:for(;;){if(f>>>=w=y>>>24,d-=w,0===(w=y>>>16&255))x[a++]=65535&y;else{if(!(16&w)){if(0===(64&w)){y=v[(65535&y)+(f&(1<<w)-1)];continue t}if(32&w){E.mode=12;break e}e.msg="invalid literal/length code",E.mode=30;break e}b=65535&y,(w&=15)&&(d<w&&(f+=A[r++]<<d,d+=8),b+=f&(1<<w)-1,f>>>=w,d-=w),d<15&&(f+=A[r++]<<d,d+=8,f+=A[r++]<<d,d+=8),y=p[f&g];r:for(;;){if(f>>>=w=y>>>24,d-=w,!(16&(w=y>>>16&255))){if(0===(64&w)){y=p[(65535&y)+(f&(1<<w)-1)];continue r}e.msg="invalid distance code",E.mode=30;break e}if(_=65535&y,d<(w&=15)&&(f+=A[r++]<<d,(d+=8)<w&&(f+=A[r++]<<d,d+=8)),(_+=f&(1<<w)-1)>o){e.msg="invalid distance too far back",E.mode=30;break e}if(f>>>=w,d-=w,_>(w=a-i)){if((w=_-w)>l&&E.sane){e.msg="invalid distance too far back",E.mode=30;break e}if(k=0,Z=h,0===c){if(k+=u-w,w<b){b-=w;do{x[a++]=h[k++]}while(--w);k=a-_,Z=x}}else if(c<w){if(k+=u+c-w,(w-=c)<b){b-=w;do{x[a++]=h[k++]}while(--w);if(k=0,c<b){b-=w=c;do{x[a++]=h[k++]}while(--w);k=a-_,Z=x}}}else if(k+=c-w,w<b){b-=w;do{x[a++]=h[k++]}while(--w);k=a-_,Z=x}for(;b>2;)x[a++]=Z[k++],x[a++]=Z[k++],x[a++]=Z[k++],b-=3;b&&(x[a++]=Z[k++],b>1&&(x[a++]=Z[k++]))}else{k=a-_;do{x[a++]=x[k++],x[a++]=x[k++],x[a++]=x[k++],b-=3}while(b>2);b&&(x[a++]=x[k++],b>1&&(x[a++]=x[k++]))}break}}break}}while(r<n&&a<s);r-=b=d>>3,f&=(1<<(d-=b<<3))-1,e.next_in=r,e.next_out=a,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=a<s?s-a+257:257-(a-s),E.hold=f,E.bits=d},Ur=15,Qr=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Wr=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Tr=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),jr=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),qr=function(e,t,r,n,a,i,s,o){var u,l,c,h,f,d,v,p,m,g=o.bits,y=0,w=0,b=0,_=0,k=0,Z=0,A=0,x=0,E=0,S=0,I=null,B=0,z=new Uint16Array(16),G=new Uint16Array(16),F=null,O=0;for(y=0;y<=Ur;y++)z[y]=0;for(w=0;w<n;w++)z[t[r+w]]++;for(k=g,_=Ur;_>=1&&0===z[_];_--);if(k>_&&(k=_),0===_)return a[i++]=20971520,a[i++]=20971520,o.bits=1,0;for(b=1;b<_&&0===z[b];b++);for(k<b&&(k=b),x=1,y=1;y<=Ur;y++)if(x<<=1,(x-=z[y])<0)return-1;if(x>0&&(0===e||1!==_))return-1;for(G[1]=0,y=1;y<Ur;y++)G[y+1]=G[y]+z[y];for(w=0;w<n;w++)0!==t[r+w]&&(s[G[t[r+w]]++]=w);if(0===e?(I=F=s,d=19):1===e?(I=Qr,B-=257,F=Wr,O-=257,d=256):(I=Tr,F=jr,d=-1),S=0,w=0,y=b,f=i,Z=k,A=0,c=-1,h=(E=1<<k)-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){v=y-A,s[w]<d?(p=0,m=s[w]):s[w]>d?(p=F[O+s[w]],m=I[B+s[w]]):(p=96,m=0),u=1<<y-A,b=l=1<<Z;do{a[f+(S>>A)+(l-=u)]=v<<24|p<<16|m|0}while(0!==l);for(u=1<<y-1;S&u;)u>>=1;if(0!==u?(S&=u-1,S+=u):S=0,w++,0===--z[y]){if(y===_)break;y=t[r+s[w]]}if(y>k&&(S&h)!==c){for(0===A&&(A=k),f+=b,x=1<<(Z=y-A);Z+A<_&&!((x-=z[Z+A])<=0);)Z++,x<<=1;if(E+=1<<Z,1===e&&E>852||2===e&&E>592)return 1;a[c=S&h]=k<<24|Z<<16|f-i|0}}return 0!==S&&(a[f+S]=y-A<<24|64<<16|0),o.bits=k,0},Pr=kt.Z_FINISH,Lr=kt.Z_BLOCK,Hr=kt.Z_TREES,Jr=kt.Z_OK,Yr=kt.Z_STREAM_END,Vr=kt.Z_NEED_DICT,Xr=kt.Z_STREAM_ERROR,Kr=kt.Z_DATA_ERROR,$r=kt.Z_MEM_ERROR,en=kt.Z_BUF_ERROR,tn=kt.Z_DEFLATED,rn=12,nn=30,an=function(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)};function sn(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var on,un,ln=function(e){if(!e||!e.state)return Xr;var t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Jr},cn=function(e){if(!e||!e.state)return Xr;var t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,ln(e)},hn=function(e,t){var r;if(!e||!e.state)return Xr;var n=e.state;return t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Xr:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,cn(e))},fn=function(e,t){if(!e)return Xr;var r=new sn;e.state=r,r.window=null;var n=hn(e,t);return n!==Jr&&(e.state=null),n},dn=!0,vn=function(e){if(dn){on=new Int32Array(512),un=new Int32Array(32);for(var t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(qr(1,e.lens,0,288,on,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;qr(2,e.lens,0,32,un,0,e.work,{bits:5}),dn=!1}e.lencode=on,e.lenbits=9,e.distcode=un,e.distbits=5},pn=function(e,t,r,n){var a,i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),n>=i.wsize?(i.window.set(t.subarray(r-i.wsize,r),0),i.wnext=0,i.whave=i.wsize):((a=i.wsize-i.wnext)>n&&(a=n),i.window.set(t.subarray(r-n,r-n+a),i.wnext),(n-=a)?(i.window.set(t.subarray(r-n,r),0),i.wnext=n,i.whave=i.wsize):(i.wnext+=a,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=a))),0},mn={inflateReset:cn,inflateReset2:hn,inflateResetKeep:ln,inflateInit:function(e){return fn(e,15)},inflateInit2:fn,inflate:function(e,t){var r,n,a,i,s,o,u,l,c,h,f,d,v,p,m,g,y,w,b,_,k,Z,A,x,E=0,S=new Uint8Array(4),I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return Xr;(r=e.state).mode===rn&&(r.mode=13),s=e.next_out,a=e.output,u=e.avail_out,i=e.next_in,n=e.input,o=e.avail_in,l=r.hold,c=r.bits,h=o,f=u,Z=Jr;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;c<16;){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}if(2&r.wrap&&35615===l){r.check=0,S[0]=255&l,S[1]=l>>>8&255,r.check=bt(r.check,S,2,0),l=0,c=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",r.mode=nn;break}if((15&l)!==tn){e.msg="unknown compression method",r.mode=nn;break}if(c-=4,k=8+(15&(l>>>=4)),0===r.wbits)r.wbits=k;else if(k>r.wbits){e.msg="invalid window size",r.mode=nn;break}r.dmax=1<<r.wbits,e.adler=r.check=1,r.mode=512&l?10:rn,l=0,c=0;break;case 2:for(;c<16;){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}if(r.flags=l,(255&r.flags)!==tn){e.msg="unknown compression method",r.mode=nn;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=nn;break}r.head&&(r.head.text=l>>8&1),512&r.flags&&(S[0]=255&l,S[1]=l>>>8&255,r.check=bt(r.check,S,2,0)),l=0,c=0,r.mode=3;case 3:for(;c<32;){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}r.head&&(r.head.time=l),512&r.flags&&(S[0]=255&l,S[1]=l>>>8&255,S[2]=l>>>16&255,S[3]=l>>>24&255,r.check=bt(r.check,S,4,0)),l=0,c=0,r.mode=4;case 4:for(;c<16;){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}r.head&&(r.head.xflags=255&l,r.head.os=l>>8),512&r.flags&&(S[0]=255&l,S[1]=l>>>8&255,r.check=bt(r.check,S,2,0)),l=0,c=0,r.mode=5;case 5:if(1024&r.flags){for(;c<16;){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}r.length=l,r.head&&(r.head.extra_len=l),512&r.flags&&(S[0]=255&l,S[1]=l>>>8&255,r.check=bt(r.check,S,2,0)),l=0,c=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((d=r.length)>o&&(d=o),d&&(r.head&&(k=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(i,i+d),k)),512&r.flags&&(r.check=bt(r.check,n,d,i)),o-=d,i+=d,r.length-=d),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===o)break e;d=0;do{k=n[i+d++],r.head&&k&&r.length<65536&&(r.head.name+=String.fromCharCode(k))}while(k&&d<o);if(512&r.flags&&(r.check=bt(r.check,n,d,i)),o-=d,i+=d,k)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===o)break e;d=0;do{k=n[i+d++],r.head&&k&&r.length<65536&&(r.head.comment+=String.fromCharCode(k))}while(k&&d<o);if(512&r.flags&&(r.check=bt(r.check,n,d,i)),o-=d,i+=d,k)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;c<16;){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}if(l!==(65535&r.check)){e.msg="header crc mismatch",r.mode=nn;break}l=0,c=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=rn;break;case 10:for(;c<32;){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}e.adler=r.check=an(l),l=0,c=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=s,e.avail_out=u,e.next_in=i,e.avail_in=o,r.hold=l,r.bits=c,Vr;e.adler=r.check=1,r.mode=rn;case rn:if(t===Lr||t===Hr)break e;case 13:if(r.last){l>>>=7&c,c-=7&c,r.mode=27;break}for(;c<3;){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}switch(r.last=1&l,c-=1,3&(l>>>=1)){case 0:r.mode=14;break;case 1:if(vn(r),r.mode=20,t===Hr){l>>>=2,c-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=nn}l>>>=2,c-=2;break;case 14:for(l>>>=7&c,c-=7&c;c<32;){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}if((65535&l)!==(l>>>16^65535)){e.msg="invalid stored block lengths",r.mode=nn;break}if(r.length=65535&l,l=0,c=0,r.mode=15,t===Hr)break e;case 15:r.mode=16;case 16:if(d=r.length){if(d>o&&(d=o),d>u&&(d=u),0===d)break e;a.set(n.subarray(i,i+d),s),o-=d,i+=d,u-=d,s+=d,r.length-=d;break}r.mode=rn;break;case 17:for(;c<14;){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}if(r.nlen=257+(31&l),l>>>=5,c-=5,r.ndist=1+(31&l),l>>>=5,c-=5,r.ncode=4+(15&l),l>>>=4,c-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=nn;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;c<3;){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}r.lens[I[r.have++]]=7&l,l>>>=3,c-=3}for(;r.have<19;)r.lens[I[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,A={bits:r.lenbits},Z=qr(0,r.lens,0,19,r.lencode,0,r.work,A),r.lenbits=A.bits,Z){e.msg="invalid code lengths set",r.mode=nn;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;g=(E=r.lencode[l&(1<<r.lenbits)-1])>>>16&255,y=65535&E,!((m=E>>>24)<=c);){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}if(y<16)l>>>=m,c-=m,r.lens[r.have++]=y;else{if(16===y){for(x=m+2;c<x;){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}if(l>>>=m,c-=m,0===r.have){e.msg="invalid bit length repeat",r.mode=nn;break}k=r.lens[r.have-1],d=3+(3&l),l>>>=2,c-=2}else if(17===y){for(x=m+3;c<x;){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}c-=m,k=0,d=3+(7&(l>>>=m)),l>>>=3,c-=3}else{for(x=m+7;c<x;){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}c-=m,k=0,d=11+(127&(l>>>=m)),l>>>=7,c-=7}if(r.have+d>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=nn;break}for(;d--;)r.lens[r.have++]=k}}if(r.mode===nn)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=nn;break}if(r.lenbits=9,A={bits:r.lenbits},Z=qr(1,r.lens,0,r.nlen,r.lencode,0,r.work,A),r.lenbits=A.bits,Z){e.msg="invalid literal/lengths set",r.mode=nn;break}if(r.distbits=6,r.distcode=r.distdyn,A={bits:r.distbits},Z=qr(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,A),r.distbits=A.bits,Z){e.msg="invalid distances set",r.mode=nn;break}if(r.mode=20,t===Hr)break e;case 20:r.mode=21;case 21:if(o>=6&&u>=258){e.next_out=s,e.avail_out=u,e.next_in=i,e.avail_in=o,r.hold=l,r.bits=c,Rr(e,f),s=e.next_out,a=e.output,u=e.avail_out,i=e.next_in,n=e.input,o=e.avail_in,l=r.hold,c=r.bits,r.mode===rn&&(r.back=-1);break}for(r.back=0;g=(E=r.lencode[l&(1<<r.lenbits)-1])>>>16&255,y=65535&E,!((m=E>>>24)<=c);){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}if(g&&0===(240&g)){for(w=m,b=g,_=y;g=(E=r.lencode[_+((l&(1<<w+b)-1)>>w)])>>>16&255,y=65535&E,!(w+(m=E>>>24)<=c);){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}l>>>=w,c-=w,r.back+=w}if(l>>>=m,c-=m,r.back+=m,r.length=y,0===g){r.mode=26;break}if(32&g){r.back=-1,r.mode=rn;break}if(64&g){e.msg="invalid literal/length code",r.mode=nn;break}r.extra=15&g,r.mode=22;case 22:if(r.extra){for(x=r.extra;c<x;){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}r.length+=l&(1<<r.extra)-1,l>>>=r.extra,c-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;g=(E=r.distcode[l&(1<<r.distbits)-1])>>>16&255,y=65535&E,!((m=E>>>24)<=c);){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}if(0===(240&g)){for(w=m,b=g,_=y;g=(E=r.distcode[_+((l&(1<<w+b)-1)>>w)])>>>16&255,y=65535&E,!(w+(m=E>>>24)<=c);){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}l>>>=w,c-=w,r.back+=w}if(l>>>=m,c-=m,r.back+=m,64&g){e.msg="invalid distance code",r.mode=nn;break}r.offset=y,r.extra=15&g,r.mode=24;case 24:if(r.extra){for(x=r.extra;c<x;){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}r.offset+=l&(1<<r.extra)-1,l>>>=r.extra,c-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=nn;break}r.mode=25;case 25:if(0===u)break e;if(d=f-u,r.offset>d){if((d=r.offset-d)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=nn;break}d>r.wnext?(d-=r.wnext,v=r.wsize-d):v=r.wnext-d,d>r.length&&(d=r.length),p=r.window}else p=a,v=s-r.offset,d=r.length;d>u&&(d=u),u-=d,r.length-=d;do{a[s++]=p[v++]}while(--d);0===r.length&&(r.mode=21);break;case 26:if(0===u)break e;a[s++]=r.length,u--,r.mode=21;break;case 27:if(r.wrap){for(;c<32;){if(0===o)break e;o--,l|=n[i++]<<c,c+=8}if(f-=u,e.total_out+=f,r.total+=f,f&&(e.adler=r.check=r.flags?bt(r.check,a,f,s-f):yt(r.check,a,f,s-f)),f=u,(r.flags?l:an(l))!==r.check){e.msg="incorrect data check",r.mode=nn;break}l=0,c=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;c<32;){if(0===o)break e;o--,l+=n[i++]<<c,c+=8}if(l!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=nn;break}l=0,c=0}r.mode=29;case 29:Z=Yr;break e;case nn:Z=Kr;break e;case 31:return $r;default:return Xr}return e.next_out=s,e.avail_out=u,e.next_in=i,e.avail_in=o,r.hold=l,r.bits=c,(r.wsize||f!==e.avail_out&&r.mode<nn&&(r.mode<27||t!==Pr))&&pn(e,e.output,e.next_out,f-e.avail_out),h-=e.avail_in,f-=e.avail_out,e.total_in+=h,e.total_out+=f,r.total+=f,r.wrap&&f&&(e.adler=r.check=r.flags?bt(r.check,a,f,e.next_out-f):yt(r.check,a,f,e.next_out-f)),e.data_type=r.bits+(r.last?64:0)+(r.mode===rn?128:0)+(20===r.mode||15===r.mode?256:0),(0===h&&0===f||t===Pr)&&Z===Jr&&(Z=en),Z},inflateEnd:function(e){if(!e||!e.state)return Xr;var t=e.state;return t.window&&(t.window=null),e.state=null,Jr},inflateGetHeader:function(e,t){if(!e||!e.state)return Xr;var r=e.state;return 0===(2&r.wrap)?Xr:(r.head=t,t.done=!1,Jr)},inflateSetDictionary:function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?Xr:11===r.mode&&yt(1,t,n,0)!==r.check?Kr:pn(e,t,n,n)?(r.mode=31,$r):(r.havedict=1,Jr):Xr},inflateInfo:"pako inflate (from Nodeca project)"};var gn=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},yn=Object.prototype.toString,wn=kt.Z_NO_FLUSH,bn=kt.Z_FINISH,_n=kt.Z_OK,kn=kt.Z_STREAM_END,Zn=kt.Z_NEED_DICT,An=kt.Z_STREAM_ERROR,xn=kt.Z_DATA_ERROR,En=kt.Z_MEM_ERROR;function Sn(e){this.options=yr({chunkSize:65536,windowBits:15,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Er,this.strm.avail_out=0;var r=mn.inflateInit2(this.strm,t.windowBits);if(r!==_n)throw new Error(_t[r]);if(this.header=new gn,mn.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"===typeof t.dictionary?t.dictionary=Zr(t.dictionary):"[object ArrayBuffer]"===yn.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=mn.inflateSetDictionary(this.strm,t.dictionary))!==_n))throw new Error(_t[r])}function In(e,t){var r=new Sn(t);if(r.push(e),r.err)throw r.msg||_t[r.err];return r.result}Sn.prototype.push=function(e,t){var r,n,a,i=this.strm,s=this.options.chunkSize,o=this.options.dictionary;if(this.ended)return!1;for(n=t===~~t?t:!0===t?bn:wn,"[object ArrayBuffer]"===yn.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),(r=mn.inflate(i,n))===Zn&&o&&((r=mn.inflateSetDictionary(i,o))===_n?r=mn.inflate(i,n):r===xn&&(r=Zn));i.avail_in>0&&r===kn&&i.state.wrap>0&&0!==e[i.next_in];)mn.inflateReset(i),r=mn.inflate(i,n);switch(r){case An:case xn:case Zn:case En:return this.onEnd(r),this.ended=!0,!1}if(a=i.avail_out,i.next_out&&(0===i.avail_out||r===kn))if("string"===this.options.to){var u=xr(i.output,i.next_out),l=i.next_out-u,c=Ar(i.output,u);i.next_out=l,i.avail_out=s-l,l&&i.output.set(i.output.subarray(u,u+l),0),this.onData(c)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(r!==_n||0!==a){if(r===kn)return r=mn.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},Sn.prototype.onData=function(e){this.chunks.push(e)},Sn.prototype.onEnd=function(e){e===_n&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=wr(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Bn={Inflate:Sn,inflate:In,inflateRaw:function(e,t){return(t=t||{}).raw=!0,In(e,t)},ungzip:In,constants:kt},zn=Bn.ungzip;var Gn=new WeakMap,Fn=function(){function e(t){if((0,b.Z)(this,e),(0,k.Z)(this,Gn,{writable:!0,value:void 0}),t instanceof File){var r=new FileReaderSync;(0,A.Z)(this,Gn,r.readAsArrayBuffer(t))}else{if(!(t instanceof ArrayBuffer))throw"unknown type '"+typeof t+"' for LoadedFile constructor";(0,A.Z)(this,Gn,t)}}return(0,_.Z)(e,[{key:"buffer",value:function(){return(0,Z.Z)(this,Gn)}},{key:"size",value:function(){return(0,Z.Z)(this,Gn).byteLength}},{key:"serialized",value:function(){return(0,Z.Z)(this,Gn)}}]),e}();function On(e){l.ki(e)&&l.Yd(e)}function Cn(e){var t="temp_"+String(Number(new Date))+".h5";return l.NC(t,new Uint8Array(e.buffer())),t}function Dn(e,t){if(!(t in e.children))return null;if("DataSet"!==e.children[t])return null;var r=e.open(t);return"String"!==r.type?null:r.load()}function Nn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"gz",r=e;"gz"==t&&(r=zn(e));var n=new TextDecoder,a=n.decode(r),i=a.split("\n");return i.length>0&&""==i[i.length-1]&&i.pop(),i}function Mn(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"\t",n=t.name.split(".").pop(),a=Nn(e,n);return a.forEach((function(e,t){a[t]=e.split(r)})),a}function Rn(e){if(null===e.genes){var t=[];if(e.matrix.isReorganized()){var r,n=e.matrix.identities(),a=(0,x.Z)(n);try{for(a.s();!(r=a.n()).done;){var i=r.value;t.push("Gene ".concat(i+1))}}catch(Xt){a.e(Xt)}finally{a.f()}}else for(var s=0;s<e.matrix.numberOfRows();s++)t.push("Gene ".concat(s+1));e.genes={id:t}}else e.matrix.isReorganized()&&L(e.matrix,e.genes)}var Un={file2link:null,link2file:null};function Qn(e){var t=Un.file2link;return Un.file2link=e,t}function Wn(e){var t=Un.link2file;return Un.link2file=e,t}function Tn(e,t,r){return jn.apply(this,arguments)}function jn(){return(jn=(0,o.Z)(u.mark((function e(t,r,n){var a,i,s,o;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={type:r,name:t.name},i=t.content.serialized(),null===n){e.next=10;break}return e.next=5,n(i,t.content.size());case 5:s=e.sent,a.offset=s.offset,a.size=s.size,e.next=16;break;case 10:if(null!==(o=Un.file2link)){e.next=13;break}throw new Error("link-creating function has not been set by 'setCreateLink'");case 13:return e.next=15,o(r,t.name,i);case 15:a.id=e.sent;case 16:return e.abrupt("return",a);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qn(e,t){return Pn.apply(this,arguments)}function Pn(){return(Pn=(0,o.Z)(u.mark((function e(t,r){var n,a;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={name:t.name},!("id"in t)){e.next=12;break}if(null!==(a=Un.link2file)){e.next=5;break}throw new Error("link-resolving function has not been set by 'setResolveLink'");case 5:return e.t0=Fn,e.next=8,a(t.id);case 8:e.t1=e.sent,n.content=new e.t0(e.t1),e.next=17;break;case 12:return e.t2=Fn,e.next=15,r(t.offset,t.size);case 15:e.t3=e.sent,n.content=new e.t2(e.t3);case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ln(e,t){var r,n={name:(r=e,r.name)};return t?n.size=function(e){return e.size}(e):n.content=new Fn(e),n}function Hn(e){if(null!==e.genes&&"type"in e.genes){var t=[],r=e.genes.type,n=new Uint8Array(r.length),a={};if(r.forEach((function(e,r){var i=e.match(/gene expression/i);n[r]=i,i?t.push(r):(e in a||(a[e]=[]),a[e].push(r))})),0!=t.length){for(var i,o=null,u=0,h=Object.keys(a);u<h.length;u++){var f=h[u];f.match(/antibody capture/i)&&(o=f)}if(null!==o){var d,v,p,m,g,y;null===e.annotations&&(e.annotations={});try{g=function(e,t){var r,n,a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.center,o=void 0===s||s,u=i.buffer,h=void 0===u?null:u,f=i.priorCount,d=void 0===f?10:f,v=i.reference,p=void 0===v?null:v;try{if(h instanceof V.lt){if(h.length!==e.numberOfColumns())throw new Error("length of 'buffer' must be equal to the number of columns in 'x'");n=h}else r=c.RJ(e.numberOfColumns()),n=r;a=c.de(t,"Int32WasmArray"),null==p&&(p=-1),l.RE((function(t){return t.grouped_size_factors(e.matrix,a.offset,o,d,p,n.offset)}))}catch(m){throw c.gd(r),m}finally{c.gd(a)}return n}(d=Ze(e.matrix,a[o]),(m=ce(p=re(v=$(d),{numberOfPCs:Math.min(v.numberOfRows()-1,25)}),20)).clusters({copy:"view"})),y=$(d,{sizeFactors:g});for(var w=0,b=Object.entries(a[o]);w<b.length;w++){var _=(0,s.Z)(b[w],2),k=_[0],Z=_[1];e.annotations[o+": "+e.genes.id[Z]]=y.row(k)}}finally{Ge(d),Ge(v),Ge(p),Ge(m),Ge(g),Ge(y)}}try{i=Ze(e.matrix,t),Ge(e.matrix),e.matrix=i}catch(A){throw Ge(i),A}L(t,e.genes)}}}function Jn(e){return{format:"10X",h5:Ln(e.h5,!0)}}function Yn(e){var t=null;if(!("matrix"in e.children)||"Group"!=e.children.matrix)throw new Error("expected a 'matrix' group at the top level of the file");var r=e.open("matrix");if("features"in r.children&&"Group"==r.children.features){var n=r.open("features"),a=Dn(n,"id");if(null!==a){t={id:a};var i=Dn(n,"name");null!==i&&(t.name=i);var s=Dn(n,"feature_type");null!==s&&(t.type=s)}}return t}function Vn(e){var t={},r=Cn(Ln(e.h5,!1).content);try{var n=new N(r);t.genes=Yn(n),t.annotations=null}finally{On(r)}return t}var Xn=new WeakMap,Kn=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,b.Z)(this,e),(0,k.Z)(this,Xn,{writable:!0,value:void 0}),r?(0,A.Z)(this,Xn,t):(0,A.Z)(this,Xn,Ln(t.h5,!1))}return(0,_.Z)(e,[{key:"load",value:function(){var e={},t=Cn((0,Z.Z)(this,Xn).content);try{e.matrix=f(t,"matrix");var r=new N(t);e.genes=Yn(r),e.annotations=null,Rn(e),Hn(e)}catch(n){throw Ge(e.matrix),n}finally{On(t)}return e}},{key:"format",value:function(){return"10X"}},{key:"serialize",value:function(){var e=(0,o.Z)(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Tn((0,Z.Z)(this,Xn),"h5",t);case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function $n(e,t){return ea.apply(this,arguments)}function ea(){return(ea=(0,o.Z)(u.mark((function e(t,r){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Kn,e.next=3,qn(t[0],r);case 3:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1,!0));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ta(e){return{format:"H5AD",h5:Ln(e.h5,!0)}}function ra(e){var t=null;if("var"in e.children&&"Group"==e.children.var){var r=e.open("var"),n=Dn(r,"_index");if(null!==n){t={_index:n};for(var a=0,i=Object.entries(r.children);a<i.length;a++){var o=(0,s.Z)(i[a],2),u=o[0];if("DataSet"===o[1]&&(u.match(/name/i)||u.match(/symb/i))){var l=r.open(u);"String"==l.type&&(t[u]=l.load())}}}}return t}function na(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.namesOnly,n=void 0!==r&&r,a=null;if("obs"in e.children&&"Group"==e.children.obs){var i=e.open("obs");a={};var o=Dn(i,"_index");null!==o&&(a._index=o);for(var u=0,l=Object.entries(i.children);u<l.length;u++){var c=(0,s.Z)(l[u],2),h=c[0],f=c[1];if("DataSet"==f){var d=i.open(h);"Other"!=d.type&&(a[h]=n?null:d.load())}}if(!n&&"__categories"in i.children&&"Group"==i.children.__categories)for(var v=i.open("__categories"),p=0,m=Object.entries(v.children);p<m.length;p++){var g=(0,s.Z)(m[p],2),y=g[0];g[1];if(y in a){var w=Dn(v,y);if(null!==w.type){var b=a[y];a[y]={type:"factor",index:b,levels:w}}}}}return n&&null!==a?Object.keys(a):a}function aa(e){var t={},r=Cn(Ln(e.h5,!1).content);try{var n=new N(r);t.genes=ra(n);var a=na(n,{load:!1});t.annotations=Object.keys(a)}finally{On(r)}return t}var ia=new WeakMap,sa=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,b.Z)(this,e),(0,k.Z)(this,ia,{writable:!0,value:void 0}),r?(0,A.Z)(this,ia,t):(0,A.Z)(this,ia,Ln(t.h5,!1))}return(0,_.Z)(e,[{key:"load",value:function(){var e={},t=Cn((0,Z.Z)(this,ia).content);try{e.matrix=f(t,"X");var r=new N(t);e.genes=ra(r),e.annotations=na(r),Rn(e)}catch(n){throw Ge(e.matrix),n}finally{On(t)}return e}},{key:"format",value:function(){return"H5AD"}},{key:"serialize",value:function(){var e=(0,o.Z)(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Tn((0,Z.Z)(this,ia),"h5",t);case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function oa(e,t){return ua.apply(this,arguments)}function ua(){return(ua=(0,o.Z)(u.mark((function e(t,r){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=sa,e.next=3,qn(t[0],r);case 3:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1,!0));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function la(e){var t={format:"MatrixMarket",mtx:Ln(e.mtx,!0)};return"genes"in e&&(t.genes=Ln(e.genes,!0)),"annotations"in e&&(t.annotations=Ln(e.annotations,!0)),t}function ca(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.numberOfRows,n=void 0===r?null:r,a=t.includeFeatureType,i=void 0!==a&&a,s=new Uint8Array(e.content.buffer()),o=Mn(s,e);if(null!==n&&o.length!==n)throw new Error("number of matrix rows is not equal to the number of genes in '"+e.name+"'");var u=[],l=[];o.forEach((function(e){u.push(e[0]),l.push(e[1])}));var c={id:u,symbol:l};if(i&&o[0].length>=3){var h=[];o.forEach((function(e){h.push(e[2])})),c.type=h}return c}function ha(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.numberOfColumns,a=void 0===n?null:n,i=r.namesOnly,s=void 0!==i&&i,o=new Uint8Array(e.content.buffer()),u=Mn(o,e),l=!0;if(null!==a){var c=a-u.length;if(0===c)l=!1;else if(-1!==c)throw"number of annotations rows is not equal to the number of cells in '"+e.name+"'"}if(t=l?u.shift():u[0],s)return t;var h={};return t.forEach((function(e,t){h[e]=u.map((function(e){return e[t]}))})),h}function fa(e){var t={};if("genes"in e){var r=Ln(e.genes,!1);t.genes=ca(r)}else t.genes=null;if("annotations"in e){var n=Ln(e.annotations,!1);t.annotations=ha(n,{namesOnly:!0})}else t.annotations=null;return t}var da=new WeakMap,va=new WeakMap,pa=new WeakMap,ma=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,b.Z)(this,e),(0,k.Z)(this,da,{writable:!0,value:void 0}),(0,k.Z)(this,va,{writable:!0,value:void 0}),(0,k.Z)(this,pa,{writable:!0,value:void 0}),r?((0,A.Z)(this,da,t.mtx),"genes"in t?(0,A.Z)(this,va,t.genes):(0,A.Z)(this,va,null),"annotations"in t?(0,A.Z)(this,pa,t.annotations):(0,A.Z)(this,pa,null)):((0,A.Z)(this,da,Ln(t.mtx,!1)),"genes"in t?(0,A.Z)(this,va,Ln(t.genes,!1)):(0,A.Z)(this,va,null),"annotations"in t?(0,A.Z)(this,pa,Ln(t.annotations,!1)):(0,A.Z)(this,pa,null))}return(0,_.Z)(e,[{key:"load",value:function(){var e=new Uint8Array((0,Z.Z)(this,da).content.buffer()),t="gz"==(0,Z.Z)(this,da).name.split(".").pop(),r={};try{r.matrix=function(e){var t,r,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).compressed,a=void 0===n?null:n;try{var i=c.de(e,"Uint8WasmArray");if(null===a){var s=i.array();a=s.length>=3&&31==s[0]&&139==s[1]&&8==s[2]}t=l.RE((function(e){return e.read_matrix_market(i.offset,i.length,a)})),r=new h.p(t)}catch(o){throw c.gd(t),o}finally{c.gd(i)}return r}(e,{compressed:t}),null!==(0,Z.Z)(this,va)?r.genes=ca((0,Z.Z)(this,va),{numberOfRows:r.matrix.numberOfRows(),includeFeatureType:!0}):r.genes=null,null!==(0,Z.Z)(this,pa)?r.annotations=ha((0,Z.Z)(this,pa),{numberOfColumns:r.matrix.numberOfColumns()}):r.annotations=null,Rn(r),Hn(r)}catch(n){throw Ge(r.matrix),n}return r}},{key:"format",value:function(){return"MatrixMarket"}},{key:"serialize",value:function(){var e=(0,o.Z)(u.mark((function e(t){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Tn((0,Z.Z)(this,da),"mtx",t);case 2:if(e.t0=e.sent,r=[e.t0],null===(0,Z.Z)(this,va)){e.next=10;break}return e.t1=r,e.next=8,Tn((0,Z.Z)(this,va),"genes",t);case 8:e.t2=e.sent,e.t1.push.call(e.t1,e.t2);case 10:if(null===(0,Z.Z)(this,pa)){e.next=16;break}return e.t3=r,e.next=14,Tn((0,Z.Z)(this,pa),"annotations",t);case 14:e.t4=e.sent,e.t3.push.call(e.t3,e.t4);case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function ga(e,t){return ya.apply(this,arguments)}function ya(){return(ya=(0,o.Z)(u.mark((function e(t,r){var n,a,i,s;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={},a=(0,x.Z)(t),e.prev=2,a.s();case 4:if((i=a.n()).done){e.next=11;break}return s=i.value,e.next=8,qn(s,r);case 8:n[s.type]=e.sent;case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),a.e(e.t0);case 16:return e.prev=16,a.f(),e.finish(16);case 19:return e.abrupt("return",new ma(n,!0));case 20:case"end":return e.stop()}}),e,null,[[2,13,16,19]])})))).apply(this,arguments)}function wa(e){for(var t={"symbol-mouse":[],"symbol-human":[],"ensembl-mouse":[],"ensembl-human":[]},r=JSON.parse(JSON.stringify(t)),n=Object.keys(e),a=0,i=n;a<i.length;a++){for(var o=e[i[a]],u={},l={},c=0,h=Object.entries(o);c<h.length;c++){var f=(0,s.Z)(h[c],2),d=f[0],v=H(f[1]),p=v.type+"-"+v.species;(!(p in u)||v.confidence>u[p])&&(u[p]=v.confidence,l[p]=d)}for(var m=0,g=Object.entries(l);m<g.length;m++){var y=(0,s.Z)(g[m],2),w=y[0],b=y[1];r[w].push(b),t[w].push(u[w])}}for(var _=-1e3,k=null,Z=0,A=Object.entries(t);Z<A.length;Z++){var x=(0,s.Z)(A[Z],2),E=x[0],S=x[1];if(S.length==n.length){var I=S.reduce((function(e,t){return e*t}));I>_&&(_=I,k=E)}}var B={},z=null;if(null!==k){var G=r[k],F=k.split("-");z={type:F[0],species:F[1]};for(var O=0;O<n.length;O++)B[n[O]]=G[O]}return{best_type:z,best_fields:B}}function ba(e){if(!(e in _a))throw"unknown matrix format '"+e+"'";return _a[e]}var _a={MatrixMarket:i,"10X":n,H5AD:a},ka=new WeakMap,Za=new WeakMap,Aa=new WeakMap,xa=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,b.Z)(this,e),(0,k.Z)(this,ka,{writable:!0,value:void 0}),(0,k.Z)(this,Za,{writable:!0,value:void 0}),(0,k.Z)(this,Aa,{writable:!0,value:void 0}),(0,A.Z)(this,ka,null===t?{}:t),(0,A.Z)(this,Za,null===r?{}:r),(0,A.Z)(this,Aa,{}),this.changed=!1}return(0,_.Z)(e,[{key:"free",value:function(){Ge((0,Z.Z)(this,Za).matrix),Ge((0,Z.Z)(this,Za).block_ids)}},{key:"fetchCountMatrix",value:function(){return(0,Z.Z)(this,Za).matrix}},{key:"fetchGenes",value:function(){return(0,Z.Z)(this,Za).genes}},{key:"fetchGeneTypes",value:function(){return(0,Z.Z)(this,Za).gene_types}},{key:"fetchAnnotations",value:function(e){var t=(0,Z.Z)(this,Za).annotations,r=(0,Z.Z)(this,Za).matrix.numberOfColumns();if(null===t||!(e in t))throw new Error("".concat(e," does not exist in the column annotations"));var n=t[e];if(ArrayBuffer.isView(n))return{type:"array",values:n.slice()};if(Oe(n)){if(!("type"in n)||"factor"!=n.type)throw new Error("annotation column should have 'type: \"factor\"' if it is an object");return{type:n.type,index:n.index.slice(),levels:n.levels.slice()}}var a=[],i={},s=new Int32Array(r);return t[e].map((function(e,t){e in i||(i[e]=a.length,a.push(e)),s[t]=i[e]})),{type:"factor",index:s,levels:a}}},{key:"fetchBlock",value:function(){return(0,Z.Z)(this,Za).block_ids}},{key:"fetchBlockLevels",value:function(){return(0,Z.Z)(this,Za).block_levels}},{key:"compute",value:function(){var e=(0,o.Z)(u.mark((function e(t,r){var n,a,i,o,l,c,h,f,d,v,p,m,g,y,w;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t){e.next=3;break}return this.changed=!1,e.abrupt("return");case 3:for(n=Object.entries(t),a={},i=0,o=n;i<o.length;i++)l=(0,s.Z)(o[i],2),c=l[0],h=l[1],f=ba(h.format),a[c]=f.abbreviate(h);if(u=a,b=(0,Z.Z)(this,Aa),JSON.stringify(u)!=JSON.stringify(b)||(0,Z.Z)(this,ka).sample_factor!==r){e.next=9;break}return this.changed=!1,e.abrupt("return");case 9:for(d={},v=0,p=n;v<p.length;v++)m=(0,s.Z)(p[v],2),g=m[0],y=m[1],w=ba(y.format),d[g]=new w.Reader(y);return Ge((0,Z.Z)(this,Za).matrix),Ge((0,Z.Z)(this,Za).block_ids),e.t0=A.Z,e.t1=this,e.t2=Za,e.next=18,Ia(d,r);case 18:return e.t3=e.sent,(0,e.t0)(e.t1,e.t2,e.t3),(0,A.Z)(this,Aa,a),(0,Z.Z)(this,ka).matrices=d,(0,Z.Z)(this,ka).sample_factor=r,this.changed=!0,e.abrupt("return",null);case 25:case"end":return e.stop()}var u,b}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"summary",value:function(){var e={dimensions:{num_genes:(0,Z.Z)(this,Za).matrix.numberOfRows(),num_cells:(0,Z.Z)(this,Za).matrix.numberOfColumns()},genes:Be({},(0,Z.Z)(this,Za).genes)};return null!==(0,Z.Z)(this,Za).annotations&&(e.annotations=Object.keys((0,Z.Z)(this,Za).annotations)),e}},{key:"serialize",value:function(){var e=(0,o.Z)(u.mark((function e(t,r){var n,a,i,o,l,c,h,f,d,v,p,m,g,y,w,b,_,k;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.createGroup("inputs"),!1,a=n.createGroup("parameters"),i=[],o=[],l=[],c=a.createGroup("files"),h=0,f=0,d=Object.entries((0,Z.Z)(this,ka).matrices);case 9:if(!(f<d.length)){e.next=49;break}return v=(0,s.Z)(d[f],2),p=v[0],m=v[1],i.push(m.format()),o.push(p),e.next=15,m.serialize(r);case 15:g=e.sent,l.push(g.length),y=(0,x.Z)(g),e.prev=18,y.s();case 20:if((w=y.n()).done){e.next=38;break}if(b=w.value,(_=c.createGroup(String(h))).writeDataSet("type","String",[],b.type),_.writeDataSet("name","String",[],b.name),"string"!=typeof b.id){e.next=29;break}_.writeDataSet("id","String",[],b.id),e.next=35;break;case 29:if("number"!=typeof b.offset||"number"!=typeof b.size){e.next=34;break}_.writeDataSet("offset","Uint32",[],b.offset),_.writeDataSet("size","Uint32",[],b.size),e.next=35;break;case 34:throw new Error("object should contain either an 'id' string or 'offset' and 'size' numbers");case 35:h++;case 36:e.next=20;break;case 38:e.next=43;break;case 40:e.prev=40,e.t0=e.catch(18),y.e(e.t0);case 43:return e.prev=43,y.f(),e.finish(43);case 46:f++,e.next=9;break;case 49:return i.length>1?(!0,a.writeDataSet("format","String",null,i),a.writeDataSet("sample_groups","Int32",null,l),a.writeDataSet("sample_names","String",null,o)):(a.writeDataSet("format","String",[],i[0]),null!==(0,Z.Z)(this,ka).sample_factor&&a.writeDataSet("sample_factor","String",[],(0,Z.Z)(this,ka).sample_factor)),(k=n.createGroup("results")).writeDataSet("dimensions","Int32",null,[(0,Z.Z)(this,Za).matrix.numberOfRows(),(0,Z.Z)(this,Za).matrix.numberOfColumns()]),null!==(0,Z.Z)(this,Za).block_levels&&k.writeDataSet("num_samples","Int32",[],(0,Z.Z)(this,Za).block_levels.length),k.writeDataSet("indices","Int32",null,(0,Z.Z)(this,Za).matrix.identities()),e.abrupt("return");case 55:case"end":return e.stop()}}),e,this,[[18,40,43,46]])})));return function(t,r){return e.apply(this,arguments)}}()}]),e}();function Ea(e,t){return Sa.apply(this,arguments)}function Sa(){return Sa=(0,o.Z)(u.mark((function e(t,r){var n,a,i,o,l,h,f,d,v,p,m,g,y,w,b,_,k,Z,A,E,S,I,B;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={},e.prev=1,a=0,i=Object.entries(t);case 3:if(!(a<i.length)){e.next=11;break}return o=(0,s.Z)(i[a],2),l=o[0],h=o[1],e.next=7,h.load();case 7:n[l]=e.sent;case 8:a++,e.next=3;break;case 11:e.next=17;break;case 13:for(e.prev=13,e.t0=e.catch(1),f=0,d=Object.entries(n);f<d.length;f++)v=(0,s.Z)(d[f],2),v[0],Ge(v[1].matrix);throw e.t0;case 17:if((p=Object.keys(n)).sort(),1!=p.length){e.next=49;break}if(m=n[p[0]],g=null,y=null,null===r){e.next=44;break}if(e.prev=24,w=m.annotations[r],b=null,Oe(w)&&(b=w.levels,w=w.index),_=m.matrix.numberOfColumns(),w.length==_){e.next=31;break}throw new Error("length of sample factor '"+r+"' should be equal to the number of cells");case 31:g=c.Wf(_),y=[],k=g.array(),Z={},w.forEach((function(e,t){e in Z||(Z[e]=y.length,y.push(e)),k[t]=Z[e]})),null!==b&&(y=Array.from(y).map((function(e){return b[e]}))),e.next=44;break;case 39:throw e.prev=39,e.t1=e.catch(24),Ge(g),Ge(m.matrix),e.t1;case 44:return m.block_ids=g,m.block_levels=y,e.abrupt("return",m);case 49:A={},e.prev=50,function(){var e,t={},r=(0,x.Z)(p);try{for(r.s();!(e=r.n()).done;){var a=e.value;if(t[a]=n[a].genes,null===t[a])throw new Error("no gene annotations found in matrix '"+a+"'")}}catch(Xt){r.e(Xt)}finally{r.f()}var i=wa(t);if(null===i.best_type)throw new Error("no common feature types available across all matrices");var o,u=i.best_fields,l=[],h=[],f=0,d=(0,x.Z)(p);try{for(d.s();!(o=d.n()).done;){var v=o.value,m=n[v];l.push(m.genes[u[v]]),h.push(m.matrix),f+=m.matrix.numberOfColumns()}}catch(Xt){d.e(Xt)}finally{d.f()}var g=(E=c.Wf(f)).array(),y=new Array(f),w=0;for(S=0;S<p.length;S++){var b=w;w+=n[p[S]].matrix.numberOfColumns(),g.fill(S,b,w),y.fill(p[S],b,w)}A.block_ids=E,A.block_levels=p;var _=Y(h,l);A.matrix=_.matrix;var k=new Set(_.indices);A.genes={};for(var Z=n[p[0]].genes,I=0,B=Object.entries(Z);I<B.length;I++){var z=(0,s.Z)(B[I],2),G=z[0],F=z[1];A.genes[G]=F.filter((function(e,t){return k.has(t)}))}var O,C=new Set,D=(0,x.Z)(p);try{for(D.s();!(O=D.n()).done;){var N=O.value,M=n[N];if(null!==M.annotations)for(var R=0,U=Object.keys(M.annotations);R<U.length;R++){var Q=U[R];C.add(Q)}}}catch(Xt){D.e(Xt)}finally{D.f()}var W,T=Ee(C),j={},q=(0,x.Z)(T);try{for(q.s();!(W=q.n()).done;){var P,L=W.value,H=[],J=(0,x.Z)(p);try{for(J.s();!(P=J.n()).done;){var V=P.value,X=n[V],K=void 0;X.annotations&&X.annotations[L]?(K=X.annotations[L])instanceof Array||(K=Array.from(K)):K=new Array(X.matrix.numberOfColumns()),H=H.concat(K)}}catch(Xt){J.e(Xt)}finally{J.f()}j[L]=H}}catch(Xt){q.e(Xt)}finally{q.f()}A.annotations=j,A.annotations.__batch__=y}(),e.next=58;break;case 54:throw e.prev=54,e.t2=e.catch(50),Ge(E),e.t2;case 58:for(e.prev=58,I=0,B=Object.values(n);I<B.length;I++)Ge(B[I].matrix);return e.finish(58);case 61:return e.abrupt("return",A);case 62:case"end":return e.stop()}}),e,null,[[1,13],[24,39],[50,54,58,61]])}))),Sa.apply(this,arguments)}function Ia(e,t){return Ba.apply(this,arguments)}function Ba(){return Ba=(0,o.Z)(u.mark((function e(t,r){var n,a,i,o,l,c,h,f;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ea(t,r);case 2:for(n=e.sent,a={},i=n.genes,o=0,l=Object.entries(i);o<l.length;o++)c=(0,s.Z)(l[o],2),h=c[0],f=c[1],a[h]=H(f);return n.gene_types=a,e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)}))),Ba.apply(this,arguments)}function za(e,t){return Ga.apply(this,arguments)}function Ga(){return Ga=(0,o.Z)(u.mark((function e(t,r){var n,a,i,s,o,l,c,h,f,d,v,p,m,g,y,w,b,_,k,Z,A,x,E,S,I,B,z,G,F,O,C,D,N,M,R,U,Q,W,T;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.open("inputs"),a=n.open("parameters"),i=a.open("files"),s=i.children,o=new Array(s.length),l=0,c=Object.keys(s);l<c.length;l++){for(h=c[l],f=i.open(h),d={},v=0,p=["type","name"];v<p.length;v++)m=p[v],g=f.open(m,{load:!0}),d[m]=g.values[0];if("id"in f.children)d.id=f.open("id",{load:!0}).values[0];else for(y=0,w=["offset","size"];y<w.length;y++)d[b=w[y]]=f.open(b,{load:!0}).values[0];_=Number(h),o[_]=d}if(k={matrices:{},sample_factor:null},Z=a.open("format",{load:!0}),!(A=0==Z.shape.length)){e.next=18;break}return x=Z.values[0],E=ba(x),e.next=14,E.unserialize(o,r);case 14:k.matrices.default=e.sent,"sample_factor"in a.children?k.sample_factor=a.open("sample_factor",{load:!0}).values[0]:k.sample_factor=null,e.next=34;break;case 18:S=Z.values,I=a.open("sample_names",{load:!0}).values,B=a.open("sample_groups",{load:!0}).values,z=0,G=0;case 23:if(!(G<S.length)){e.next=34;break}return F=z,z+=B[G],O=o.slice(F,z),C=ba(S[G]),e.next=30,C.unserialize(O,r);case 30:k.matrices[I[G]]=e.sent;case 31:G++,e.next=23;break;case 34:return e.next=36,Ia(k.matrices,k.sample_factor);case 36:return D=e.sent,N=n.open("results"),R=null,A?"permutation"in N.children?(U=N.open("permutation",{load:!0}),Q=new Int32Array(U.values.length),U.values.forEach((function(e,t){Q[e]=t})),R=P(D.matrix,Q)):"identities"in N.children&&(W=N.open("identities",{load:!0}),R=P(D.matrix,W.values)):(T="indices"in N.children?N.open("indices",{load:!0}).values:N.open("identities",{load:!0}).values,R=P(D.matrix,T)),M=null===R?function(e){}:function(e){var t=e.slice();e.forEach((function(r,n){e[n]=t[R[n]]}))},e.abrupt("return",{state:new xa(k,D),parameters:{sample_factor:k.sample_factor},permuter:M});case 42:case"end":return e.stop()}}),e)}))),Ga.apply(this,arguments)}function Fa(e){return Oa.apply(this,arguments)}function Oa(){return(Oa=(0,o.Z)(u.mark((function e(t){var r,n,a,i,o,l,c,h,f,d,v,p,m,g,y,w,b,_,k,Z,A,x,E,S,I,B;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=Object.keys(t),n=r.length>1,a=[],i=0,o=r;i<o.length;i++)l=o[i],c=t[l],h=ba(c.format),a.push(h.preflight(c));return e.next=6,Promise.all(a);case 6:f=e.sent,d={},v={},p=0,m=Object.entries(r);case 10:if(!(p<m.length)){e.next=23;break}if(g=(0,s.Z)(m[p],2),y=g[0],w=g[1],null===(b=f[y]).genes){e.next=17;break}d[w]=b.genes,e.next=19;break;case 17:if(!n){e.next=19;break}throw new Error("cannot find gene annotations for matrix '"+w+"'");case 19:v[w]=b.annotations;case 20:p++,e.next=10;break;case 23:if(_={annotations:v},!n){e.next=34;break}if(null!==(k=wa(d)).best_type){e.next=28;break}throw new Error("cannot find common feature types across all matrices");case 28:for(_.best_gene_fields=k.best_fields,Z=null,A=0,x=Object.entries(k.best_fields);A<x.length;A++)E=(0,s.Z)(x[A],2),S=E[0],I=E[1],B=d[S][I],null===Z?Z=B:function(){var e=new Set(B);Z=Z.filter((function(t){return e.has(t)}))}();if(0!==Z.length){e.next=33;break}throw new Error("cannot find common genes across all matrices");case 33:_.common_genes=Z.length;case 34:return e.abrupt("return",_);case 35:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ca={};Ca.ensembl=new Set(["ENSMUSG00000064336","ENSMUSG00000064337","ENSMUSG00000064338","ENSMUSG00000064339","ENSMUSG00000064340","ENSMUSG00000064341","ENSMUSG00000064342","ENSMUSG00000064343","ENSMUSG00000064344","ENSMUSG00000064345","ENSMUSG00000064346","ENSMUSG00000064347","ENSMUSG00000064348","ENSMUSG00000064349","ENSMUSG00000064350","ENSMUSG00000064351","ENSMUSG00000064352","ENSMUSG00000064353","ENSMUSG00000064354","ENSMUSG00000064355","ENSMUSG00000064356","ENSMUSG00000064357","ENSMUSG00000064358","ENSMUSG00000064359","ENSMUSG00000064360","ENSMUSG00000064361","ENSMUSG00000064363","ENSMUSG00000064364","ENSMUSG00000064365","ENSMUSG00000064366","ENSMUSG00000064367","ENSMUSG00000064368","ENSMUSG00000064369","ENSMUSG00000064370","ENSMUSG00000064371","ENSMUSG00000064372","ENSMUSG00000065947","ENSG00000198695","ENSG00000198712","ENSG00000198727","ENSG00000198763","ENSG00000198786","ENSG00000198804","ENSG00000198840","ENSG00000198886","ENSG00000198888","ENSG00000198899","ENSG00000198938","ENSG00000209082","ENSG00000210049","ENSG00000210077","ENSG00000210082","ENSG00000210100","ENSG00000210107","ENSG00000210112","ENSG00000210117","ENSG00000210127","ENSG00000210135","ENSG00000210140","ENSG00000210144","ENSG00000210151","ENSG00000210154","ENSG00000210156","ENSG00000210164","ENSG00000210174","ENSG00000210176","ENSG00000210184","ENSG00000210191","ENSG00000210194","ENSG00000210195","ENSG00000210196","ENSG00000211459","ENSG00000212907","ENSG00000228253"]),Ca.symbol=new Set(["mt-Tf","mt-Rnr1","mt-Tv","mt-Rnr2","mt-Tl1","mt-Nd1","mt-Ti","mt-Tq","mt-Tm","mt-Nd2","mt-Tw","mt-Ta","mt-Tn","mt-Tc","mt-Ty","mt-Co1","mt-Ts1","mt-Td","mt-Co2","mt-Tk","mt-Atp8","mt-Atp6","mt-Co3","mt-Tg","mt-Nd3","mt-Tr","mt-Nd4","mt-Th","mt-Ts2","mt-Tl2","mt-Nd5","mt-Nd6","mt-Te","mt-Cytb","mt-Tt","mt-Tp","mt-Nd4l","MT-ND6","MT-CO2","MT-CYB","MT-ND2","MT-ND5","MT-CO1","MT-ND3","MT-ND4","MT-ND1","MT-ATP6","MT-CO3","MT-TL1","MT-TF","MT-TV","MT-RNR2","MT-TI","MT-TQ","MT-TM","MT-TW","MT-TA","MT-TN","MT-TC","MT-TY","MT-TS1","MT-TD","MT-TK","MT-TG","MT-TR","MT-TH","MT-TS2","MT-TL2","MT-TE","MT-TT","MT-TP","MT-RNR1","MT-ND4L","MT-ATP8"]);var Da=new WeakMap,Na=new WeakMap,Ma=new WeakMap,Ra=new WeakSet,Ua=new WeakSet,Qa=new WeakSet,Wa=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,b.Z)(this,e),y(this,Qa),y(this,Ua),y(this,Ra),(0,k.Z)(this,Da,{writable:!0,value:void 0}),(0,k.Z)(this,Na,{writable:!0,value:void 0}),(0,k.Z)(this,Ma,{writable:!0,value:void 0}),!(t instanceof xa))throw new Error("'inputs' should be a State object from './inputs.js'");(0,A.Z)(this,Da,t),(0,A.Z)(this,Ma,null===r?{}:r),(0,A.Z)(this,Na,null===n?{}:n),this.changed=!1}return(0,_.Z)(e,[{key:"free",value:function(){Ge((0,Z.Z)(this,Na).metrics),Ge((0,Z.Z)(this,Na).filters),Ge((0,Z.Z)(this,Na).matrix),Ge((0,Z.Z)(this,Na).block_buffer),Ge((0,Z.Z)(this,Na).metrics_buffer)}},{key:"fetchSums",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.unsafe,r=void 0!==t&&t;return(0,Z.Z)(this,Na).metrics.sums({copy:!r})}},{key:"fetchDiscards",value:function(){return(0,Z.Z)(this,Na).filters.discardOverall({copy:"view"})}},{key:"fetchFilteredMatrix",value:function(){return"matrix"in(0,Z.Z)(this,Na)||w(this,Ra,Ta).call(this),(0,Z.Z)(this,Na).matrix}},{key:"fetchFilteredBlock",value:function(){return"blocked"in(0,Z.Z)(this,Na)||w(this,Ra,Ta).call(this),(0,Z.Z)(this,Na).blocked?(0,Z.Z)(this,Na).block_buffer:null}},{key:"fetchFilteredAnnotations",value:function(e){var t=(0,Z.Z)(this,Da).fetchAnnotations(e),r=this.fetchDiscards().array(),n=function(e,t){return!r[t]};return"factor"===t.type?t.index=t.index.filter(n):t.values=t.values.filter(n),t}},{key:"compute",value:function(e,t,r){if(this.changed=!1,(0,Z.Z)(this,Da).changed||e!==(0,Z.Z)(this,Ma).use_mito_default||t!==(0,Z.Z)(this,Ma).mito_prefix){var n=(0,Z.Z)(this,Da).fetchCountMatrix(),a=Fe(1*n.numberOfRows(),"Uint8Array",(0,Z.Z)(this,Na),"metrics_buffer");a.fill(0);for(var i=(0,Z.Z)(this,Da).fetchGenes(),o=a.array(),u=0,h=Object.entries(i);u<h.length;u++){var f=(0,s.Z)(h[u],2),d=(f[0],f[1]);if(e)d.forEach((function(e,t){(Ca.symbol.has(e)||Ca.ensembl.has(e))&&(o[t]=1)}));else{var v=t.toLowerCase();d.forEach((function(e,t){e.toLowerCase().startsWith(v)&&(o[t]=1)}))}}Ge((0,Z.Z)(this,Na).metrics),(0,Z.Z)(this,Na).metrics=function(e,t){var r,n,a=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).subsetProportions,i=void 0===a||a;try{if(t instanceof V.yh){var s=Math.round(t.length/e.numberOfRows());if(s*e.numberOfRows()!=t.length)throw new Error("length of 'subsets' should be a multiple of the matrix rows");var o=c.de(t,null);try{var u=t.offset;n=l.RE((function(t){return t.per_cell_qc_metrics(e.matrix,s,u,i)}))}finally{o.free()}}else if(t instanceof Array){var h=c.TS(e.numberOfRows()*t.length);try{for(var f=0,d=0;d<t.length;d++){var v=t[d];if(v.length!=e.numberOfRows())throw new Error("length of each array in 'subsets' should be equal to the matrix rows");h.array().set(v,f),f+=v.length}n=l.RE((function(r){return r.per_cell_qc_metrics(e.matrix,t.length,h.offset,i)}))}finally{h.free()}}else{if(null!==t)throw new Error("'subsets' should be an Array or Uint8WasmArray");n=l.RE((function(t){return t.per_cell_qc_metrics(e.matrix,0,0)}))}r=new X(n)}catch(p){throw c.gd(n),p}return r}(n,a),(0,Z.Z)(this,Ma).use_mito_default=e,(0,Z.Z)(this,Ma).mito_prefix=t,this.changed=!0}if(this.changed||r!==(0,Z.Z)(this,Ma).nmads){var p=(0,Z.Z)(this,Da).fetchBlock();Ge((0,Z.Z)(this,Na).filters),(0,Z.Z)(this,Na).filters=function(e){var t,r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=a.numberOfMADs,s=void 0===i?3:i,o=a.block,u=void 0===o?null:o;try{var h=0,f=!1;if(null!==u){if((t=c.de(u,"Int32WasmArray")).length!=e.sums().length)throw new Error("'block' must be of length equal to the number of cells in 'metrics'");f=!0,h=t.offset}r=l.RE((function(t){return t.per_cell_qc_filters(e.results,f,h,s)})),n=new K(r)}catch(d){throw c.gd(r),d}finally{c.gd(t)}return n}((0,Z.Z)(this,Na).metrics,{numberOfMADs:r,block:p}),(0,Z.Z)(this,Ma).nmads=r,this.changed=!0}this.changed&&(w(this,Ra,Ta).call(this),this.changed=!0)}},{key:"summary",value:function(){var e=this,t={},r=(0,Z.Z)(this,Da).fetchBlockLevels();null===r?(r=["default"],t.default=w(this,Ua,ja).call(this)):function(){var n=w(e,Ua,ja).call(e,{copy:"view"}),a=(0,Z.Z)(e,Da).fetchBlock().array();for(i=0;i<r.length;i++){for(var o={},u=0,l=Object.entries(n);u<l.length;u++){var c=(0,s.Z)(l[u],2),h=c[0],f=c[1];o[h]=f.array().filter((function(e,t){return a[t]==i}))}t[r[i]]=o}}();for(var n={},a=w(this,Qa,qa).call(this,{copy:!1}),i=0;i<r.length;i++){for(var o={},u=0,l=Object.entries(a);u<l.length;u++){var c=(0,s.Z)(l[u],2),h=c[0],f=c[1];o[h]=f[i]}n[r[i]]=o}var d=0;return"matrix"in(0,Z.Z)(this,Na)?d=(0,Z.Z)(this,Na).matrix.numberOfColumns():this.fetchDiscards().array().forEach((function(e){0==e&&d++})),{data:t,thresholds:n,retained:d}}},{key:"serialize",value:function(e){var t=e.createGroup("quality_control"),r=t.createGroup("parameters");r.writeDataSet("use_mito_default","Uint8",[],Number((0,Z.Z)(this,Ma).use_mito_default)),r.writeDataSet("mito_prefix","String",[],(0,Z.Z)(this,Ma).mito_prefix),r.writeDataSet("nmads","Float64",[],(0,Z.Z)(this,Ma).nmads);var n=t.createGroup("results"),a=n.createGroup("metrics"),i=w(this,Ua,ja).call(this,{copy:"view"});a.writeDataSet("sums","Float64",null,i.sums),a.writeDataSet("detected","Int32",null,i.detected),a.writeDataSet("proportion","Float64",null,i.proportion);for(var s=n.createGroup("thresholds"),o=w(this,Qa,qa).call(this,{copy:"hdf5"}),u=0,l=["sums","detected","proportion"];u<l.length;u++){var c=l[u],h=o[c];s.writeDataSet(c,"Float64",null,h)}var f=this.fetchDiscards();n.writeDataSet("discards","Uint8",null,f)}}]),e}();function Ta(){var e=(0,Z.Z)(this,Da).fetchCountMatrix(),t=this.fetchDiscards();Ge((0,Z.Z)(this,Na).matrix),(0,Z.Z)(this,Na).matrix=function(e,t){var r,n,a;try{var i;if(t instanceof K){var s=t.discardOverall({copy:!1});i=s.byteOffset}else{if((r=c.de(t,"Uint8WasmArray")).length!=e.numberOfColumns())throw new Error("length of 'filters' must be equal to number of columns in 'x'");i=r.offset}n=l.RE((function(t){return t.filter_cells(e.matrix,i,!1)})),a=new e.constructor(n)}catch(o){throw c.gd(n),o}finally{c.gd(r)}return a}(e,t);var r=(0,Z.Z)(this,Da).fetchBlock();if((0,Z.Z)(this,Na).blocked=null!==r,(0,Z.Z)(this,Na).blocked)for(var n=Fe((0,Z.Z)(this,Na).matrix.numberOfColumns(),"Int32Array",(0,Z.Z)(this,Na),"block_buffer").array(),a=r.array(),i=t.array(),s=0,o=0;o<a.length;o++)0==i[o]&&(n[s]=a[o],s++)}function ja(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return{sums:(0,Z.Z)(this,Na).metrics.sums({copy:r}),detected:(0,Z.Z)(this,Na).metrics.detected({copy:r}),proportion:(0,Z.Z)(this,Na).metrics.subsetProportions(0,{copy:r})}}function qa(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return{sums:(0,Z.Z)(this,Na).filters.thresholdsSums({copy:r}),detected:(0,Z.Z)(this,Na).filters.thresholdsDetected({copy:r}),proportion:(0,Z.Z)(this,Na).filters.thresholdsSubsetProportions(0,{copy:r})}}var Pa=function(){function e(t,r,n,a){(0,b.Z)(this,e),this.sums_=t,this.detected_=r,this.proportion_=n,this.discards=c.TS(a.length),this.discards.set(a)}return(0,_.Z)(e,[{key:"thresholdsSums",value:function(e){var t=e.copy;return ze(this.sums_,t)}},{key:"thresholdsDetected",value:function(e){var t=e.copy;return ze(this.detected_,t)}},{key:"thresholdsSubsetProportions",value:function(e,t){var r=t.copy;if(0!=e)throw"only 'index = 0' is supported for mimics";return ze(this.proportion_,r)}},{key:"discardOverall",value:function(e){var t=e.copy;return ze(this.discards,t)}},{key:"free",value:function(){this.discards.free()}}]),e}();function La(e,t){var r,n=e.open("quality_control"),a=n.open("parameters");r={use_mito_default:a.open("use_mito_default",{load:!0}).values[0]>0,mito_prefix:a.open("mito_prefix",{load:!0}).values[0],nmads:a.open("nmads",{load:!0}).values[0]};var i={},s=n.open("results"),o=s.open("metrics"),u=o.open("sums",{load:!0}).values;i.metrics=function(e,t){var r,n,a=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).subsetProportions,i=void 0===a||a;try{r=l.RE((function(r){return new r.PerCellQCMetrics_Results(e,t,i)})),n=new X(r)}catch(s){throw c.gd(r),s}return n}(u.length,1),i.metrics.sums({copy:!1}).set(u);var h=o.open("detected",{load:!0}).values;i.metrics.detected({copy:!1}).set(h);var f=o.open("proportion",{load:!0}).values;i.metrics.subsetProportions(0,{copy:!1}).set(f);var d=s.open("thresholds"),v=d.open("sums",{load:!0}).values,p=d.open("detected",{load:!0}).values,m=d.open("proportion",{load:!0}).values,g=s.open("discards",{load:!0}).values;return i.filters=new Pa(v,p,m,g),{state:new Wa(t,r,i),parameters:Be({},r)}}var Ha=new WeakMap,Ja=new WeakMap,Ya=new WeakMap,Va=new WeakSet,Xa=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,b.Z)(this,e),y(this,Va),(0,k.Z)(this,Ha,{writable:!0,value:void 0}),(0,k.Z)(this,Ja,{writable:!0,value:void 0}),(0,k.Z)(this,Ya,{writable:!0,value:void 0}),!(t instanceof Wa))throw new Error("'qc' should be a State object from './quality_control.js'");(0,A.Z)(this,Ha,t),(0,A.Z)(this,Ja,null===r?{}:r),(0,A.Z)(this,Ya,null===n?{}:n),this.changed=!1}return(0,_.Z)(e,[{key:"free",value:function(){Ge((0,Z.Z)(this,Ya).matrix)}},{key:"fetchNormalizedMatrix",value:function(){return"matrix"in(0,Z.Z)(this,Ya)||w(this,Va,Ka).call(this),(0,Z.Z)(this,Ya).matrix}},{key:"fetchExpression",value:function(e){var t=this.fetchNormalizedMatrix(),r=Fe(t.numberOfColumns(),"Float64Array",(0,Z.Z)(this,Ya));return t.row(e,{buffer:r}),r.slice()}},{key:"compute",value:function(){this.changed=!1,(0,Z.Z)(this,Ha).changed&&(this.changed=!0),this.changed&&w(this,Va,Ka).call(this)}},{key:"summary",value:function(){return{}}},{key:"serialize",value:function(e){var t=e.createGroup("normalization");t.createGroup("parameters"),t.createGroup("results")}}]),e}();function Ka(){var e=(0,Z.Z)(this,Ha).fetchFilteredMatrix(),t=Fe(e.numberOfColumns(),"Float64Array",(0,Z.Z)(this,Ya)),r=(0,Z.Z)(this,Ha).fetchDiscards(),n=(0,Z.Z)(this,Ha).fetchSums({unsafe:!0}),a=t.array(),i=0;if(r.array().forEach((function(e,t){e||(a[i]=n[t],i++)})),i!=e.numberOfColumns())throw"normalization and filtering are not in sync";var s=(0,Z.Z)(this,Ha).fetchFilteredBlock();Ge((0,Z.Z)(this,Ya).matrix),(0,Z.Z)(this,Ya).matrix=$(e,{sizeFactors:t,block:s})}function $a(e,t){return{state:new Xa(t),parameters:{}}}var ei=new WeakMap,ti=new WeakMap,ri=new WeakMap,ni=new WeakMap,ai=new WeakSet,ii=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,b.Z)(this,e),y(this,ai),(0,k.Z)(this,ei,{writable:!0,value:void 0}),(0,k.Z)(this,ti,{writable:!0,value:void 0}),(0,k.Z)(this,ri,{writable:!0,value:void 0}),(0,k.Z)(this,ni,{writable:!0,value:void 0}),!(t instanceof Wa))throw new Error("'qc' should be a State object from './quality_control.js'");if((0,A.Z)(this,ei,t),!(r instanceof Xa))throw new Error("'norm' should be a State object from './normalization.js'");(0,A.Z)(this,ti,r),(0,A.Z)(this,ni,null===n?{}:n),(0,A.Z)(this,ri,null===a?{}:a),this.changed=!1}return(0,_.Z)(e,[{key:"free",value:function(){Ge((0,Z.Z)(this,ri).matrix)}},{key:"fetchSortedResiduals",value:function(){return(0,Z.Z)(this,ri).sorted_residuals}},{key:"fetchResiduals",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.unsafe,r=void 0!==t&&t;return(0,Z.Z)(this,ri).results.residuals({copy:!r})}},{key:"compute",value:function(e){if(this.changed=!1,(0,Z.Z)(this,ti).changed||e!=(0,Z.Z)(this,ni).span){Ge((0,Z.Z)(this,ri).results);var t=(0,Z.Z)(this,ti).fetchNormalizedMatrix(),r=(0,Z.Z)(this,ei).fetchFilteredBlock();(0,Z.Z)(this,ri).results=ee.r(t,{span:e,block:r}),(0,Z.Z)(this,ri).sorted_residuals=(0,Z.Z)(this,ri).results.residuals().slice(),(0,Z.Z)(this,ri).sorted_residuals.sort(),(0,Z.Z)(this,ni).span=e,this.changed=!0}}},{key:"summary",value:function(){return w(this,ai,si).call(this)}},{key:"serialize",value:function(e){var t=e.createGroup("feature_selection");t.createGroup("parameters").writeDataSet("span","Float64",[],(0,Z.Z)(this,ni).span);for(var r=w(this,ai,si).call(this,{copy:"hdf5"}),n=t.createGroup("results"),a=0,i=Object.entries(r);a<i.length;a++){var o=(0,s.Z)(i[a],2),u=o[0],l=o[1];n.writeDataSet(u,"Float64",null,l)}}}]),e}();function si(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return{means:(0,Z.Z)(this,ri).results.means({copy:r}),vars:(0,Z.Z)(this,ri).results.variances({copy:r}),fitted:(0,Z.Z)(this,ri).results.fitted({copy:r}),resids:(0,Z.Z)(this,ri).results.residuals({copy:r})}}var oi=function(){function e(t,r,n,a){(0,b.Z)(this,e),this.means_=t,this.vars_=r,this.fitted_=n,this.resids_=a}return(0,_.Z)(e,[{key:"means",value:function(e){var t=e.copy;return ze(this.means_,t)}},{key:"variances",value:function(e){var t=e.copy;return ze(this.vars_,t)}},{key:"fitted",value:function(e){var t=e.copy;return ze(this.fitted_,t)}},{key:"residuals",value:function(e){var t=e.copy;return ze(this.resids_,t)}},{key:"free",value:function(){}}]),e}();function ui(e,t,r,n){var a,i=e.open("feature_selection");a={span:i.open("parameters").open("span",{load:!0}).values[0]};for(var s={},o=i.open("results"),u={},l=0,c=["means","vars","fitted","resids"];l<c.length;l++){var h=c[l],f=o.open(h,{load:!0}).values;t(f),u[h]=f}return s.results=new oi(u.means,u.vars,u.fitted,u.resids),s.sorted_residuals=s.results.residuals({copy:!0}),s.sorted_residuals.sort(),{state:new ii(r,n,a,s),parameters:Be({},a)}}var li=new WeakMap,ci=new WeakMap,hi=new WeakMap,fi=new WeakMap,di=new WeakMap,vi=function(){function e(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if((0,b.Z)(this,e),(0,k.Z)(this,li,{writable:!0,value:void 0}),(0,k.Z)(this,ci,{writable:!0,value:void 0}),(0,k.Z)(this,hi,{writable:!0,value:void 0}),(0,k.Z)(this,fi,{writable:!0,value:void 0}),(0,k.Z)(this,di,{writable:!0,value:void 0}),!(t instanceof Wa))throw new Error("'qc' should be a State object from './quality_control.js'");if((0,A.Z)(this,li,t),!(r instanceof Xa))throw new Error("'norm' should be a State object from './normalization.js'");if((0,A.Z)(this,ci,r),!(n instanceof ii))throw new Error("'feat' should be a State object from './feature_selection.js'");(0,A.Z)(this,hi,n),(0,A.Z)(this,di,null===a?{}:a),(0,A.Z)(this,fi,null===i?{}:i),this.changed=!1}return(0,_.Z)(e,[{key:"free",value:function(){Ge((0,Z.Z)(this,fi).hvg_buffer),Ge((0,Z.Z)(this,fi).pcs),Ge((0,Z.Z)(this,fi).corrected)}},{key:"fetchPCs",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.original,n=void 0!==r&&r;return{pcs:e=n||"mnn"!=(0,Z.Z)(this,di).block_method?(0,Z.Z)(this,fi).pcs.principalComponents({copy:"view"}):(0,Z.Z)(this,fi).corrected,num_pcs:(0,Z.Z)(this,di).num_pcs,num_obs:e.length/(0,Z.Z)(this,di).num_pcs}}},{key:"compute",value:function(e,t,r){if(this.changed=!1,((0,Z.Z)(this,hi).changed||e!==(0,Z.Z)(this,di).num_hvgs)&&(pi(e,(0,Z.Z)(this,hi),(0,Z.Z)(this,fi)),(0,Z.Z)(this,di).num_hvgs=e,this.changed=!0),this.changed||(0,Z.Z)(this,ci).changed||t!==(0,Z.Z)(this,di).num_pcs||r!==(0,Z.Z)(this,di).block_method){var n=(0,Z.Z)(this,fi).hvg_buffer,a=(0,Z.Z)(this,li).fetchFilteredBlock(),i="block";"none"==r?a=null:"mnn"==r&&(i="weight");var s=(0,Z.Z)(this,ci).fetchNormalizedMatrix();if(Ge((0,Z.Z)(this,fi).pcs),(0,Z.Z)(this,fi).pcs=re(s,{features:n,numberOfPCs:t,block:a,blockMethod:i}),"mnn"==r){var o=Fe((0,Z.Z)(this,fi).pcs.principalComponents({copy:"view"}).length,"Float64Array",(0,Z.Z)(this,fi),"corrected");!function(e,t){var r,n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=a.buffer,s=void 0===i?null:i,o=a.numberOfDims,u=void 0===o?null:o,h=a.numberOfCells,f=void 0===h?null:h,d=a.k,v=void 0===d?15:d,p=a.numberOfMADs,m=void 0===p?3:p,g=a.robustIterations,y=void 0===g?2:g,w=a.robustTrim,b=void 0===w?.25:w,_=a.approximate,k=void 0===_||_;try{if(e instanceof te)u=e.numberOfPCs(),f=e.numberOfCells(),e=e.principalComponents({copy:"view"});else{if(null===u||null===f||u*f!==e.length)throw new Error("length of 'x' must be equal to the product of 'numberOfDims' and 'numberOfCells'");r=c.de(e,"Float64WasmArray"),e=r}if(null==s&&(s=c.RJ(f*u)),(n=c.de(t,"Int32WasmArray")).length!=f)throw new Error("'block' must be of length equal to the number of cells in 'x'");l.RE((function(t){return t.mnn_correct(u,f,e.offset,n.offset,s.offset,v,m,y,b,k)}))}finally{c.gd(r)}}((0,Z.Z)(this,fi).pcs,a,{buffer:o})}(0,Z.Z)(this,di).num_pcs=t,(0,Z.Z)(this,di).block_method=r,this.changed=!0}}},{key:"summary",value:function(){var e=(0,Z.Z)(this,fi).pcs,t=e.varianceExplained(),r=e.totalVariance();return t.forEach((function(e,n){t[n]=e/r})),{var_exp:t}}},{key:"serialize",value:function(e){var t=e.createGroup("pca"),r=t.createGroup("parameters");r.writeDataSet("num_hvgs","Int32",[],(0,Z.Z)(this,di).num_hvgs),r.writeDataSet("num_pcs","Int32",[],(0,Z.Z)(this,di).num_pcs),r.writeDataSet("block_method","String",[],(0,Z.Z)(this,di).block_method);var n=t.createGroup("results"),a=this.summary().var_exp;n.writeDataSet("var_exp","Float64",null,a);var i=this.fetchPCs({original:!0});if(n.writeDataSet("pcs","Float64",[i.num_obs,i.num_pcs],i.pcs),"mnn"==(0,Z.Z)(this,di).block_method){var s=(0,Z.Z)(this,fi).corrected;n.writeDataSet("corrected","Float64",[i.num_obs,i.num_pcs],s)}}}]),e}();function pi(e,t,r){var n=t.fetchSortedResiduals(),a=Fe(n.length,"Uint8Array",r,"hvg_buffer");if(e<n.length){var i=n[n.length-e],s=t.fetchResiduals({unsafe:!0});a.array().forEach((function(e,t,r){r[t]=s[t]>=i}))}else a.fill(1);return a}var mi=function(){function e(t,r){(0,b.Z)(this,e),this.var_exp=r,this.pcs=c.RJ(t.length),this.pcs.set(t)}return(0,_.Z)(e,[{key:"principalComponents",value:function(e){var t=e.copy;return ze(this.pcs,t)}},{key:"varianceExplained",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return ze(this.var_exp,r)}},{key:"totalVariance",value:function(){return 1}},{key:"free",value:function(){this.pcs.free()}}]),e}();function gi(e,t,r,n){var a=e.open("pca"),i={},s=a.open("parameters");i={num_hvgs:s.open("num_hvgs",{load:!0}).values[0],num_pcs:s.open("num_pcs",{load:!0}).values[0]},"block_method"in s.children?i.block_method=s.open("block_method",{load:!0}).values[0]:i.block_method="none";var o={};pi(i.num_hvgs,n,o);var u=a.open("results"),l=u.open("var_exp",{load:!0}).values,c=u.open("pcs",{load:!0}).values;if(o.pcs=new mi(c,l),"mnn"==i.block_method){var h=u.open("corrected",{load:!0}).values;Fe(h.length,"Float64Array",o,"corrected").set(h)}return{state:new vi(t,r,n,i,o),parameters:Be({},i)}}var yi=new WeakMap,wi=new WeakMap,bi=new WeakMap,_i=new WeakSet,ki=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,b.Z)(this,e),y(this,_i),(0,k.Z)(this,yi,{writable:!0,value:void 0}),(0,k.Z)(this,wi,{writable:!0,value:void 0}),(0,k.Z)(this,bi,{writable:!0,value:void 0}),!(t instanceof vi))throw new Error("'pca' should be a State object from './pca.js'");(0,A.Z)(this,yi,t),(0,A.Z)(this,wi,null===r?{}:r),(0,A.Z)(this,bi,null===n?{}:n),this.changed=!1}return(0,_.Z)(e,[{key:"free",value:function(){Ge((0,Z.Z)(this,bi).raw)}},{key:"fetchIndex",value:function(){return"raw"in(0,Z.Z)(this,bi)||w(this,_i,Zi).call(this,(0,Z.Z)(this,wi).approximate),(0,Z.Z)(this,bi).raw}},{key:"compute",value:function(e){this.changed=!1,((0,Z.Z)(this,yi).changed||e!=(0,Z.Z)(this,wi).approximate)&&(Ge((0,Z.Z)(this,bi).raw),w(this,_i,Zi).call(this,e),(0,Z.Z)(this,wi).approximate=e,this.changed=!0)}},{key:"summary",value:function(){return{}}},{key:"serialize",value:function(e){var t=e.createGroup("neighbor_index");t.createGroup("parameters").writeDataSet("approximate","Uint8",[],Number((0,Z.Z)(this,wi).approximate)),t.createGroup("results")}}]),e}();function Zi(e){var t=(0,Z.Z)(this,yi).fetchPCs();(0,Z.Z)(this,bi).raw=function(e){var t,r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=a.numberOfDims,s=void 0===i?null:i,o=a.numberOfCells,u=void 0===o?null:o,h=a.approximate,f=void 0===h||h;try{var d;if(e instanceof te){s=e.numberOfPCs(),u=e.numberOfCells();var v=e.principalComponents({copy:!1});d=v.byteOffset}else{if(null===s||null===u)throw new Error("'numberOfDims' and 'numberOfCells' must be specified when 'x' is an Array");if((t=c.de(e,"Float64WasmArray")).length!=s*u)throw new Error("length of 'x' must be the product of 'numberOfDims' and 'numberOfCells'");d=t.offset}r=l.RE((function(e){return e.build_neighbor_index(d,s,u,f)})),n=new ne(r)}catch(p){throw c.gd(r),p}finally{c.gd(t)}return n}(t.pcs,{approximate:e,numberOfDims:t.num_pcs,numberOfCells:t.num_obs})}function Ai(e,t){var r;r={approximate:e.open("neighbor_index").open("parameters").open("approximate",{load:!0}).value>0};return{state:new ki(t,r,{}),parameters:Be({},r)}}var xi=new WeakMap,Ei=new WeakMap,Si=new WeakMap,Ii=new WeakSet,Bi=new WeakSet,zi=new WeakSet,Gi=new WeakSet,Fi=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,b.Z)(this,e),y(this,Gi),y(this,zi),y(this,Bi),y(this,Ii),(0,k.Z)(this,xi,{writable:!0,value:void 0}),(0,k.Z)(this,Ei,{writable:!0,value:void 0}),(0,k.Z)(this,Si,{writable:!0,value:void 0}),!(t instanceof ki))throw new Error("'index' should be a State object from './neighbor_index.js'");(0,A.Z)(this,xi,t),(0,A.Z)(this,Ei,null===r?{}:r),(0,A.Z)(this,Si,null===n?{}:n),this.changed=!1}return(0,_.Z)(e,[{key:"free",value:function(){Ge((0,Z.Z)(this,Si).neighbors),Ge((0,Z.Z)(this,Si).graph),Ge((0,Z.Z)(this,Si).clusters)}},{key:"fetchClustersAsWasmArray",value:function(){if(w(this,Ii,Oi).call(this))return(0,Z.Z)(this,Si).clusters.membership({copy:"view"});throw"cannot fetch SNN clusters from an invalid state"}},{key:"compute",value:function(e,t,r,n){this.changed=!1,((0,Z.Z)(this,xi).changed||t!==(0,Z.Z)(this,Ei).k)&&(Ge((0,Z.Z)(this,Si).neighbors),e?w(this,Bi,Ci).call(this,t):delete(0,Z.Z)(this,Si).neighbors,(0,Z.Z)(this,Ei).k=t,this.changed=!0),(this.changed||r!==(0,Z.Z)(this,Ei).scheme)&&(Ge((0,Z.Z)(this,Si).graph),e?w(this,zi,Di).call(this,r):delete(0,Z.Z)(this,Si).graph,(0,Z.Z)(this,Ei).scheme=r,this.changed=!0),(this.changed||n!==(0,Z.Z)(this,Ei).resolution||!w(this,Ii,Oi).call(this)&&e)&&(Ge((0,Z.Z)(this,Si).clusters),e?w(this,Gi,Ni).call(this,n):delete(0,Z.Z)(this,Si).clusters,(0,Z.Z)(this,Ei).resolution=n,this.changed=!0)}},{key:"summary",value:function(){return{}}},{key:"serialize",value:function(e){var t=e.createGroup("snn_graph_cluster"),r=t.createGroup("parameters");r.writeDataSet("k","Int32",[],(0,Z.Z)(this,Ei).k),r.writeDataSet("scheme","String",[],(0,Z.Z)(this,Ei).scheme),r.writeDataSet("resolution","Float64",[],(0,Z.Z)(this,Ei).resolution);var n=t.createGroup("results");if(w(this,Ii,Oi).call(this)){var a=this.fetchClustersAsWasmArray();n.writeDataSet("clusters","Int32",null,a)}}}]),e}();function Oi(){return"clusters"in(0,Z.Z)(this,Si)}function Ci(e){(0,Z.Z)(this,Si).neighbors=ie((0,Z.Z)(this,xi).fetchIndex(),e)}function Di(e){"neighbors"in(0,Z.Z)(this,Si)||w(this,Bi,Ci).call(this,(0,Z.Z)(this,Ei).k),(0,Z.Z)(this,Si).graph=function(e){var t,r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=a.scheme,s=void 0===i?"rank":i,o=a.neighbors,u=void 0===o?10:o;"number"==typeof s&&(s=["rank","number","jaccard"][s]);try{var h;e instanceof ae?h=e:(n=ie(e,u),h=n),t=l.RE((function(e){return e.build_snn_graph(h.results,s)})),r=new se(t)}catch(f){throw c.gd(t),f}finally{c.gd(n)}return r}((0,Z.Z)(this,Si).neighbors,{scheme:e})}function Ni(e){"graph"in(0,Z.Z)(this,Si)||w(this,zi,Di).call(this,(0,Z.Z)(this,Ei).scheme),(0,Z.Z)(this,Si).clusters=function(e){var t,r,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).resolution,a=void 0===n?1:n;try{t=l.RE((function(t){return t.cluster_snn_graph(e.graph,a)})),r=new oe(t)}catch(i){throw c.gd(t),i}return r}((0,Z.Z)(this,Si).graph,{resolution:e})}var Mi=function(){function e(t){(0,b.Z)(this,e),this.buffer=c.Wf(t.length),this.buffer.set(t)}return(0,_.Z)(e,[{key:"membership",value:function(e){var t=e.copy;return ze(this.buffer,t)}},{key:"free",value:function(){this.buffer.free()}}]),e}();function Ri(e,t){var r=e.open("snn_graph_cluster"),n={},a=r.open("parameters");n.k=a.open("k",{load:!0}).values[0],n.scheme=a.open("scheme",{load:!0}).values[0],"string"!==typeof n.scheme&&(n.scheme="rank"),n.resolution=a.open("resolution",{load:!0}).values[0];var i={},s=r.open("results");if("clusters"in s.children){var o=s.open("clusters",{load:!0}).values;i.clusters=new Mi(o)}return{state:new Fi(t,n,i),parameters:Be({},n)}}var Ui=new WeakMap,Qi=new WeakMap,Wi=new WeakMap,Ti=new WeakSet,ji=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,b.Z)(this,e),y(this,Ti),(0,k.Z)(this,Ui,{writable:!0,value:void 0}),(0,k.Z)(this,Qi,{writable:!0,value:void 0}),(0,k.Z)(this,Wi,{writable:!0,value:void 0}),!(t instanceof vi))throw new Error("'pca' should be a State object from './pca.js'");(0,A.Z)(this,Ui,t),(0,A.Z)(this,Qi,null===r?{}:r),(0,A.Z)(this,Wi,null===n?{}:n),this.changed=!1}return(0,_.Z)(e,[{key:"free",value:function(){Ge((0,Z.Z)(this,Wi).raw)}},{key:"fetchClustersAsWasmArray",value:function(){if(w(this,Ti,qi).call(this))return(0,Z.Z)(this,Wi).raw.clusters({copy:"view"});throw new Error("cannot fetch k-means clusters from an invalid state")}},{key:"compute",value:function(e,t){if(this.changed=!1,(0,Z.Z)(this,Ui).changed||t!=(0,Z.Z)(this,Qi).k||!w(this,Ti,qi).call(this)&&e){if(Ge((0,Z.Z)(this,Wi).raw),e){var r=(0,Z.Z)(this,Ui).fetchPCs();(0,Z.Z)(this,Wi).raw=ce(r.pcs,t,{numberOfDims:r.num_pcs,numberOfCells:r.num_obs,initMethod:"pca-part"})}else delete(0,Z.Z)(this,Wi).raw;(0,Z.Z)(this,Qi).k=t,this.changed=!0}}},{key:"summary",value:function(){return{}}},{key:"serialize",value:function(e){var t=e.createGroup("kmeans_cluster");t.createGroup("parameters").writeDataSet("k","Int32",[],(0,Z.Z)(this,Qi).k);var r=t.createGroup("results");if(w(this,Ti,qi).call(this)){var n=this.fetchClustersAsWasmArray();r.writeDataSet("clusters","Int32",null,n)}}}]),e}();function qi(){return"raw"in(0,Z.Z)(this,Wi)}var Pi=function(){function e(t){(0,b.Z)(this,e),this.buffer=c.Wf(t.length),this.buffer.set(t)}return(0,_.Z)(e,[{key:"clusters",value:function(e){var t=e.copy;return ze(this.buffer,t)}},{key:"free",value:function(){this.buffer.free()}}]),e}();function Li(e,t){var r={k:10},n={};if("kmeans_cluster"in e.children){var a=e.open("kmeans_cluster"),i=a.open("parameters");r.k=i.open("k",{load:!0}).values[0];var s=a.open("results");if("clusters"in s.children){var o=s.open("clusters",{load:!0}).values;n.raw=new Pi(o)}}return{state:new ji(t,r,n),parameters:Be({},r)}}var Hi=new WeakMap,Ji=new WeakMap,Yi=new WeakMap,Vi=new WeakMap,Xi=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,b.Z)(this,e),(0,k.Z)(this,Hi,{writable:!0,value:void 0}),(0,k.Z)(this,Ji,{writable:!0,value:void 0}),(0,k.Z)(this,Yi,{writable:!0,value:void 0}),(0,k.Z)(this,Vi,{writable:!0,value:void 0}),!(t instanceof Fi))throw new Error("'snn' should be a State object from './snn_graph_cluster.js'");if((0,A.Z)(this,Hi,t),!(r instanceof ji))throw new Error("'kmeans' should be a State object from './kmeans_cluster.js'");(0,A.Z)(this,Ji,r),(0,A.Z)(this,Yi,null===n?{}:n),(0,A.Z)(this,Vi,null===a?{}:a),this.changed=!1}return(0,_.Z)(e,[{key:"free",value:function(){}},{key:"fetchClustersAsWasmArray",value:function(){return"snn_graph"==(0,Z.Z)(this,Yi).method?(0,Z.Z)(this,Hi).fetchClustersAsWasmArray():"kmeans"==(0,Z.Z)(this,Yi).method?(0,Z.Z)(this,Ji).fetchClustersAsWasmArray():void 0}},{key:"compute",value:function(e){this.changed=!0,e==(0,Z.Z)(this,Yi).method&&("snn_graph"==e?(0,Z.Z)(this,Hi).changed||(this.changed=!1):"kmeans"==e&&((0,Z.Z)(this,Ji).changed||(this.changed=!1))),(0,Z.Z)(this,Yi).method=e}},{key:"summary",value:function(){return{clusters:this.fetchClustersAsWasmArray().slice()}}},{key:"serialize",value:function(e){var t=e.createGroup("choose_clustering");t.createGroup("parameters").writeDataSet("method","String",[],(0,Z.Z)(this,Yi).method),t.createGroup("results")}}]),e}();function Ki(e,t,r){var n;n={method:e.open("choose_clustering").open("parameters").open("method",{load:!0}).values[0]};return{state:new Xi(t,r,n,{}),parameters:Be({},n)}}function $i(){return new Worker(new URL(r.p+r.u(370),r.b),{type:void 0})}function es(){return new Worker(new URL(r.p+r.u(792),r.b),{type:void 0})}function ts(e,t,r){e.postMessage(t,r)}var rs=function(e,t,r){return null};function ns(e){var t=rs;return rs=e,t}var as={numberOfThreads:1};function is(e,t){var r=e.fetchIndex(),n={num_obs:r.numberOfCells()},a=null,i=null,s=null,o=null;try{a=ie(r,t),i=c.Wf(a.numberOfCells()),s=c.Wf(a.size()),o=c.RJ(a.size()),a.serialize({runs:i,indices:s,distances:o}),n.size=a.size(),n.runs=i.array().slice(),n.indices=s.array().slice(),n.distances=o.array().slice()}finally{null!==a&&a.free(),null!==i&&i.free(),null!==s&&s.free(),null!==o&&o.free()}return n}function ss(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=r.counter,i=new Promise((function(e,t){r.promises[a]={resolve:e,reject:t}}));return r.counter++,t.id=a,ts(e,t,n),i}var os=[];function us(e,t,r){var n=os.length;return os.push(e),function(e,t){e.onmessage=t}(e,(function(e){var r=e.data.type;if(r.endsWith("_iter"))rs(r.slice(0,-5),e.data.x,e.data.y,e.data.iteration);else{var n=e.data.id,a=t.promises[n];"error"==r?a.reject(e.data.error):a.resolve(e.data.data),delete t.promises[n]}})),{worker_id:n,ready:ss(e,{cmd:"INIT",scranOptions:r},t)}}function ls(e){var t=os[e];return os[e]=null,function(e){e.terminate()}(t)}function cs(e,t,r,n){var a={cmd:"RUN",params:t},i=[];return null!==r&&(i=[r.runs.buffer,r.indices.buffer,r.distances.buffer],a.neighbors=r),ss(e,a,n,i)}var hs=new WeakMap,fs=new WeakMap,ds=new WeakMap,vs=new WeakMap,ps=new WeakMap,ms=new WeakMap,gs=new WeakMap,ys=new WeakMap,ws=new WeakSet,bs=new WeakSet,_s=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,b.Z)(this,e),y(this,bs),y(this,ws),(0,k.Z)(this,hs,{writable:!0,value:void 0}),(0,k.Z)(this,fs,{writable:!0,value:void 0}),(0,k.Z)(this,ds,{writable:!0,value:void 0}),(0,k.Z)(this,vs,{writable:!0,value:void 0}),(0,k.Z)(this,ps,{writable:!0,value:void 0}),(0,k.Z)(this,ms,{writable:!0,value:void 0}),(0,k.Z)(this,gs,{writable:!0,value:void 0}),(0,k.Z)(this,ys,{writable:!0,value:void 0}),!(t instanceof ki))throw new Error("'index' should be a State object from './neighbor_index.js'");(0,A.Z)(this,hs,t),(0,A.Z)(this,fs,null===r?{}:r),(0,A.Z)(this,ds,{counter:0,promises:{}}),(0,A.Z)(this,vs,n),this.changed=!1;var a=$i(),i=us(a,(0,Z.Z)(this,ds),as),s=i.worker_id,o=i.ready;(0,A.Z)(this,ps,a),(0,A.Z)(this,ms,s),(0,A.Z)(this,gs,o),(0,A.Z)(this,ys,null)}return(0,_.Z)(e,[{key:"ready",value:function(){return(0,Z.Z)(this,gs)}},{key:"free",value:function(){return ls((0,Z.Z)(this,ms))}},{key:"compute",value:function(e,t,r){var n=!(0,Z.Z)(this,hs).changed&&e===(0,Z.Z)(this,fs).perplexity;return n&&t==(0,Z.Z)(this,fs).iterations?(this.changed=!1,new Promise((function(e){return e(null)}))):(null!==(0,Z.Z)(this,vs)&&(n=!1,(0,A.Z)(this,vs,null)),w(this,ws,ks).call(this,e,t,r,!n),(0,Z.Z)(this,fs).perplexity=e,(0,Z.Z)(this,fs).iterations=t,(0,Z.Z)(this,fs).animate=r,this.changed=!0,(0,Z.Z)(this,ys))}},{key:"summary",value:function(){return w(this,bs,Zs).call(this,!0)}},{key:"serialize",value:function(){var e=(0,o.Z)(u.mark((function e(t){var r,n,a,i;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.createGroup("tsne"),(n=r.createGroup("parameters")).writeDataSet("perplexity","Float64",[],(0,Z.Z)(this,fs).perplexity),n.writeDataSet("iterations","Int32",[],(0,Z.Z)(this,fs).iterations),n.writeDataSet("animate","Uint8",[],Number((0,Z.Z)(this,fs).animate)),e.next=7,w(this,bs,Zs).call(this,!1);case 7:return a=e.sent,(i=r.createGroup("results")).writeDataSet("x","Float64",null,a.x),i.writeDataSet("y","Float64",null,a.y),e.abrupt("return");case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"animate",value:function(){return null!==(0,Z.Z)(this,vs)?((0,A.Z)(this,vs,null),w(this,ws,ks).call(this,(0,Z.Z)(this,fs).perplexity,(0,Z.Z)(this,fs).iterations,!0,!0),(0,Z.Z)(this,ys).then((function(e){return{type:"tsne_rerun",data:{status:"SUCCESS"}}}))):ss((0,Z.Z)(this,ps),{cmd:"RERUN"},(0,Z.Z)(this,ds))}}]),e}();function ks(e,t,r,n){var a=null;if(n){var i=ue(e);a=is((0,Z.Z)(this,hs),i)}var s={perplexity:e,iterations:t,animate:r};(0,A.Z)(this,ys,cs((0,Z.Z)(this,ps),s,a,(0,Z.Z)(this,ds)))}function Zs(e){return As.apply(this,arguments)}function As(){return(As=(0,o.Z)(u.mark((function e(t){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(0,Z.Z)(this,vs)){e.next=7;break}return r={x:(0,Z.Z)(this,vs).x,y:(0,Z.Z)(this,vs).y},t&&(r.x=r.x.slice(),r.y=r.y.slice()),r.iterations=(0,Z.Z)(this,fs).iterations,e.abrupt("return",r);case 7:return e.next=9,(0,Z.Z)(this,ys);case 9:return e.abrupt("return",ss((0,Z.Z)(this,ps),{cmd:"FETCH"},(0,Z.Z)(this,ds)));case 10:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function xs(e,t){var r,n,a=e.open("tsne"),i=a.open("parameters");r={perplexity:i.open("perplexity",{load:!0}).values[0],iterations:i.open("iterations",{load:!0}).values[0],animate:i.open("animate",{load:!0}).values[0]>0};var s=a.open("results");return n={x:s.open("x",{load:!0}).values,y:s.open("y",{load:!0}).values},{state:new _s(t,r,n),parameters:Be({},r)}}var Es=new WeakMap,Ss=new WeakMap,Is=new WeakMap,Bs=new WeakMap,zs=new WeakMap,Gs=new WeakMap,Fs=new WeakMap,Os=new WeakMap,Cs=new WeakSet,Ds=new WeakSet,Ns=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,b.Z)(this,e),y(this,Ds),y(this,Cs),(0,k.Z)(this,Es,{writable:!0,value:void 0}),(0,k.Z)(this,Ss,{writable:!0,value:void 0}),(0,k.Z)(this,Is,{writable:!0,value:void 0}),(0,k.Z)(this,Bs,{writable:!0,value:void 0}),(0,k.Z)(this,zs,{writable:!0,value:void 0}),(0,k.Z)(this,Gs,{writable:!0,value:void 0}),(0,k.Z)(this,Fs,{writable:!0,value:void 0}),(0,k.Z)(this,Os,{writable:!0,value:void 0}),!(t instanceof ki))throw new Error("'index' should be a State object from './neighbor_index.js'");(0,A.Z)(this,Es,t),(0,A.Z)(this,Ss,null===r?{}:r),(0,A.Z)(this,Is,{counter:0,promises:{}}),(0,A.Z)(this,Bs,n),this.changed=!1;var a=es(),i=us(a,(0,Z.Z)(this,Is),as),s=i.worker_id,o=i.ready;(0,A.Z)(this,zs,a),(0,A.Z)(this,Gs,s),(0,A.Z)(this,Fs,o),(0,A.Z)(this,Os,null)}return(0,_.Z)(e,[{key:"ready",value:function(){return(0,Z.Z)(this,Fs)}},{key:"free",value:function(){return ls((0,Z.Z)(this,Gs))}},{key:"compute",value:function(e,t,r,n){var a=!(0,Z.Z)(this,Es).changed&&(0,Z.Z)(this,Ss).num_neighbors===e;return a&&t===(0,Z.Z)(this,Ss).num_epochs&&r===(0,Z.Z)(this,Ss).min_dist?(this.changed=!1,new Promise((function(e){return e(null)}))):(null!==(0,Z.Z)(this,Bs)&&(a=!1,(0,A.Z)(this,Bs,null)),w(this,Cs,Ms).call(this,e,t,r,n,!a),(0,Z.Z)(this,Ss).num_neighbors=e,(0,Z.Z)(this,Ss).num_epochs=t,(0,Z.Z)(this,Ss).min_dist=r,(0,Z.Z)(this,Ss).animate=n,this.changed=!0,(0,Z.Z)(this,Os))}},{key:"summary",value:function(){return w(this,Ds,Rs).call(this,!0)}},{key:"serialize",value:function(){var e=(0,o.Z)(u.mark((function e(t){var r,n,a,i;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.createGroup("umap"),(n=r.createGroup("parameters")).writeDataSet("num_neighbors","Int32",[],(0,Z.Z)(this,Ss).num_neighbors),n.writeDataSet("num_epochs","Int32",[],(0,Z.Z)(this,Ss).num_epochs),n.writeDataSet("min_dist","Float64",[],(0,Z.Z)(this,Ss).min_dist),n.writeDataSet("animate","Uint8",[],Number((0,Z.Z)(this,Ss).animate)),e.next=8,w(this,Ds,Rs).call(this,!1);case 8:return a=e.sent,(i=r.createGroup("results")).writeDataSet("x","Float64",null,a.x),i.writeDataSet("y","Float64",null,a.y),e.abrupt("return");case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"animate",value:function(){return null!==(0,Z.Z)(this,Bs)?((0,A.Z)(this,Bs,null),w(this,Cs,Ms).call(this,(0,Z.Z)(this,Ss).num_neighbors,(0,Z.Z)(this,Ss).num_epochs,(0,Z.Z)(this,Ss).min_dist,!0,!0),(0,Z.Z)(this,Os).then((function(e){return{type:"umap_rerun",data:{status:"SUCCESS"}}}))):ss((0,Z.Z)(this,zs),{cmd:"RERUN"},(0,Z.Z)(this,Is))}}]),e}();function Ms(e,t,r,n,a){var i=null;a&&(i=is((0,Z.Z)(this,Es),e));var s={num_neighbors:e,num_epochs:t,min_dist:r,animate:n};(0,A.Z)(this,Os,cs((0,Z.Z)(this,zs),s,i,(0,Z.Z)(this,Is)))}function Rs(e){return Us.apply(this,arguments)}function Us(){return(Us=(0,o.Z)(u.mark((function e(t){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(0,Z.Z)(this,Bs)){e.next=7;break}return r={x:(0,Z.Z)(this,Bs).x,y:(0,Z.Z)(this,Bs).y},t&&(r.x=r.x.slice(),r.y=r.y.slice()),r.iterations=(0,Z.Z)(this,Ss).num_epochs,e.abrupt("return",r);case 7:return e.next=9,(0,Z.Z)(this,Os);case 9:return e.abrupt("return",ss((0,Z.Z)(this,zs),{cmd:"FETCH"},(0,Z.Z)(this,Is)));case 10:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function Qs(e,t){var r,n,a=e.open("umap"),i=a.open("parameters");r={num_neighbors:i.open("num_neighbors",{load:!0}).values[0],num_epochs:i.open("num_epochs",{load:!0}).values[0],min_dist:i.open("min_dist",{load:!0}).values[0],animate:i.open("animate",{load:!0}).values[0]>0};var s=a.open("results");return n={x:s.open("x",{load:!0}).values,y:s.open("y",{load:!0}).values},{state:new Ns(t,r,n),parameters:Be({},r)}}var Ws={min:0,mean:1,min_rank:4},Ts={0:"min",1:"mean",4:"min_rank"};function js(e,t,r){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=n.no_summaries,i=void 0!==a&&a,o=0,u=["means","detected"];o<u.length;o++){var l=u[o],c=t[l](r,{copy:"hdf5"});e.writeDataSet(l,"Float64",null,c)}for(var h=function(){var n=d[f],a=n;"delta_detected"==n&&(a="deltaDetected");var o=function(e){return t[a](r,{summary:e,copy:"hdf5"})};if(i){var u=o(Ws.mean);e.writeDataSet(n,"Float64",null,u)}else for(var l=e.createGroup(n),c=0,h=Object.entries(Ws);c<h.length;c++){var v=(0,s.Z)(h[c],2),p=v[0],m=o(v[1]);l.writeDataSet(p,"Float64",null,m)}},f=0,d=["lfc","delta_detected","auc","cohen"];f<d.length;f++)h()}function qs(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.no_summaries,a=void 0!==n&&n,i={},s=0,o=["means","detected"];s<o.length;s++){var u=o[s];i[u]=e.open(u,{load:!0}).values,t(i[u])}for(var l=0,c=["lfc","delta_detected","auc","cohen"];l<c.length;l++){var h=c[l];if(a)i[h]=e.open(h,{load:!0}).values;else{for(var f=e.open(h),d={},v=0,p=Object.keys(Ws);v<p.length;v++){var m=p[v];d[m]=f.open(m,{load:!0}).values,t(d[m])}i[h]=d}}return i}function Ps(e,t,r){var n;r&&void 0!==r||(r="cohen-min-rank");var a,i=!1,s=1;if(r.match(/-min$/)?s=0:r.match(/-min-rank$/)&&(i=!0,s=4),r.match(/^cohen-/))a=e.cohen(t,{summary:s,copy:!1});else if(r.match(/^auc-/))a=e.auc(t,{summary:s,copy:!1});else if(r.match(/^lfc-/))a=e.lfc(t,{summary:s,copy:!1});else{if(!r.match(/^delta-d-/))throw"unknown rank type '"+r+"'";a=e.deltaDetected(t,{summary:s,copy:!1})}n=new Int32Array(a.length);for(var o=0;o<n.length;o++)n[o]=o;i?n.sort((function(e,t){return a[e]-a[t]})):n.sort((function(e,t){return a[t]-a[e]}));var u=function(e){for(var t=new Float64Array(e.length),r=0;r<n.length;r++)t[r]=e[n[r]];return t},l=u(e.detected(t,{copy:!1})),c=u(e.means(t,{copy:!1})),h=u(e.lfc(t,{summary:1,copy:!1})),f=u(e.deltaDetected(t,{summary:1,copy:!1}));return{ordering:n,means:c,detected:l,lfc:h,delta_detected:f}}var Ls=new WeakMap,Hs=new WeakMap,Js=new WeakMap,Ys=new WeakMap,Vs=new WeakMap,Xs=function(){function e(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if((0,b.Z)(this,e),(0,k.Z)(this,Ls,{writable:!0,value:void 0}),(0,k.Z)(this,Hs,{writable:!0,value:void 0}),(0,k.Z)(this,Js,{writable:!0,value:void 0}),(0,k.Z)(this,Ys,{writable:!0,value:void 0}),(0,k.Z)(this,Vs,{writable:!0,value:void 0}),!(t instanceof Wa))throw new Error("'qc' should be a State object from './quality_control.js'");if((0,A.Z)(this,Ls,t),!(r instanceof Xa))throw new Error("'norm' should be a State object from './normalization.js'");if((0,A.Z)(this,Hs,r),!(n instanceof Xi))throw new Error("'choice' should be a State object from './choose_clustering.js'");(0,A.Z)(this,Js,n),(0,A.Z)(this,Ys,null===a?{}:a),(0,A.Z)(this,Vs,null===i?{}:i),this.changed=!1}return(0,_.Z)(e,[{key:"free",value:function(){Ge((0,Z.Z)(this,Vs).raw)}},{key:"fetchGroupResults",value:function(e,t){return Ps((0,Z.Z)(this,Vs).raw,e,t)}},{key:"numberOfGroups",value:function(){return(0,Z.Z)(this,Vs).raw.numberOfGroups()}},{key:"fetchGroupMeans",value:function(e,t){var r=t.copy,n=void 0===r||r;return(0,Z.Z)(this,Vs).raw.means(e,{copy:n})}},{key:"compute",value:function(){if(this.changed=!1,(0,Z.Z)(this,Hs).changed||(0,Z.Z)(this,Js).changed){var e=(0,Z.Z)(this,Hs).fetchNormalizedMatrix(),t=(0,Z.Z)(this,Js).fetchClustersAsWasmArray(),r=(0,Z.Z)(this,Ls).fetchFilteredBlock();Ge((0,Z.Z)(this,Vs).raw),(0,Z.Z)(this,Vs).raw=fe(e,t,{block:r}),this.changed=!0}}},{key:"summary",value:function(){return{}}},{key:"serialize",value:function(e){var t=e.createGroup("marker_detection");t.createGroup("parameters");for(var r=t.createGroup("results").createGroup("clusters"),n=(0,Z.Z)(this,Vs).raw.numberOfGroups(),a=0;a<n;a++){js(r.createGroup(String(a)),(0,Z.Z)(this,Vs).raw,a)}}}]),e}(),Ks=function(){function e(t){(0,b.Z)(this,e),this.clusters=t}return(0,_.Z)(e,[{key:"effect_grabber",value:function(e,t,r,n){var a=Ts[r];return ze(this.clusters[t][e][a],n)}},{key:"lfc",value:function(e,t){var r=t.summary,n=t.copy;return this.effect_grabber("lfc",e,r,n)}},{key:"deltaDetected",value:function(e,t){var r=t.summary,n=t.copy;return this.effect_grabber("delta_detected",e,r,n)}},{key:"cohen",value:function(e,t){var r=t.summary,n=t.copy;return this.effect_grabber("cohen",e,r,n)}},{key:"auc",value:function(e,t){var r=t.summary,n=t.copy;return this.effect_grabber("auc",e,r,n)}},{key:"stat_grabber",value:function(e,t,r){return ze(this.clusters[t][e],r)}},{key:"means",value:function(e,t){var r=t.copy;return this.stat_grabber("means",e,r)}},{key:"detected",value:function(e,t){var r=t.copy;return this.stat_grabber("detected",e,r)}},{key:"numberOfGroups",value:function(){return Object.keys(this.clusters).length}},{key:"free",value:function(){}}]),e}();function $s(e,t,r,n,a){for(var i={},s={},o=e.open("marker_detection").open("results").open("clusters"),u={},l=0,c=Object.keys(o.children);l<c.length;l++){var h=c[l];u[Number(h)]=qs(o.open(h),t)}return s.raw=new Ks(u),{state:new Xs(r,n,a,i,s),parameters:Be({},i)}}var eo=function(){var e=(0,o.Z)(u.mark((function e(t){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:if((r=e.sent).ok){e.next=5;break}throw new Error("failed to fetch content at "+t+"("+r.status+")");case 5:return e.next=7,r.arrayBuffer();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),to="https://cors-proxy.aaron-lun.workers.dev",ro="https://github.com/clusterfork/singlepp-references/releases/download/hs-latest",no="https://github.com/clusterfork/singlepp-references/releases/download/mm-latest",ao={},io={},so=new WeakMap,oo=new WeakMap,uo=new WeakMap,lo=new WeakMap,co=new WeakMap,ho=new WeakMap,fo=new WeakSet,vo=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,b.Z)(this,e),y(this,fo),(0,k.Z)(this,so,{writable:!0,value:void 0}),(0,k.Z)(this,oo,{writable:!0,value:void 0}),(0,k.Z)(this,uo,{writable:!0,value:void 0}),(0,k.Z)(this,lo,{writable:!0,value:void 0}),(0,k.Z)(this,co,{writable:!0,value:void 0}),(0,k.Z)(this,ho,{writable:!0,value:void 0}),!(t instanceof xa))throw new Error("'inputs' should be a State object from './inputs.js'");if((0,A.Z)(this,so,t),!(r instanceof Xs))throw new Error("'markers' should be a State object from './marker_detection.js'");(0,A.Z)(this,oo,r),(0,A.Z)(this,uo,null===n?{}:n),(0,A.Z)(this,lo,null===a?{}:a),this.changed=!1,(0,A.Z)(this,co,{}),(0,A.Z)(this,ho,{})}return(0,_.Z)(e,[{key:"free",value:function(){Ge((0,Z.Z)(this,lo).buffer);for(var e=0,t=Object.entries((0,Z.Z)(this,co));e<t.length;e++){var r=(0,s.Z)(t[e],2);r[0];r[1].raw.free()}for(var n=0,a=Object.entries((0,Z.Z)(this,ho));n<a.length;n++){var i=(0,s.Z)(a[n],2);i[0];i[1].raw.free()}}},{key:"compute",value:function(e,t){var r=this;if(!(0,Z.Z)(this,so).changed&&!(0,Z.Z)(this,oo).changed&&go(e,(0,Z.Z)(this,uo).human_references)&&go(t,(0,Z.Z)(this,uo).mouse_references))return this.changed=!1,new Promise((function(e){return e(null)}));if((0,Z.Z)(this,so).changed||!("features"in(0,Z.Z)(this,lo))){var n=function(e){for(var t=e.fetchGenes(),r=e.fetchGeneTypes(),n=null,a=null,i=0,o=Object.entries(r);i<o.length;i++){var u=(0,s.Z)(o[i],2),l=u[0],c=u[1];(null===a||c.confidence>a.confidence)&&(n=l,a=c)}return{features:t[n],details:a}}((0,Z.Z)(this,so));(0,Z.Z)(this,lo).features=n.features,(0,Z.Z)(this,lo).feature_details=n.details}var a=(0,Z.Z)(this,lo).feature_details.species,i={};if("human"==a){var h,f=(0,x.Z)(e);try{for(f.s();!(h=f.n()).done;){var d=h.value;i[d]=w(this,fo,po).call(this,d,"human",(0,Z.Z)(this,so).changed)}}catch(Xt){f.e(Xt)}finally{f.f()}}else if("mouse"==a){var v,p=(0,x.Z)(t);try{for(p.s();!(v=p.n()).done;){var m=v.value;i[m]=w(this,fo,po).call(this,m,"mouse",(0,Z.Z)(this,so).changed)}}catch(Xt){p.e(Xt)}finally{p.f()}}var g=(0,Z.Z)(this,lo).buffer,y=(0,Z.Z)(this,lo).features.length,b=(0,Z.Z)(this,oo).numberOfGroups();if((0,Z.Z)(this,oo).changed||"undefined"===typeof g){g=Fe(b*y,"Float64Array",(0,Z.Z)(this,lo));for(var _=0;_<b;_++){var k=(0,Z.Z)(this,oo).fetchGroupMeans(_,{copy:!1});g.array().set(k,_*y)}}var A=[];(0,Z.Z)(this,lo).results={};for(var E=0,S=Object.entries(i);E<S.length;E++){var I=(0,s.Z)(S[E],2),B=I[0],z=I[1].then((function(e){var t,r=be(g,e.built.raw,{numberOfFeatures:y,numberOfCells:b}),n=[],a=(0,x.Z)(r);try{for(a.s();!(t=a.n()).done;){var i=t.value;n.push(e.loaded.labels[i])}}catch(Xt){a.e(Xt)}finally{a.f()}return n}));(0,Z.Z)(this,lo).results[B]=z,A.push(z)}var G=Object.keys(i);if(G.length>1){if((0,Z.Z)(this,so).changed||!go(G,(0,Z.Z)(this,lo).used)||!("integrated"in(0,Z.Z)(this,lo))){var F=Object.values(i);(0,Z.Z)(this,lo).integrated=Promise.all(F).then((function(e){var t=e.map((function(e){return e.loaded.raw})),n=e.map((function(e){return e.built.features})),a=e.map((function(e){return e.built.raw}));return function(e,t,r,n){var a,i,s,o,u,h,f=t.length;if(r.length!=f)throw new Error("'loaded' and 'referenceFeatures' should be of the same length");if(n.length!=f)throw new Error("'loaded' and 'built' should be of the same length");for(var d=0;d<f;d++)if(t[d].numberOfFeatures()!=r[d].length)throw new Error("length of each 'referenceFeatures' should be equal to the number of features in the corresponding 'loaded'");var v=new Array(f);try{a=c.Wf(e.length);var p=me(e,a),m=(i=c.GF(f)).array();for(d=0;d<f;d++)m[d]=BigInt(t[d].reference.$$.ptr);var g=(s=c.GF(f)).array();for(d=0;d<f;d++){var y=r[d];y instanceof V.do?g[d]=BigInt(y.offset):(v[d]=c.Wf(y.length),ge(y,p,v[d]),g[d]=BigInt(v[d].offset))}var w=(o=c.GF(f)).array();for(d=0;d<f;d++)w[d]=BigInt(n[d].reference.$$.ptr);u=l.RE((function(t){return t.integrate_singlepp_references(e.length,a.offset,f,i.offset,s.offset,o.offset)})),(h=new _e(u)).expectedNumberOfFeatures=e.length}catch(Z){throw c.gd(u),Z}finally{c.gd(a),c.gd(i),c.gd(o),c.gd(s);for(var b=0,_=v;b<_.length;b++){var k=_[b];c.gd(k)}}return h}((0,Z.Z)(r,lo).features,t,n,a)}))}var O=(0,Z.Z)(this,lo).integrated.then(function(){var e=(0,o.Z)(u.mark((function e(t){var n,a,i,s,o,l;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],a=(0,x.Z)(G),e.prev=2,a.s();case 4:if((i=a.n()).done){e.next=13;break}return s=i.value,e.t0=n,e.next=9,(0,Z.Z)(r,lo).results[s];case 9:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t2=e.catch(2),a.e(e.t2);case 18:return e.prev=18,a.f(),e.finish(18);case 21:return o=ke(g,n,t,{numberOfFeatures:y,numberOfCells:b}),l=[],o.forEach((function(e){l.push(G[e])})),e.abrupt("return",l);case 25:case"end":return e.stop()}}),e,null,[[2,15,18,21]])})));return function(t){return e.apply(this,arguments)}}());(0,Z.Z)(this,lo).integrated_results=O,A.push(O)}else delete(0,Z.Z)(this,lo).integrated_results;return(0,Z.Z)(this,lo).used=G,(0,Z.Z)(this,uo).human_references=e,(0,Z.Z)(this,uo).mouse_references=t,this.changed=!0,Promise.all(A).then((function(e){return null}))}},{key:"summary",value:function(){var e=(0,o.Z)(u.mark((function e(){var t,r,n,a,i,o,l;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={},r=0,n=Object.entries((0,Z.Z)(this,lo).results);case 2:if(!(r<n.length)){e.next=10;break}return a=(0,s.Z)(n[r],2),i=a[0],o=a[1],e.next=6,o;case 6:t[i]=e.sent;case 7:r++,e.next=2;break;case 10:if(l={per_reference:t},!("integrated_results"in(0,Z.Z)(this,lo))){e.next=15;break}return e.next=14,(0,Z.Z)(this,lo).integrated_results;case 14:l.integrated=e.sent;case 15:return e.abrupt("return",l);case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialize",value:function(){var e=(0,o.Z)(u.mark((function e(t){var r,n,a,i,o,l,c,h,f,d;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.createGroup("cell_labelling"),(n=r.createGroup("parameters")).writeDataSet("mouse_references","String",null,(0,Z.Z)(this,uo).mouse_references),n.writeDataSet("human_references","String",null,(0,Z.Z)(this,uo).human_references),a=r.createGroup("results"),e.next=7,this.summary();case 7:for(i=e.sent,o=a.createGroup("per_reference"),l=0,c=Object.entries(i.per_reference);l<c.length;l++)h=(0,s.Z)(c[l],2),f=h[0],d=h[1],o.writeDataSet(f,"String",null,d);return"integrated"in i&&a.writeDataSet("integrated","String",null,i.integrated),e.abrupt("return");case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function po(e,t,r){return mo.apply(this,arguments)}function mo(){return mo=(0,o.Z)(u.mark((function e(t,r,n){var a,i,s,o,l,c,h,f,d,v,p,m,g;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("human"==r?(a=ro,i=ao,s=(0,Z.Z)(this,co)):(a=no,i=io,s=(0,Z.Z)(this,ho)),t in i){e.next=19;break}return e.next=4,Promise.all([eo(to+"/"+encodeURIComponent(a+"/"+t+"_genes.csv.gz")),eo(to+"/"+encodeURIComponent(a+"/"+t+"_labels_fine.csv.gz")),eo(to+"/"+encodeURIComponent(a+"/"+t+"_label_names_fine.csv.gz")),eo(to+"/"+encodeURIComponent(a+"/"+t+"_markers_fine.gmt.gz")),eo(to+"/"+encodeURIComponent(a+"/"+t+"_matrix.csv.gz"))]);case 4:o=e.sent,e.prev=5,l=ve(new Uint8Array(o[4]),new Uint8Array(o[3]),new Uint8Array(o[1])),c=Nn(new Uint8Array(o[0])),h=[],f=[],c.forEach((function(e){var t=e.split(",");h.push(t[0]),f.push(t[1])})),d=Nn(new Uint8Array(o[2])),i[t]={raw:l,genes:{ensembl:h,symbol:f},labels:d},e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(5),Ge(l),e.t0;case 19:if(t in s&&!n){e.next=33;break}e.prev=20,t in s&&Ge(s[t].raw),v=i[t],p=v.raw,m="ensembl"===(0,Z.Z)(this,lo).feature_details.type?v.genes.ensembl:v.genes.symbol,g=ye((0,Z.Z)(this,lo).features,p,m),s[t]={features:m,raw:g},e.next=33;break;case 29:throw e.prev=29,e.t1=e.catch(20),Ge(undefined),e.t1;case 33:return e.abrupt("return",{loaded:i[t],built:s[t]});case 34:case"end":return e.stop()}}),e,this,[[5,15],[20,29]])}))),mo.apply(this,arguments)}function go(e,t){if("undefined"===typeof e||"undefined"===typeof t)return!1;if(e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!=t[r])return!1;return!0}function yo(e,t,r){var n={mouse_references:[],human_references:[]},a={results:{}};if("cell_labelling"in e.children){var i=e.open("cell_labelling"),s=i.open("parameters");n.mouse_references=s.open("mouse_references",{load:!0}).values,n.human_references=s.open("human_references",{load:!0}).values;for(var o=i.open("results"),u=o.open("per_reference"),l=0,c=Object.keys(u.children);l<c.length;l++){var h=c[l];a.results[h]=u.open(h,{load:!0}).values}"integrated"in o.children&&(a.integrated_results=o.open("integrated",{load:!0}).values)}return{state:new vo(t,r,n,a),parameters:Be({},n)}}function wo(e){var t=eo;return eo=e,t}var bo=new WeakMap,_o=new WeakMap,ko=new WeakMap,Zo=new WeakMap,Ao=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,b.Z)(this,e),(0,k.Z)(this,bo,{writable:!0,value:void 0}),(0,k.Z)(this,_o,{writable:!0,value:void 0}),(0,k.Z)(this,ko,{writable:!0,value:void 0}),(0,k.Z)(this,Zo,{writable:!0,value:void 0}),!(t instanceof Wa))throw new Error("'qc' should be a State object from './quality_control.js'");if((0,A.Z)(this,bo,t),!(r instanceof Xa))throw new Error("'norm' should be a State object from './normalization.js'");(0,A.Z)(this,_o,r),(0,A.Z)(this,ko,null===a?{results:{}}:a),(0,A.Z)(this,Zo,null===n?{selections:{}}:n),this.changed=!1}return(0,_.Z)(e,[{key:"free",value:function(){Ge((0,Z.Z)(this,ko).buffer);for(var e=0,t=Object.entries((0,Z.Z)(this,ko).results);e<t.length;e++){var r=(0,s.Z)(t[e],2);r[0];r[1].raw.free()}}},{key:"addSelection",value:function(e,t){var r=(0,Z.Z)(this,_o).fetchNormalizedMatrix(),n=Fe(r.numberOfColumns(),"Int32Array",(0,Z.Z)(this,ko));n.fill(0);var a=n.array();t.forEach((function(e){a[e]=1}));var i=fe(r,n);e in(0,Z.Z)(this,ko).results&&Ge((0,Z.Z)(this,ko).results[e].raw),(0,Z.Z)(this,ko).results[e]={raw:i},(0,Z.Z)(this,Zo).selections[e]=t}},{key:"removeSelection",value:function(e){Ge((0,Z.Z)(this,ko).results[e].raw),delete(0,Z.Z)(this,ko).results[e],delete(0,Z.Z)(this,Zo).selections[e]}},{key:"fetchResults",value:function(e,t){return Ps((0,Z.Z)(this,ko).results[e].raw,1,t+"-mean")}},{key:"compute",value:function(){if(this.changed=!1,(0,Z.Z)(this,bo).changed){for(var e=0,t=Object.entries((0,Z.Z)(this,ko).results);e<t.length;e++){var r=(0,s.Z)(t[e],2);r[0];Ge(r[1].raw)}(0,Z.Z)(this,Zo).selections={},(0,Z.Z)(this,ko).results={},this.changed=!0}}},{key:"summary",value:function(){return{}}},{key:"serialize",value:function(e){for(var t=e.createGroup("custom_selections"),r=t.createGroup("parameters").createGroup("selections"),n=0,a=Object.entries((0,Z.Z)(this,Zo).selections);n<a.length;n++){var i=(0,s.Z)(a[n],2),o=i[0],u=i[1];r.writeDataSet(String(o),"Int32",null,u)}for(var l=t.createGroup("results").createGroup("markers"),c=0,h=Object.entries((0,Z.Z)(this,ko).results);c<h.length;c++){var f=(0,s.Z)(h[c],2),d=f[0],v=f[1];js(l.createGroup(d),v.raw,1,{no_summaries:!0})}}}]),e}(),xo=function(){function e(t){(0,b.Z)(this,e),this.results=t}return(0,_.Z)(e,[{key:"effect_grabber",value:function(e,t,r,n){if(1!=t)throw"only group 1 is supported for custom marker mimics";if(1!=r)throw"only the mean effect size is supported for custom marker mimics";return ze(this.results[t][e],n)}},{key:"lfc",value:function(e,t){var r=t.summary,n=t.copy;return this.effect_grabber("lfc",e,r,n)}},{key:"deltaDetected",value:function(e,t){var r=t.summary,n=t.copy;return this.effect_grabber("delta_detected",e,r,n)}},{key:"cohen",value:function(e,t){var r=t.summary,n=t.copy;return this.effect_grabber("cohen",e,r,n)}},{key:"auc",value:function(e,t){var r=t.summary,n=t.copy;return this.effect_grabber("auc",e,r,n)}},{key:"stat_grabber",value:function(e,t,r){return ze(this.results[t][e],r)}},{key:"means",value:function(e,t){var r=t.copy;return this.stat_grabber("means",e,r)}},{key:"detected",value:function(e,t){var r=t.copy;return this.stat_grabber("detected",e,r)}},{key:"free",value:function(){}}]),e}();function Eo(e,t,r,n){for(var a=e.open("custom_selections"),i={selections:{}},o=a.open("parameters").open("selections"),u=0,l=Object.keys(o.children);u<l.length;u++){var c=l[u];i.selections[c]=o.open(c,{load:!0}).values}for(var h={results:{}},f=a.open("results").open("markers"),d=0,v=Object.keys(f.children);d<v.length;d++){var p=v[d],m=qs(f.open(p),t,{no_summaries:!0});h.results[p]={raw:new xo({1:m})}}for(var g={selections:{}},y=0,w=Object.entries(i.selections);y<w.length;y++){var b=(0,s.Z)(w[y],2),_=b[0],k=b[1];g.selections[_]=k.slice()}return{state:new Ao(r,n,i,h),parameters:g}}function So(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)e[t]=So(e[t]);else if(e instanceof Object)if("_TypedArray_class"in e){var r=e[["_TypedArray_class"]],n=e[["_TypedArray_values"]];switch(r){case"Uint8Array":case"Uint8Array":e=new Uint8Array(n.length);break;case"Int8Array":e=new Int8Array(n.length);break;case"Uint16Array":e=new Uint16Array(n.length);break;case"Int16Array":e=new Int16Array(n.length);break;case"Uint32Array":e=new Uint32Array(n.length);break;case"Int32Array":e=new Int32Array(n.length);break;case"Uint64Array":e=new Uint64Array(n.length);break;case"Int64Array":e=new Int64Array(n.length);break;case"Float32Array":e=new Float32Array(n.length);break;case"Float64Array":e=new Float64Array(n.length);break;default:throw"unrecognized TypedArray class '"+r}e.set(n)}else for(var a=0,i=Object.entries(e);a<i.length;a++){var o=(0,s.Z)(i[a],2),u=o[0],l=o[1];e[u]=So(l)}return e}function Io(e){for(var t=new Uint8Array(8),r=0;e>0;)t[r]=e%256,e=Math.floor(e/256),r++;return t}function Bo(e){var t,r=0,n=1,a=(0,x.Z)(e);try{for(a.s();!(t=a.n()).done;){r+=n*t.value,n*=256}}catch(Xt){a.e(Xt)}finally{a.f()}return r}function zo(){var e={collected:[],total:0,saver:function(t,r){e.collected.push(t);var n=e.total;return e.total+=r,{offset:n,size:r}}};return e}function Go(e,t){var r=null!==t,n=l.pJ(e),a=function(e,t){var r=new ArrayBuffer(24),n=new Uint8Array(r),a=0,i=Io(e?0:1);n.set(i,a),a+=i.length;var s=Io(1002e3);n.set(s,a),a+=s.length;var o=Io(t);if(n.set(o,a),24!=(a+=o.length))throw"oops - accounting error in the serialization code!";return r}(r,n.byteLength),i=a.byteLength+n.byteLength;if(r){var s,o=(0,x.Z)(t);try{for(o.s();!(s=o.n()).done;){i+=s.value.byteLength}}catch(Xt){o.e(Xt)}finally{o.f()}}var u=new ArrayBuffer(i),c=new Uint8Array(u);c.set(new Uint8Array(a));var h=a.byteLength;if(c.set(new Uint8Array(n),h),h+=n.byteLength,r){var f,d=(0,x.Z)(t);try{for(d.s();!(f=d.n()).done;){var v=f.value;c.set(new Uint8Array(v),h),h+=v.byteLength}}catch(Xt){d.e(Xt)}finally{d.f()}}return u}function Fo(e,t){var r=function(e){var t=0,r=Bo(new Uint8Array(e,t,8));t+=8;var n=Bo(new Uint8Array(e,t,8));return t+=8,{embedded:0==r,version:n,state:Bo(new Uint8Array(e,t,8)),offset:t+=8}}(e),n=r.offset+r.state,a=e.slice(r.offset,n);if(r.version<1e6){var i=zn(new Uint8Array(a),{to:"string"});!function(e,t){var r=M(t),n=r.createGroup("inputs"),a=e.inputs.parameters,i=n.createGroup("parameters");i.writeDataSet("format","String",[],a.type);var o,u=i.createGroup("files"),l=(0,x.Z)(a.files.entries());try{for(l.s();!(o=l.n()).done;){var c=(0,s.Z)(o.value,2),h=c[0],f=c[1],d=u.createGroup(String(h));d.writeDataSet("type","String",[],f.type),d.writeDataSet("name","String",[],f.name),f.buffer instanceof Object?(d.writeDataSet("offset","Uint32",[],f.buffer.offset),d.writeDataSet("size","Uint32",[],f.buffer.size)):d.writeDataSet("id","String",[],f.buffer)}}catch(Xt){l.e(Xt)}finally{l.f()}var v=n.createGroup("results"),p=e.inputs.contents,m=Object.values(p.genes)[0].length;v.writeDataSet("dimensions","Int32",null,[m,p.num_cells]);for(var g=v.createGroup("genes"),y=0,w=Object.entries(p.genes);y<w.length;y++){var b=(0,s.Z)(w[y],2),_=b[0],k=b[1];g.writeDataSet(_,"String",null,k)}var Z=r.createGroup("quality_control"),A=Z.createGroup("parameters"),E=e.quality_control_metrics.parameters;A.writeDataSet("use_mito_default","Uint8",[],Number(E.use_mito_default)),A.writeDataSet("mito_prefix","String",[],E.mito_prefix);var S=e.quality_control_thresholds.parameters;A.writeDataSet("nmads","Float64",[],S.nmads);var I=Z.createGroup("results"),B=I.createGroup("metrics"),z=So(e.quality_control_metrics.contents);B.writeDataSet("sums","Float64",null,z.sums),B.writeDataSet("detected","Int32",null,z.detected),B.writeDataSet("proportion","Float64",null,z.proportion);for(var G=I.createGroup("thresholds"),F=So(e.quality_control_thresholds.contents),O=0,C=["sums","detected","proportion"];O<C.length;O++){var D=C[O];G.writeDataSet(D,"Float64",null,[F[D]])}var N=F.discards;I.writeDataSet("discards","Uint8",null,N);var R=r.createGroup("normalization");R.createGroup("parameters"),R.createGroup("results");var U=r.createGroup("feature_selection");U.createGroup("parameters").writeDataSet("span","Float64",[],e.feature_selection.parameters.span);for(var Q=U.createGroup("results"),W=So(e.feature_selection.contents),T=0,j=["means","vars","fitted","resids"];T<j.length;T++){var q=j[T];Q.writeDataSet(q,"Float64",null,W[q])}for(var P=r.createGroup("pca"),L=P.createGroup("parameters"),H=e.pca.parameters,J=0,Y=["num_hvgs","num_pcs"];J<Y.length;J++){var V=Y[J];L.writeDataSet(V,"Int32",null,H[V])}var X=P.createGroup("results"),K=So(e.pca.contents),$=K.var_exp;X.writeDataSet("var_exp","Float64",null,$);var ee=$.length,te=K.pcs.length/ee;X.writeDataSet("pcs","Float64",[te,ee],K.pcs);var re=r.createGroup("neighbor_index"),ne=re.createGroup("parameters"),ae=e.pca.parameters;ne.writeDataSet("approximate","Uint8",[],Number(ae.approximate)),re.createGroup("results");var ie=r.createGroup("tsne"),se=ie.createGroup("parameters"),oe=e.tsne.parameters;se.writeDataSet("perplexity","Float64",[],oe.perplexity),se.writeDataSet("iterations","Int32",[],oe.iterations),se.writeDataSet("animate","Uint8",[],oe.animate);var ue=ie.createGroup("results"),le=So(e.tsne.contents);ue.writeDataSet("x","Float64",null,le.x),ue.writeDataSet("y","Float64",null,le.y);var ce=r.createGroup("umap"),he=ce.createGroup("parameters"),fe=e.umap.parameters;he.writeDataSet("num_neighbors","Int32",[],fe.num_neighbors),he.writeDataSet("num_epochs","Int32",[],fe.num_epochs),he.writeDataSet("min_dist","Float64",[],fe.min_dist),he.writeDataSet("animate","Uint8",[],Number(fe.animate));var de=ce.createGroup("results"),ve=So(e.umap.contents);de.writeDataSet("x","Float64",null,ve.x),de.writeDataSet("y","Float64",null,ve.y);var pe=r.createGroup("kmeans_cluster"),me=pe.createGroup("parameters").createDataSet("k","Int32",[]);if("kmeans_cluster"in e){var ge=e.kmeans_cluster.parameters;me.write(ge.k)}else me.write(10);var ye=pe.createGroup("results"),we=So(e.kmeans_cluster.contents);"kmeans_cluster"in e&&ye.writeDataSet("clusters","Int32",null,we.clusters);var be=r.createGroup("snn_graph_cluster"),_e=be.createGroup("parameters"),ke=e.snn_find_neighbors.parameters;_e.writeDataSet("k","Int32",[],ke.k);var Ze=e.snn_build_graph.parameters;_e.writeDataSet("scheme","String",[],["rank","number","jaccard"][Ze.scheme]);var Ae=e.snn_cluster_graph.parameters;_e.writeDataSet("resolution","Float64",[],Ae.resolution);var xe=be.createGroup("results"),Ee=So(e.snn_cluster_graph.contents);xe.writeDataSet("clusters","Int32",null,Ee.clusters),r.createGroup("choose_clustering").createGroup("parameters").writeDataSet("method","String",[],e.choose_clustering.parameters.method);var Se=r.createGroup("marker_detection");Se.createGroup("parameters");var Ie,Be=Se.createGroup("results").createGroup("clusters"),ze=e.marker_detection.contents,Ge=(0,x.Z)(ze.entries());try{for(Ge.s();!(Ie=Ge.n()).done;){for(var Fe=(0,s.Z)(Ie.value,2),Oe=Fe[0],Ce=Fe[1],De=Be.createGroup(String(Oe)),Ne=So(Ce),Me=0,Re=["means","detected"];Me<Re.length;Me++){var Ue=Re[Me];De.writeDataSet(Ue,"Float64",null,Ne[Ue])}for(var Qe=0,We=["lfc","delta_detected","auc","cohen"];Qe<We.length;Qe++)for(var Te=We[Qe],je=Ne[Te],qe=De.createGroup(Te),Pe=0,Le=["min","mean","min-rank"];Pe<Le.length;Pe++){var He=Le[Pe],Je="min-rank"==He?"min_rank":He;qe.writeDataSet(Je,"Float64",null,je[He])}}}catch(Xt){Ge.e(Xt)}finally{Ge.f()}for(var Ye=r.createGroup("custom_selections"),Ve=Ye.createGroup("parameters").createGroup("selections"),Xe=e.custom_marker_management.parameters,Ke=0,$e=Object.entries(Xe.selections);Ke<$e.length;Ke++){var et=(0,s.Z)($e[Ke],2),tt=et[0],rt=et[1];Ve.writeDataSet(String(tt),"Int32",null,rt)}for(var nt=Ye.createGroup("results").createGroup("markers"),at=0,it=Object.entries(e.custom_marker_management.contents.results);at<it.length;at++){for(var st=(0,s.Z)(it[at],2),ot=st[0],ut=st[1],lt=nt.createGroup(String(ot)),ct=So(ut),ht=0,ft=["means","detected"];ht<ft.length;ht++){var dt=ft[ht];lt.writeDataSet(dt,"Float64",null,ct[dt])}for(var vt=0,pt=["lfc","delta_detected","auc","cohen"];vt<pt.length;vt++){var mt=pt[vt];lt.writeDataSet(mt,"Float64",null,ct[mt].mean)}}}(JSON.parse(i),t)}else l.NC(t,new Uint8Array(a));return r.embedded?function(t,r){return e.slice(n+t,n+t+r)}:null}var Oo="inputs",Co="quality_control",Do="normalization",No="feature_selection",Mo="pca",Ro="neighbor_index",Uo="tsne",Qo="umap",Wo="kmeans_cluster",To="snn_graph_cluster",jo="choose_clustering",qo="marker_detection",Po="cell_labelling",Lo="custom_selections";function Ho(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.numberOfThreads,r=void 0===t?1:t,n=e.localFile,a=void 0!==n&&n,i=l.j2({numberOfThreads:r,localFile:a});return as.localFile=a,i.then((function(e){return null}))}function Jo(){return Yo.apply(this,arguments)}function Yo(){return(Yo=(0,o.Z)(u.mark((function e(){var t;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t={}).inputs=new xa,t[Co]=new Wa(t.inputs),t[Do]=new Xa(t[Co]),t[No]=new ii(t[Co],t[Do]),t.pca=new vi(t[Co],t[Do],t[No]),t.neighbor_index=new ki(t.pca),t.tsne=new _s(t.neighbor_index),t.umap=new Ns(t.neighbor_index),t[Wo]=new ji(t.pca),t[To]=new Fi(t.neighbor_index),t[jo]=new Xi(t[To],t[Wo]),t[qo]=new Xs(t[Co],t[Do],t[jo]),t[Po]=new vo(t.inputs,t[qo]),t[Lo]=new Ao(t[Co],t[Do]),e.abrupt("return",Promise.all([t.tsne.ready(),t.umap.ready()]).then((function(e){return t})));case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Vo(e){for(var t=[],r=0,n=Object.entries(e);r<n.length;r++){var a=(0,s.Z)(n[r],2),i=(a[0],a[1].free());i&&t.push(i)}return Promise.all(t).then((function(e){return null}))}function Xo(e,t,r){return Ko.apply(this,arguments)}function Ko(){return Ko=(0,o.Z)(u.mark((function e(t,r,n){var a,i,s,o,l,c,h,f,d,v,p,m,g,y=arguments;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=y.length>3&&void 0!==y[3]?y[3]:{},i=a.startFun,s=void 0===i?null:i,o=a.finishFun,l=void 0===o?null:o,h=function(e){null!==l&&(t[e].changed?l(e,t[e].summary()):l(e))},f=[],d=function(e,r){null!==l&&(r=t[e].changed?t[e].summary().then((function(t){return l(e,t)})):r.then((function(t){return l(e)}))),f.push(r)},(c=function(e){null!==s&&s(e)})(Oo),e.next=8,t.inputs.compute(r,n.inputs.sample_factor);case 8:return h(Oo),c(Co),t[Co].compute(n[Co].use_mito_default,n[Co].mito_prefix,n[Co].nmads),h(Co),c(Do),t[Do].compute(),h(Do),c(No),t[No].compute(n[No].span),h(No),c(Mo),t.pca.compute(n.pca.num_hvgs,n.pca.num_pcs,n.pca.block_method),h(Mo),c(Ro),t.neighbor_index.compute(n.neighbor_index.approximate),h(Ro),c(Uo),v=t.tsne.compute(n.tsne.perplexity,n.tsne.iterations,n.tsne.animate),d(Uo,v),c(Qo),p=t.umap.compute(n.umap.num_neighbors,n.umap.num_epochs,n.umap.min_dist,n.umap.animate),d(Qo,p),m=n[jo].method,c(Wo),t[Wo].compute("kmeans"==m,n[Wo].k),h(Wo),c(To),t[To].compute("snn_graph"==m,n[To].k,n[To].scheme,n[To].resolution),h(To),c(jo),t[jo].compute(m),h(jo),c(qo),t[qo].compute(),h(qo),c(Po),g=t[Po].compute(n[Po].human_references,n[Po].mouse_references),d(Po,g),t[Lo].compute(),h(Lo),e.next=50,Promise.all(f);case 50:return e.abrupt("return",null);case 51:case"end":return e.stop()}}),e)}))),Ko.apply(this,arguments)}function $o(e,t){return eu.apply(this,arguments)}function eu(){return eu=(0,o.Z)(u.mark((function e(t,r){var n,a,i,s,o,l=arguments;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>2&&void 0!==l[2]?l[2]:{},a=n.embedded,i=null,s=null,(void 0===a||a)&&(s=zo(),i=s.saver,delete s.saver),o=M(r),e.next=7,t.inputs.serialize(o,i);case 7:return t[Co].serialize(o),t[Do].serialize(o),t[No].serialize(o),t.pca.serialize(o),t.neighbor_index.serialize(o),e.next=14,t.tsne.serialize(o);case 14:return e.next=16,t.umap.serialize(o);case 16:return t[Wo].serialize(o),t[To].serialize(o),t[jo].serialize(o),t[qo].serialize(o),e.next=22,t[Po].serialize(o);case 22:return t[Lo].serialize(o),e.abrupt("return",s);case 24:case"end":return e.stop()}}),e)}))),eu.apply(this,arguments)}function tu(e,t){return ru.apply(this,arguments)}function ru(){return ru=(0,o.Z)(u.mark((function e(t,r){var n,a,i,s,o,l,c,h,f,d,v,p,m,g,y,w,b,_,k,Z,A,x,E=arguments;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=E.length>2&&void 0!==E[2]?E[2]:{},a=n.finishFun,i=void 0===a?null:a,s={},o={},l=new N(t),c=function(e){null!==i&&i(e,o[e].summary())},e.next=7,za(l,r);case 7:if(f=e.sent,o.inputs=f.state,s.inputs=f.parameters,h=f.permuter,c(Oo),d=La(l,o.inputs),o[Co]=d.state,s[Co]=d.parameters,c(Co),v=$a(0,o[Co]),o[Do]=v.state,s[Do]=v.parameters,c(Do),p=ui(l,h,o[Co],o[Do]),o[No]=p.state,s[No]=p.parameters,c(No),m=gi(l,o[Co],o[Do],o[No]),o.pca=m.state,s.pca=m.parameters,c(Mo),g=Ai(l,o.pca),o.neighbor_index=g.state,s.neighbor_index=g.parameters,c(Ro),y=xs(l,o.neighbor_index),o.tsne=y.state,s.tsne=y.parameters,null===i){e.next=42;break}return e.t0=i,e.t1=Uo,e.next=40,o.tsne.summary();case 40:e.t2=e.sent,(0,e.t0)(e.t1,e.t2);case 42:if(w=Qs(l,o.neighbor_index),o.umap=w.state,s.umap=w.parameters,null===i){e.next=52;break}return e.t3=i,e.t4=Qo,e.next=50,o.umap.summary();case 50:e.t5=e.sent,(0,e.t3)(e.t4,e.t5);case 52:if(b=Li(l,o.pca),o[Wo]=b.state,s[Wo]=b.parameters,c(Wo),_=Ri(l,o.neighbor_index),o[To]=_.state,s[To]=_.parameters,c(To),k=Ki(l,o[To],o[Wo]),o[jo]=k.state,s[jo]=k.parameters,c(jo),Z=$s(l,h,o[Co],o[Do],o[jo]),o[qo]=Z.state,s[qo]=Z.parameters,c(qo),A=yo(l,o.inputs,o[qo]),o[Po]=A.state,s[Po]=A.parameters,null===i){e.next=78;break}return e.t6=i,e.t7=Po,e.next=76,o[Po].summary();case 76:e.t8=e.sent,(0,e.t6)(e.t7,e.t8);case 78:return x=Eo(l,h,o[Co],o[Do]),o[Lo]=x.state,s[Lo]=x.parameters,c(Lo),e.abrupt("return",{state:o,parameters:s});case 83:case"end":return e.stop()}}),e)}))),ru.apply(this,arguments)}function nu(e,t){return Go(e,t)}function au(e,t){return Fo(e,t)}function iu(e){On(e)}},9390:function(e,t,r){"use strict";r.d(t,{p:function(){return s}});var n=r(5671),a=r(3144),i=r(519),s=function(){function e(t){(0,n.Z)(this,e),this.matrix=t}return(0,a.Z)(e,[{key:"numberOfRows",value:function(){return this.matrix.nrow()}},{key:"numberOfColumns",value:function(){return this.matrix.ncol()}},{key:"row",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.buffer,n=void 0===r?null:r;if(null==n){var a;n=i.RJ(this.matrix.ncol());try{this.matrix.row(e,n.offset),a=n.slice()}finally{n.free()}return a}this.matrix.row(e,n.offset)}},{key:"column",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.buffer,n=void 0===r?null:r;if(null==n){var a;n=i.RJ(this.matrix.nrow());try{this.matrix.column(e,n.offset),a=n.slice()}finally{n.free()}return a}this.matrix.column(e,n.offset)}},{key:"free",value:function(){null!==this.matrix&&(this.matrix.delete(),this.matrix=null)}},{key:"isSparse",value:function(){return this.matrix.sparse()}},{key:"isReorganized",value:function(){return this.matrix.reorganized()}},{key:"isPermuted",value:function(){return this.isReorganized()}},{key:"identities",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.buffer,n=void 0===r?null:r;if(null!=n)return this.matrix.identities(n.offset),n;n=i.Wf(this.matrix.nrow());try{this.matrix.identities(n.offset),e=n.slice()}finally{n.free()}return e}}]),e}()},4657:function(e,t,r){"use strict";r.d(t,{r:function(){return u}});var n=r(5671),a=r(3144),i=r(3515),s=r(519),o=function(){function e(t){(0,n.Z)(this,e),this.results=t}return(0,a.Z)(e,[{key:"means",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.block,r=void 0===t?-1:t,n=e.copy,a=void 0===n||n;return s.Yj(this.results.means(r),a)}},{key:"variances",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.block,r=void 0===t?-1:t,n=e.copy,a=void 0===n||n;return s.Yj(this.results.variances(r),a)}},{key:"fitted",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.block,r=void 0===t?-1:t,n=e.copy,a=void 0===n||n;return s.Yj(this.results.fitted(r),a)}},{key:"residuals",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.block,r=void 0===t?-1:t,n=e.copy,a=void 0===n||n;return s.Yj(this.results.residuals(r),a)}},{key:"numberOfBlocks",value:function(){return this.results.num_blocks()}},{key:"free",value:function(){null!==this.results&&(this.results.delete(),this.results=null)}}]),e}();function u(e){var t,r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=a.block,l=void 0===u?null:u,c=a.span,h=void 0===c?.3:c;try{var f=0,d=!1;if(null!==l){if((t=s.de(l,"Int32WasmArray")).length!=e.numberOfColumns())throw new Error("'block' must be of length equal to the number of columns in 'x'");d=!0,f=t.offset}r=i.RE((function(t){return t.model_gene_var(e.matrix,d,f,h)})),n=new o(r)}catch(v){throw s.gd(r),v}finally{s.gd(t)}return n}},519:function(e,t,r){"use strict";r.d(t,{TS:function(){return i},Wf:function(){return s},GF:function(){return o},RJ:function(){return u},de:function(){return l},gd:function(){return c},Yj:function(){return h}});var n=r(3515),a=r(6737);function i(e){return a.TS((0,n.Fx)(),e)}function s(e){return a.Wf((0,n.Fx)(),e)}function o(e){return a.GF((0,n.Fx)(),e)}function u(e){return a.RJ((0,n.Fx)(),e)}function l(e,t){if(e instanceof a.PQ){if(null!==t&&t!=e.constructor.className)throw new Error("expected '"+t+"', got '"+e.constructor.className+"'");return e.space===(0,n.Fx)()?null===e.owner?e.view():e:e.clone((0,n.Fx)())}return null!==t?a.Zv((0,n.Fx)(),e,a.rr(t)):a.Zv((0,n.Fx)(),e)}function c(e){null!==e&&void 0!==e&&("free"in e?e.free():"delete"in e&&e.delete())}function h(e,t){if("view"===t){if(e.buffer!==(0,n.f3)())throw new Error('cannot use copy = "view" for non-Wasm TypedArrays');var r=e.constructor.name.replace("Array","WasmArray");return a.dt((0,n.Fx)(),e.length,e.byteOffset,a.rr(r))}return t?e.slice():e}},3515:function(e,t,r){"use strict";r.d(t,{j2:function(){return u},RE:function(){return c},f3:function(){return h},Fx:function(){return f},NC:function(){return d},pJ:function(){return v},Yd:function(){return p},ki:function(){return m}});var n=r(5861),a=r(7757),i=r(3587),s=r(6737),o={};function u(){return l.apply(this,arguments)}function l(){return l=(0,n.Z)(a.mark((function e(){var t,r,n,u,l,c,h=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h.length>0&&void 0!==h[0]?h[0]:{},r=t.numberOfThreads,n=void 0===r?4:r,u=t.localFile,l=void 0!==u&&u,!("module"in o)){e.next=3;break}return e.abrupt("return",!1);case 3:return c={scran_custom_nthreads:n},l&&(c.locateFile=function(e){return"file:///home/runner/work/kana/kana/node_modules/scran.js/module/wasm.js".substring(7)+"/../wasm/"+e}),e.next=7,(0,i.default)(c);case 7:return o.module=e.sent,o.space=(0,s.z2)(o.module),e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}function c(e){if(!("module"in o))throw new Error("Wasm module needs to be initialized via 'initialize()'");var t;try{t=e(o.module)}catch(r){throw"number"==typeof r?new Error(o.module.get_error_message(r)):r}return t}function h(){if(!("module"in o))throw new Error("Wasm module needs to be initialized via 'initialize()'");return o.module.wasmMemory.buffer}function f(){return o.space}function d(e,t){o.module.FS.writeFile(e,t)}function v(e){return o.module.FS.readFile(e,{encoding:"binary"})}function p(e){o.module.FS.unlink(e)}function m(e){return o.module.FS.analyzePath(e).exists}},2905:function(e,t,r){"use strict";r.d(t,{P:function(){return p}});var n,a=r(5671),i=r(3144),s=r(2346),o=r(6033),u=r(3092),l=r(2813),c=new WeakMap,h=new WeakMap,f=new WeakMap,d=new WeakMap,v=new WeakMap;n=Symbol.iterator;var p=function(){function e(t,r,n,i,o){(0,a.Z)(this,e),(0,s.Z)(this,c,{writable:!0,value:void 0}),(0,s.Z)(this,h,{writable:!0,value:void 0}),(0,s.Z)(this,f,{writable:!0,value:void 0}),(0,s.Z)(this,d,{writable:!0,value:void 0}),(0,s.Z)(this,v,{writable:!0,value:void 0}),(0,u.Z)(this,c,t),(0,u.Z)(this,h,r),(0,u.Z)(this,f,n),(0,u.Z)(this,d,i),(0,u.Z)(this,v,o)}return(0,i.Z)(e,[{key:"space",get:function(){return(0,o.Z)(this,c)}},{key:"id",get:function(){return(0,o.Z)(this,h)}},{key:"offset",get:function(){return(0,o.Z)(this,d)}},{key:"byteOffset",get:function(){return(0,o.Z)(this,d)}},{key:"buffer",get:function(){return(0,l.f3)((0,o.Z)(this,c))}},{key:"byteLength",get:function(){return this.length*this.constructor.valueSize}},{key:"length",get:function(){return(0,o.Z)(this,f)}},{key:"owner",get:function(){return(0,o.Z)(this,v)}},{key:"fill",value:function(e,t,r){var n=this.array();return n.fill.apply(n,arguments),n}},{key:"set",value:function(e,t){var r;(r=this.array()).set.apply(r,arguments)}},{key:"slice",value:function(e,t){var r;return(r=this.array()).slice.apply(r,arguments)}},{key:"clone",value:function(e){"undefined"===typeof e&&(e=(0,o.Z)(this,c));var t=(0,l.TK)(e,(0,o.Z)(this,f),this.constructor);return t.set(this.array()),t}},{key:"view",value:function(e,t){"undefined"===typeof e&&(e=0),"undefined"===typeof t&&(t=(0,o.Z)(this,f));var r=t-e,n=(0,o.Z)(this,v);null===n&&(n=this);var a=e*this.constructor.valueSize;return new this.constructor((0,o.Z)(this,c),-1,r,(0,o.Z)(this,d)+a,n)}},{key:"free",value:function(){null===(0,o.Z)(this,v)&&null!==(0,o.Z)(this,d)&&((0,l.Ar)((0,o.Z)(this,c),(0,o.Z)(this,h)),(0,u.Z)(this,d,null))}},{key:n,value:function(){return this.values()}},{key:"values",value:function(){return this.array().values()}},{key:"keys",value:function(){return this.array().keys()}},{key:"at",value:function(e){return this.array().at(e)}},{key:"forEach",value:function(e,t){var r;(r=this.array()).forEach.apply(r,arguments)}},{key:"filter",value:function(e,t){var r;return(r=this.array()).filter.apply(r,arguments)}},{key:"map",value:function(e,t){var r;return(r=this.array()).map.apply(r,arguments)}},{key:"subarray",value:function(e,t){return this.array().subarray(e,t)}},{key:"every",value:function(e,t){var r;return(r=this.array()).every.apply(r,arguments)}},{key:"some",value:function(e,t){var r;return(r=this.array()).some.apply(r,arguments)}},{key:"reduce",value:function(e,t){var r;return(r=this.array()).reduce.apply(r,arguments)}},{key:"reduceRight",value:function(e,t){var r;return(r=this.array()).reduceRight.apply(r,arguments)}},{key:"sort",value:function(e){return this.array().sort(e)}},{key:"reverse",value:function(){return this.array().reverse()}}]),e}()},8383:function(e,t,r){"use strict";r.d(t,{yh:function(){return c},do:function(){return p},g1:function(){return m},lt:function(){return w},rr:function(){return _}});var n=r(5671),a=r(3144),i=r(136),s=r(9388),o=r(4942),u=r(2813),l=r(2905),c=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"array",value:function(){return new Uint8Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(c,"className","Uint8WasmArray"),(0,o.Z)(c,"valueSize",1);var h=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"array",value:function(){return new Int8Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(h,"className","Int8WasmArray"),(0,o.Z)(h,"valueSize",1);var f=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"array",value:function(){return new Uint16Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(f,"className","Uint16WasmArray"),(0,o.Z)(f,"valueSize",2);var d=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"array",value:function(){return new Int16Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(d,"className","Int16WasmArray"),(0,o.Z)(d,"valueSize",2);var v=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"array",value:function(){return new Uint32Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(v,"className","Uint32WasmArray"),(0,o.Z)(v,"valueSize",4);var p=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"array",value:function(){return new Int32Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(p,"className","Int32WasmArray"),(0,o.Z)(p,"valueSize",4);var m=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"array",value:function(){return new BigUint64Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(m,"className","BigUint64WasmArray"),(0,o.Z)(m,"valueSize",8);var g=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"array",value:function(){return new BigInt64Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(g,"className","BigInt64WasmArray"),(0,o.Z)(g,"valueSize",8);var y=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"array",value:function(){return new Float32Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(y,"className","Float32WasmArray"),(0,o.Z)(y,"valueSize",4);var w=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"array",value:function(){return new Float64Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(w,"className","Float64WasmArray"),(0,o.Z)(w,"valueSize",8);var b={Uint8WasmArray:c,Int8WasmArray:h,Uint16WasmArray:f,Int16WasmArray:d,Uint32WasmArray:v,Int32WasmArray:p,BigUint64WasmArray:m,BigInt64WasmArray:g,Float32WasmArray:y,Float64WasmArray:w};function _(e){if(!(e in b))throw new Error("unknown WasmArray class '"+e+"'");return b[e]}},6737:function(e,t,r){"use strict";r.d(t,{lt:function(){return a.lt},do:function(){return a.do},yh:function(){return a.yh},PQ:function(){return n.P},Zv:function(){return h.Zv},GF:function(){return l},RJ:function(){return c},Wf:function(){return u},TS:function(){return o},dt:function(){return f},z2:function(){return i.z2},rr:function(){return a.rr}});var n=r(2905),a=r(8383),i=r(2813);function s(e,t,r){return(0,i.TK)(e,t,r)}function o(e,t){return s(e,t,a.yh)}function u(e,t){return s(e,t,a.do)}function l(e,t){return s(e,t,a.g1)}function c(e,t){return s(e,t,a.lt)}var h=r(4163);function f(e,t,r,n){return new n(e,-1,t,r,{})}}}]);
//# sourceMappingURL=450.a0bf5a4f.chunk.js.map