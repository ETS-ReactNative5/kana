(this.webpackJsonpkana=this.webpackJsonpkana||[]).push([[0],{282:function(e,t,n){},283:function(e,t,n){},309:function(e,t,n){},312:function(e,t,n){},313:function(e,t,n){},314:function(e,t,n){},326:function(e,t,n){},327:function(e,t,n){},328:function(e,t,n){},329:function(e,t,n){},330:function(e,t,n){},331:function(e,t,n){"use strict";n.r(t);var s=n(1),a=n.n(s),c=n(25),i=n.n(c),l=(n(282),n(4)),r=n(22),o=n(6),d=(n(283),n(339)),u=n(49),j=n(136),h=n(79),b=n(43),O=n(3),p=n(20),x=d.H.create({className:"notifications",position:p.a.TOP_RIGHT,maxToasts:5}),m=n(0),f=Object(s.createContext)(null),v=function(e){var t=e.children,n=Object(s.useState)({format:null,files:null}),a=Object(o.a)(n,2),c=a[0],i=a[1],l=Object(s.useState)({qc:{"qc-nmads":3},fSelection:{"fsel-span":.3},pca:{"pca-npc":5,"pca-hvg":4e3},cluster:{"clus-k":10,"clus-res":.5,"clus-scheme":0,"clus-approx":!0,"clus-method":"snn_graph"},tsne:{"tsne-iter":500,"tsne-perp":30,animate:!1},umap:{"umap-nn":15,"umap-epochs":500,"umap-min_dist":.01,animate:!1},markerGene:{}}),r=Object(o.a)(l,2),d=r[0],u=r[1],j=Object(s.useState)(!1),h=Object(o.a)(j,2),b=h[0],O=h[1],p=Object(s.useState)(!1),v=Object(o.a)(p,2),g=v[0],y=v[1],w=Object(s.useState)("new"),F=Object(o.a)(w,2),N=F[0],C=F[1],k=Object(s.useState)(null),S=Object(o.a)(k,2),E=S[0],D=S[1],M=Object(s.useState)(null),A=Object(o.a)(M,2),L=A[0],T=A[1],I=Object(s.useState)(null),R=Object(o.a)(I,2),q=R[0],G=R[1],P=Object(s.useState)("kana-"+String(Date.now()).slice(0,8)),B=Object(o.a)(P,2),_=B[0],W=B[1],V=Object(s.useState)(!1),z=Object(o.a)(V,2),U=z[0],H=z[1],K=Object(s.useState)(!1),Q=Object(o.a)(K,2),X=Q[0],Y=Q[1],J=Object(s.useState)(!1),Z=Object(o.a)(J,2),$=Z[0],ee=Z[1],te=Object(s.useState)(!1),ne=Object(o.a)(te,2),se=ne[0],ae=ne[1],ce=Object(s.useState)(null),ie=Object(o.a)(ce,2),le=ie[0],re=ie[1],oe=Object(s.useState)(null),de=Object(o.a)(oe,2),ue=de[0],je=de[1],he=Object(s.useState)(null),be=Object(o.a)(he,2),Oe=be[0],pe=be[1],xe=Object(s.useState)(null),me=Object(o.a)(xe,2),fe=me[0],ve=me[1],ge=Object(s.useState)(null),ye=Object(o.a)(ge,2),we=ye[0],Fe=ye[1],Ne=Object(s.useState)(null),Ce=Object(o.a)(Ne,2),ke=Ce[0],Se=Ce[1],Ee=Object(s.useState)(null),De=Object(o.a)(Ee,2),Me=De[0],Ae=De[1],Le=Object(s.useState)(null),Te=Object(o.a)(Le,2),Ie=Te[0],Re=Te[1],qe=Object(s.useState)([]),Ge=Object(o.a)(qe,2),Pe=Ge[0],Be=Ge[1],_e=Object(s.useState)(null),We=Object(o.a)(_e,2),Ve=We[0],ze=We[1],Ue=Object(s.useState)(null),He=Object(o.a)(Ue,2),Ke=He[0],Qe=He[1],Xe=Object(s.useState)(null),Ye=Object(o.a)(Xe,2),Je=Ye[0],Ze=Ye[1],$e=Object(s.useState)(null),et=Object(o.a)($e,2),tt=et[0],nt=et[1],st=Object(s.useState)([]),at=Object(o.a)(st,2),ct=at[0],it=at[1],lt=Object(s.useState)(null),rt=Object(o.a)(lt,2),ot=rt[0],dt=rt[1],ut=Object(s.useState)(null),jt=Object(o.a)(ut,2),ht=jt[0],bt=jt[1],Ot=Object(s.useState)({}),pt=Object(o.a)(Ot,2),xt=pt[0],mt=pt[1],ft=Object(s.useState)(null),vt=Object(o.a)(ft,2),gt=vt[0],yt=vt[1],wt=Object(s.useState)(null),Ft=Object(o.a)(wt,2),Nt=Ft[0],Ct=Ft[1],kt=Object(s.useState)(null),St=Object(o.a)(kt,2),Et=St[0],Dt=St[1],Mt=Object(s.useState)(!1),At=Object(o.a)(Mt,2),Lt=At[0],Tt=At[1],It=Object(s.useState)(!1),Rt=Object(o.a)(It,2),qt=Rt[0],Gt=Rt[1],Pt=Object(s.useState)(null),Bt=Object(o.a)(Pt,2),_t=Bt[0],Wt=Bt[1],Vt=Object(s.useState)(null),zt=Object(o.a)(Vt,2),Ut=zt[0],Ht=zt[1],Kt=Object(s.useState)(null),Qt=Object(o.a)(Kt,2),Xt=Qt[0],Yt=Qt[1],Jt=Object(s.useState)(null),Zt=Object(o.a)(Jt,2),$t=Zt[0],en=Zt[1],tn=Object(s.useState)([]),nn=Object(o.a)(tn,2),sn=nn[0],an=nn[1],cn=Object(s.useState)([]),ln=Object(o.a)(cn,2),rn=ln[0],on=ln[1];return Object(s.useEffect)((function(){se&&null!=c.files&&!$&&("new"===N?window.scranWorker.postMessage({type:"RUN",payload:{files:c,params:d},msg:"not much to pass"}):"load"===N&&(null==L?window.scranWorker.postMessage({type:"LOAD",payload:{files:c},msg:"not much to pass"}):window.scranWorker.postMessage({type:"RUN",payload:{files:c,params:d},msg:"not much to pass"}),ee(!0)))}),[c,d,se]),Object(s.useEffect)((function(){U?(window.scranWorker.postMessage({type:"EXPORT",payload:{files:c,params:d},msg:"not much to pass"}),x.show({icon:"download",intent:"primary",message:"Exporting analysis in the background"})):(null===c||void 0===c?void 0:c.files)&&x.show({icon:"download",intent:"primary",message:"Analysis saved. Please check your downloads directory!"})}),[U]),Object(s.useEffect)((function(){X?(window.scranWorker.postMessage({type:"SAVEKDB",payload:{files:c,params:d,id:_},msg:"not much to pass"}),x.show({icon:"floppy-disk",intent:"primary",message:"Saving analysis in the background. Note: analysis is saved within the browser!!"})):(null===c||void 0===c?void 0:c.files)&&x.show({icon:"floppy-disk",intent:"primary",message:"Analysis saved!"})}),[X]),Object(m.jsx)(f.Provider,{value:{inputFiles:c,setInputFiles:i,params:d,setParams:u,error:le,setError:re,wasmInitialized:se,setWasmInitialized:ae,pcaData:Nt,setPcaData:Ct,pcaVarExp:Et,setPcaVarExp:Dt,tsneData:_t,setTsneData:Wt,umapData:Ut,setUmapData:Ht,genesInfo:we,setGenesInfo:Fe,initDims:ue,setInitDims:je,qcDims:Oe,setQcDims:pe,qcData:ke,setQcData:Se,qcThreshold:Me,setQcThreshold:Ae,fSelDims:fe,setFSelDims:ve,redDims:Pe,setRedDims:Be,defaultRedDims:Ve,setDefaultRedDims:ze,plotRedDims:Ke,setPlotRedDims:Qe,clusterData:Je,setClusterData:Ze,fSelectionData:Ie,setFSelectionData:Re,logs:sn,setLogs:an,selectedCluster:tt,setSelectedCluster:nt,selectedClusterSummary:ct,setSelectedClusterSummary:it,clusterRank:ht,setClusterRank:bt,gene:Xt,setGene:Yt,clusterColors:ot,setClusterColors:dt,reqGene:$t,setReqGene:en,openInput:b,setOpenInput:O,customSelection:xt,setCustomSelection:mt,delCustomSelection:gt,setDelCustomSelection:yt,showGame:g,setShowGame:y,exportState:U,setExportState:H,datasetName:_,setDatasetName:W,tabSelected:N,setTabSelected:C,loadParams:L,setLoadParams:T,showAnimation:Lt,setShowAnimation:Tt,triggerAnimation:qt,setTriggerAnimation:Gt,savedPlot:rn,setSavedPlot:on,indexedDBState:X,setIndexedDBState:Y,kanaIDBRecs:E,setKanaIDBRecs:D,initLoadState:$,setInitLoadState:ee,loadParamsFor:q,setLoadParamsFor:G},children:t})},g=(n(309),["buttonText","includeFooter"]);var y=function(e){var t=e.buttonText,n=e.includeFooter,a=Object(b.a)(e,g),c=Object(s.useState)(!1),i=Object(o.a)(c,2),r=i[0],u=i[1],h=Object(s.useState)(1),p=Object(o.a)(h,2),x=p[0],v=p[1],y=Object(s.useCallback)((function(){return u(!r)}),[r]),w=Object(s.useCallback)((function(){return u(!1)}),[]),F=Object(s.useContext)(f),N=(F.inputFiles,F.setInputFiles),C=F.params,k=F.setParams,S=F.openInput,E=F.tabSelected,D=F.setTabSelected,M=F.loadParams,A=F.kanaIDBRecs,L=F.setLoadParamsFor,T=F.loadParamsFor,I=Object(s.useState)({gene:null,mtx:null,barcode:null}),R=Object(o.a)(I,2),q=R[0],G=R[1],P=Object(s.useState)({mtx:"Choose Matrix Market file",gene:"Choose feature/gene annotation",barcode:"Choose barcode annotation"}),B=Object(o.a)(P,2),_=B[0],W=B[1],V=Object(s.useState)(!0),z=Object(o.a)(V,2),U=z[0],H=z[1],K=Object(s.useState)("mtx"),Q=Object(o.a)(K,2),X=Q[0],Y=Q[1],J=Object(s.useState)("kana"),Z=Object(o.a)(J,2),$=Z[0],ee=Z[1],te=Object(s.useState)("new"==E?C:M),ne=Object(o.a)(te,2),se=ne[0],ae=ne[1];function ce(e,t){"mtx"===e?(G({gene:null,mtx:null,barcode:null}),W({mtx:"Choose Matrix Market file",gene:"Choose feature/gene annotation",barcode:"Choose barcode annotation"})):"tenx"===e?(G({file:null}),W({file:"Choose 10x v3 H5 file"})):"h5ad"===e&&(G({file:null}),W({file:"Choose H5ad file"})),ae(C),Y(e)}return Object(s.useEffect)((function(){S&&u(!0)}),[S]),Object(s.useEffect)((function(){M&&"load"==E&&ae(M)}),[M]),Object(s.useEffect)((function(){"load"==E&&"kanadb"==$&&null==(null===q||void 0===q?void 0:q.file)&&A&&G({file:A[0]})}),[A,$]),Object(s.useEffect)((function(){q&&("new"===E?"mtx"===X?(null===q||void 0===q?void 0:q.mtx)&&!(null===_||void 0===_?void 0:_.mtx.toLowerCase().endsWith("mtx"))&&!(null===_||void 0===_?void 0:_.mtx.toLowerCase().endsWith("mtx.gz"))||(null===q||void 0===q?void 0:q.gene)&&!(null===_||void 0===_?void 0:_.gene.toLowerCase().endsWith("tsv"))&&!(null===_||void 0===_?void 0:_.gene.toLowerCase().endsWith("tsv.gz"))||(null===q||void 0===q?void 0:q.barcode)&&!(null===_||void 0===_?void 0:_.barcode.toLowerCase().endsWith("tsv"))&&!(null===_||void 0===_?void 0:_.barcode.toLowerCase().endsWith("tsv.gz"))?H(!1):H(!0):"tenx"!==X&&"h5ad"!==X||((null===q||void 0===q?void 0:q.file)&&!((null===_||void 0===_?void 0:_.file.toLowerCase().endsWith("hdf5"))||(null===_||void 0===_?void 0:_.file.toLowerCase().endsWith("h5"))||(null===_||void 0===_?void 0:_.file.toLowerCase().endsWith("h5ad")))?H(!1):H(!0)):"load"===E&&(null===_||void 0===_?void 0:_.file)&&(null==(null===q||void 0===q?void 0:q.file)||(null===_||void 0===_?void 0:_.file.toLowerCase().endsWith("kana"))||(null===_||void 0===_?void 0:_.file.toLowerCase().endsWith("kana.gz"))?H(!0):H(!1)))}),[q]),Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(d.a,{onClick:y,icon:"social-media",intent:"primary",text:t}),Object(m.jsxs)(d.g,Object(l.a)(Object(l.a)({className:"analysis-dialog"},a),{},{isOpen:r,onClose:w,children:[Object(m.jsx)("div",{className:O.a.DIALOG_BODY,children:Object(m.jsxs)(d.E,{animate:!0,renderActiveTabPanelOnly:!0,vertical:!1,onChange:function(e,t){"new"===e&&ce(X),D(e)},defaultSelectedTabId:E,children:[Object(m.jsx)(d.D,{id:"new",title:"Import new dataset",panel:Object(m.jsxs)("div",{className:"inputs-container",children:[Object(m.jsxs)("div",{className:"row-input",children:[Object(m.jsx)("div",{className:"col",style:{paddingBottom:"15px"},children:Object(m.jsxs)("div",{children:[Object(m.jsxs)(d.m,{children:[Object(m.jsx)(d.F,{round:!0,children:"1"}),Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(1)},onMouseLeave:function(){return v(null)},children:"Load input files"})]}),Object(m.jsxs)(d.E,{animate:!0,renderActiveTabPanelOnly:!0,vertical:!0,onChange:ce,defaultSelectedTabId:X,children:[Object(m.jsx)(d.D,{id:"mtx",title:"Matrix Market file",panel:Object(m.jsxs)("div",{className:"row",children:[Object(m.jsx)(d.q,{className:"row-input",children:Object(m.jsx)(d.k,{text:_.mtx,onInputChange:function(e){W(Object(l.a)(Object(l.a)({},_),{},{mtx:e.target.files[0].name})),G(Object(l.a)(Object(l.a)({},q),{},{mtx:e.target.files}))}})}),Object(m.jsx)(d.q,{className:"row-input",children:Object(m.jsx)(d.k,{text:_.gene,onInputChange:function(e){W(Object(l.a)(Object(l.a)({},_),{},{gene:e.target.files[0].name})),G(Object(l.a)(Object(l.a)({},q),{},{gene:e.target.files}))}})})]})}),Object(m.jsx)(d.D,{id:"tenx",title:"10x v3 H5",panel:Object(m.jsx)("div",{className:"row",children:Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",children:"Choose 10x V3 H5 file"})}),Object(m.jsx)(d.k,{style:{marginTop:"5px"},text:_.file,onInputChange:function(e){W(Object(l.a)(Object(l.a)({},_),{},{file:e.target.files[0].name})),G(Object(l.a)(Object(l.a)({},q),{},{file:e.target.files}))}})]})})}),Object(m.jsx)(d.D,{id:"h5ad",title:"H5ad",panel:Object(m.jsx)("div",{className:"row",children:Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",children:"Choose H5ad file"})}),Object(m.jsx)(d.k,{style:{marginTop:"5px"},text:_.file,onInputChange:function(e){W(Object(l.a)(Object(l.a)({},_),{},{file:e.target.files[0].name})),G(Object(l.a)(Object(l.a)({},q),{},{file:e.target.files}))}})]})})})]})]})}),Object(m.jsx)("div",{className:"col",children:Object(m.jsxs)("div",{children:[Object(m.jsxs)(d.m,{children:[Object(m.jsx)(d.F,{round:!0,children:"2"}),Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(2)},onMouseLeave:function(){return v(null)},children:"Quality control"})]}),Object(m.jsx)("div",{className:"row",children:Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(2)},onMouseLeave:function(){return v(null)},children:"Number of MADs"})}),Object(m.jsx)(d.x,{placeholder:"3",value:se.qc["qc-nmads"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{qc:Object(l.a)(Object(l.a)({},se.qc),{},{"qc-nmads":e})}))}})]})})]})}),Object(m.jsx)("div",{className:"col",children:Object(m.jsxs)("div",{children:[Object(m.jsxs)(d.m,{children:[Object(m.jsx)(d.F,{round:!0,children:"3"}),Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(3)},onMouseLeave:function(){return v(null)},children:"Feature Selection"})]}),Object(m.jsx)("div",{className:"row",children:Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(3)},onMouseLeave:function(){return v(null)},children:"Lowess span"})}),Object(m.jsx)(d.x,{placeholder:"0.3",value:se.fSelection["fsel-span"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{fSelection:Object(l.a)(Object(l.a)({},se.fSelection),{},{"fsel-span":e})}))}})]})})]})}),Object(m.jsx)("div",{className:"col",children:Object(m.jsxs)("div",{children:[Object(m.jsxs)(d.m,{children:[Object(m.jsx)(d.F,{round:!0,children:"4"}),Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(4)},onMouseLeave:function(){return v(null)},children:"Principal components analysis"})]}),Object(m.jsxs)("div",{className:"row",children:[Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(4)},onMouseLeave:function(){return v(null)},children:"Number of HVGs"})}),Object(m.jsx)(d.x,{placeholder:"2500",value:se.pca["pca-hvg"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{pca:Object(l.a)(Object(l.a)({},se.pca),{},{"pca-hvg":e})}))}})]}),Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(4)},onMouseLeave:function(){return v(null)},children:"Number of PCs"})}),Object(m.jsx)(d.x,{placeholder:"25",value:se.pca["pca-npc"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{pca:Object(l.a)(Object(l.a)({},se.pca),{},{"pca-npc":e})}))}})]})]})]})}),Object(m.jsx)("div",{className:"col",children:Object(m.jsxs)("div",{children:[Object(m.jsxs)(d.m,{children:[Object(m.jsx)(d.F,{round:!0,children:"5"}),Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(5)},onMouseLeave:function(){return v(null)},children:"Clustering"})]}),Object(m.jsxs)("div",{className:"row",children:[Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(5)},onMouseLeave:function(){return v(null)},children:"Method"})}),Object(m.jsx)(d.n,{defaultValue:se.cluster["clus-method"],children:Object(m.jsx)("option",{children:se.cluster["clus-method"]})})]}),Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(5)},onMouseLeave:function(){return v(null)},children:"Number of neighbors"})}),Object(m.jsx)(d.x,{placeholder:"10",value:se.cluster["clus-k"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{cluster:Object(l.a)(Object(l.a)({},se.cluster),{},{"clus-k":e})}))}})]}),Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(5)},onMouseLeave:function(){return v(null)},children:"Use ANN"})}),Object(m.jsx)(d.C,{style:{marginTop:"10px"},large:!0,checked:se.cluster["clus-approx"],innerLabelChecked:"true",innerLabel:"false",onChange:function(e){ae(Object(l.a)(Object(l.a)({},se),{},{cluster:Object(l.a)(Object(l.a)({},se.cluster),{},{"clus-approx":e.target.checked})}))}})]}),Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(5)},onMouseLeave:function(){return v(null)},children:"Weighting scheme"})}),Object(m.jsxs)(d.n,{onChange:function(e,t){var n;return ae(Object(l.a)(Object(l.a)({},se),{},{cluster:Object(l.a)(Object(l.a)({},se.cluster),{},{"clus-scheme":parseInt(null===e||void 0===e||null===(n=e.currentTarget)||void 0===n?void 0:n.value)})}))},children:[Object(m.jsx)("option",{children:"Rank"},"0"),Object(m.jsx)("option",{children:"Number"},"1"),Object(m.jsx)("option",{children:"Jaccard"},"2")]})]}),Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(5)},onMouseLeave:function(){return v(null)},children:"Resolution"})}),Object(m.jsx)(d.x,{placeholder:"0.5",value:se.cluster["clus-res"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{cluster:Object(l.a)(Object(l.a)({},se.cluster),{},{"clus-res":e})}))}})]})]})]})}),Object(m.jsx)("div",{className:"col",children:Object(m.jsxs)("div",{children:[Object(m.jsxs)(d.m,{children:[Object(m.jsx)(d.F,{round:!0,children:"6"}),Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(6)},onMouseLeave:function(){return v(null)},children:"t-SNE"})]}),Object(m.jsxs)("div",{className:"row",children:[Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(6)},onMouseLeave:function(){return v(null)},children:"Perplexity"})}),Object(m.jsx)(d.x,{placeholder:"30",value:se.tsne["tsne-perp"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{tsne:Object(l.a)(Object(l.a)({},se.tsne),{},{"tsne-perp":e})}))}})]}),Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(6)},onMouseLeave:function(){return v(null)},children:"Iterations"})}),Object(m.jsx)(d.x,{placeholder:"500",value:se.tsne["tsne-iter"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{tsne:Object(l.a)(Object(l.a)({},se.tsne),{},{"tsne-iter":e})}))}})]})]})]})}),Object(m.jsx)("div",{className:"col",children:Object(m.jsxs)("div",{children:[Object(m.jsxs)(d.m,{children:[Object(m.jsx)(d.F,{round:!0,children:"7"}),Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(7)},onMouseLeave:function(){return v(null)},children:"UMAP"})]}),Object(m.jsxs)("div",{className:"row",children:[Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(7)},onMouseLeave:function(){return v(null)},children:"Number of neighbors"})}),Object(m.jsx)(d.x,{placeholder:"15",value:se.umap["umap-nn"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{umap:Object(l.a)(Object(l.a)({},se.umap),{},{"umap-nn":e})}))}})]}),Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(7)},onMouseLeave:function(){return v(null)},children:"Minimum distance"})}),Object(m.jsx)(d.x,{placeholder:"0.01",value:se.umap["umap-min_dist"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{umap:Object(l.a)(Object(l.a)({},se.umap),{},{"umap-min_dist":e})}))}})]}),Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(7)},onMouseLeave:function(){return v(null)},children:"Epochs"})}),Object(m.jsx)(d.x,{placeholder:"500",value:se.umap["umap-epoch"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{umap:Object(l.a)(Object(l.a)({},se.umap),{},{"umap-epoch":e})}))}})]})]})]})})]}),Object(m.jsxs)("div",{className:"row-input-tooltips",children:[!U&&Object(m.jsx)(d.c,{intent:"danger",title:"Incorrect file format",style:{marginBottom:"10px"},children:Object(m.jsxs)("p",{children:["Upload files that in one of these formats;",Object(m.jsxs)("ul",{children:[Object(m.jsxs)("li",{children:["Matrix Market - ",Object(m.jsx)("code",{children:"*.mtx"})," or ",Object(m.jsx)("code",{children:"*.mtx.gz"})]}),Object(m.jsxs)("li",{children:["features or genes, ",Object(m.jsx)("code",{children:"*.tsv"})," or ",Object(m.jsx)("code",{children:"*.tsv.gz"})]}),Object(m.jsxs)("li",{children:["HDF5 (10x or h5ad) - ",Object(m.jsx)("code",{children:"*.h5"})," or ",Object(m.jsx)("code",{children:"*.hdf5"})," or ",Object(m.jsx)("code",{children:"*.h5ad"})]})]})]})}),1==x&&Object(m.jsx)(d.c,{intent:"primary",children:Object(m.jsxs)("p",{children:["We currently support files in the Cellranger format - namely, a Matrix Market file containing the count matrix. We also recommend supplying the feature annotation (",Object(m.jsx)("code",{children:"features.tsv.gz"})," or ",Object(m.jsx)("code",{children:"genes.tsv.gz"}),"). Users may also provide a TSV file containing the barcode annotations, if any."]})}),2==x&&Object(m.jsxs)(d.c,{intent:"primary",children:[Object(m.jsx)("p",{children:"At this step, we compute per-cell quality control (QC) metrics such as the total count per cell, the total number of detected features and (if the feature annotation is supplied) the mitochondrial proportion in each cell."}),Object(m.jsx)("p",{children:"We remove low-quality cells based on these metrics - specifically, cells with low total counts/number of detected features or high mitochondrial proportions are filtered out."}),Object(m.jsx)("p",{children:"We use an outlier-based approach to define the filter threshold under the assumption that most cells in the dataset are of acceptable quality."}),Object(m.jsxs)("p",{children:[Object(m.jsx)("strong",{children:"Number of MADs"}),": Number of median absolute deviations (MADs) from the median, used to define a filter threshold in the appropriate direction for each QC metric. Increasing this value will reduce the stringency of the filtering."]})]}),3==x&&Object(m.jsxs)(d.c,{intent:"primary",children:[Object(m.jsx)("p",{children:"Identify highly variable genes while accounting for the mean-variance relationship. We do so by fitting a mean-dependent trend to the variances, computed from the log-transformed normalized expression values. The residuals from the trend are then used to rank highly variable genes."}),Object(m.jsxs)("p",{children:[Object(m.jsx)("strong",{children:"Lowess span"}),": The span of the LOWESS smoother for fitting the mean-variance trend. Larger values increase the smoothness of the global trend at the cost of decreasing sensitivity to local variations."]})]}),4==x&&Object(m.jsxs)(d.c,{intent:"primary",children:[Object(m.jsx)("p",{children:"Perform a principal components analysis (PCA) to obtain per-cell coordinates in a low-dimensional space. This is used to compact the data for faster downstream computation, as well as to remove uninteresting high-dimensional noise."}),Object(m.jsxs)("p",{children:[Object(m.jsx)("strong",{children:"Number of HVGs"}),": Number of highly variable genes to use to perform the PCA. Larger values will capture more biological signal at the cost of increasing noise and computational work."]}),Object(m.jsxs)("p",{children:[Object(m.jsx)("strong",{children:"Number of PCs"}),": Number of principal components with the highest variance to retain in downstream analyses. Larger values will capture more biological signal at the cost of increasing noise and computational work."]})]}),5==x&&Object(m.jsxs)(d.c,{intent:"primary",children:[Object(m.jsx)("p",{children:"Cluster cells into discrete groupings based on their relative similarity in the low-dimensional space. The set of clusters serve as a summary of the cellular heterogeneity in the population, allowing us to easily perform further characterization on subpopulations of interest."}),Object(m.jsxs)("p",{children:[Object(m.jsx)("strong",{children:"Method"}),": Clustering algorithm to use. Currently, we use multi-level community detection on an shared nearest neighbor (SNN) graph where cells are the nodes and edges are created between neighboring cells."]}),Object(m.jsxs)("p",{children:[Object(m.jsx)("strong",{children:"Number of neighbors"}),": Number of neighbors to use to construct the shared nearest neighbor graph. Larger values result in broader clusters."]}),Object(m.jsxs)("p",{children:[Object(m.jsx)("strong",{children:"Use ANN ?"}),": Use an approximate method to speed up the nearest neighbor search. This sacrifices some accuracy for speed in larger datasets."]}),Object(m.jsxs)("p",{children:[Object(m.jsx)("strong",{children:"Weighting scheme"}),": Weighting scheme to use for the edges of the shared nearest neighbor graph. The Rank approach derives a weight from the rank of the closest shared neighbor; the Number approach uses the number of shared neighbors; and the Jaccard approach uses the Jaccard index of the neighbor sets."]}),Object(m.jsxs)("p",{children:[Object(m.jsx)("strong",{children:"Resolution"}),": Resolution parameter for the multi-level clustering, used to adjust the modularity calculation during community optimization. Larger values yield more fine-grained clusters."]})]}),6==x&&Object(m.jsxs)(d.c,{intent:"primary",children:[Object(m.jsx)("p",{children:"Create a t-SNE plot to visualize cells in two dimensions, because our feeble human minds cannot interpret high-dimensional spaces. Cells that were neighbors in the original space are kept close together in the 2D embedding, while dissimilar cells are placed (arbitrarily) far away."}),Object(m.jsxs)("p",{children:[Object(m.jsx)("strong",{children:"Perplexity"}),": Perplexity parameter, which determines the size of the neighborhood of each cell. Larger values will favor preservation of global structure in the 2D embedding."]}),Object(m.jsxs)("p",{children:[Object(m.jsx)("strong",{children:"Iterations"}),": Number of t-SNE iterations. Doesn't usually have much of an effect if you leave it as it is."]})]}),7==x&&Object(m.jsxs)(d.c,{title:"Visually important content",intent:"primary",children:[Object(m.jsx)("p",{children:"Create a UMAP plot to visualize cells in two dimensions. Like the t-SNE, this aims to map cells from a high-dimensional space into a 2D embedding, where neighboring cells are kept close together and dissimilar cells are placed far apart."}),Object(m.jsxs)("p",{children:[Object(m.jsx)("strong",{children:"Number of neighbors"}),": Number of neighbors to use when defining the size of the local neighborhood. Larger values will favor preservation of global structure."]}),Object(m.jsxs)("p",{children:[Object(m.jsx)("strong",{children:"Minimum distance"}),": Minimum distance between points. Smaller values result in more tightly packed embedding and favor local structure."]}),Object(m.jsxs)("p",{children:[Object(m.jsx)("strong",{children:"Epochs"}),": Number of epochs to use for convergence. This doesn't really change all too much."]})]})]})]})}),Object(m.jsx)(d.D,{id:"load",title:"Load saved analysis",panel:Object(m.jsxs)("div",{className:"inputs-container",children:[Object(m.jsxs)("div",{className:"row-input",children:[Object(m.jsx)("div",{className:"col",children:Object(m.jsxs)(d.E,{animate:!0,renderActiveTabPanelOnly:!0,vertical:!0,onChange:function(e,t){"kana"===e?(G({file:null}),W({file:"Choose kana analysis file"})):"kanadb"===e&&G({file:null}),M&&ae(M),ee(e)},defaultSelectedTabId:$,children:[Object(m.jsx)(d.D,{id:"kana",title:"Load Analysis file",panel:Object(m.jsxs)("div",{children:[Object(m.jsxs)(d.m,{children:[Object(m.jsx)(d.F,{round:!0,children:"1"}),Object(m.jsx)("span",{className:"row-tooltip",children:"Load saved analysis file"})]}),Object(m.jsx)("div",{className:"row",children:Object(m.jsx)(d.q,{className:"row-input",children:Object(m.jsx)(d.k,{text:_.file,onInputChange:function(e){W(Object(l.a)(Object(l.a)({},_),{},{file:e.target.files[0].name})),G(Object(l.a)(Object(l.a)({},q),{},{file:e.target.files}))}})})})]})}),Object(m.jsx)(d.D,{id:"kanadb",title:"Load from database",panel:Object(m.jsxs)("div",{children:[Object(m.jsxs)(d.m,{children:[Object(m.jsx)(d.F,{round:!0,children:"1"}),Object(m.jsx)("span",{className:"row-tooltip",children:"Load analysis file"})]}),A?Object(m.jsx)("div",{className:"row",children:Object(m.jsx)(d.n,{onChange:function(e){var t;G(Object(l.a)(Object(l.a)({},q),{},{file:null===(t=e.currentTarget)||void 0===t?void 0:t.value}))},children:A.map((function(e,t){return Object(m.jsx)("option",{children:e},t)}))})}):Object(m.jsx)("div",{className:"row",children:Object(m.jsx)(d.q,{children:"No saved analysis found in the browser!!"})})]})})]})}),M&&T==$?Object(m.jsx)("div",{className:"col",children:Object(m.jsxs)("div",{children:[Object(m.jsxs)(d.m,{children:[Object(m.jsx)(d.F,{round:!0,children:"2"}),Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(2)},onMouseLeave:function(){return v(null)},children:"Quality control"})]}),Object(m.jsx)("div",{className:"row",children:Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(2)},onMouseLeave:function(){return v(null)},children:"Number of MADs"})}),Object(m.jsx)(d.x,{placeholder:"3",value:se.qc["qc-nmads"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{qc:Object(l.a)(Object(l.a)({},se.qc),{},{"qc-nmads":e})}))}})]})})]})}):"",M&&T==$?Object(m.jsx)("div",{className:"col",children:Object(m.jsxs)("div",{children:[Object(m.jsxs)(d.m,{children:[Object(m.jsx)(d.F,{round:!0,children:"3"}),Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(3)},onMouseLeave:function(){return v(null)},children:"Feature Selection"})]}),Object(m.jsx)("div",{className:"row",children:Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(3)},onMouseLeave:function(){return v(null)},children:"Lowess span"})}),Object(m.jsx)(d.x,{placeholder:"0.3",value:se.fSelection["fsel-span"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{fSelection:Object(l.a)(Object(l.a)({},se.fSelection),{},{"fsel-span":e})}))}})]})})]})}):"",M&&T==$?Object(m.jsx)("div",{className:"col",children:Object(m.jsxs)("div",{children:[Object(m.jsxs)(d.m,{children:[Object(m.jsx)(d.F,{round:!0,children:"4"}),Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(4)},onMouseLeave:function(){return v(null)},children:"Principal components analysis"})]}),Object(m.jsxs)("div",{className:"row",children:[Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(4)},onMouseLeave:function(){return v(null)},children:"Number of HVGs"})}),Object(m.jsx)(d.x,{placeholder:"2500",value:se.pca["pca-hvg"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{pca:Object(l.a)(Object(l.a)({},se.pca),{},{"pca-hvg":e})}))}})]}),Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(4)},onMouseLeave:function(){return v(null)},children:"Number of PCs"})}),Object(m.jsx)(d.x,{placeholder:"25",value:se.pca["pca-npc"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{pca:Object(l.a)(Object(l.a)({},se.pca),{},{"pca-npc":e})}))}})]})]})]})}):"",M&&T==$?Object(m.jsx)("div",{className:"col",children:Object(m.jsxs)("div",{children:[Object(m.jsxs)(d.m,{children:[Object(m.jsx)(d.F,{round:!0,children:"5"}),Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(5)},onMouseLeave:function(){return v(null)},children:"Clustering"})]}),Object(m.jsxs)("div",{className:"row",children:[Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(5)},onMouseLeave:function(){return v(null)},children:"Method"})}),Object(m.jsx)(d.n,{defaultValue:se.cluster["clus-method"],children:Object(m.jsx)("option",{children:se.cluster["clus-method"]})})]}),Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(5)},onMouseLeave:function(){return v(null)},children:"Number of neighbors"})}),Object(m.jsx)(d.x,{placeholder:"10",value:se.cluster["clus-k"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{cluster:Object(l.a)(Object(l.a)({},se.cluster),{},{"clus-k":e})}))}})]}),Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(5)},onMouseLeave:function(){return v(null)},children:"Use ANN"})}),Object(m.jsx)(d.C,{style:{marginTop:"10px"},large:!0,checked:se.cluster["clus-approx"],innerLabelChecked:"true",innerLabel:"false",onChange:function(e){ae(Object(l.a)(Object(l.a)({},se),{},{cluster:Object(l.a)(Object(l.a)({},se.cluster),{},{"clus-approx":e.target.checked})}))}})]}),Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(5)},onMouseLeave:function(){return v(null)},children:"Weighting scheme"})}),Object(m.jsxs)(d.n,{onChange:function(e,t){var n;return ae(Object(l.a)(Object(l.a)({},se),{},{cluster:Object(l.a)(Object(l.a)({},se.cluster),{},{"clus-scheme":parseInt(null===e||void 0===e||null===(n=e.currentTarget)||void 0===n?void 0:n.value)})}))},children:[Object(m.jsx)("option",{children:"Rank"},"0"),Object(m.jsx)("option",{children:"Number"},"1"),Object(m.jsx)("option",{children:"Jaccard"},"2")]})]}),Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(5)},onMouseLeave:function(){return v(null)},children:"Resolution"})}),Object(m.jsx)(d.x,{placeholder:"0.5",value:se.cluster["clus-res"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{cluster:Object(l.a)(Object(l.a)({},se.cluster),{},{"clus-res":e})}))}})]})]})]})}):"",M&&T==$?Object(m.jsx)("div",{className:"col",children:Object(m.jsxs)("div",{children:[Object(m.jsxs)(d.m,{children:[Object(m.jsx)(d.F,{round:!0,children:"6"}),Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(6)},onMouseLeave:function(){return v(null)},children:"t-SNE"})]}),Object(m.jsxs)("div",{className:"row",children:[Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(6)},onMouseLeave:function(){return v(null)},children:"Perplexity"})}),Object(m.jsx)(d.x,{placeholder:"30",value:se.tsne["tsne-perp"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{tsne:Object(l.a)(Object(l.a)({},se.tsne),{},{"tsne-perp":e})}))}})]}),Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(6)},onMouseLeave:function(){return v(null)},children:"Iterations"})}),Object(m.jsx)(d.x,{placeholder:"500",value:se.tsne["tsne-iter"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{tsne:Object(l.a)(Object(l.a)({},se.tsne),{},{"tsne-iter":e})}))}})]})]})]})}):"",M&&T==$?Object(m.jsx)("div",{className:"col",children:Object(m.jsxs)("div",{children:[Object(m.jsxs)(d.m,{children:[Object(m.jsx)(d.F,{round:!0,children:"7"}),Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(7)},onMouseLeave:function(){return v(null)},children:"UMAP"})]}),Object(m.jsxs)("div",{className:"row",children:[Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(7)},onMouseLeave:function(){return v(null)},children:"Number of neighbors"})}),Object(m.jsx)(d.x,{placeholder:"15",value:se.umap["umap-nn"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{umap:Object(l.a)(Object(l.a)({},se.umap),{},{"umap-nn":e})}))}})]}),Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(7)},onMouseLeave:function(){return v(null)},children:"Minimum distance"})}),Object(m.jsx)(d.x,{placeholder:"0.01",value:se.umap["umap-min_dist"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{umap:Object(l.a)(Object(l.a)({},se.umap),{},{"umap-min_dist":e})}))}})]}),Object(m.jsxs)(d.q,{className:"row-input",children:[Object(m.jsx)(d.G,{className:"text-100",children:Object(m.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return v(7)},onMouseLeave:function(){return v(null)},children:"Epochs"})}),Object(m.jsx)(d.x,{placeholder:"500",value:se.umap["umap-epoch"],onValueChange:function(e,t){ae(Object(l.a)(Object(l.a)({},se),{},{umap:Object(l.a)(Object(l.a)({},se.umap),{},{"umap-epoch":e})}))}})]})]})]})}):""]}),Object(m.jsxs)("div",{className:"row-input-tooltips",children:[!U&&Object(m.jsx)(d.c,{intent:"danger",title:"Incorrect file format",style:{marginBottom:"10px"}}),Object(m.jsxs)(d.c,{intent:"primary",children:["Import a saved analysis from ",Object(m.jsx)("strong",{children:"kana"}),". These files are gzipped and are stored as ",Object(m.jsx)("strong",{children:Object(m.jsx)("code",{children:"*.kana.gz"})}),"."]})]})]})})]})}),n?Object(m.jsx)("div",{className:O.a.DIALOG_FOOTER,children:Object(m.jsx)("div",{className:O.a.DIALOG_FOOTER_ACTIONS,children:Object(m.jsx)(j.a,{content:"Run Analysis",children:Object(m.jsx)(d.a,{disabled:!U,icon:"function",onClick:function(){k(se),N({format:"new"==E?X:$,files:q}),L("new"==E?X:$),w()},children:"Analyze"})})})}):Object(m.jsx)("div",{style:{margin:"0 20px"}})]}))]})},w=function(){var e=Object(s.useContext)(f),t=e.initDims,n=e.qcDims;return Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("span",{children:[": ",t?"".concat(t):" ???",n?" (after QC: ".concat(n,")"):""]})})},F=function(){var e=Object(s.useContext)(f).logs,t=Object(s.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!0,enforceFocus:!0,hasBackdrop:!0,isOpen:!1,position:p.a.RIGHT,size:void 0,usePortal:!0}),n=Object(o.a)(t,2),a=n[0],c=n[1];return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(d.a,{onClick:function(){return c({isOpen:!0})},icon:"wrench",outlined:!0,intent:"warning"}),Object(m.jsx)(d.i,Object(l.a)(Object(l.a)({icon:"info-sign",onClose:function(){return c({isOpen:!1})},title:"What's happening ?"},a),{},{children:Object(m.jsx)("div",{className:O.a.DRAWER_BODY,children:Object(m.jsx)("div",{className:O.a.DIALOG_BODY,children:Object(m.jsx)("ul",{className:"list",children:e.map((function(e,t){return Object(m.jsx)("li",{children:e},t)}))})})})}))]})},N=n(34),C=["buttonText","includeFooter"];var k=function(e){e.buttonText,e.includeFooter;var t=Object(b.a)(e,C),n=Object(s.useContext)(f).setOpenInput,a=Object(s.useState)(!0),c=Object(o.a)(a,2),i=c[0],r=c[1],u=Object(s.useState)(!1),h=Object(o.a)(u,2),p=h[0],x=h[1],v=Object(s.useCallback)((function(){r(!i),x(!0)}),[i]),g=Object(s.useCallback)((function(){return r(!1)}),[]);return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(d.a,{onClick:v,icon:"info-sign",intent:"primary",text:""}),Object(m.jsxs)(d.g,Object(l.a)(Object(l.a)({},t),{},{isOpen:i,onClose:g,children:[Object(m.jsx)("div",{className:O.a.DIALOG_BODY,children:Object(m.jsxs)(d.d,{elevation:N.a.ZERO,children:[Object(m.jsxs)("p",{children:[Object(m.jsx)("strong",{children:"kana"})," performs a standard scRNA-seq data analysis directly inside the browser."]}),Object(m.jsxs)("p",{children:["With just a few clicks, you can get a UMAP/t-SNE and marker genes in an intuitive interface for further exploration. No need to transfer data, no need to install software, no need to configure a backend server - just point to a Matrix Market file and we'll analyze ",Object(m.jsx)("em",{children:"your"})," data on ",Object(m.jsx)("em",{children:"your"})," computer, no questions asked."]}),Object(m.jsxs)("p",{children:["Check out our ",Object(m.jsx)("a",{href:"https://github.com/jkanche/scran.js.app",target:"_blank",children:"GitHub page"})," for more details. Or you could just play around with the app to see what it can do - after all, it's totally free!"]}),Object(m.jsx)(d.m,{children:"Authors"}),"Jayaram Kancherla (",Object(m.jsx)("a",{href:"https://github.com/jkanche",target:"_blank",children:Object(m.jsx)("strong",{children:"@jkanche"})}),"), Aaron Lun (",Object(m.jsx)("a",{href:"https://github.com/LTLA",target:"_blank",children:Object(m.jsx)("strong",{children:"@LTLA"})}),")"]})}),Object(m.jsx)("div",{className:O.a.DIALOG_FOOTER,children:Object(m.jsx)("div",{className:O.a.DIALOG_FOOTER_ACTIONS,children:p?Object(m.jsx)(d.a,{icon:"cross",onClick:g,children:"Close"}):Object(m.jsx)(j.a,{content:"\u884c\u304f\u305e!",children:Object(m.jsx)(d.a,{icon:"bring-data",onClick:function(){n(!0),g()},children:"Get started"})})})})]}))]})},S=function(){var e=Object(s.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!1,enforceFocus:!0,shouldReturnFocusOnClose:!0}),t=Object(o.a)(e,1)[0],n=Object(s.useContext)(f),a=n.setExportState,c=n.datasetName,i=n.setDatasetName,r=n.setIndexedDBState;return Object(m.jsx)(m.Fragment,{children:Object(m.jsx)(d.t,{className:"bp3-dark",children:Object(m.jsxs)(d.v,{className:"navbar-group",align:u.a.LEFT,children:[Object(m.jsx)(d.w,{children:"kana"}),Object(m.jsx)(d.u,{}),Object(m.jsx)("span",{children:"Single cell RNA-seq analysis in the browser"}),Object(m.jsx)(d.u,{}),Object(m.jsx)(y,Object(l.a)({icon:"document",title:"Import dataset & update parameters (mouseover for info)",buttonText:"Start Analysis",includeFooter:!0},t)),Object(m.jsx)(d.u,{}),Object(m.jsx)(j.a,{content:"Modify dataset title",children:Object(m.jsx)(d.j,{defaultValue:c,intent:"primary",onConfirm:function(e){i(e)}})}),Object(m.jsx)(w,{}),Object(m.jsx)(d.u,{}),Object(m.jsx)(d.b,{children:Object(m.jsx)(h.a,{content:Object(m.jsxs)(d.r,{children:[Object(m.jsx)(d.s,{text:"Save",icon:"floppy-disk",onClick:function(){r(!0)}}),Object(m.jsx)(d.s,{text:"Download",icon:"download",onClick:function(){a(!0)}})]}),placement:"bottom-start",children:Object(m.jsx)(d.a,{intent:"warning",rightIcon:"caret-down",text:"Export"})})}),Object(m.jsx)(d.u,{}),Object(m.jsx)(F,{}),Object(m.jsx)(d.u,{}),Object(m.jsx)(k,Object(l.a)({icon:"document",title:"Single-cell RNA-seq analysis in the browser",isOpen:!0},t))]})})})},E=n(11),D=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color,c=null===e||void 0===e?void 0:e.ymax;if(c||(c=Math.max.apply(Math,Object(r.a)(n.map((function(e){return e.value}))))),s||(s=325),a||(a="#00B3A4"),!n)return"";var i=t.current;i.innerHTML="";var l=10,o=30,d=30,u=40,j=s-u-o,h=200-l-d,b=E.o(i).append("svg").attr("width",j+u+o).attr("height",h+l+d).append("g").attr("transform","translate(".concat(u,",").concat(l,")")),O=E.l().range([0,j]).domain(n.map((function(e){return e.key}))).padding(.2);b.append("g").attr("transform","translate(0,"+h+")").call(E.b(O)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");var p=E.m().domain([0,c]).range([h,0]);b.append("g").call(E.c(p)),b.selectAll("bars").data(n).enter().append("rect").attr("x",(function(e){return O(e.key)})).attr("y",(function(e){return p(e.value)})).attr("width",O.bandwidth()).attr("height",(function(e){return h-p(e.value)})).attr("fill",(function(e,t){return Array.isArray(a)?a[t]:a}))}),[]),Object(m.jsx)("div",{ref:t})},M=function(e){var t,n,s=null===e||void 0===e||null===(t=e.pca)||void 0===t?void 0:t.var_exp;if(!s)return"";var a=[];return null===(n=Object.values(s))||void 0===n||n.forEach((function(e,t){a.push({key:t+1,value:100*e})})),Object(m.jsx)(D,{data:a})},A=n(63),L=function(e){var t,n,a=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.clusters,c=Object(s.useContext)(f),i=c.clusterColors,l=c.setClusterColors;Object(s.useEffect)((function(){var e=Math.max.apply(Math,Object(r.a)(a))+1,t=null;t=e>Object.keys(o).length?Object(A.randomColor)({luminosity:"dark",count:e+1}):o[e.toString()],l(t)}),[]);for(var o={1:["#1b9e77"],2:["#1b9e77","#d95f02"],3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},d={},u=0;u<(null===a||void 0===a?void 0:a.length);u++){var j=a[u];"CLUS_"+j in d?d["CLUS_"+j]++:d["CLUS_"+j]=0}var h=[];return null===(n=Object.values(d))||void 0===n||n.forEach((function(e,t){h.push({key:t+1,value:e})})),i&&Object(m.jsx)(D,{data:h,color:i})},T=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.rdata,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color;if(s||(s=200),a||(a="#00B3A4"),!n)return"";var c=t.current;c.innerHTML="";var i=10,l=30,r=30,o=40,d=s-o-l,u=200-i-r,j=E.o(c).append("svg").attr("width",d+o+l).attr("height",u+i+r).append("g").attr("transform","translate(".concat(o,",").concat(i,")")),h=E.m().domain(null===e||void 0===e?void 0:e.range).range([u,0]).nice();j.append("g").call(E.c(h).tickFormat((function(t){return"log"===(null===e||void 0===e?void 0:e.transform)?E.g(".2s")(Math.pow(2,t)):E.g(".2s")(100*t)})));var b=E.l().range([0,d]).domain([null===e||void 0===e?void 0:e.showLabel]).padding(.05);j.append("g").attr("transform","translate(0,"+u+")").call(E.b(b));var O=E.d().domain(h.domain()).thresholds(h.ticks(10)).value((function(e){return e}))(n),p=E.k(O,(function(e){return e.length})),x=E.m().range([0,b.bandwidth()]).domain([-1,1]);j.selectAll("violins").data([null===e||void 0===e?void 0:e.label]).enter().append("g").attr("transform",(function(e){return"translate("+b(e)+" ,0)"})).append("path").datum((function(){return O})).style("stroke","none").style("fill",a).attr("d",E.a().x0((function(e){return x(-e.length/p)})).x1((function(e){return x(e.length/p)})).y((function(e){return h(e.x0)})).curve(E.e)),j.selectAll("threshold").data([null===e||void 0===e?void 0:e.threshold]).enter().append("line").attr("transform",(function(){return"translate("+b(null===e||void 0===e?void 0:e.label)+" ,0)"})).attr("class","threshold").attr("x1",5).attr("y1",(function(e){return h(e)})).attr("x2",b.bandwidth()-5).attr("y2",(function(e){return h(e)})).attr("stroke-width",2).attr("stroke","Orange").on("mouseover",(function(){var e=E.o(this);e.attr("stroke","black"),e.attr("stroke-width","8")})).on("mouseout",(function(){var e=E.o(this);e.attr("stroke","Orange"),e.attr("stroke-width","5")}))}),[]),Object(m.jsx)("div",{ref:t})},I=(n(312),function(e){var t=e.data;return Object(m.jsx)("div",{className:"qc-plots",children:["sums","detected","proportion"].map((function(e){var n,s,a,c,i,r,o={threshold:"proportion"!==e?Math.log2(null===t||void 0===t||null===(n=t.thresholds)||void 0===n?void 0:n[e]):100*(null===t||void 0===t||null===(s=t.thresholds)||void 0===s?void 0:s[e]),range:"proportion"!==e?null===t||void 0===t||null===(a=t.ranges)||void 0===a?void 0:a[e].map((function(e){return Math.log2(e+1)})):null===t||void 0===t||null===(c=t.ranges)||void 0===c?void 0:c[e].map((function(e){return 100*e})),label:e,transform:"proportion"!==e?"log":"perc",showLabel:e,rdata:"proportion"!==e?null===t||void 0===t||null===(i=t.data)||void 0===i?void 0:i[e].map((function(e){return Math.log2(e+1)})):null===t||void 0===t||null===(r=t.data)||void 0===r?void 0:r[e].map((function(e){return 100*e}))};return Object(m.jsx)("div",{children:Object(m.jsx)(T,Object(l.a)({},o))},e)}))})}),R=(n(313),n(314),function(e){var t=Object(s.useRef)(),n=Object(s.useState)(null),a=Object(o.a)(n,2),c=a[0],i=a[1],l=Object(s.useContext)(f),r=l.genesInfo,u=l.selectedClusterSummary,j=null===e||void 0===e?void 0:e.data,h=null===e||void 0===e?void 0:e.width,b=null===e||void 0===e?void 0:e.height,O=null===e||void 0===e?void 0:e.color;return h||(h=325),b||(b=200),O||(O="#00B3A4"),Object(s.useEffect)((function(){var e=t.current;if(e){var n,s,a;if(null===j||void 0===j?void 0:j.image){var c=e.getContext("2d"),l=new Image;l.onload=function(){c.drawImage(l,0,0,h,b)},l.src=null===j||void 0===j?void 0:j.image}var o,d,O,p=" ".concat(null===j||void 0===j||null===(n=j.config)||void 0===n?void 0:n.embedding," ");if(null===j||void 0===j||null===(s=j.config)||void 0===s?void 0:s.gene)p+="\u2283 ".concat(r[null===u||void 0===u||null===(o=u[null===j||void 0===j||null===(d=j.config)||void 0===d?void 0:d.gene])||void 0===o?void 0:o.row]," ");if(null===j||void 0===j||null===(a=j.config)||void 0===a?void 0:a.highlight)p+="\u2283 Cluster ".concat(parseInt((null===j||void 0===j||null===(O=j.config)||void 0===O?void 0:O.highlight)+1)," ");i(p)}}),[]),Object(m.jsxs)("div",{className:"imgplot-container",children:[Object(m.jsx)("h5",{children:c}),Object(m.jsx)(d.a,{small:!0,className:"imgplot-save",icon:"download",onClick:function(){var e=document.createElement("a");e.href=null===j||void 0===j?void 0:j.image,e.download="".concat(c.replace("\u2283","").split(" ").join("_"),".png"),e.click()},children:"Save"}),Object(m.jsx)("canvas",{className:"imgplot-canvas",width:h,height:b,ref:t})]})}),q=function(){var e=Object(s.useContext)(f),t=e.pcaVarExp,n=e.qcData,a=e.clusterData,c=e.savedPlot;return Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"gallery-cont",children:[n&&(null===n||void 0===n?void 0:n.thresholds)?Object(m.jsxs)(d.d,{className:"gallery-elem",elevation:N.a.ONE,children:[Object(m.jsx)("h5",{children:"QC Statistics"}),Object(m.jsx)(I,{data:n})]}):"",t?Object(m.jsxs)(d.d,{className:"gallery-elem",elevation:N.a.ONE,children:[Object(m.jsx)("h5",{children:"PCA (% variance explained)"}),Object(m.jsx)(M,{pca:t})]}):"",a?Object(m.jsxs)(d.d,{className:"gallery-elem",elevation:N.a.ONE,children:[Object(m.jsx)("h5",{children:"# of cells per cluster"}),Object(m.jsx)(L,{data:a})]}):"",c?c.map((function(e,t){return Object(m.jsx)(d.d,{className:"gallery-elem",elevation:N.a.ONE,children:Object(m.jsx)(R,{data:e})},t)})):""]})})},G=n(78),P=function(e){var t=-Number.MAX_VALUE,n=Number.MAX_VALUE;return e.forEach((function(e){t<e&&(t=e),n>e&&(n=e)})),[n,t]};function B(){var e=null,t=0,n=100,s=["ff0000","ffff00","00ff00","0000ff"];function a(a){if(a.length<2)throw new Error("Rainbow must have two or more colours.");var c=(n-t)/(a.length-1),i=new _;i.setGradient(a[0],a[1]),i.setNumberRange(t,t+c),e=[i];for(var l=1;l<a.length-1;l++){var r=new _;r.setGradient(a[l],a[l+1]),r.setNumberRange(t+c*l,t+c*(l+1)),e[l]=r}s=a}a(s),this.setSpectrum=function(){return a(arguments),this},this.setSpectrumByArray=function(e){return a(e),this},this.colourAt=function(s){if(isNaN(s))throw new TypeError(s+" is not a number");if(1===e.length)return e[0].colourAt(s);var a=(n-t)/e.length,c=Math.min(Math.floor((Math.max(s,t)-t)/a),e.length-1);return e[c].colourAt(s)},this.colorAt=this.colourAt,this.setNumberRange=function(e,c){if(!(c>e))throw new RangeError("maxNumber ("+c+") is not greater than minNumber ("+e+")");return t=e,n=c,a(s),this}}function _(){var e="ff0000",t="0000ff",n=0,s=100;function a(e,t,a){var c=e;c<n&&(c=n),c>s&&(c=s);var i,l=s-n,r=parseInt(t,16),o=(parseInt(a,16)-r)/l,d=Math.round(o*(c-n)+r);return 1===(i=d.toString(16)).length?"0"+i:i}function c(e){if(function(e){return/^#?[0-9a-fA-F]{6}$/i.test(e)}(e))return e.substring(e.length-6,e.length);var t=e.toLowerCase();if(i.hasOwnProperty(t))return i[t];throw new Error(e+" is not a valid colour.")}this.setGradient=function(n,s){e=c(n),t=c(s)},this.setNumberRange=function(e,t){if(!(t>e))throw new RangeError("maxNumber ("+t+") is not greater than minNumber ("+e+")");n=e,s=t},this.colourAt=function(n){return a(n,e.substring(0,2),t.substring(0,2))+a(n,e.substring(2,4),t.substring(2,4))+a(n,e.substring(4,6),t.substring(4,6))};var i={aliceblue:"F0F8FF",antiquewhite:"FAEBD7",aqua:"00FFFF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000000",blanchedalmond:"FFEBCD",blue:"0000FF",blueviolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetblue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerblue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"00FFFF",darkblue:"00008B",darkcyan:"008B8B",darkgoldenrod:"B8860B",darkgray:"A9A9A9",darkgreen:"006400",darkgrey:"A9A9A9",darkkhaki:"BDB76B",darkmagenta:"8B008B",darkolivegreen:"556B2F",darkorange:"FF8C00",darkorchid:"9932CC",darkred:"8B0000",darksalmon:"E9967A",darkseagreen:"8FBC8F",darkslateblue:"483D8B",darkslategray:"2F4F4F",darkslategrey:"2F4F4F",darkturquoise:"00CED1",darkviolet:"9400D3",deeppink:"FF1493",deepskyblue:"00BFFF",dimgray:"696969",dimgrey:"696969",dodgerblue:"1E90FF",firebrick:"B22222",floralwhite:"FFFAF0",forestgreen:"228B22",fuchsia:"FF00FF",gainsboro:"DCDCDC",ghostwhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"808080",green:"008000",greenyellow:"ADFF2F",grey:"808080",honeydew:"F0FFF0",hotpink:"FF69B4",indianred:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderblush:"FFF0F5",lawngreen:"7CFC00",lemonchiffon:"FFFACD",lightblue:"ADD8E6",lightcoral:"F08080",lightcyan:"E0FFFF",lightgoldenrodyellow:"FAFAD2",lightgray:"D3D3D3",lightgreen:"90EE90",lightgrey:"D3D3D3",lightpink:"FFB6C1",lightsalmon:"FFA07A",lightseagreen:"20B2AA",lightskyblue:"87CEFA",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"B0C4DE",lightyellow:"FFFFE0",lime:"00FF00",limegreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumaquamarine:"66CDAA",mediumblue:"0000CD",mediumorchid:"BA55D3",mediumpurple:"9370DB",mediumseagreen:"3CB371",mediumslateblue:"7B68EE",mediumspringgreen:"00FA9A",mediumturquoise:"48D1CC",mediumvioletred:"C71585",midnightblue:"191970",mintcream:"F5FFFA",mistyrose:"FFE4E1",moccasin:"FFE4B5",navajowhite:"FFDEAD",navy:"000080",oldlace:"FDF5E6",olive:"808000",olivedrab:"6B8E23",orange:"FFA500",orangered:"FF4500",orchid:"DA70D6",palegoldenrod:"EEE8AA",palegreen:"98FB98",paleturquoise:"AFEEEE",palevioletred:"DB7093",papayawhip:"FFEFD5",peachpuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderblue:"B0E0E6",purple:"800080",red:"FF0000",rosybrown:"BC8F8F",royalblue:"4169E1",saddlebrown:"8B4513",salmon:"FA8072",sandybrown:"F4A460",seagreen:"2E8B57",seashell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyblue:"87CEEB",slateblue:"6A5ACD",slategray:"708090",slategrey:"708090",snow:"FFFAFA",springgreen:"00FF7F",steelblue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFFFFF",whitesmoke:"F5F5F5",yellow:"FFFF00",yellowgreen:"9ACD32"}}n(326);var W=function(){var e,t,n=Object(s.useRef)(),a=Object(s.useState)(null),c=Object(o.a)(a,2),i=c[0],u=c[1],h=Object(s.useState)(null),b=Object(o.a)(h,2),O=b[0],p=b[1],x=Object(s.useState)(!1),v=Object(o.a)(x,2),g=v[0],y=v[1],w=Object(s.useState)(null),F=Object(o.a)(w,2),N=F[0],C=F[1],k=Object(s.useState)(N),S=Object(o.a)(k,2),E=S[0],D=S[1],M=Object(s.useState)(null),L=Object(o.a)(M,2),T=L[0],I=L[1],R=Object(s.useState)(!0),q=Object(o.a)(R,2),_=q[0],W=q[1],V=Object(s.useContext)(f),z=(V.plotRedDims,V.redDims),U=V.defaultRedDims,H=V.setDefaultRedDims,K=V.clusterData,Q=V.tsneData,X=V.umapData,Y=(V.setPlotRedDims,V.clusterColors),J=V.setClusterColors,Z=V.gene,$=V.selectedClusterSummary,ee=V.customSelection,te=V.setCustomSelection,ne=V.setDelCustomSelection,se=V.showAnimation,ae=V.setTriggerAnimation,ce=V.savedPlot,ie=V.setSavedPlot,le=V.selectedCluster,re=Object(s.useState)(null),oe=Object(o.a)(re,2),de=oe[0],ue=oe[1],je=Object(s.useState)("PAN"),he=Object(o.a)(je,2),be=he[0],Oe=he[1],pe=Math.max.apply(Math,Object(r.a)(null===K||void 0===K?void 0:K.clusters));Object(s.useEffect)((function(){var e;if(null===Z&&(y(!1),I(null)),null===$||void 0===$||null===(e=$[Z])||void 0===e?void 0:e.expr){var t,n=P(null===$||void 0===$||null===(t=$[Z])||void 0===t?void 0:t.expr),s=0===n[1]?.01:n[1],a=new B;a.setSpectrum("#F5F8FA","#2965CC"),a.setNumberRange(0,s),y(!0),I(a),D([0,s]),C([0,s])}}),[null===$||void 0===$||null===(e=$[Z])||void 0===e?void 0:e.expr],Z),Object(s.useEffect)((function(){if(Array.isArray(E)){var e=new B;e.setSpectrum("#F5F8FA","#2965CC"),e.setNumberRange.apply(e,Object(r.a)(E)),I(e),y(!0)}}),[E]),Object(s.useEffect)((function(){if(n.current){var e=i;if(!e){var t=n.current;t.style.width="95%",t.style.height="95%",e=new G.ScatterGL(t,{onSelect:function(e){0!==e.length&&ue(e)},orbitControls:{zoomSpeed:1.25},styles:{point:{scaleDefault:1,scaleSelected:1.25,scaleHover:1.25}}}),e.setPanMode(),u(e)}var s=null;if("TSNE"===U?s=Q:"UMAP"===U&&(s=X),s){var a=null===K||void 0===K?void 0:K.clusters,c=Y,l=[];s.x.forEach((function(e,t){l.push([e,s.y[t]])}));var r={clusters:a},o=new G.ScatterGL.Dataset(l,r);_?(e.render(o),W(!1)):e.updateDataset(o),e.setPointColorer((function(e,t,n){var s,i,l;if(t.has(e))return"#30404D";if(null!=O)if(String(O).startsWith("cs")){if(!ee[O].includes(e))return"#D3D3D3"}else if(O!==a[e])return"#D3D3D3";if(null!==Z&&Array.isArray(null===$||void 0===$||null===(s=$[Z])||void 0===s?void 0:s.expr))return"#"+T.colorAt(null===$||void 0===$||null===(i=$[Z])||void 0===i||null===(l=i.expr)||void 0===l?void 0:l[e]);if(null!=O&&String(O).startsWith("cs")){var r=parseInt(O.replace("cs",""));return c[pe+r]}return c[a[e]]}))}}}),[Q,X,U,T,O]);var xe=function(e){"PAN"===e?(i.setPanMode(),Oe("PAN")):"SELECT"===e&&(i.setSelectMode(),Oe("SELECT"))};return Object(m.jsxs)("div",{className:"scatter-plot",children:[Object(m.jsxs)(d.b,{style:{minWidth:75,minHeight:150},fill:!1,large:!1,minimal:!1,vertical:!0,className:"left-sidebar",children:[Object(m.jsxs)(d.a,{className:"dim-button",disabled:-1===z.indexOf("TSNE"),onClick:function(){return H("TSNE")},intent:"TSNE"===U?"primary":"",children:[Object(m.jsx)(d.o,{icon:"database"}),Object(m.jsx)("br",{}),Object(m.jsx)("span",{children:"TSNE"})]}),Object(m.jsxs)(d.a,{className:"dim-button",disabled:-1===z.indexOf("UMAP"),onClick:function(){return H("UMAP")},intent:"UMAP"===U?"primary":"",children:[Object(m.jsx)(d.o,{icon:"database"}),Object(m.jsx)("br",{}),Object(m.jsx)("span",{children:"UMAP"})]})]}),Object(m.jsxs)("div",{className:"top-header",children:[Object(m.jsxs)(d.f,{fill:!1,vertical:!1,style:{marginRight:"4px"},children:[Object(m.jsx)(j.a,{content:"Interactively visualize embeddings",children:Object(m.jsx)(d.a,{icon:"play",onClick:function(){return ae(!0)},children:"Animate"})}),Object(m.jsx)(j.a,{content:"Save this embedding",children:Object(m.jsx)(d.a,{icon:"inheritance",onClick:function(){if(console.log("handleSaveEmbedding"),n.current){i.renderScatterPlot();var e=i.scatterPlot.renderer.domElement.toDataURL(),t=Object(r.a)(ce);t.push({image:e,config:{cluster:le,gene:Z,highlight:O,embedding:U}}),ie(t)}},children:"Save"})})]}),Object(m.jsxs)(d.f,{fill:!1,vertical:!1,children:[Object(m.jsx)(d.a,{active:"PAN"==be,intent:"PAN"===be?"primary":"none",icon:"hand-up",onClick:function(e){return xe("PAN")},children:"Pan"}),Object(m.jsx)(d.a,{active:"SELECT"==be,intent:"SELECT"===be?"primary":"none",icon:"widget",onClick:function(e){return xe("SELECT")},children:"Selection"})]})]}),se?Object(m.jsxs)(d.q,{className:"iter",children:["Iteration: ","TSNE"===U?null===Q||void 0===Q?void 0:Q.iteration:null===X||void 0===X?void 0:X.iteration]}):"",Object(m.jsx)("div",{className:"dim-plot",children:U?Object(m.jsx)("div",{ref:n}):"Choose an Embedding... or Embeddings are being computed..."}),Object(m.jsx)("div",{className:"right-sidebar",children:Object(m.jsxs)("div",{style:{width:"100%"},children:[Object(m.jsxs)("div",{className:"right-sidebar-cluster",children:[Object(m.jsxs)(d.c,{title:"CLUSTERS",children:[Object(m.jsx)("ul",{children:null===Y||void 0===Y?void 0:Y.map((function(e,t){return t<Y.length-Object.keys(ee).length?Object(m.jsxs)("li",{className:O==t?"legend-highlight":"",style:{color:e},onClick:function(){p(t===O?null:t)},children:[" Cluster ",t+1," "]},t):""}))}),Object.keys(ee).length>0?Object(m.jsxs)("div",{style:{paddingTop:"5px"},children:[Object(m.jsxs)("span",{children:["Custom Selection \xa0",Object(m.jsx)(j.a,{content:"Custom selection of cells",openOnTargetFocus:!1,children:Object(m.jsx)(d.o,{icon:"help"})})]}),Object(m.jsx)("ul",{children:null===(t=Object.keys(ee))||void 0===t?void 0:t.map((function(e,t){return Object(m.jsx)("li",{className:O==e?"legend-highlight":"",style:{color:Y[Math.max.apply(Math,Object(r.a)(null===K||void 0===K?void 0:K.clusters))+1+t]},children:Object(m.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",flexDirection:"row"},children:[Object(m.jsxs)("span",{style:{alignSelf:"center"},onClick:function(){p(e===O?null:e)},children:["Custom Selection ",e.replace("cs","")]}),Object(m.jsx)(d.o,{size:12,icon:"trash",style:{paddingLeft:"2px"},onClick:function(){var t=Object(l.a)({},ee);delete t[e],te(t);var n=Object(r.a)(Y);n=n.slice(0,n.length-1),J(n),ne(e),O===e&&p(null)}})]})},e)}))})]}):""]}),de&&de.length>0?Object(m.jsxs)("div",{children:[Object(m.jsx)(d.h,{}),Object(m.jsxs)("span",{children:["Selection \xa0",Object(m.jsx)(j.a,{content:"save this selection of cells",openOnTargetFocus:!1,children:Object(m.jsx)(d.o,{icon:"help"})})]}),Object(m.jsxs)("div",{className:"selection-container",children:[Object(m.jsxs)("span",{children:[de.length," cells selected"]}),Object(m.jsxs)("div",{className:"selection-button-container",children:[Object(m.jsx)(d.a,{small:!0,intent:"primary",onClick:function(){var e=Object(A.randomColor)({luminosity:"dark",count:1}),t=Object(r.a)(Y);t.push(e[0]),J(t);var n=Object.keys(ee).length,s=Object(l.a)({},ee);s["cs".concat(n+1)]=de,te(s),ue(null),i.select(null)},children:"Save"}),Object(m.jsx)(d.a,{small:!0,onClick:function(){ue(null),i.select(null)},children:"Clear"})]})]})]}):""]}),g?Object(m.jsxs)("div",{className:"right-sidebar-slider",children:[Object(m.jsx)(d.h,{}),Object(m.jsxs)(d.c,{children:[Object(m.jsxs)("span",{children:["Customize Gradient \xa0",Object(m.jsx)(j.a,{content:"Use the slider to adjust the color gradient of the plot. Useful when data is skewed by either a few lowly or highly expressed cells",openOnTargetFocus:!1,children:Object(m.jsx)(d.o,{icon:"help"})})]}),Object(m.jsxs)("div",{className:"dim-slider-container",children:[Object(m.jsxs)("div",{className:"dim-slider-gradient",children:[Object(m.jsx)("span",{children:Math.round(N[0])}),"\xa0",Object(m.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, #F5F8FA ".concat(100*(E[0]-N[0])/(N[1]-N[0]),"%, ").concat(100*(E[1]+E[0]-2*N[0])/(2*(N[1]-N[0])),"%, #2965CC ").concat(100-100*(N[1]-E[1])/(N[1]-N[0]),"%)"),width:"175px",height:"15px"}}),"\xa0",Object(m.jsx)("span",{children:Math.round(N[1])})]}),Object(m.jsx)("div",{className:"dim-range-slider",children:Object(m.jsx)(d.A,{min:Math.round(N[0]),max:Math.round(N[1]),stepSize:Math.round(N[1]-N[0])/25,onChange:function(e){D(e)},value:[Math.round(E[0]),Math.round(E[1])],vertical:!1})})]})]})]}):""]})})]})},V=a.a.memo(W),z=n(135),U=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color,c=null===e||void 0===e?void 0:e.clusters,i=null===e||void 0===e?void 0:e.clusterlabel;if(s||(s=325),a||(a="#00B3A4"),!n)return"";var l=t.current;l.innerHTML="";var r=10,o=30,d=30,u=40,j=s-u-o,h=150-r-d,b=E.o(l).append("svg").attr("width",j+u+o).attr("height",h+r+d).append("g").attr("transform","translate(".concat(u,",").concat(r,")")),O=E.m().domain(E.f(n)).range([0,j]);b.append("g").attr("transform","translate(0, ".concat(h/2,")")).call(E.b(O).ticks(5).tickValues(E.f(n)));var p=E.d().value((function(e){return e})).domain(O.domain()).thresholds(E.p),x=(p(n),p(n.filter((function(e,t){return 0===(null===c||void 0===c?void 0:c[t])})))),m=p(n.filter((function(e,t){return 1===(null===c||void 0===c?void 0:c[t])}))),f=E.k(x,(function(e){return e.length})),v=E.k(m,(function(e){return e.length})),g=E.m().range([h,0]).domain([-1,1]);b.selectAll("rectAll").data(x).join("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(O(e.x0)," , ").concat(g(0),")")})).attr("width",(function(e){return O(e.x1)-O(e.x0)-1})).attr("height",(function(e){return g(-e.length/f)-h/2})).style("fill","#D3D3D3").style("opacity",.6),b.selectAll("rectCluster").data(m).enter().append("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(O(e.x0),", ").concat(g(e.length/v),")")})).attr("width",(function(e){return O(e.x1)-O(e.x0)-1})).attr("height",(function(e){return h/2-g(e.length/v)})).style("fill",a).style("opacity",.6),b.append("text").attr("x",j-20).attr("y",g(-.5)).text("other cells").style("font-size","10px").attr("alignment-baseline","middle"),b.append("text").attr("x",j-20).attr("y",g(.5)).text(i).style("font-size","10px").attr("alignment-baseline","middle").style("fill",a)}),[]),Object(m.jsx)("div",{ref:t})},H=function(e){var t=Object(s.useRef)(),n=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.minmax,c=null===e||void 0===e?void 0:e.score,i=null===e||void 0===e?void 0:e.colorscale,l=null===e||void 0===e?void 0:e.colorscore,r=null===e||void 0===e?void 0:e.color,o=(c-a[0])/(a[1]-a[0]);return n||(n="100%"),r||(r="#00B3A4"),Object(m.jsx)("div",{ref:t,style:{width:n,height:"15px",margin:"5px",border:"1px solid gainsboro",alignItems:"center"},children:i?Object(m.jsx)("div",{style:{width:"".concat(100*l,"%"),backgroundColor:i(l),height:"100%"}}):Object(m.jsx)("div",{style:{width:"".concat(100*o,"%"),backgroundColor:r,height:"100%"}})})},K=function(e){var t=Object(s.useRef)(),n=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.score,c=null===e||void 0===e?void 0:e.minmax,i=E.n(E.j).domain([c[1],c[0]]);return n||(n="100%"),Object(m.jsx)("div",{ref:t,style:{width:n,height:"15px",margin:"5px",border:"1px solid gainsboro",alignItems:"center",backgroundColor:i(a)},children:Object(m.jsx)("div",{style:{width:"100%",backgroundColor:i(a),height:"100%"}})})},Q=(n(327),["children"]),X=function(){var e=Object(s.useContext)(f),t=e.genesInfo,n=e.clusterData,a=e.selectedClusterSummary,c=e.setSelectedClusterSummary,i=e.selectedCluster,u=e.setSelectedCluster,p=e.setClusterRank,x=e.setReqGene,v=e.clusterColors,g=e.gene,y=e.setGene,w=e.customSelection,F=Object(s.useState)(null),C=Object(o.a)(F,2),k=C[0],S=C[1],D=Object(s.useState)(null),M=Object(o.a)(D,2),A=M[0],L=M[1],T=Object(s.useState)(null),I=Object(o.a)(T,2),R=I[0],q=I[1],G=Object(s.useState)(null),P=Object(o.a)(G,2),B=P[0],_=P[1],W=Object(s.useState)(null),V=Object(o.a)(W,2),X=V[0],Y=V[1],J=Object(s.useState)(null),Z=Object(o.a)(J,2),$=Z[0],ee=Z[1],te=Object(s.useState)(null),ne=Object(o.a)(te,2),se=ne[0],ae=ne[1],ce=Object(s.useState)(null),ie=Object(o.a)(ce,2),le=ie[0],re=ie[1],oe=Object(s.useState)(null),de=Object(o.a)(oe,2),ue=(de[0],de[1]),je=Object(s.useState)(null),he=Object(o.a)(je,2),be=(he[0],he[1]),Oe=Object(s.useState)(null),pe=Object(o.a)(Oe,2),xe=(pe[0],pe[1]),me=Object(s.useState)(null),fe=Object(o.a)(me,2),ve=(fe[0],fe[1]),ge=Object(s.useState)({}),ye=Object(o.a)(ge,2),we=ye[0],Fe=ye[1],Ne=Object(s.useState)(null),Ce=Object(o.a)(Ne,2),ke=Ce[0],Se=Ce[1],Ee=E.j;Object(s.useEffect)((function(){if(!a)return a;var e=a;if(0===e.length)return e;var t=e.map((function(e){return null===e||void 0===e?void 0:e.mean})),n=E.f(t),s=0===n[1]?.01:n[1];_([parseFloat(n[0].toFixed(2)),parseFloat(s.toFixed(2))]),ue(t);var c=e.map((function(e){return null===e||void 0===e?void 0:e.delta})),i=E.f(c),l=0===i[1]?.01:i[1];Y([parseFloat(i[0].toFixed(2)),parseFloat(l.toFixed(2))]),be(c);var o=e.map((function(e){return null===e||void 0===e?void 0:e.lfc})),d=E.f(o),u=0===d[1]?.01:d[1];ee([parseFloat(d[0].toFixed(2)),parseFloat(u.toFixed(2))]),xe(o);var j=e.map((function(e){return null===e||void 0===e?void 0:e.detected})),h=E.f(j),b=0===h[1]?.01:h[1];ae([parseFloat(h[0].toFixed(2)),parseFloat(b.toFixed(2))]),ve(j),re({lfc:[parseFloat(d[0].toFixed(2)),parseFloat(u.toFixed(2))],mean:[parseFloat(n[0].toFixed(2)),parseFloat(s.toFixed(2))],detected:[parseFloat(h[0].toFixed(2)),parseFloat(b.toFixed(2))],delta:[parseFloat(i[0].toFixed(2)),parseFloat(l.toFixed(2))]});var O=Object(r.a)(e);Fe({lfc:[0,parseFloat(u.toFixed(2))],delta:[0,parseFloat(l.toFixed(2))]}),Se(O)}),[a]);var De=Object(s.useMemo)((function(){if(!ke)return[];var e=ke;if(we){var n=function(t){var n=we[t];if(n[0]==le[t][0]&&n[1]==le[t][1])return"continue";e=e.filter((function(e){return e[t]>=n[0]&&e[t]<=n[1]}))};for(var s in we)n(s)}return R&&""!==R?e=e.filter((function(e){return-1!==t[e.row].toLowerCase().indexOf(R.toLowerCase())})):e}),[ke,R,we]);Object(s.useEffect)((function(){if(null===n||void 0===n?void 0:n.clusters){for(var e=Math.max.apply(Math,Object(r.a)(n.clusters)),t=[],s=0;s<e+1;s++)t.push(s+1);t=t.concat(Object.keys(w)),S(t),null==i&&u(0)}}),[n,w,i]),Object(s.useEffect)((function(){var e,t,s=[];String(i).startsWith("cs")?null===n||void 0===n||null===(e=n.clusters)||void 0===e||e.forEach((function(e,t){return w[i].includes(t)?s.push(1):s.push(0)})):null===n||void 0===n||null===(t=n.clusters)||void 0===t||t.forEach((function(e){return e===i?s.push(1):s.push(0)}));L(s)}),[i]);var Me=function(e,t){var n=Object(l.a)({},we);n[t]=e,Fe(n)};return Object(m.jsxs)("div",{className:"marker-container",children:[Object(m.jsx)(d.l,{children:"Marker Genes"}),k?Object(m.jsx)(d.n,{onChange:function(e){var t;y(null);var n=null===(t=e.currentTarget)||void 0===t?void 0:t.value;n.startsWith("Cluster")?n=parseInt(n.replace("Cluster ",""))-1:n.startsWith("Custom")&&(n=n.replace("Custom Selection ","")),u(n),Fe({}),y(null)},children:k.map((function(e,t){return Object(m.jsxs)("option",{children:[String(e).startsWith("cs")?"Custom Selection":"Cluster"," ",e]},t)}))}):"",a?Object(m.jsxs)("div",{className:"marker-table",children:[Object(m.jsxs)("div",{className:"marker-header",children:[Object(m.jsx)(d.p,{leftIcon:"search",small:!0,placeholder:"Search gene...",type:"text",onChange:function(e){return q(e.target.value)}}),Object(m.jsxs)("span",{children:[Object(m.jsx)(d.o,{icon:"sort",style:{paddingRight:"5px"}}),Object(m.jsxs)(d.n,{onChange:function(e){p(e.currentTarget.value)},defaultValue:"cohen-min-rank",children:[Object(m.jsx)("option",{children:"cohen-min"}),Object(m.jsx)("option",{children:"cohen-mean"}),Object(m.jsx)("option",{children:"cohen-min-rank"}),Object(m.jsx)("option",{children:"auc-min"}),Object(m.jsx)("option",{children:"auc-mean"}),Object(m.jsx)("option",{children:"auc-min-rank"}),Object(m.jsx)("option",{children:"lfc-min"}),Object(m.jsx)("option",{children:"lfc-mean"}),Object(m.jsx)("option",{children:"lfc-min-rank"}),Object(m.jsx)("option",{children:"delta-d-min"}),Object(m.jsx)("option",{children:"delta-d-mean"}),Object(m.jsx)("option",{children:"delta-d-min-rank"})]})]})]}),Object(m.jsx)(z.a,{components:{Item:function(e){var t=e.children,n=Object(b.a)(e,Q);return Object(m.jsx)("div",Object(l.a)(Object(l.a)({className:"row-card"},n),{},{children:t}))},Header:function(){return Object(m.jsxs)("div",{className:"row-container row-header",children:[Object(m.jsx)("span",{children:"Gene"}),Object(m.jsx)("span",{children:"Log-FC"}),Object(m.jsx)("span",{children:"\u0394-detected"}),Object(m.jsxs)("span",{children:["Expression \xa0",Object(m.jsx)(j.a,{content:"bar represents the mean expression of the gene and the color gradient represents detected.",openOnTargetFocus:!1,children:Object(m.jsx)(d.o,{size:12,icon:"help"})})]}),Object(m.jsx)("span",{})]})}},className:"marker-list",totalCount:De.length,itemContent:function(e){var s=De[e],l=s.expanded,o=s.expr;return Object(m.jsxs)("div",{children:[Object(m.jsxs)("div",{className:"row-container",children:[Object(m.jsx)("span",{children:t[s.row]}),Object(m.jsx)(h.a,{popoverClassName:O.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(m.jsx)(d.d,{elevation:N.a.ZERO,children:Object(m.jsxs)("table",{children:[Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{}),Object(m.jsx)("th",{scope:"col",children:t[s.row]}),Object(m.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"row",children:"Log-FC"}),Object(m.jsx)("td",{children:s.lfc.toFixed(2)}),Object(m.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",$[0].toFixed(2),", ",$[1].toFixed(2),"]"]})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(m.jsx)("td",{children:s.delta.toFixed(2)}),Object(m.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",X[0].toFixed(2),", ",X[1].toFixed(2),"]"]})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"row",children:"Detected"}),Object(m.jsx)("td",{children:s.detected.toFixed(2)}),Object(m.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",se[0].toFixed(2),", ",se[1].toFixed(2),"]"]})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"row",children:"Expression"}),Object(m.jsx)("td",{children:s.mean.toFixed(2)}),Object(m.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",B[0].toFixed(2),", ",B[1].toFixed(2),"]"]})]})]})}),children:Object(m.jsx)(K,{minmax:$,colorscale:E.i,score:s.lfc})}),Object(m.jsx)(h.a,{popoverClassName:O.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(m.jsx)(d.d,{elevation:N.a.ZERO,children:Object(m.jsxs)("table",{children:[Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{}),Object(m.jsx)("th",{scope:"col",children:t[s.row]}),Object(m.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(m.jsx)("td",{children:s.delta.toFixed(2)}),Object(m.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",X[0].toFixed(2),", ",X[1].toFixed(2),"]"]})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"row",children:"Detected"}),Object(m.jsx)("td",{children:s.detected.toFixed(2)}),Object(m.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",se[0].toFixed(2),", ",se[1].toFixed(2),"]"]})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"row",children:"Log-FC"}),Object(m.jsx)("td",{children:s.lfc.toFixed(2)}),Object(m.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",$[0].toFixed(2),", ",$[1].toFixed(2),"]"]})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"row",children:"Expression"}),Object(m.jsx)("td",{children:s.mean.toFixed(2)}),Object(m.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",B[0].toFixed(2),", ",B[1].toFixed(2),"]"]})]})]})}),children:Object(m.jsx)(K,{minmax:X,colorscale:E.i,score:s.delta})}),Object(m.jsx)(h.a,{popoverClassName:O.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(m.jsx)(d.d,{elevation:N.a.ZERO,children:Object(m.jsxs)("table",{children:[Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{}),Object(m.jsx)("th",{scope:"col",children:t[s.row]}),Object(m.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"row",children:"Expression"}),Object(m.jsx)("td",{children:s.mean.toFixed(2)}),Object(m.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",B[0].toFixed(2),", ",B[1].toFixed(2),"]"]})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"row",children:"Log-FC"}),Object(m.jsx)("td",{children:s.lfc.toFixed(2)}),Object(m.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",$[0].toFixed(2),", ",$[1].toFixed(2),"]"]})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(m.jsx)("td",{children:s.delta.toFixed(2)}),Object(m.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",X[0].toFixed(2),", ",X[1].toFixed(2),"]"]})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"row",children:"Detected"}),Object(m.jsx)("td",{children:s.detected.toFixed(2)}),Object(m.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",se[0].toFixed(2),", ",se[1].toFixed(2),"]"]})]})]})}),children:Object(m.jsx)(H,{minmax:B,colorscale:Ee,score:s.mean,colorscore:s.detected})}),Object(m.jsxs)("div",{className:"row-action",children:[Object(m.jsx)(d.a,{icon:l?"minus":"plus",small:!0,fill:!1,className:"row-action",onClick:function(){var e=Object(r.a)(a);e[s.index].expanded=!e[s.index].expanded,c(e),o||x(s.row)}}),Object(m.jsx)(d.a,{small:!0,fill:!1,className:"row-action",onClick:function(){s.index===g?y(null):(y(s.index),o||x(s.row))},children:Object(m.jsx)(d.o,{icon:"tint",color:s.index===g?String(i).startsWith("cs")?v[Math.max.apply(Math,Object(r.a)(null===n||void 0===n?void 0:n.clusters))+parseInt(i.replace("cs",""))]:v[i]:""})})]})]}),Object(m.jsx)(d.e,{isOpen:l,children:o&&Object(m.jsx)(U,{data:o,color:String(i).startsWith("cs")?v[Math.max.apply(Math,Object(r.a)(null===n||void 0===n?void 0:n.clusters))+parseInt(i.replace("cs",""))]:v[i],clusterlabel:String(i).startsWith("cs")?"Custom Selection ".concat(i):"Cluster ".concat(parseInt(i+1)),clusters:A})})]})}}),Object(m.jsxs)("div",{className:"marker-footer",children:[Object(m.jsx)(d.m,{className:"marker-footer-title",children:"Filter Markers"}),Object(m.jsxs)("div",{className:"marker-filter-container",children:[Object(m.jsx)(d.F,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Log-FC"}),$&&Object(m.jsxs)("div",{className:"marker-slider-container",children:[Object(m.jsxs)("div",{className:"marker-filter-gradient",children:[Object(m.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, blue 33%, yellow 50%, red 100%)",width:"100%",height:"5px"}}),"\xa0"]}),Object(m.jsx)(d.A,{className:"marker-filter-slider",min:$[0],max:$[1],labelValues:$,stepSize:parseFloat((Math.abs($[1]-$[0])/20).toFixed(2)),onChange:function(e){return Me(e,"lfc")},value:(null===we||void 0===we?void 0:we.lfc)?null===we||void 0===we?void 0:we.lfc:[0,$[1]],vertical:!1})]})]}),Object(m.jsxs)("div",{className:"marker-filter-container",children:[Object(m.jsx)(d.F,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"\u0394-detected"}),X&&Object(m.jsxs)("div",{className:"marker-slider-container",children:[Object(m.jsxs)("div",{className:"marker-filter-gradient",children:[Object(m.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, blue 33%, yellow 50%, red 100%)",width:"100%",height:"5px"}}),"\xa0"]}),Object(m.jsx)(d.A,{className:"marker-filter-slider",min:X[0],max:X[1],labelValues:X,stepSize:parseFloat((Math.abs(X[1]-X[0])/20).toFixed(2)),onChange:function(e){return Me(e,"delta")},value:(null===we||void 0===we?void 0:we.delta)?null===we||void 0===we?void 0:we.delta:[0,X[1]],vertical:!1})]})]}),Object(m.jsxs)("div",{className:"marker-filter-container",children:[Object(m.jsx)(d.F,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Mean"}),B&&Object(m.jsxs)("div",{className:"marker-slider-container",children:[Object(m.jsxs)("div",{className:"marker-filter-gradient",children:[Object(m.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, #F5F8FA, #2965CC)",width:"100%",height:"5px"}}),"\xa0"]}),Object(m.jsx)(d.A,{className:"marker-filter-slider",min:B[0],max:B[1],labelValues:B,stepSize:parseFloat((Math.abs(B[1]-B[0])/20).toFixed(2)),onChange:function(e){return Me(e,"mean")},value:(null===we||void 0===we?void 0:we.mean)?null===we||void 0===we?void 0:we.mean:B,vertical:!1})]})]}),Object(m.jsxs)("div",{className:"marker-filter-container",children:[Object(m.jsx)(d.F,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Detected"}),se&&Object(m.jsx)("div",{className:"marker-slider-container",children:Object(m.jsx)(d.A,{className:"marker-filter-slider",min:se[0],max:se[1],labelValues:se,stepSize:parseFloat((Math.abs(se[1]-se[0])/20).toFixed(2)),onChange:function(e){return Me(e,"detected")},value:(null===we||void 0===we?void 0:we.detected)?null===we||void 0===we?void 0:we.detected:se,vertical:!1})})]})]})]}):""]})},Y=(n(328),n(329),function(){var e=Object(s.useRef)();return Object(s.useEffect)((function(){var t=e.current,n=0,s=1,a=2,c=3,i=4,l=[5,5,3,3,2],r=["#1abc9c","#2ecc71","#3498db","#e74c3c","#9b59b6"],o={new:function(e){return{width:18,height:18,x:this.canvas.width/2-9,y:this.canvas.height/2-9,moveX:n,moveY:n,speed:e||9}}},d={new:function(e){return{width:18,height:70,x:"left"===e?150:this.canvas.width-150,y:this.canvas.height/2-35,score:0,move:n,speed:10}}},u={initialize:function(){this.canvas=t.querySelector("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=1400,this.canvas.height=1e3,this.canvas.style.width=this.canvas.width/2+"px",this.canvas.style.height=this.canvas.height/2+"px",this.player=d.new.call(this,"left"),this.paddle=d.new.call(this,"right"),this.ball=o.new.call(this),this.paddle.speed=8,this.running=this.over=!1,this.turn=this.paddle,this.timer=this.round=0,this.color="#2c3e50",j.menu(),j.listen()},endGameMenu:function(e){j.context.font="50px Courier New",j.context.fillStyle=this.color,j.context.fillRect(j.canvas.width/2-350,j.canvas.height/2-48,700,100),j.context.fillStyle="#ffffff",j.context.fillText(e,j.canvas.width/2,j.canvas.height/2+15),setTimeout((function(){(j=Object.assign({},u)).initialize()}),3e3)},menu:function(){j.draw(),this.context.font="50px Courier New",this.context.fillStyle=this.color,this.context.fillRect(this.canvas.width/2-350,this.canvas.height/2-48,700,100),this.context.fillStyle="#ffffff",this.context.fillText("Press any key to begin",this.canvas.width/2,this.canvas.height/2+15)},update:function(){this.over||(this.ball.x<=0&&j._resetTurn.call(this,this.paddle,this.player),this.ball.x>=this.canvas.width-this.ball.width&&j._resetTurn.call(this,this.player,this.paddle),this.ball.y<=0&&(this.ball.moveY=a),this.ball.y>=this.canvas.height-this.ball.height&&(this.ball.moveY=s),this.player.move===s?this.player.y-=this.player.speed:this.player.move===a&&(this.player.y+=this.player.speed),j._turnDelayIsOver.call(this)&&this.turn&&(this.ball.moveX=this.turn===this.player?c:i,this.ball.moveY=[s,a][Math.round(Math.random())],this.ball.y=Math.floor(Math.random()*this.canvas.height-200)+200,this.turn=null),this.player.y<=0?this.player.y=0:this.player.y>=this.canvas.height-this.player.height&&(this.player.y=this.canvas.height-this.player.height),this.ball.moveY===s?this.ball.y-=this.ball.speed/1.5:this.ball.moveY===a&&(this.ball.y+=this.ball.speed/1.5),this.ball.moveX===c?this.ball.x-=this.ball.speed:this.ball.moveX===i&&(this.ball.x+=this.ball.speed),this.paddle.y>this.ball.y-this.paddle.height/2&&(this.ball.moveX===i?this.paddle.y-=this.paddle.speed/1.5:this.paddle.y-=this.paddle.speed/4),this.paddle.y<this.ball.y-this.paddle.height/2&&(this.ball.moveX===i?this.paddle.y+=this.paddle.speed/1.5:this.paddle.y+=this.paddle.speed/4),this.paddle.y>=this.canvas.height-this.paddle.height?this.paddle.y=this.canvas.height-this.paddle.height:this.paddle.y<=0&&(this.paddle.y=0),this.ball.x-this.ball.width<=this.player.x&&this.ball.x>=this.player.x-this.player.width&&this.ball.y<=this.player.y+this.player.height&&this.ball.y+this.ball.height>=this.player.y&&(this.ball.x=this.player.x+this.ball.width,this.ball.moveX=i),this.ball.x-this.ball.width<=this.paddle.x&&this.ball.x>=this.paddle.x-this.paddle.width&&this.ball.y<=this.paddle.y+this.paddle.height&&this.ball.y+this.ball.height>=this.paddle.y&&(this.ball.x=this.paddle.x-this.ball.width,this.ball.moveX=c)),this.player.score===l[this.round]?l[this.round+1]?(this.color=this._generateRoundColor(),this.player.score=this.paddle.score=0,this.player.speed+=.5,this.paddle.speed+=1,this.ball.speed+=1,this.round+=1):(this.over=!0,setTimeout((function(){j.endGameMenu("Winner!")}),1e3)):this.paddle.score===l[this.round]&&(this.over=!0,setTimeout((function(){j.endGameMenu("Game Over!")}),1e3))},draw:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.color,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle="#ffffff",this.context.fillRect(this.player.x,this.player.y,this.player.width,this.player.height),this.context.fillRect(this.paddle.x,this.paddle.y,this.paddle.width,this.paddle.height),j._turnDelayIsOver.call(this)&&this.context.fillRect(this.ball.x,this.ball.y,this.ball.width,this.ball.height),this.context.beginPath(),this.context.setLineDash([7,15]),this.context.moveTo(this.canvas.width/2,this.canvas.height-140),this.context.lineTo(this.canvas.width/2,140),this.context.lineWidth=10,this.context.strokeStyle="#ffffff",this.context.stroke(),this.context.font="100px Courier New",this.context.textAlign="center",this.context.fillText(this.player.score.toString(),this.canvas.width/2-300,200),this.context.fillText(this.paddle.score.toString(),this.canvas.width/2+300,200),this.context.font="30px Courier New",this.context.fillText("Round "+(j.round+1),this.canvas.width/2,35),this.context.font="40px Courier",this.context.fillText(l[j.round]?l[j.round]:l[j.round-1],this.canvas.width/2,100)},loop:function(){j.update(),j.draw(),j.over||requestAnimationFrame(j.loop)},listen:function(){document.addEventListener("keydown",(function(e){!1===j.running&&(j.running=!0,window.requestAnimationFrame(j.loop)),38!==e.keyCode&&87!==e.keyCode||(j.player.move=s),40!==e.keyCode&&83!==e.keyCode||(j.player.move=a)})),document.addEventListener("keyup",(function(e){j.player.move=n}))},_resetTurn:function(e,t){this.ball=o.new.call(this,this.ball.speed),this.turn=t,this.timer=(new Date).getTime(),e.score++},_turnDelayIsOver:function(){return(new Date).getTime()-this.timer>=1e3},_generateRoundColor:function(){var e=r[Math.floor(Math.random()*r.length)];return e===this.color?j._generateRoundColor():e}},j=Object.assign({},u);j.initialize()}),[]),Object(m.jsxs)("div",{ref:e,className:"pong-container",children:[Object(m.jsx)("canvas",{}),Object(m.jsxs)("p",{className:"credit",children:["Game Credits ",Object(m.jsx)("a",{href:"https://codepen.io/gdube/pen/JybxxZ",target:"_blank",children:"Pong Game"})]})]})}),J=(n(330),function(){return Object(m.jsx)("div",{className:"dots-bars-5"})});function Z(){var e=Object(s.useState)(!0),t=Object(o.a)(e,2),n=t[0],a=t[1],c=Object(s.useContext)(f),i=c.setWasmInitialized,u=c.setTsneData,j=c.setRedDims,h=c.redDims,b=c.setGenesInfo,O=c.setInitDims,p=c.setQcDims,x=c.defaultRedDims,v=c.setDefaultRedDims,g=c.setQcData,y=c.qcData,w=c.setClusterData,F=c.setFSelectionData,N=c.setUmapData,C=c.setPcaVarExp,k=c.logs,E=c.setLogs,D=c.selectedCluster,M=c.clusterRank,A=c.selectedClusterSummary,L=c.setSelectedClusterSummary,T=c.reqGene,I=c.customSelection,R=c.clusterData,G=c.delCustomSelection,P=c.setDelCustomSelection,B=c.setSelectedCluster,_=c.setShowGame,W=c.showGame,z=c.datasetName,U=c.setExportState,H=c.setShowAnimation,K=c.triggerAnimation,Q=c.setTriggerAnimation,Z=c.params,$=c.setKanaIDBRecs,ee=c.setLoadParams,te=c.setInitLoadState,ne=c.setIndexedDBState;return Object(s.useEffect)((function(){window.scranWorker.postMessage({type:"INIT",msg:"Initial Load"})}),[]),Object(s.useEffect)((function(){if(null!==D){var e=String(D).startsWith("cs")?"getMarkersForSelection":"getMarkersForCluster";window.scranWorker.postMessage({type:e,payload:{cluster:D,rank_type:M}})}}),[D,M]),Object(s.useEffect)((function(){if(null!==I&&Object.keys(I).length>0){var e="cs".concat(Object.keys(I).length),t=I[e];window.scranWorker.postMessage({type:"computeCustomMarkers",payload:{selection:t,id:e}})}}),[I]),Object(s.useEffect)((function(){null!==G&&(window.scranWorker.postMessage({type:"removeCustomMarkers",payload:{id:G}}),P(null))}),[G]),Object(s.useEffect)((function(){null!==T&&window.scranWorker.postMessage({type:"getGeneExpression",payload:{gene:T}})}),[T]),Object(s.useEffect)((function(){K&&x&&window.scranWorker.postMessage({type:"animate"+x,payload:{params:Z[x.toLowerCase()]}})}),[K]),window.scranWorker.onmessage=function(e){var t=e.data;if(null===t||void 0===t?void 0:t.msg){var n=Object(r.a)(k),s=new Date;n.push("".concat(s.getHours()+":"+s.getMinutes()+":"+s.getSeconds()," - ").concat(null===t||void 0===t?void 0:t.type," - ").concat(null===t||void 0===t?void 0:t.msg)),E(n)}if("INIT"===t.type)a(!1),i(!0);else if("KanaDB_store"===t.type){var c=t.resp;c.length>0&&$(c)}else if("inputs_DATA"===t.type)O("".concat(t.resp.dimensions.num_genes," genes, ").concat(t.resp.dimensions.num_cells," cells")),b(t.resp.gene_names);else if("quality_control_metrics_DATA"===t.type){var o=t.resp;g(o)}else if("quality_control_thresholds_DATA"===t.type){var d=t.resp,m=Object(l.a)({},y);m.thresholds=d,g(m)}else if("quality_control_filtered_DATA"===t.type)p("".concat(t.resp.retained," cells"));else if("feature_selection_DATA"===t.type){var f=t.resp;F(f)}else if("pca_DATA"===t.type){var S=t.resp;C(S)}else if("snn_cluster_graph_DATA"===t.type){var D=t.resp;w(D),B(0)}else if("tsne_DATA"===t.type||"tsne_iter"===t.type){var M=t.resp;if(u(M),H(!0),"tsne_DATA"===t.type){var T=Object(r.a)(h);T.push("TSNE"),x||v("TSNE"),j(T),_(!1),H(!1),Q(!1)}}else if("umap_DATA"===t.type||"umap_iter"===t.type){var I=t.resp;if(N(I),H(!0),"umap_DATA"===t.type){var R=Object(r.a)(h);R.push("UMAP"),j(R),H(!1),Q(!1)}}else if("markerGene_DATA"===t.type);else if("setMarkersForCluster"===t.type||"setMarkersForCustomSelection"===t.type){var q=t.resp,G=[];q.means.forEach((function(e,t){var n,s,a,c;G.push({index:t,row:null===q||void 0===q||null===(n=q.ordering)||void 0===n?void 0:n[t],mean:e,delta:null===q||void 0===q||null===(s=q.delta_detected)||void 0===s?void 0:s[t],lfc:null===q||void 0===q||null===(a=q.lfc)||void 0===a?void 0:a[t],detected:null===q||void 0===q||null===(c=q.detected)||void 0===c?void 0:c[t],expanded:!1,expr:null})})),L(G)}else if("setGeneExpression"===t.type){for(var P=t.resp,W=Object(r.a)(A),V=0;V<W.length;V++)if(P.gene===W[V].row){W[V].expr=Object.values(P.expr);break}L(W)}else if("exportState"===t.type){var K=t.resp,X=document.createElement("a"),Y=new Blob([K],{type:"text/plain"});X.href=URL.createObjectURL(Y),X.download=z.split(" ").join("_")+".kana.gz",X.click(),U(!1)}else if("KanaDB"===t.type)ne(!1);else if("loadedParameters"===t.type){var J=t.resp;ee(J.params),setTimeout((function(){te(!1)}),1e3)}},Object(m.jsxs)("div",{className:"App",children:[Object(m.jsx)(S,{}),Object(m.jsxs)("div",{className:"App-content",children:[Object(m.jsx)("div",{className:"plot",children:x?Object(m.jsx)(V,{}):W?Object(m.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:"50px"},children:[Object(m.jsx)(d.q,{children:"Get some coffee or play pong while you wait for the analysis to finish.."}),Object(m.jsx)(d.a,{onClick:function(){_(!1)},children:"I'm good, go back"}),Object(m.jsx)(Y,{})]}):Object(m.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:"50px"},children:[Object(m.jsx)(J,{}),Object(m.jsx)(d.q,{children:"Get some coffee or play pong while you wait for the analysis to finish.."}),Object(m.jsx)(d.a,{onClick:function(){_(!0)},children:"Play Pong"})]})}),Object(m.jsx)("div",{className:"marker",children:R?Object(m.jsx)(X,{}):Object(m.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[Object(m.jsx)(J,{}),Object(m.jsx)(d.q,{children:"Generating nearest neighbor graph to compute clusters...."})]})}),Object(m.jsx)("div",{className:"analysis",children:Object(m.jsx)(q,{})})]}),Object(m.jsx)(d.y,Object(l.a)(Object(l.a)({isOpen:n},{autoFocus:!0,canEscapeKeyClose:!1,canOutsideClickClose:!1,enforceFocus:!0,hasBackdrop:!0,usePortal:!0,useTallContent:!1}),{},{children:Object(m.jsxs)("div",{className:"spinner",children:[Object(m.jsx)(d.B,{size:100}),Object(m.jsx)("p",{children:"Initializing kana"})]})}))]})}var $=a.a.memo(Z),ee=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,340)).then((function(t){var n=t.getCLS,s=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),s(e),a(e),c(e),i(e)}))};i.a.render(Object(m.jsx)(v,{children:Object(m.jsx)($,{})}),document.getElementById("root")),ee()}},[[331,1,2]]]);
//# sourceMappingURL=main.4bac19de.chunk.js.map