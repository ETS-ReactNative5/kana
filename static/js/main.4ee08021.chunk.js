(this.webpackJsonpkana=this.webpackJsonpkana||[]).push([[0],{279:function(e,t,n){},280:function(e,t,n){},306:function(e,t,n){},309:function(e,t,n){},310:function(e,t,n){},311:function(e,t,n){},323:function(e,t,n){},324:function(e,t,n){},325:function(e,t,n){},326:function(e,t,n){},327:function(e,t,n){},328:function(e,t,n){"use strict";n.r(t);var s=n(1),a=n.n(s),i=n(26),c=n.n(i),l=(n(279),n(4)),r=n(21),o=n(5),d=(n(280),n(336)),u=n(49),h=n(20),j=n(136),b=n(79),p=n(43),m=n(3),O=d.J.create({className:"notifications",position:h.a.TOP_RIGHT,maxToasts:5}),x=n(0),f=Object(s.createContext)(null),v=function(e){var t=e.children,n=Object(s.useState)({format:null,files:null}),a=Object(o.a)(n,2),i=a[0],c=a[1],l=Object(s.useState)({qc:{"qc-nmads":3,"qc-usemitodefault":!0,"qc-mito":"mt-"},fSelection:{"fsel-span":.3},pca:{"pca-npc":5,"pca-hvg":4e3},cluster:{"clus-k":10,"clus-res":.5,"clus-scheme":0,"clus-approx":!0,"clus-method":"snn_graph"},tsne:{"tsne-iter":500,"tsne-perp":30,animate:!1},umap:{"umap-nn":15,"umap-epochs":500,"umap-min_dist":.01,animate:!1},markerGene:{}}),r=Object(o.a)(l,2),d=r[0],u=r[1],h=Object(s.useState)(!1),j=Object(o.a)(h,2),b=j[0],p=j[1],m=Object(s.useState)(!1),v=Object(o.a)(m,2),g=v[0],y=v[1],w=Object(s.useState)("new"),N=Object(o.a)(w,2),C=N[0],F=N[1],k=Object(s.useState)(null),S=Object(o.a)(k,2),E=S[0],D=S[1],A=Object(s.useState)(null),M=Object(o.a)(A,2),T=M[0],I=M[1],q=Object(s.useState)(null),L=Object(o.a)(q,2),R=L[0],B=L[1],P=Object(s.useState)(null),_=Object(o.a)(P,2),W=_[0],G=_[1],z=Object(s.useState)("kana-"+String(Date.now()).slice(0,8)),V=Object(o.a)(z,2),H=V[0],U=V[1],K=Object(s.useState)(!1),Q=Object(o.a)(K,2),X=Q[0],J=Q[1],Y=Object(s.useState)(!1),Z=Object(o.a)(Y,2),$=Z[0],ee=Z[1],te=Object(s.useState)(!1),ne=Object(o.a)(te,2),se=ne[0],ae=ne[1],ie=Object(s.useState)(!1),ce=Object(o.a)(ie,2),le=ce[0],re=ce[1],oe=Object(s.useState)(null),de=Object(o.a)(oe,2),ue=de[0],he=de[1],je=Object(s.useState)(null),be=Object(o.a)(je,2),pe=be[0],me=be[1],Oe=Object(s.useState)(null),xe=Object(o.a)(Oe,2),fe=xe[0],ve=xe[1],ge=Object(s.useState)(null),ye=Object(o.a)(ge,2),we=ye[0],Ne=ye[1],Ce=Object(s.useState)(null),Fe=Object(o.a)(Ce,2),ke=Fe[0],Se=Fe[1],Ee=Object(s.useState)("id"),De=Object(o.a)(Ee,2),Ae=De[0],Me=De[1],Te=Object(s.useState)(null),Ie=Object(o.a)(Te,2),qe=Ie[0],Le=Ie[1],Re=Object(s.useState)(null),Be=Object(o.a)(Re,2),Pe=Be[0],_e=Be[1],We=Object(s.useState)(null),Ge=Object(o.a)(We,2),ze=Ge[0],Ve=Ge[1],He=Object(s.useState)([]),Ue=Object(o.a)(He,2),Ke=Ue[0],Qe=Ue[1],Xe=Object(s.useState)(null),Je=Object(o.a)(Xe,2),Ye=Je[0],Ze=Je[1],$e=Object(s.useState)(null),et=Object(o.a)($e,2),tt=et[0],nt=et[1],st=Object(s.useState)(null),at=Object(o.a)(st,2),it=at[0],ct=at[1],lt=Object(s.useState)(null),rt=Object(o.a)(lt,2),ot=rt[0],dt=rt[1],ut=Object(s.useState)([]),ht=Object(o.a)(ut,2),jt=ht[0],bt=ht[1],pt=Object(s.useState)(null),mt=Object(o.a)(pt,2),Ot=mt[0],xt=mt[1],ft=Object(s.useState)(null),vt=Object(o.a)(ft,2),gt=vt[0],yt=vt[1],wt=Object(s.useState)({}),Nt=Object(o.a)(wt,2),Ct=Nt[0],Ft=Nt[1],kt=Object(s.useState)(null),St=Object(o.a)(kt,2),Et=St[0],Dt=St[1],At=Object(s.useState)(null),Mt=Object(o.a)(At,2),Tt=Mt[0],It=Mt[1],qt=Object(s.useState)(null),Lt=Object(o.a)(qt,2),Rt=Lt[0],Bt=Lt[1],Pt=Object(s.useState)(!1),_t=Object(o.a)(Pt,2),Wt=_t[0],Gt=_t[1],zt=Object(s.useState)(!1),Vt=Object(o.a)(zt,2),Ht=Vt[0],Ut=Vt[1],Kt=Object(s.useState)(null),Qt=Object(o.a)(Kt,2),Xt=Qt[0],Jt=Qt[1],Yt=Object(s.useState)(null),Zt=Object(o.a)(Yt,2),$t=Zt[0],en=Zt[1],tn=Object(s.useState)(null),nn=Object(o.a)(tn,2),sn=nn[0],an=nn[1],cn=Object(s.useState)(null),ln=Object(o.a)(cn,2),rn=ln[0],on=ln[1],dn=Object(s.useState)([]),un=Object(o.a)(dn,2),hn=un[0],jn=un[1],bn=Object(s.useState)([]),pn=Object(o.a)(bn,2),mn=pn[0],On=pn[1];return Object(s.useEffect)((function(){le&&null!=i.files&&!se&&("new"===C?window.scranWorker.postMessage({type:"RUN",payload:{files:i,params:d},msg:"not much to pass"}):"load"===C&&(null==R||(null===i||void 0===i?void 0:i.reset)?window.scranWorker.postMessage({type:"LOAD",payload:{files:i},msg:"not much to pass"}):window.scranWorker.postMessage({type:"RUN",payload:{files:i,params:d},msg:"not much to pass"}),ae(!0)))}),[i,d,le]),Object(s.useEffect)((function(){X?(window.scranWorker.postMessage({type:"EXPORT",payload:{files:i,params:d},msg:"not much to pass"}),O.show({icon:"download",intent:"primary",message:"Exporting analysis in the background"})):(null===i||void 0===i?void 0:i.files)&&O.show({icon:"download",intent:"primary",message:"Analysis saved. Please check your downloads directory!"})}),[X]),Object(s.useEffect)((function(){$?(window.scranWorker.postMessage({type:"SAVEKDB",payload:{files:i,params:d,id:H},msg:"not much to pass"}),O.show({icon:"floppy-disk",intent:"primary",message:"Saving analysis in the background. Note: analysis is saved within the browser!!"})):(null===i||void 0===i?void 0:i.files)&&O.show({icon:"floppy-disk",intent:"primary",message:"Analysis saved!"})}),[$]),Object(s.useEffect)((function(){T&&(window.scranWorker.postMessage({type:"REMOVEKDB",payload:{id:T},msg:"not much to pass"}),O.show({icon:"floppy-disk",intent:"danger",message:"Deleting Analysis in the background"}))}),[T]),Object(x.jsx)(f.Provider,{value:{inputFiles:i,setInputFiles:c,params:d,setParams:u,error:ue,setError:he,wasmInitialized:le,setWasmInitialized:re,pcaData:Tt,setPcaData:It,pcaVarExp:Rt,setPcaVarExp:Bt,tsneData:Xt,setTsneData:Jt,umapData:$t,setUmapData:en,genesInfo:ke,setGenesInfo:Se,initDims:pe,setInitDims:me,qcDims:fe,setQcDims:ve,qcData:qe,setQcData:Le,qcThreshold:Pe,setQcThreshold:_e,fSelDims:we,setFSelDims:Ne,redDims:Ke,setRedDims:Qe,defaultRedDims:Ye,setDefaultRedDims:Ze,plotRedDims:tt,setPlotRedDims:nt,clusterData:it,setClusterData:ct,fSelectionData:ze,setFSelectionData:Ve,logs:hn,setLogs:jn,selectedCluster:ot,setSelectedCluster:dt,selectedClusterSummary:jt,setSelectedClusterSummary:bt,clusterRank:gt,setClusterRank:yt,gene:sn,setGene:an,clusterColors:Ot,setClusterColors:xt,reqGene:rn,setReqGene:on,openInput:b,setOpenInput:p,customSelection:Ct,setCustomSelection:Ft,delCustomSelection:Et,setDelCustomSelection:Dt,showGame:g,setShowGame:y,exportState:X,setExportState:J,datasetName:H,setDatasetName:U,tabSelected:C,setTabSelected:F,loadParams:R,setLoadParams:B,showAnimation:Wt,setShowAnimation:Gt,triggerAnimation:Ht,setTriggerAnimation:Ut,savedPlot:mn,setSavedPlot:On,geneColSel:Ae,setGeneColSel:Me,indexedDBState:$,setIndexedDBState:ee,kanaIDBRecs:E,setKanaIDBRecs:D,initLoadState:se,setInitLoadState:ae,loadParamsFor:W,setLoadParamsFor:G,deletekdb:T,setDeletekdb:I},children:t})},g=a.a.memo(v),y=(n(306),["buttonText","includeFooter"]);var w=function(e){var t,n,a,i,c,r,u=e.buttonText,b=e.includeFooter,O=Object(p.a)(e,y),v=Object(s.useState)(!1),g=Object(o.a)(v,2),w=g[0],N=g[1],C=Object(s.useState)(1),F=Object(o.a)(C,2),k=F[0],S=F[1],E=Object(s.useCallback)((function(){return N(!w)}),[w]),D=Object(s.useCallback)((function(){return N(!1)}),[]),A=Object(s.useContext)(f),M=A.inputFiles,T=A.setInputFiles,I=A.params,q=A.setParams,L=A.openInput,R=A.tabSelected,B=A.setTabSelected,P=A.loadParams,_=A.kanaIDBRecs,W=A.setLoadParamsFor,G=A.loadParamsFor,z=A.setDeletekdb,V=A.setDatasetName,H=Object(s.useState)({gene:null,mtx:null,barcode:null}),U=Object(o.a)(H,2),K=U[0],Q=U[1],X=Object(s.useState)({mtx:"Choose Matrix Market file",gene:"Choose feature/gene annotation",barcode:"Choose barcode annotation"}),J=Object(o.a)(X,2),Y=J[0],Z=J[1],$=Object(s.useState)(!0),ee=Object(o.a)($,2),te=ee[0],ne=ee[1],se=Object(s.useState)("mtx"),ae=Object(o.a)(se,2),ie=ae[0],ce=ae[1],le=Object(s.useState)("kana"),re=Object(o.a)(le,2),oe=re[0],de=re[1],ue=Object(s.useState)("new"==R?I:P),he=Object(o.a)(ue,2),je=he[0],be=he[1];function pe(e,t){"mtx"===e?(Q({gene:null,mtx:null,barcode:null}),Z({mtx:"Choose Matrix Market file",gene:"Choose feature/gene annotation",barcode:"Choose barcode annotation"})):"tenx"===e?(Q({file:null}),Z({file:"Choose 10x v3 H5 file"})):"h5ad"===e&&(Q({file:null}),Z({file:"Choose H5ad file"})),be(I),ce(e)}return Object(s.useEffect)((function(){L&&N(!0)}),[L]),Object(s.useEffect)((function(){P&&"load"==R&&be(P)}),[P]),Object(s.useEffect)((function(){"load"==R&&"kanadb"==oe&&null==(null===K||void 0===K?void 0:K.file)&&_&&Q({file:_[0]})}),[_,oe]),Object(s.useEffect)((function(){K&&("new"===R?"mtx"===ie?(null===K||void 0===K?void 0:K.mtx)&&!(null===Y||void 0===Y?void 0:Y.mtx.toLowerCase().endsWith("mtx"))&&!(null===Y||void 0===Y?void 0:Y.mtx.toLowerCase().endsWith("mtx.gz"))||(null===K||void 0===K?void 0:K.gene)&&!(null===Y||void 0===Y?void 0:Y.gene.toLowerCase().endsWith("tsv"))&&!(null===Y||void 0===Y?void 0:Y.gene.toLowerCase().endsWith("tsv.gz"))||(null===K||void 0===K?void 0:K.barcode)&&!(null===Y||void 0===Y?void 0:Y.barcode.toLowerCase().endsWith("tsv"))&&!(null===Y||void 0===Y?void 0:Y.barcode.toLowerCase().endsWith("tsv.gz"))?ne(!1):ne(!0):"tenx"!==ie&&"h5ad"!==ie||((null===K||void 0===K?void 0:K.file)&&!((null===Y||void 0===Y?void 0:Y.file.toLowerCase().endsWith("hdf5"))||(null===Y||void 0===Y?void 0:Y.file.toLowerCase().endsWith("h5"))||(null===Y||void 0===Y?void 0:Y.file.toLowerCase().endsWith("h5ad")))?ne(!1):ne(!0)):"load"===R&&(null===Y||void 0===Y?void 0:Y.file)&&("kana"!==oe||null==(null===K||void 0===K?void 0:K.file)||(null===Y||void 0===Y?void 0:Y.file.toLowerCase().endsWith("kana"))?ne(!0):ne(!1)))}),[K]),Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(j.a,{content:"Start new analysis or modify parameters",position:h.a.BOTTOM,children:Object(x.jsx)(d.a,{onClick:E,icon:"social-media",intent:"primary",text:u})}),Object(x.jsxs)(d.g,Object(l.a)(Object(l.a)({className:"analysis-dialog"},O),{},{isOpen:w,onClose:D,children:[Object(x.jsx)("div",{className:m.a.DIALOG_BODY,children:Object(x.jsxs)(d.G,{animate:!0,renderActiveTabPanelOnly:!0,vertical:!1,onChange:function(e,t){"new"===e&&pe(ie),B(e),S(0)},defaultSelectedTabId:R,children:[Object(x.jsx)(d.F,{id:"new",title:"Import new dataset",panel:Object(x.jsxs)("div",{className:"inputs-container",children:[Object(x.jsxs)("div",{className:"row-input",children:[Object(x.jsx)("div",{className:"col",style:{paddingBottom:"15px"},children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"1"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(1)},children:"Load input files"})]}),Object(x.jsxs)(d.G,{animate:!0,renderActiveTabPanelOnly:!0,vertical:!0,onChange:pe,defaultSelectedTabId:ie,children:[Object(x.jsx)(d.F,{id:"mtx",title:"Matrix Market file",panel:Object(x.jsxs)("div",{className:"row",children:[Object(x.jsx)(d.q,{className:"row-input",children:Object(x.jsx)(d.k,{text:Y.mtx,onInputChange:function(e){Z(Object(l.a)(Object(l.a)({},Y),{},{mtx:e.target.files[0].name})),Q(Object(l.a)(Object(l.a)({},K),{},{mtx:e.target.files}))}})}),Object(x.jsx)(d.q,{className:"row-input",children:Object(x.jsx)(d.k,{text:Y.gene,onInputChange:function(e){Z(Object(l.a)(Object(l.a)({},Y),{},{gene:e.target.files[0].name})),Q(Object(l.a)(Object(l.a)({},K),{},{gene:e.target.files}))}})})]})}),Object(x.jsx)(d.F,{id:"tenx",title:"10x v3 H5",panel:Object(x.jsx)("div",{className:"row",children:Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",children:"Choose 10x V3 H5 file"})}),Object(x.jsx)(d.k,{style:{marginTop:"5px"},text:Y.file,onInputChange:function(e){Z(Object(l.a)(Object(l.a)({},Y),{},{file:e.target.files[0].name})),Q(Object(l.a)(Object(l.a)({},K),{},{file:e.target.files}))}})]})})}),Object(x.jsx)(d.F,{id:"h5ad",title:"H5ad",panel:Object(x.jsx)("div",{className:"row",children:Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",children:"Choose H5ad file"})}),Object(x.jsx)(d.k,{style:{marginTop:"5px"},text:Y.file,onInputChange:function(e){Z(Object(l.a)(Object(l.a)({},Y),{},{file:e.target.files[0].name})),Q(Object(l.a)(Object(l.a)({},K),{},{file:e.target.files}))}})]})})})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"2"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(2)},children:"Quality control"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(2)},children:"Number of MADs"})}),Object(x.jsx)(d.x,{placeholder:"3",value:je.qc["qc-nmads"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{qc:Object(l.a)(Object(l.a)({},je.qc),{},{"qc-nmads":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(2)},children:"Use default mitochondrial list ?"})}),Object(x.jsx)(d.E,{style:{marginTop:"10px"},large:!0,checked:je.qc["qc-usemitodefault"],innerLabelChecked:"yes",innerLabel:"no",onChange:function(e){be(Object(l.a)(Object(l.a)({},je),{},{qc:Object(l.a)(Object(l.a)({},je.qc),{},{"qc-usemitodefault":e.target.checked})}))}})]}),!je.qc["qc-usemitodefault"]&&Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(2)},children:"Mitochondrial gene prefix"})}),Object(x.jsx)(d.p,{leftIcon:"filter",onChange:function(e,t){var n;be(Object(l.a)(Object(l.a)({},je),{},{qc:Object(l.a)(Object(l.a)({},je.qc),{},{"qc-mito":null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value})}))},placeholder:"mt-",value:je.qc["qc-mito"]})]})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"3"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(3)},children:"Feature Selection"})]}),Object(x.jsx)("div",{className:"row",children:Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(3)},children:"Lowess span"})}),Object(x.jsx)(d.x,{placeholder:"0.3",value:je.fSelection["fsel-span"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{fSelection:Object(l.a)(Object(l.a)({},je.fSelection),{},{"fsel-span":e})}))}})]})})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"4"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(4)},children:"Principal components analysis"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(4)},children:"Number of HVGs"})}),Object(x.jsx)(d.x,{placeholder:"2500",value:je.pca["pca-hvg"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{pca:Object(l.a)(Object(l.a)({},je.pca),{},{"pca-hvg":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(4)},children:"Number of PCs"})}),Object(x.jsx)(d.x,{placeholder:"25",value:je.pca["pca-npc"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{pca:Object(l.a)(Object(l.a)({},je.pca),{},{"pca-npc":e})}))}})]})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"5"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Clustering"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Method"})}),Object(x.jsx)(d.n,{defaultValue:je.cluster["clus-method"],children:Object(x.jsx)("option",{children:je.cluster["clus-method"]})})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Number of neighbors"})}),Object(x.jsx)(d.x,{placeholder:"10",value:je.cluster["clus-k"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{cluster:Object(l.a)(Object(l.a)({},je.cluster),{},{"clus-k":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Use ANN"})}),Object(x.jsx)(d.E,{style:{marginTop:"10px"},large:!0,checked:je.cluster["clus-approx"],innerLabelChecked:"yes",innerLabel:"no",onChange:function(e){be(Object(l.a)(Object(l.a)({},je),{},{cluster:Object(l.a)(Object(l.a)({},je.cluster),{},{"clus-approx":e.target.checked})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Weighting scheme"})}),Object(x.jsxs)(d.n,{onChange:function(e,t){var n;return be(Object(l.a)(Object(l.a)({},je),{},{cluster:Object(l.a)(Object(l.a)({},je.cluster),{},{"clus-scheme":parseInt(null===e||void 0===e||null===(n=e.currentTarget)||void 0===n?void 0:n.value)})}))},children:[Object(x.jsx)("option",{children:"Rank"},"0"),Object(x.jsx)("option",{children:"Number"},"1"),Object(x.jsx)("option",{children:"Jaccard"},"2")]})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Resolution"})}),Object(x.jsx)(d.x,{placeholder:"0.5",value:je.cluster["clus-res"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{cluster:Object(l.a)(Object(l.a)({},je.cluster),{},{"clus-res":e})}))}})]})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"6"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(6)},children:"t-SNE"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(6)},children:"Perplexity"})}),Object(x.jsx)(d.x,{placeholder:"30",value:je.tsne["tsne-perp"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{tsne:Object(l.a)(Object(l.a)({},je.tsne),{},{"tsne-perp":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(6)},children:"Iterations"})}),Object(x.jsx)(d.x,{placeholder:"500",value:je.tsne["tsne-iter"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{tsne:Object(l.a)(Object(l.a)({},je.tsne),{},{"tsne-iter":e})}))}})]})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"7"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(7)},children:"UMAP"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(7)},children:"Number of neighbors"})}),Object(x.jsx)(d.x,{placeholder:"15",value:je.umap["umap-nn"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{umap:Object(l.a)(Object(l.a)({},je.umap),{},{"umap-nn":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(7)},children:"Minimum distance"})}),Object(x.jsx)(d.x,{placeholder:"0.01",value:je.umap["umap-min_dist"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{umap:Object(l.a)(Object(l.a)({},je.umap),{},{"umap-min_dist":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(7)},children:"Epochs"})}),Object(x.jsx)(d.x,{placeholder:"500",value:je.umap["umap-epoch"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{umap:Object(l.a)(Object(l.a)({},je.umap),{},{"umap-epoch":e})}))}})]})]})]})})]}),Object(x.jsxs)("div",{className:"row-input-tooltips",children:[!te&&Object(x.jsxs)(d.c,{intent:"danger",title:"Incorrect file format",style:{marginBottom:"10px"},children:[Object(x.jsx)("p",{children:"Upload files that in one of these formats;"}),Object(x.jsxs)("ul",{children:[Object(x.jsxs)("li",{children:["Matrix Market - ",Object(x.jsx)("code",{children:"*.mtx"})," or ",Object(x.jsx)("code",{children:"*.mtx.gz"})]}),Object(x.jsxs)("li",{children:["features or genes, ",Object(x.jsx)("code",{children:"*.tsv"})," or ",Object(x.jsx)("code",{children:"*.tsv.gz"})]}),Object(x.jsxs)("li",{children:["HDF5 (10x or h5ad) - ",Object(x.jsx)("code",{children:"*.h5"})," or ",Object(x.jsx)("code",{children:"*.hdf5"})," or ",Object(x.jsx)("code",{children:"*.h5ad"})]})]})]}),1==k&&Object(x.jsx)(d.c,{intent:"primary",children:Object(x.jsxs)("p",{children:["We currently support files in the Cellranger format - namely, a Matrix Market file containing the count matrix. We also recommend supplying the feature annotation (",Object(x.jsx)("code",{children:"features.tsv.gz"})," or ",Object(x.jsx)("code",{children:"genes.tsv.gz"}),"). Users may also provide a TSV file containing the barcode annotations, if any."]})}),2==k&&Object(x.jsxs)(d.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"At this step, we compute per-cell quality control (QC) metrics such as the total count per cell, the total number of detected features and (if the feature annotation is supplied) the mitochondrial proportion in each cell."}),Object(x.jsx)("p",{children:"We remove low-quality cells based on these metrics - specifically, cells with low total counts/number of detected features or high mitochondrial proportions are filtered out."}),Object(x.jsx)("p",{children:"We use an outlier-based approach to define the filter threshold under the assumption that most cells in the dataset are of acceptable quality."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of MADs"}),": Number of median absolute deviations (MADs) from the median, used to define a filter threshold in the appropriate direction for each QC metric. Increasing this value will reduce the stringency of the filtering."]})]}),3==k&&Object(x.jsxs)(d.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Identify highly variable genes while accounting for the mean-variance relationship. We do so by fitting a mean-dependent trend to the variances, computed from the log-transformed normalized expression values. The residuals from the trend are then used to rank highly variable genes."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Lowess span"}),": The span of the LOWESS smoother for fitting the mean-variance trend. Larger values increase the smoothness of the global trend at the cost of decreasing sensitivity to local variations."]})]}),4==k&&Object(x.jsxs)(d.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Perform a principal components analysis (PCA) to obtain per-cell coordinates in a low-dimensional space. This is used to compact the data for faster downstream computation, as well as to remove uninteresting high-dimensional noise."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of HVGs"}),": Number of highly variable genes to use to perform the PCA. Larger values will capture more biological signal at the cost of increasing noise and computational work."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of PCs"}),": Number of principal components with the highest variance to retain in downstream analyses. Larger values will capture more biological signal at the cost of increasing noise and computational work."]})]}),5==k&&Object(x.jsxs)(d.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Cluster cells into discrete groupings based on their relative similarity in the low-dimensional space. The set of clusters serve as a summary of the cellular heterogeneity in the population, allowing us to easily perform further characterization on subpopulations of interest."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Method"}),": Clustering algorithm to use. Currently, we use multi-level community detection on an shared nearest neighbor (SNN) graph where cells are the nodes and edges are created between neighboring cells."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of neighbors"}),": Number of neighbors to use to construct the shared nearest neighbor graph. Larger values result in broader clusters."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Use ANN ?"}),": Use an approximate method to speed up the nearest neighbor search. This sacrifices some accuracy for speed in larger datasets."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Weighting scheme"}),": Weighting scheme to use for the edges of the shared nearest neighbor graph. The Rank approach derives a weight from the rank of the closest shared neighbor; the Number approach uses the number of shared neighbors; and the Jaccard approach uses the Jaccard index of the neighbor sets."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Resolution"}),": Resolution parameter for the multi-level clustering, used to adjust the modularity calculation during community optimization. Larger values yield more fine-grained clusters."]})]}),6==k&&Object(x.jsxs)(d.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Create a t-SNE plot to visualize cells in two dimensions, because our feeble human minds cannot interpret high-dimensional spaces. Cells that were neighbors in the original space are kept close together in the 2D embedding, while dissimilar cells are placed (arbitrarily) far away."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Perplexity"}),": Perplexity parameter, which determines the size of the neighborhood of each cell. Larger values will favor preservation of global structure in the 2D embedding."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Iterations"}),": Number of t-SNE iterations. Doesn't usually have much of an effect if you leave it as it is."]})]}),7==k&&Object(x.jsxs)(d.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Create a UMAP plot to visualize cells in two dimensions. Like the t-SNE, this aims to map cells from a high-dimensional space into a 2D embedding, where neighboring cells are kept close together and dissimilar cells are placed far apart."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of neighbors"}),": Number of neighbors to use when defining the size of the local neighborhood. Larger values will favor preservation of global structure."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Minimum distance"}),": Minimum distance between points. Smaller values result in more tightly packed embedding and favor local structure."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Epochs"}),": Number of epochs to use for convergence. This doesn't really change all too much."]})]})]})]})}),Object(x.jsx)(d.F,{id:"load",title:"Load saved analysis",panel:Object(x.jsxs)("div",{className:"inputs-container",children:[Object(x.jsxs)("div",{className:"row-input",children:[Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)(d.G,{animate:!0,renderActiveTabPanelOnly:!0,vertical:!0,onChange:function(e,t){"kana"===e?(Q({file:null}),Z({file:"Choose kana analysis file"})):"kanadb"===e&&(Q({file:null}),ne(!0)),P&&be(P),de(e)},defaultSelectedTabId:oe,children:[Object(x.jsx)(d.F,{id:"kana",title:"Load Analysis file",panel:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"1"}),Object(x.jsx)("span",{className:"row-tooltip",children:"Load saved analysis file"})]}),Object(x.jsx)("div",{className:"row",children:Object(x.jsx)(d.q,{className:"row-input",children:Object(x.jsx)(d.k,{text:Y.file,onInputChange:function(e){Z(Object(l.a)(Object(l.a)({},Y),{},{file:e.target.files[0].name})),Q(Object(l.a)(Object(l.a)({},K),{},{file:e.target.files}))}})})})]})}),Object(x.jsx)(d.F,{id:"kanadb",title:"Load from database",panel:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"1"}),Object(x.jsx)("span",{className:"row-tooltip",children:"Load analysis file"})]}),_?Object(x.jsx)("div",{className:"row",children:Object(x.jsx)(d.B,{label:"Choose an anlaysis",onChange:function(e){var t;Q(Object(l.a)(Object(l.a)({},K),{},{file:null===(t=e.currentTarget)||void 0===t?void 0:t.value})),ne(!0)},selectedValue:null===K||void 0===K?void 0:K.file,children:_.map((function(e,t){return Object(x.jsx)(d.A,{style:{display:"flex",flexDirection:"row",alignItems:"center"},label:e,value:e,children:Object(x.jsx)(d.o,{icon:"trash",size:"10",style:{alignSelf:"baseline",paddingTop:"4px",paddingLeft:"5px"},onClick:function(){z(e)}})},t)}))})}):Object(x.jsx)("div",{className:"row",children:Object(x.jsx)(d.q,{children:"No saved analysis found in the browser!!"})})]})})]})}),P&&G==oe&&(null===K||void 0===K?void 0:K.file)===(null===M||void 0===M||null===(t=M.files)||void 0===t?void 0:t.file)?Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"2"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(2)},children:"Quality control"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(2)},children:"Number of MADs"})}),Object(x.jsx)(d.x,{placeholder:"3",value:je.qc["qc-nmads"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{qc:Object(l.a)(Object(l.a)({},je.qc),{},{"qc-nmads":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(2)},children:"Use default mitochondrial list ?"})}),Object(x.jsx)(d.E,{style:{marginTop:"10px"},large:!0,checked:je.qc["qc-usemitodefault"],innerLabelChecked:"yes",innerLabel:"no",onChange:function(e){be(Object(l.a)(Object(l.a)({},je),{},{qc:Object(l.a)(Object(l.a)({},je.qc),{},{"qc-usemitodefault":e.target.checked})}))}})]}),!je.qc["qc-usemitodefault"]&&Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(2)},children:"Mitochondrial gene prefix"})}),Object(x.jsx)(d.p,{leftIcon:"filter",onChange:function(e,t){var n;be(Object(l.a)(Object(l.a)({},je),{},{qc:Object(l.a)(Object(l.a)({},je.qc),{},{"qc-mito":null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value})}))},placeholder:"mt-",value:je.qc["qc-mito"]})]})]})]})}):"",P&&G==oe&&(null===K||void 0===K?void 0:K.file)===(null===M||void 0===M||null===(n=M.files)||void 0===n?void 0:n.file)?Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"3"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(3)},children:"Feature Selection"})]}),Object(x.jsx)("div",{className:"row",children:Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(3)},children:"Lowess span"})}),Object(x.jsx)(d.x,{placeholder:"0.3",value:je.fSelection["fsel-span"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{fSelection:Object(l.a)(Object(l.a)({},je.fSelection),{},{"fsel-span":e})}))}})]})})]})}):"",P&&G==oe&&(null===K||void 0===K?void 0:K.file)===(null===M||void 0===M||null===(a=M.files)||void 0===a?void 0:a.file)?Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"4"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(4)},children:"Principal components analysis"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(4)},children:"Number of HVGs"})}),Object(x.jsx)(d.x,{placeholder:"2500",value:je.pca["pca-hvg"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{pca:Object(l.a)(Object(l.a)({},je.pca),{},{"pca-hvg":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(4)},children:"Number of PCs"})}),Object(x.jsx)(d.x,{placeholder:"25",value:je.pca["pca-npc"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{pca:Object(l.a)(Object(l.a)({},je.pca),{},{"pca-npc":e})}))}})]})]})]})}):"",P&&G==oe&&(null===K||void 0===K?void 0:K.file)===(null===M||void 0===M||null===(i=M.files)||void 0===i?void 0:i.file)?Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"5"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Clustering"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Method"})}),Object(x.jsx)(d.n,{defaultValue:je.cluster["clus-method"],children:Object(x.jsx)("option",{children:je.cluster["clus-method"]})})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Number of neighbors"})}),Object(x.jsx)(d.x,{placeholder:"10",value:je.cluster["clus-k"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{cluster:Object(l.a)(Object(l.a)({},je.cluster),{},{"clus-k":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Use ANN"})}),Object(x.jsx)(d.E,{style:{marginTop:"10px"},large:!0,checked:je.cluster["clus-approx"],innerLabelChecked:"true",innerLabel:"false",onChange:function(e){be(Object(l.a)(Object(l.a)({},je),{},{cluster:Object(l.a)(Object(l.a)({},je.cluster),{},{"clus-approx":e.target.checked})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Weighting scheme"})}),Object(x.jsxs)(d.n,{onChange:function(e,t){var n;return be(Object(l.a)(Object(l.a)({},je),{},{cluster:Object(l.a)(Object(l.a)({},je.cluster),{},{"clus-scheme":parseInt(null===e||void 0===e||null===(n=e.currentTarget)||void 0===n?void 0:n.value)})}))},children:[Object(x.jsx)("option",{children:"Rank"},"0"),Object(x.jsx)("option",{children:"Number"},"1"),Object(x.jsx)("option",{children:"Jaccard"},"2")]})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Resolution"})}),Object(x.jsx)(d.x,{placeholder:"0.5",value:je.cluster["clus-res"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{cluster:Object(l.a)(Object(l.a)({},je.cluster),{},{"clus-res":e})}))}})]})]})]})}):"",P&&G==oe&&(null===K||void 0===K?void 0:K.file)===(null===M||void 0===M||null===(c=M.files)||void 0===c?void 0:c.file)?Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"6"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(6)},children:"t-SNE"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(6)},children:"Perplexity"})}),Object(x.jsx)(d.x,{placeholder:"30",value:je.tsne["tsne-perp"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{tsne:Object(l.a)(Object(l.a)({},je.tsne),{},{"tsne-perp":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(6)},children:"Iterations"})}),Object(x.jsx)(d.x,{placeholder:"500",value:je.tsne["tsne-iter"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{tsne:Object(l.a)(Object(l.a)({},je.tsne),{},{"tsne-iter":e})}))}})]})]})]})}):"",P&&G==oe&&(null===K||void 0===K?void 0:K.file)===(null===M||void 0===M||null===(r=M.files)||void 0===r?void 0:r.file)?Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"7"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(7)},children:"UMAP"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(7)},children:"Number of neighbors"})}),Object(x.jsx)(d.x,{placeholder:"15",value:je.umap["umap-nn"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{umap:Object(l.a)(Object(l.a)({},je.umap),{},{"umap-nn":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(7)},children:"Minimum distance"})}),Object(x.jsx)(d.x,{placeholder:"0.01",value:je.umap["umap-min_dist"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{umap:Object(l.a)(Object(l.a)({},je.umap),{},{"umap-min_dist":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(7)},children:"Epochs"})}),Object(x.jsx)(d.x,{placeholder:"500",value:je.umap["umap-epoch"],onValueChange:function(e,t){be(Object(l.a)(Object(l.a)({},je),{},{umap:Object(l.a)(Object(l.a)({},je.umap),{},{"umap-epoch":e})}))}})]})]})]})}):""]}),Object(x.jsxs)("div",{className:"row-input-tooltips",children:[!te&&Object(x.jsx)(d.c,{intent:"danger",title:"Incorrect file format",style:{marginBottom:"10px"}}),Object(x.jsxs)(d.c,{intent:"primary",children:["Import a saved analysis from ",Object(x.jsx)("strong",{children:"kana"}),". These files are stored as ",Object(x.jsx)("strong",{children:Object(x.jsx)("code",{children:"*.kana"})}),"."]}),1==k&&Object(x.jsx)(d.c,{intent:"primary",children:Object(x.jsxs)("p",{children:["We currently support files in the Cellranger format - namely, a Matrix Market file containing the count matrix. We also recommend supplying the feature annotation (",Object(x.jsx)("code",{children:"features.tsv.gz"})," or ",Object(x.jsx)("code",{children:"genes.tsv.gz"}),"). Users may also provide a TSV file containing the barcode annotations, if any."]})}),2==k&&Object(x.jsxs)(d.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"At this step, we compute per-cell quality control (QC) metrics such as the total count per cell, the total number of detected features and (if the feature annotation is supplied) the mitochondrial proportion in each cell."}),Object(x.jsx)("p",{children:"We remove low-quality cells based on these metrics - specifically, cells with low total counts/number of detected features or high mitochondrial proportions are filtered out."}),Object(x.jsx)("p",{children:"We use an outlier-based approach to define the filter threshold under the assumption that most cells in the dataset are of acceptable quality."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of MADs"}),": Number of median absolute deviations (MADs) from the median, used to define a filter threshold in the appropriate direction for each QC metric. Increasing this value will reduce the stringency of the filtering."]})]}),3==k&&Object(x.jsxs)(d.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Identify highly variable genes while accounting for the mean-variance relationship. We do so by fitting a mean-dependent trend to the variances, computed from the log-transformed normalized expression values. The residuals from the trend are then used to rank highly variable genes."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Lowess span"}),": The span of the LOWESS smoother for fitting the mean-variance trend. Larger values increase the smoothness of the global trend at the cost of decreasing sensitivity to local variations."]})]}),4==k&&Object(x.jsxs)(d.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Perform a principal components analysis (PCA) to obtain per-cell coordinates in a low-dimensional space. This is used to compact the data for faster downstream computation, as well as to remove uninteresting high-dimensional noise."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of HVGs"}),": Number of highly variable genes to use to perform the PCA. Larger values will capture more biological signal at the cost of increasing noise and computational work."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of PCs"}),": Number of principal components with the highest variance to retain in downstream analyses. Larger values will capture more biological signal at the cost of increasing noise and computational work."]})]}),5==k&&Object(x.jsxs)(d.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Cluster cells into discrete groupings based on their relative similarity in the low-dimensional space. The set of clusters serve as a summary of the cellular heterogeneity in the population, allowing us to easily perform further characterization on subpopulations of interest."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Method"}),": Clustering algorithm to use. Currently, we use multi-level community detection on an shared nearest neighbor (SNN) graph where cells are the nodes and edges are created between neighboring cells."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of neighbors"}),": Number of neighbors to use to construct the shared nearest neighbor graph. Larger values result in broader clusters."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Use ANN ?"}),": Use an approximate method to speed up the nearest neighbor search. This sacrifices some accuracy for speed in larger datasets."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Weighting scheme"}),": Weighting scheme to use for the edges of the shared nearest neighbor graph. The Rank approach derives a weight from the rank of the closest shared neighbor; the Number approach uses the number of shared neighbors; and the Jaccard approach uses the Jaccard index of the neighbor sets."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Resolution"}),": Resolution parameter for the multi-level clustering, used to adjust the modularity calculation during community optimization. Larger values yield more fine-grained clusters."]})]}),6==k&&Object(x.jsxs)(d.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Create a t-SNE plot to visualize cells in two dimensions, because our feeble human minds cannot interpret high-dimensional spaces. Cells that were neighbors in the original space are kept close together in the 2D embedding, while dissimilar cells are placed (arbitrarily) far away."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Perplexity"}),": Perplexity parameter, which determines the size of the neighborhood of each cell. Larger values will favor preservation of global structure in the 2D embedding."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Iterations"}),": Number of t-SNE iterations. Doesn't usually have much of an effect if you leave it as it is."]})]}),7==k&&Object(x.jsxs)(d.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Create a UMAP plot to visualize cells in two dimensions. Like the t-SNE, this aims to map cells from a high-dimensional space into a 2D embedding, where neighboring cells are kept close together and dissimilar cells are placed far apart."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of neighbors"}),": Number of neighbors to use when defining the size of the local neighborhood. Larger values will favor preservation of global structure."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Minimum distance"}),": Minimum distance between points. Smaller values result in more tightly packed embedding and favor local structure."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Epochs"}),": Number of epochs to use for convergence. This doesn't really change all too much."]})]})]})]})})]})}),b?Object(x.jsx)("div",{className:m.a.DIALOG_FOOTER,children:Object(x.jsx)("div",{className:m.a.DIALOG_FOOTER_ACTIONS,children:Object(x.jsx)(j.a,{content:"Run Analysis",children:Object(x.jsx)(d.a,{disabled:!te,icon:"function",onClick:function(){var e,t,n;q(je),"load"==R&&V("kanadb"===oe?null===K||void 0===K?void 0:K.file:null===K||void 0===K||null===(t=K.file)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.name.split(".")[0]),T({format:"new"==R?ie:oe,files:K,reset:"new"!=R&&(null===K||void 0===K?void 0:K.file)!==(null===M||void 0===M||null===(e=M.files)||void 0===e?void 0:e.file)}),W("new"==R?ie:oe),D()},children:"Analyze"})})})}):Object(x.jsx)("div",{style:{margin:"0 20px"}})]}))]})},N=function(){var e=Object(s.useContext)(f),t=e.initDims,n=e.qcDims;return Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)("span",{children:[": ",t?"".concat(t):" ???",n?" (after QC: ".concat(n,")"):""]})})},C=function(){var e=Object(s.useContext)(f).logs,t=Object(s.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!0,enforceFocus:!0,hasBackdrop:!0,isOpen:!1,position:h.a.RIGHT,size:void 0,usePortal:!0}),n=Object(o.a)(t,2),a=n[0],i=n[1];return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(d.a,{onClick:function(){return i({isOpen:!0})},icon:"wrench",outlined:!0,intent:"warning"}),Object(x.jsx)(d.i,Object(l.a)(Object(l.a)({icon:"info-sign",onClose:function(){return i({isOpen:!1})},title:"What's happening ?"},a),{},{children:Object(x.jsx)("div",{className:m.a.DRAWER_BODY,children:Object(x.jsx)("div",{className:m.a.DIALOG_BODY,children:Object(x.jsx)("ul",{className:"list",children:e.map((function(e,t){return Object(x.jsx)("li",{children:e},t)}))})})})}))]})},F=n(34),k=["buttonText","includeFooter"];var S=function(e){e.buttonText,e.includeFooter;var t=Object(p.a)(e,k),n=Object(s.useContext)(f).setOpenInput,a=Object(s.useState)(!0),i=Object(o.a)(a,2),c=i[0],r=i[1],u=Object(s.useState)(!1),b=Object(o.a)(u,2),O=b[0],v=b[1],g=Object(s.useCallback)((function(){r(!c),v(!0)}),[c]),y=Object(s.useCallback)((function(){return r(!1)}),[]);return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(j.a,{content:"App Info",position:h.a.BOTTOM,children:Object(x.jsx)(d.a,{onClick:g,icon:"info-sign",intent:"primary",text:""})}),Object(x.jsxs)(d.g,Object(l.a)(Object(l.a)({},t),{},{isOpen:c,onClose:y,children:[Object(x.jsx)("div",{className:m.a.DIALOG_BODY,children:Object(x.jsxs)(d.d,{elevation:F.a.ZERO,children:[Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"kana"})," performs a standard scRNA-seq data analysis directly inside the browser."]}),Object(x.jsxs)("p",{children:["With just a few clicks, you can get a UMAP/t-SNE and marker genes in an intuitive interface for further exploration. No need to transfer data, no need to install software, no need to configure a backend server - just point to a Matrix Market file and we'll analyze ",Object(x.jsx)("em",{children:"your"})," data on ",Object(x.jsx)("em",{children:"your"})," computer, no questions asked."]}),Object(x.jsxs)("p",{children:["Check out our ",Object(x.jsx)("a",{href:"https://github.com/jkanche/scran.js.app",target:"_blank",children:"GitHub page"})," for more details. Or you could just play around with the app to see what it can do - after all, it's totally free!"]}),Object(x.jsx)(d.m,{children:"Authors"}),"Jayaram Kancherla (",Object(x.jsx)("a",{href:"https://github.com/jkanche",target:"_blank",children:Object(x.jsx)("strong",{children:"@jkanche"})}),"), Aaron Lun (",Object(x.jsx)("a",{href:"https://github.com/LTLA",target:"_blank",children:Object(x.jsx)("strong",{children:"@LTLA"})}),")"]})}),Object(x.jsx)("div",{className:m.a.DIALOG_FOOTER,children:Object(x.jsx)("div",{className:m.a.DIALOG_FOOTER_ACTIONS,children:O?Object(x.jsx)(d.a,{icon:"cross",onClick:y,children:"Close"}):Object(x.jsx)(j.a,{content:"\u884c\u304f\u305e!",children:Object(x.jsx)(d.a,{icon:"bring-data",onClick:function(){n(!0),y()},children:"Get started"})})})})]}))]})},E=function(){var e=Object(s.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!1,enforceFocus:!1,shouldReturnFocusOnClose:!0}),t=Object(o.a)(e,1)[0],n=Object(s.useContext)(f),a=n.setExportState,i=n.datasetName,c=n.setDatasetName,r=n.setIndexedDBState;return Object(x.jsx)(x.Fragment,{children:Object(x.jsx)(d.t,{className:"bp3-dark",children:Object(x.jsxs)(d.v,{className:"navbar-group",align:u.a.LEFT,children:[Object(x.jsx)(d.w,{children:"kana"}),Object(x.jsx)(d.u,{}),Object(x.jsx)("span",{children:"Single cell RNA-seq analysis in the browser"}),Object(x.jsx)(d.u,{}),Object(x.jsx)(w,Object(l.a)({icon:"document",title:"Import dataset & update parameters (mouseover for info)",buttonText:"Start Analysis",includeFooter:!0},t)),Object(x.jsx)(d.u,{}),Object(x.jsx)(j.a,{content:"Modify dataset title",position:h.a.BOTTOM,children:Object(x.jsx)(d.j,{defaultValue:i,intent:"primary",onConfirm:function(e){c(e)}})}),Object(x.jsx)(N,{}),Object(x.jsx)(d.u,{}),Object(x.jsx)(j.a,{content:"Save Analysis",position:h.a.BOTTOM,children:Object(x.jsx)(d.b,{children:Object(x.jsx)(b.a,{content:Object(x.jsxs)(d.r,{children:[Object(x.jsx)(d.s,{text:"Save",icon:"floppy-disk",onClick:function(){r(!0)}}),Object(x.jsx)(d.s,{text:"Download",icon:"download",onClick:function(){a(!0)}})]}),placement:"bottom-start",children:Object(x.jsx)(d.a,{intent:"warning",rightIcon:"caret-down",text:"Export"})})})}),Object(x.jsx)(d.u,{}),Object(x.jsx)(j.a,{content:"Whats happening ?",position:h.a.BOTTOM,children:Object(x.jsx)(C,{})}),Object(x.jsx)(d.u,{}),Object(x.jsx)(S,Object(l.a)({icon:"document",title:"Single-cell RNA-seq analysis in the browser",isOpen:!0},t))]})})})},D=a.a.memo(E),A=n(11);function M(e,t,n,s){var a=function(e){e.setAttribute("xlink","http://www.w3.org/1999/xlink"),function(e,t){var n=document.createElement("style");n.setAttribute("type","text/css"),n.innerHTML=e;var s=t.hasChildNodes()?t.children[0]:null;t.insertBefore(n,s)}(function(e){var t=[];t.push("#"+e.id);for(var n=0;n<e.classList.length;n++)u("."+e.classList[n],t)||t.push("."+e.classList[n]);for(var s=e.getElementsByTagName("*"),a=0;a<s.length;a++){var i=s[a].id;u("#"+i,t)||t.push("#"+i);var c=s[a].classList;for(n=0;n<c.length;n++)u("."+c[n],t)||t.push("."+c[n])}var l="";for(a=0;a<document.styleSheets.length;a++){var r=document.styleSheets[a];try{if(!r.cssRules)continue}catch(h){if("SecurityError"!==h.name)throw h;continue}for(var o=r.cssRules,d=0;d<o.length;d++)u(o[d].selectorText,t)&&(l+=o[d].cssText)}return l;function u(e,t){return-1!==t.indexOf(e)}}(e),e);var t=(new XMLSerializer).serializeToString(e);return(t=t.replace(/(\w+)?:?xlink=/g,"xmlns:xlink=")).replace(/NS\d+:href/g,"xlink:href")}(e),i="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(a))),c=document.createElement("canvas"),l=c.getContext("2d");c.width=t,c.height=n;var r=new Image;r.onload=function(){l.clearRect(0,0,t,n),l.drawImage(r,0,0,t,n);var e=c.toDataURL(),a=document.createElement("a");a.href=e,a.download=s||"plot.png",a.click()},r.src=i}var T=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color,i=null===e||void 0===e?void 0:e.ymax;if(i||(i=Math.max.apply(Math,Object(r.a)(n.map((function(e){return e.value}))))),s||(s=325),a||(a="#00B3A4"),!n)return"";var c=t.current;c.innerHTML="";var l=10,o=30,d=30,u=40,h=s-u-o,j=200-l-d;c.querySelector("svg")&&(c.querySelector("svg").innerHTML="");var b=A.p(c).append("svg").attr("width",h+u+o).attr("height",j+l+d).append("g").attr("transform","translate(".concat(u,",").concat(l,")")),p=A.m().range([0,h]).domain(n.map((function(e){return e.key}))).padding(.2);b.append("g").attr("transform","translate(0,"+j+")").call(A.b(p)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");var m=A.n().domain([0,i]).range([j,0]);b.append("g").call(A.c(m)),b.selectAll("bars").data(n).enter().append("rect").attr("x",(function(e){return p(e.key)})).attr("y",(function(e){return m(e.value)})).attr("width",p.bandwidth()).attr("height",(function(e){return j-m(e.value)})).attr("fill",(function(e,t){return Array.isArray(a)?a[t]:a}))}),[null===e||void 0===e?void 0:e.data]),Object(x.jsxs)("div",{className:"imgplot-container",children:[Object(x.jsx)(d.a,{small:!0,className:"imgplot-save",icon:"download",onClick:function(){M(A.p(t.current.querySelector("svg")).node(),650,400,null===e||void 0===e?void 0:e.filename)},children:"Download"}),Object(x.jsx)("div",{ref:t})]})},I=a.a.memo(T),q=function(e){var t,n,s=null===e||void 0===e||null===(t=e.pca)||void 0===t?void 0:t.var_exp;if(!s)return"";var a=[];return null===(n=Object.values(s))||void 0===n||n.forEach((function(e,t){a.push({key:t+1,value:100*e})})),Object(x.jsx)(I,{filename:(null===e||void 0===e?void 0:e.title)+"_pca.png",data:a})},L=a.a.memo(q),R=n(63),B=function(e){var t=Object(s.useState)(null),n=Object(o.a)(t,2),a=n[0],i=n[1],c=Object(s.useContext)(f),l=c.clusterColors,d=c.setClusterColors,u=c.datasetName;Object(s.useEffect)((function(){var t,n,s=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.clusters;if(s){var a=Math.max.apply(Math,Object(r.a)(s))+1,c=null;c=a>Object.keys(h).length?Object(R.randomColor)({luminosity:"dark",count:a+1}):h[a.toString()],d(c);for(var l={},o=0;o<(null===s||void 0===s?void 0:s.length);o++){var u=s[o];"CLUS_"+u in l?l["CLUS_"+u]++:l["CLUS_"+u]=0}var j=[];null===(n=Object.values(l))||void 0===n||n.forEach((function(e,t){j.push({key:t+1,value:e})})),i(j)}}),[null===e||void 0===e?void 0:e.data]);var h={1:["#1b9e77"],2:["#1b9e77","#d95f02"],3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]};return l&&Object(x.jsx)(I,{filename:u.split(" ").join("_")+"_clusters.png",data:a,color:l})},P=a.a.memo(B),_=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.rdata,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color;if(s||(s=200),a||(a="#00B3A4"),!n)return"";var i=null===e||void 0===e?void 0:e.dataTransform,c=null===e||void 0===e?void 0:e.range,l=null===e||void 0===e?void 0:e.threshold;"log"===i&&(n=n.map((function(e){return Math.log2(e+1)})),c=c.map((function(e){return Math.log2(e+1)})),l=Math.log2(l+1));var r=t.current;r.innerHTML="";var o=10,d=30,u=30,h=40,j=s-h-d,b=200-o-u,p=A.p(r).append("svg").attr("width",j+h+d).attr("height",b+o+u).append("g").attr("transform","translate(".concat(h,",").concat(o,")")),m=A.n().domain(c).range([b,0]).nice();p.append("g").call(A.c(m).tickFormat((function(t){return"log"===i?A.h(null===e||void 0===e?void 0:e.transform)(Math.pow(2,t)):A.h(null===e||void 0===e?void 0:e.transform)(t)})));var O=A.m().range([0,j]).domain([null===e||void 0===e?void 0:e.showLabel]).padding(.05);p.append("g").attr("transform","translate(0,"+b+")").call(A.b(O));var x=A.d().domain(m.domain()).thresholds("log"===i?m.ticks(10):m.ticks(40)).value((function(e){return e}))(n),f=A.l(x,(function(e){return e.length})),v=A.n().range([0,O.bandwidth()]).domain([-1,1]);p.selectAll("violins").data([null===e||void 0===e?void 0:e.label]).enter().append("g").attr("transform",(function(e){return"translate("+O(e)+" ,0)"})).append("path").datum((function(){return x})).style("stroke","none").style("fill",a).attr("d",A.a().x0((function(e){return v(-e.length/f)})).x1((function(e){return v(e.length/f)})).y((function(e){return m(e.x0)})).curve("log"===i?A.e:A.f)),p.selectAll("threshold").data([l]).enter().append("line").attr("transform",(function(){return"translate("+O(null===e||void 0===e?void 0:e.label)+" ,0)"})).attr("class","threshold").attr("x1",5).attr("y1",(function(e){return m(e)})).attr("x2",O.bandwidth()-5).attr("y2",(function(e){return m(e)})).attr("stroke-width",2).attr("stroke","Orange").on("mouseover",(function(){var e=A.p(this);e.attr("stroke","black"),e.attr("stroke-width","8")})).on("mouseout",(function(){var e=A.p(this);e.attr("stroke","Orange"),e.attr("stroke-width","5")}))}),[e]),Object(x.jsxs)("div",{className:"imgplot-container",children:[Object(x.jsx)(d.a,{small:!0,className:"imgplot-save",icon:"download",onClick:function(){M(A.p(t.current.querySelector("svg")).node(),650,400,null===e||void 0===e?void 0:e.filename)},children:"Download"}),Object(x.jsx)("div",{ref:t})]})},W=a.a.memo(_),G=(n(309),function(e){var t=Object(s.useState)(null),n=Object(o.a)(t,2),a=n[0],i=n[1];return Object(s.useEffect)((function(){i(e.data)}),[e]),a&&Object(x.jsx)("div",{className:"qc-plots",children:["sums","detected","proportion"].map((function(t){var n,s,i,c={threshold:null===a||void 0===a||null===(n=a.thresholds)||void 0===n?void 0:n[t],range:null===a||void 0===a||null===(s=a.ranges)||void 0===s?void 0:s[t],label:t,transform:"proportion"===t?".2":".2s",showLabel:t,dataTransform:"proportion"===t?null:"log",rdata:null===a||void 0===a||null===(i=a.data)||void 0===i?void 0:i[t]};return Object(x.jsx)("div",{children:Object(x.jsx)(W,Object(l.a)({filename:(null===e||void 0===e?void 0:e.title)+"_"+t+".png"},c))},t)}))})}),z=a.a.memo(G),V=(n(310),n(311),function(e){var t=Object(s.useRef)(),n=Object(s.useState)(null),a=Object(o.a)(n,2),i=a[0],c=a[1],l=Object(s.useContext)(f),r=l.genesInfo,u=l.selectedClusterSummary,h=l.geneColSel,j=null===e||void 0===e?void 0:e.data,b=null===e||void 0===e?void 0:e.width,p=null===e||void 0===e?void 0:e.height,m=null===e||void 0===e?void 0:e.color;return b||(b=325),p||(p=200),m||(m="#00B3A4"),Object(s.useEffect)((function(){var e=t.current;if(e){var n,s,a;if(null===j||void 0===j?void 0:j.image){var i=e.getContext("2d"),l=new Image;l.onload=function(){i.drawImage(l,0,0,b,p)},l.src=null===j||void 0===j?void 0:j.image}var o,d,m,O=" ".concat(null===j||void 0===j||null===(n=j.config)||void 0===n?void 0:n.embedding," ");if(null===j||void 0===j||null===(s=j.config)||void 0===s?void 0:s.gene)O+="\u2283 ".concat(r[h][null===u||void 0===u||null===(o=u[null===j||void 0===j||null===(d=j.config)||void 0===d?void 0:d.gene])||void 0===o?void 0:o.row]," ");if(null===j||void 0===j||null===(a=j.config)||void 0===a?void 0:a.highlight)O+="\u2283 Cluster ".concat(parseInt((null===j||void 0===j||null===(m=j.config)||void 0===m?void 0:m.highlight)+1)," ");c(O)}}),[]),Object(x.jsxs)("div",{className:"imgplot-container",children:[Object(x.jsx)("h5",{children:i}),Object(x.jsx)(d.a,{small:!0,className:"imgplot-save",icon:"download",onClick:function(){var e=document.createElement("a");e.href=null===j||void 0===j?void 0:j.image,e.download="".concat(i.replace("\u2283","").split(" ").join("_"),".png"),e.click()},children:"Download"}),Object(x.jsx)("canvas",{className:"imgplot-canvas",width:b,height:p,ref:t})]})}),H=function(){var e=Object(s.useContext)(f),t=e.pcaVarExp,n=e.qcData,a=e.clusterData,i=e.savedPlot,c=e.datasetName;return Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)("div",{className:"gallery-cont",children:[n&&(null===n||void 0===n?void 0:n.thresholds)?Object(x.jsxs)(d.d,{className:"gallery-elem",elevation:F.a.ONE,children:[Object(x.jsx)("h5",{children:"QC Statistics"}),Object(x.jsx)(z,{title:c.split(" ").join("_"),data:n})]}):"",t?Object(x.jsxs)(d.d,{className:"gallery-elem",elevation:F.a.ONE,children:[Object(x.jsx)("h5",{children:"PCA (% variance explained)"}),Object(x.jsx)(L,{title:c.split(" ").join("_"),pca:t})]}):"",a?Object(x.jsxs)(d.d,{className:"gallery-elem",elevation:F.a.ONE,children:[Object(x.jsx)("h5",{children:"# of cells per cluster"}),Object(x.jsx)(P,{data:a})]}):"",i?i.map((function(e,t){return Object(x.jsx)(d.d,{className:"gallery-elem",elevation:F.a.ONE,children:Object(x.jsx)(V,{data:e})},t)})):""]})})},U=a.a.memo(H),K=n(78);function Q(){var e=null,t=0,n=100,s=["ff0000","ffff00","00ff00","0000ff"];function a(a){if(a.length<2)throw new Error("Rainbow must have two or more colours.");var i=(n-t)/(a.length-1),c=new X;c.setGradient(a[0],a[1]),c.setNumberRange(t,t+i),e=[c];for(var l=1;l<a.length-1;l++){var r=new X;r.setGradient(a[l],a[l+1]),r.setNumberRange(t+i*l,t+i*(l+1)),e[l]=r}s=a}a(s),this.setSpectrum=function(){return a(arguments),this},this.setSpectrumByArray=function(e){return a(e),this},this.colourAt=function(s){if(isNaN(s))throw new TypeError(s+" is not a number");if(1===e.length)return e[0].colourAt(s);var a=(n-t)/e.length,i=Math.min(Math.floor((Math.max(s,t)-t)/a),e.length-1);return e[i].colourAt(s)},this.colorAt=this.colourAt,this.setNumberRange=function(e,i){if(!(i>e))throw new RangeError("maxNumber ("+i+") is not greater than minNumber ("+e+")");return t=e,n=i,a(s),this}}function X(){var e="ff0000",t="0000ff",n=0,s=100;function a(e,t,a){var i=e;i<n&&(i=n),i>s&&(i=s);var c,l=s-n,r=parseInt(t,16),o=(parseInt(a,16)-r)/l,d=Math.round(o*(i-n)+r);return 1===(c=d.toString(16)).length?"0"+c:c}function i(e){if(function(e){return/^#?[0-9a-fA-F]{6}$/i.test(e)}(e))return e.substring(e.length-6,e.length);var t=e.toLowerCase();if(c.hasOwnProperty(t))return c[t];throw new Error(e+" is not a valid colour.")}this.setGradient=function(n,s){e=i(n),t=i(s)},this.setNumberRange=function(e,t){if(!(t>e))throw new RangeError("maxNumber ("+t+") is not greater than minNumber ("+e+")");n=e,s=t},this.colourAt=function(n){return a(n,e.substring(0,2),t.substring(0,2))+a(n,e.substring(2,4),t.substring(2,4))+a(n,e.substring(4,6),t.substring(4,6))};var c={aliceblue:"F0F8FF",antiquewhite:"FAEBD7",aqua:"00FFFF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000000",blanchedalmond:"FFEBCD",blue:"0000FF",blueviolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetblue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerblue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"00FFFF",darkblue:"00008B",darkcyan:"008B8B",darkgoldenrod:"B8860B",darkgray:"A9A9A9",darkgreen:"006400",darkgrey:"A9A9A9",darkkhaki:"BDB76B",darkmagenta:"8B008B",darkolivegreen:"556B2F",darkorange:"FF8C00",darkorchid:"9932CC",darkred:"8B0000",darksalmon:"E9967A",darkseagreen:"8FBC8F",darkslateblue:"483D8B",darkslategray:"2F4F4F",darkslategrey:"2F4F4F",darkturquoise:"00CED1",darkviolet:"9400D3",deeppink:"FF1493",deepskyblue:"00BFFF",dimgray:"696969",dimgrey:"696969",dodgerblue:"1E90FF",firebrick:"B22222",floralwhite:"FFFAF0",forestgreen:"228B22",fuchsia:"FF00FF",gainsboro:"DCDCDC",ghostwhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"808080",green:"008000",greenyellow:"ADFF2F",grey:"808080",honeydew:"F0FFF0",hotpink:"FF69B4",indianred:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderblush:"FFF0F5",lawngreen:"7CFC00",lemonchiffon:"FFFACD",lightblue:"ADD8E6",lightcoral:"F08080",lightcyan:"E0FFFF",lightgoldenrodyellow:"FAFAD2",lightgray:"D3D3D3",lightgreen:"90EE90",lightgrey:"D3D3D3",lightpink:"FFB6C1",lightsalmon:"FFA07A",lightseagreen:"20B2AA",lightskyblue:"87CEFA",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"B0C4DE",lightyellow:"FFFFE0",lime:"00FF00",limegreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumaquamarine:"66CDAA",mediumblue:"0000CD",mediumorchid:"BA55D3",mediumpurple:"9370DB",mediumseagreen:"3CB371",mediumslateblue:"7B68EE",mediumspringgreen:"00FA9A",mediumturquoise:"48D1CC",mediumvioletred:"C71585",midnightblue:"191970",mintcream:"F5FFFA",mistyrose:"FFE4E1",moccasin:"FFE4B5",navajowhite:"FFDEAD",navy:"000080",oldlace:"FDF5E6",olive:"808000",olivedrab:"6B8E23",orange:"FFA500",orangered:"FF4500",orchid:"DA70D6",palegoldenrod:"EEE8AA",palegreen:"98FB98",paleturquoise:"AFEEEE",palevioletred:"DB7093",papayawhip:"FFEFD5",peachpuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderblue:"B0E0E6",purple:"800080",red:"FF0000",rosybrown:"BC8F8F",royalblue:"4169E1",saddlebrown:"8B4513",salmon:"FA8072",sandybrown:"F4A460",seagreen:"2E8B57",seashell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyblue:"87CEEB",slateblue:"6A5ACD",slategray:"708090",slategrey:"708090",snow:"FFFAFA",springgreen:"00FF7F",steelblue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFFFFF",whitesmoke:"F5F5F5",yellow:"FFFF00",yellowgreen:"9ACD32"}}n(323);var J=function(){var e,t,n,a=Object(s.useRef)(),i=Object(s.useState)(null),c=Object(o.a)(i,2),u=c[0],h=c[1],b=Object(s.useState)(null),p=Object(o.a)(b,2),m=p[0],v=p[1],g=Object(s.useState)(!1),y=Object(o.a)(g,2),w=y[0],N=y[1],C=Object(s.useState)(null),F=Object(o.a)(C,2),k=F[0],S=F[1],E=Object(s.useState)(k),D=Object(o.a)(E,2),A=D[0],M=D[1],T=Object(s.useState)(null),I=Object(o.a)(T,2),q=I[0],L=I[1],B=Object(s.useState)(!0),P=Object(o.a)(B,2),_=P[0],W=P[1],G=Object(s.useContext)(f),z=G.redDims,V=G.defaultRedDims,H=G.setDefaultRedDims,U=G.clusterData,X=G.tsneData,J=G.umapData,Y=G.clusterColors,Z=G.setClusterColors,$=G.gene,ee=G.setGene,te=G.selectedClusterSummary,ne=G.customSelection,se=G.setCustomSelection,ae=G.setDelCustomSelection,ie=G.showAnimation,ce=G.setTriggerAnimation,le=G.savedPlot,re=G.setSavedPlot,oe=G.selectedCluster,de=G.genesInfo,ue=G.geneColSel,he=Object(s.useState)(null),je=Object(o.a)(he,2),be=je[0],pe=je[1],me=Object(s.useState)("PAN"),Oe=Object(o.a)(me,2),xe=Oe[0],fe=Oe[1],ve=Math.max.apply(Math,Object(r.a)(null===U||void 0===U?void 0:U.clusters));Object(s.useEffect)((function(){var e;if(null===$&&(N(!1),L(null)),null===te||void 0===te||null===(e=te[$])||void 0===e?void 0:e.expr){var t,n,s=function(e){var t=-Number.MAX_VALUE,n=Number.MAX_VALUE;return e.forEach((function(e){t<e&&(t=e),n>e&&(n=e)})),[n,t]}(null===te||void 0===te||null===(t=te[$])||void 0===t?void 0:t.expr),a=0===s[1]?.01:s[1],i=new Q;if(i.setSpectrum("#F5F8FA","#2965CC"),i.setNumberRange(0,a),s[0]!==s[1])N(!0),M([0,a]),S([0,a]);else N(!1),O.show({icon:"warning-sign",intent:"warning",message:"".concat(de[ue][null===te||void 0===te||null===(n=te[$])||void 0===n?void 0:n.row]," is not expressed in any cell (mean = 0)")});L(i)}}),[null===te||void 0===te||null===(e=te[$])||void 0===e?void 0:e.expr],$),Object(s.useEffect)((function(){if(Array.isArray(A)){var e=new Q;e.setSpectrum("#F5F8FA","#2965CC"),e.setNumberRange.apply(e,Object(r.a)(A)),L(e),N(!0)}}),[A]),Object(s.useEffect)((function(){if(a.current){var e=u;if(!e){var t=a.current;t.style.width="95%",t.style.height="95%",e=new K.ScatterGL(t,{onSelect:function(e){0!==e.length&&pe(e)},orbitControls:{zoomSpeed:1.25},styles:{point:{scaleDefault:1,scaleSelected:1.25,scaleHover:1.25}}}),e.setPanMode(),h(e)}var n=null;if("TSNE"===V?n=X:"UMAP"===V&&(n=J),n){var s=null===U||void 0===U?void 0:U.clusters,i=Y,c=[];n.x.forEach((function(e,t){c.push([e,n.y[t]])}));var l={clusters:s},r=new K.ScatterGL.Dataset(c,l);_?(e.render(r),W(!1)):e.updateDataset(r),e.setPointColorer((function(e,t,n){var a,c,l;if(t.has(e))return"#30404D";if(null!=m)if(String(m).startsWith("cs")){if(!ne[m].includes(e))return"#D3D3D3"}else if(m!==s[e])return"#D3D3D3";if(null!==$&&Array.isArray(null===te||void 0===te||null===(a=te[$])||void 0===a?void 0:a.expr))return"#"+q.colorAt(null===te||void 0===te||null===(c=te[$])||void 0===c||null===(l=c.expr)||void 0===l?void 0:l[e]);if(null!=m&&String(m).startsWith("cs")){var r=parseInt(m.replace("cs",""));return i[ve+r]}return i[s[e]]}))}}}),[X,J,V,q,m]);var ge=function(e){"SELECT"===e?(u.setSelectMode(),fe("SELECT")):(u.setPanMode(),fe("PAN"))};return Object(x.jsxs)("div",{className:"scatter-plot",children:[Object(x.jsxs)(d.b,{style:{minWidth:75,minHeight:150},fill:!1,large:!1,minimal:!1,vertical:!0,className:"left-sidebar",children:[Object(x.jsxs)(d.a,{className:"dim-button",disabled:-1===z.indexOf("TSNE"),onClick:function(){return H("TSNE")},intent:"TSNE"===V?"primary":"",children:[Object(x.jsx)(d.o,{icon:"heatmap"}),Object(x.jsx)("br",{}),Object(x.jsx)("span",{children:"t-SNE"})]}),Object(x.jsxs)(d.a,{className:"dim-button",disabled:-1===z.indexOf("UMAP"),onClick:function(){return H("UMAP")},intent:"UMAP"===V?"primary":"",children:[Object(x.jsx)(d.o,{icon:"heatmap"}),Object(x.jsx)("br",{}),Object(x.jsx)("span",{children:"UMAP"})]}),Object(x.jsxs)(d.a,{className:"dim-button",disabled:!0,children:[Object(x.jsx)(d.o,{icon:"heat-grid"}),Object(x.jsx)("br",{}),Object(x.jsx)("span",{children:"HEATMAP (coming soon)"})]})]}),Object(x.jsxs)("div",{className:"top-header",children:[Object(x.jsxs)(d.f,{fill:!1,vertical:!1,style:{marginRight:"4px"},children:[Object(x.jsx)(j.a,{content:"Interactively visualize embeddings",children:Object(x.jsx)(d.a,{icon:"play",onClick:function(){return ce(!0)},children:"Animate"})}),Object(x.jsx)(j.a,{content:"Save this embedding",children:Object(x.jsx)(d.a,{icon:"inheritance",onClick:function(){if(console.log("handleSaveEmbedding"),a.current){u.renderScatterPlot();var e=u.scatterPlot.renderer.domElement.toDataURL(),t=Object(r.a)(le);t.push({image:e,config:{cluster:oe,gene:$,highlight:m,embedding:V}}),re(t)}},children:"Save"})})]}),Object(x.jsxs)(d.f,{fill:!1,vertical:!1,children:[Object(x.jsx)(d.a,{active:"PAN"==xe,intent:"PAN"===xe?"primary":"none",icon:"hand-up",onClick:function(e){return ge("PAN")},children:"Pan"}),Object(x.jsx)(d.a,{active:"SELECT"==xe,intent:"SELECT"===xe?"primary":"none",icon:"widget",onClick:function(e){return ge("SELECT")},children:"Selection"})]})]}),ie?Object(x.jsxs)(d.q,{className:"iter",children:["Iteration: ","TSNE"===V?null===X||void 0===X?void 0:X.iteration:null===J||void 0===J?void 0:J.iteration]}):"",Object(x.jsx)("div",{className:"dim-plot",children:V?Object(x.jsx)("div",{ref:a}):"Choose an Embedding... or Embeddings are being computed..."}),Object(x.jsx)("div",{className:"right-sidebar",children:Object(x.jsxs)("div",{style:{width:"100%"},children:[Object(x.jsxs)("div",{className:"right-sidebar-cluster",children:[Object(x.jsxs)(d.c,{title:"CLUSTERS",children:[Object(x.jsx)("ul",{children:null===Y||void 0===Y?void 0:Y.map((function(e,t){return t<Y.length-Object.keys(ne).length?Object(x.jsxs)("li",{className:m==t?"legend-highlight":"",style:{color:e},onClick:function(){v(t===m?null:t)},children:[" Cluster ",t+1," "]},t):""}))}),Object.keys(ne).length>0?Object(x.jsxs)("div",{style:{paddingTop:"5px"},children:[Object(x.jsxs)("span",{children:["Custom Selection \xa0",Object(x.jsx)(j.a,{content:"Custom selection of cells",openOnTargetFocus:!1,children:Object(x.jsx)(d.o,{icon:"help"})})]}),Object(x.jsx)("ul",{children:null===(t=Object.keys(ne))||void 0===t?void 0:t.map((function(e,t){return Object(x.jsx)("li",{className:m==e?"legend-highlight":"",style:{color:Y[Math.max.apply(Math,Object(r.a)(null===U||void 0===U?void 0:U.clusters))+1+t]},children:Object(x.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",flexDirection:"row"},children:[Object(x.jsxs)("span",{style:{alignSelf:"center"},onClick:function(){v(e===m?null:e)},children:["Custom Selection ",e.replace("cs","")]}),Object(x.jsx)(d.o,{size:12,icon:"trash",style:{paddingLeft:"2px"},onClick:function(){var t=Object(l.a)({},ne);delete t[e],se(t);var n=Object(r.a)(Y);n=n.slice(0,n.length-1),Z(n),ae(e),m===e&&v(null)}})]})},e)}))})]}):""]}),be&&be.length>0?Object(x.jsxs)("div",{children:[Object(x.jsx)(d.h,{}),Object(x.jsxs)("span",{children:["Selection \xa0",Object(x.jsx)(j.a,{content:"save this selection of cells",openOnTargetFocus:!1,children:Object(x.jsx)(d.o,{icon:"help"})})]}),Object(x.jsxs)("div",{className:"selection-container",children:[Object(x.jsxs)("span",{children:[be.length," cells selected"]}),Object(x.jsxs)("div",{className:"selection-button-container",children:[Object(x.jsx)(d.a,{small:!0,intent:"primary",onClick:function(){var e=Object(R.randomColor)({luminosity:"dark",count:1}),t=Object(r.a)(Y);t.push(e[0]),Z(t);var n=Object.keys(ne).length,s=Object(l.a)({},ne);s["cs".concat(n+1)]=be,se(s),pe(null),u.select(null)},children:"Save"}),Object(x.jsx)(d.a,{small:!0,onClick:function(){pe(null),u.select(null)},children:"Clear"})]})]})]}):""]}),w?Object(x.jsxs)("div",{className:"right-sidebar-slider",children:[Object(x.jsx)(d.h,{}),Object(x.jsxs)(d.c,{children:[Object(x.jsxs)("span",{children:["Gradient for ",Object(x.jsx)(d.H,{minimal:!0,intent:"primary",onRemove:function(){ee(null)},children:de[ue][null===te||void 0===te||null===(n=te[$])||void 0===n?void 0:n.row]}),"\xa0",Object(x.jsx)(j.a,{content:"Use the slider to adjust the color gradient of the plot. Useful when data is skewed by either a few lowly or highly expressed cells",openOnTargetFocus:!1,children:Object(x.jsx)(d.o,{icon:"help"})})]}),Object(x.jsxs)("div",{className:"dim-slider-container",children:[Object(x.jsxs)("div",{className:"dim-slider-gradient",children:[Object(x.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, #F5F8FA ".concat(100*(A[0]-k[0])/(k[1]-k[0]),"%, ").concat(100*(A[1]+A[0]-2*k[0])/(2*(k[1]-k[0])),"%, #2965CC ").concat(100-100*(k[1]-A[1])/(k[1]-k[0]),"%)"),width:"175px",height:"15px"}}),"\xa0"]}),Object(x.jsx)("div",{className:"dim-range-slider",children:Object(x.jsx)(d.C,{min:Math.round(k[0]),max:Math.round(k[1]),stepSize:Math.round(k[1]-k[0])/10,labelValues:[Math.round(k[0]),Math.round(k[1])],onChange:function(e){M(e)},value:[Math.round(A[0]),Math.round(A[1])],vertical:!1})})]})]})]}):""]})})]})},Y=a.a.memo(J),Z=n(135),$=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color,i=null===e||void 0===e?void 0:e.clusters,c=null===e||void 0===e?void 0:e.clusterlabel;if(s||(s=325),a||(a="#00B3A4"),!n)return"";var l=t.current;l.innerHTML="";var r=10,o=30,d=30,u=40,h=s-u-o,j=150-r-d,b=A.p(l).append("svg").attr("width",h+u+o).attr("height",j+r+d).append("g").attr("transform","translate(".concat(u,",").concat(r,")")),p=A.n().domain(A.g(n)).range([0,h]);b.append("g").attr("transform","translate(0, ".concat(j/2,")")).call(A.b(p).ticks(5).tickValues(A.g(n)));var m=A.d().value((function(e){return e})).domain(p.domain()).thresholds(A.q),O=(m(n),m(n.filter((function(e,t){return 0===(null===i||void 0===i?void 0:i[t])})))),x=m(n.filter((function(e,t){return 1===(null===i||void 0===i?void 0:i[t])}))),f=A.l(O,(function(e){return e.length})),v=A.l(x,(function(e){return e.length})),g=A.n().range([j,0]).domain([-1,1]);(b.selectAll("rectAll").data(O).join("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(p(e.x0)," , ").concat(g(0),")")})).attr("width",(function(e){return p(e.x1)-p(e.x0)-1})).attr("height",(function(e){return g(-e.length/f)-j/2})).style("fill","#D3D3D3").style("opacity",.6),b.selectAll("rectCluster").data(x).enter().append("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(p(e.x0),", ").concat(g(e.length/v),")")})).attr("width",(function(e){return p(e.x1)-p(e.x0)-1})).attr("height",(function(e){return j/2-g(e.length/v)})).style("fill",a).style("opacity",.6),b.append("text").attr("x",h-20).attr("y",g(-.5)).text("other cells").style("font-size","10px").attr("alignment-baseline","middle"),c.startsWith("Custom"))?c.split(" ").forEach((function(e,t){b.append("text").attr("x",h-20).attr("y",g(.7-.17*t)).text(e).style("font-size","10px").attr("alignment-baseline","middle").style("fill",a)})):b.append("text").attr("x",h-20).attr("y",g(.5)).text(c).style("font-size","10px").attr("alignment-baseline","middle").style("fill",a)}),[]),Object(x.jsx)("div",{ref:t})},ee=function(e){var t=Object(s.useRef)(),n=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.minmax,i=null===e||void 0===e?void 0:e.score,c=null===e||void 0===e?void 0:e.colorscale,l=null===e||void 0===e?void 0:e.colorscore,r=null===e||void 0===e?void 0:e.color,o=(i-a[0])/(a[1]-a[0]);return n||(n="100%"),r||(r="#00B3A4"),Object(x.jsx)("div",{ref:t,style:{width:n,height:"15px",margin:"1px",border:"1px solid gainsboro",alignItems:"center"},children:c?Object(x.jsx)("div",{style:{width:"".concat(100*l,"%"),backgroundColor:c(l),height:"100%"}}):Object(x.jsx)("div",{style:{width:"".concat(100*o,"%"),backgroundColor:r,height:"100%"}})})},te=function(e){var t=Object(s.useRef)(),n=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.score,i=null===e||void 0===e?void 0:e.minmax,c=A.o(A.k).domain([i[1],i[0]]);return n||(n="100%"),Object(x.jsx)("div",{ref:t,style:{width:n,height:"15px",margin:"1px",border:"1px solid gainsboro",alignItems:"center",backgroundColor:c(a)},children:Object(x.jsx)("div",{style:{width:"100%",backgroundColor:c(a),height:"100%"}})})},ne=(n(324),["children"]),se=function(){var e=Object(s.useContext)(f),t=e.genesInfo,n=e.clusterData,a=e.selectedClusterSummary,i=e.setSelectedClusterSummary,c=e.selectedCluster,u=e.setSelectedCluster,h=e.setClusterRank,O=e.setReqGene,v=e.clusterColors,g=e.gene,y=e.setGene,w=e.customSelection,N=e.geneColSel,C=e.setGeneColSel,k=Object(s.useState)(null),S=Object(o.a)(k,2),E=S[0],D=S[1],M=Object(s.useState)(null),T=Object(o.a)(M,2),I=T[0],q=T[1],L=Object(s.useState)(null),R=Object(o.a)(L,2),B=R[0],P=R[1],_=Object(s.useState)(null),W=Object(o.a)(_,2),G=W[0],z=W[1],V=Object(s.useState)(null),H=Object(o.a)(V,2),U=H[0],K=H[1],Q=Object(s.useState)(null),X=Object(o.a)(Q,2),J=X[0],Y=X[1],se=Object(s.useState)(null),ae=Object(o.a)(se,2),ie=ae[0],ce=ae[1],le=Object(s.useState)(null),re=Object(o.a)(le,2),oe=re[0],de=re[1],ue=Object(s.useState)(null),he=Object(o.a)(ue,2),je=(he[0],he[1]),be=Object(s.useState)(null),pe=Object(o.a)(be,2),me=(pe[0],pe[1]),Oe=Object(s.useState)(null),xe=Object(o.a)(Oe,2),fe=(xe[0],xe[1]),ve=Object(s.useState)(null),ge=Object(o.a)(ve,2),ye=(ge[0],ge[1]),we=Object(s.useState)({}),Ne=Object(o.a)(we,2),Ce=Ne[0],Fe=Ne[1],ke=Object(s.useState)(null),Se=Object(o.a)(ke,2),Ee=Se[0],De=Se[1],Ae=A.k;Object(s.useEffect)((function(){if(!a)return a;var e=a;if(0===e.length)return e;var t=e.map((function(e){return null===e||void 0===e?void 0:e.mean})),n=A.g(t),s=0===n[1]?.01:n[1];z([parseFloat(n[0].toFixed(2)),parseFloat(s.toFixed(2))]),je(t);var i=e.map((function(e){return null===e||void 0===e?void 0:e.delta})),c=A.g(i),l=0===c[1]?.01:c[1];K([parseFloat(c[0].toFixed(2)),parseFloat(l.toFixed(2))]),me(i);var o=e.map((function(e){return null===e||void 0===e?void 0:e.lfc})),d=A.g(o),u=0===d[1]?.01:d[1];Y([parseFloat(d[0].toFixed(2)),parseFloat(u.toFixed(2))]),fe(o);var h=e.map((function(e){return null===e||void 0===e?void 0:e.detected})),j=A.g(h),b=0===j[1]?.01:j[1];ce([parseFloat(j[0].toFixed(2)),parseFloat(b.toFixed(2))]),ye(h),de({lfc:[parseFloat(d[0].toFixed(2)),parseFloat(u.toFixed(2))],mean:[parseFloat(n[0].toFixed(2)),parseFloat(s.toFixed(2))],detected:[parseFloat(j[0].toFixed(2)),parseFloat(b.toFixed(2))],delta:[parseFloat(c[0].toFixed(2)),parseFloat(l.toFixed(2))]});var p=Object(r.a)(e);Fe({lfc:[0,parseFloat(u.toFixed(2))],delta:[0,parseFloat(l.toFixed(2))]}),De(p)}),[a]);var Me=Object(s.useMemo)((function(){if(!Ee)return[];var e=Ee;if(Ce){var n=function(t){var n=Ce[t];if(n[0]==oe[t][0]&&n[1]==oe[t][1])return"continue";e=e.filter((function(e){return e[t]>=n[0]&&e[t]<=n[1]}))};for(var s in Ce)n(s)}return B&&""!==B?e=e.filter((function(e){return-1!==t[N][e.row].toLowerCase().indexOf(B.toLowerCase())})):e}),[Ee,B,Ce]);Object(s.useEffect)((function(){if(null===n||void 0===n?void 0:n.clusters){for(var e=Math.max.apply(Math,Object(r.a)(n.clusters)),t=[],s=0;s<e+1;s++)t.push(s+1);t=t.concat(Object.keys(w)),D(t),null==c&&u(0)}}),[n,w,c]),Object(s.useEffect)((function(){var e,t,s=[];String(c).startsWith("cs")?null===n||void 0===n||null===(e=n.clusters)||void 0===e||e.forEach((function(e,t){return w[c].includes(t)?s.push(1):s.push(0)})):null===n||void 0===n||null===(t=n.clusters)||void 0===t||t.forEach((function(e){return e===c?s.push(1):s.push(0)}));q(s)}),[c]);var Te=function(e,t){var n=Object(l.a)({},Ce);n[t]=e,Fe(n)};return Object(x.jsxs)("div",{className:"marker-container",children:[Object(x.jsx)(d.l,{children:"Marker Genes"}),E?Object(x.jsx)(d.n,{onChange:function(e){var t;y(null);var n=null===(t=e.currentTarget)||void 0===t?void 0:t.value;n.startsWith("Cluster")?n=parseInt(n.replace("Cluster ",""))-1:n.startsWith("Custom")&&(n=n.replace("Custom Selection ","")),u(n),Fe({}),y(null)},children:E.map((function(e,t){return Object(x.jsxs)("option",{children:[String(e).startsWith("cs")?"Custom Selection":"Cluster"," ",e]},t)}))}):"",a?Object(x.jsxs)("div",{className:"marker-table",children:[Object(x.jsxs)("div",{className:"marker-header",children:[Object(x.jsx)(d.p,{leftIcon:"search",small:!0,placeholder:"Search gene...",type:"text",onChange:function(e){return P(e.target.value)}}),Object(x.jsxs)("span",{children:[Object(x.jsx)(d.o,{icon:"sort",style:{paddingRight:"5px"}}),Object(x.jsxs)(d.n,{onChange:function(e){h(e.currentTarget.value)},defaultValue:"cohen-min-rank",children:[Object(x.jsx)("option",{children:"cohen-min"}),Object(x.jsx)("option",{children:"cohen-mean"}),Object(x.jsx)("option",{children:"cohen-min-rank"}),Object(x.jsx)("option",{children:"auc-min"}),Object(x.jsx)("option",{children:"auc-mean"}),Object(x.jsx)("option",{children:"auc-min-rank"}),Object(x.jsx)("option",{children:"lfc-min"}),Object(x.jsx)("option",{children:"lfc-mean"}),Object(x.jsx)("option",{children:"lfc-min-rank"}),Object(x.jsx)("option",{children:"delta-d-min"}),Object(x.jsx)("option",{children:"delta-d-mean"}),Object(x.jsx)("option",{children:"delta-d-min-rank"})]})]})]}),Object(x.jsx)(Z.a,{components:{Item:function(e){var t=e.children,n=Object(p.a)(e,ne);return Object(x.jsx)("div",Object(l.a)(Object(l.a)({className:"row-card"},n),{},{children:t}))},Header:function(){return Object(x.jsxs)("div",{className:"row-container row-header",children:[Object(x.jsx)("span",{children:Object(x.jsx)(d.n,{large:!1,minimal:!0,defaultValue:N,onChange:function(e,t){var n;return C(null===e||void 0===e||null===(n=e.currentTarget)||void 0===n?void 0:n.value)},children:Object.keys(t).map((function(e,t){return Object(x.jsx)("option",{children:e},t)}))})}),Object(x.jsxs)("span",{children:["Log-FC \xa0",Object(x.jsx)(j.a,{content:"Log fold change",openOnTargetFocus:!1,children:Object(x.jsx)(d.o,{style:{marginBottom:"1px"},size:8,icon:"help"})})]}),Object(x.jsxs)("span",{children:["\u0394-detected \xa0",Object(x.jsx)(j.a,{content:"delta detected",openOnTargetFocus:!1,children:Object(x.jsx)(d.o,{style:{marginBottom:"1px"},size:8,icon:"help"})})]}),Object(x.jsxs)("span",{children:["Expression \xa0",Object(x.jsx)(j.a,{content:"Bar represents the mean expression of the gene and the color gradient represents detected.",openOnTargetFocus:!1,children:Object(x.jsx)(d.o,{style:{marginBottom:"1px"},size:8,icon:"help"})})]}),Object(x.jsx)("span",{})]})}},className:"marker-list",totalCount:Me.length,itemContent:function(e){var s=Me[e],l=s.expanded,o=s.expr;return Object(x.jsxs)("div",{children:[Object(x.jsxs)("div",{className:"row-container",children:[Object(x.jsx)("span",{style:{color:s.index===g?String(c).startsWith("cs")?v[Math.max.apply(Math,Object(r.a)(null===n||void 0===n?void 0:n.clusters))+parseInt(c.replace("cs",""))]:v[c]:"black"},className:s.index===g?"marker-gene-title-selected":"marker-gene-title",children:t[N][s.row]}),Object(x.jsx)(b.a,{popoverClassName:m.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(x.jsx)(d.d,{elevation:F.a.ZERO,children:Object(x.jsxs)("table",{children:[Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{}),Object(x.jsx)("th",{scope:"col",children:t[N][s.row]}),Object(x.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Log-FC"}),Object(x.jsx)("td",{children:s.lfc.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",J[0].toFixed(2),", ",J[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(x.jsx)("td",{children:s.delta.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",U[0].toFixed(2),", ",U[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Detected"}),Object(x.jsx)("td",{children:s.detected.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ie[0].toFixed(2),", ",ie[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Expression"}),Object(x.jsx)("td",{children:s.mean.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",G[0].toFixed(2),", ",G[1].toFixed(2),"]"]})]})]})}),children:Object(x.jsx)(te,{minmax:J,colorscale:A.j,score:s.lfc})}),Object(x.jsx)(b.a,{popoverClassName:m.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(x.jsx)(d.d,{elevation:F.a.ZERO,children:Object(x.jsxs)("table",{children:[Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{}),Object(x.jsx)("th",{scope:"col",children:t[N][s.row]}),Object(x.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(x.jsx)("td",{children:s.delta.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",U[0].toFixed(2),", ",U[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Detected"}),Object(x.jsx)("td",{children:s.detected.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ie[0].toFixed(2),", ",ie[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Log-FC"}),Object(x.jsx)("td",{children:s.lfc.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",J[0].toFixed(2),", ",J[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Expression"}),Object(x.jsx)("td",{children:s.mean.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",G[0].toFixed(2),", ",G[1].toFixed(2),"]"]})]})]})}),children:Object(x.jsx)(te,{minmax:U,colorscale:A.j,score:s.delta})}),Object(x.jsx)(b.a,{popoverClassName:m.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(x.jsx)(d.d,{elevation:F.a.ZERO,children:Object(x.jsxs)("table",{children:[Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{}),Object(x.jsx)("th",{scope:"col",children:t[N][s.row]}),Object(x.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Expression"}),Object(x.jsx)("td",{children:s.mean.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",G[0].toFixed(2),", ",G[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Log-FC"}),Object(x.jsx)("td",{children:s.lfc.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",J[0].toFixed(2),", ",J[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(x.jsx)("td",{children:s.delta.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",U[0].toFixed(2),", ",U[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Detected"}),Object(x.jsx)("td",{children:s.detected.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ie[0].toFixed(2),", ",ie[1].toFixed(2),"]"]})]})]})}),children:Object(x.jsx)(ee,{minmax:G,colorscale:Ae,score:s.mean,colorscore:s.detected})}),Object(x.jsxs)("div",{className:"row-action",children:[Object(x.jsx)(d.a,{icon:l?"minus":"plus",small:!0,fill:!1,className:"row-action",onClick:function(){var e=Object(r.a)(a);e[s.index].expanded=!e[s.index].expanded,i(e),o||O(s.row)}}),Object(x.jsx)(d.a,{small:!0,fill:!1,className:"row-action",onClick:function(){s.index===g?y(null):(y(s.index),o||O(s.row))},children:Object(x.jsx)(d.o,{icon:"tint",color:s.index===g?String(c).startsWith("cs")?v[Math.max.apply(Math,Object(r.a)(null===n||void 0===n?void 0:n.clusters))+parseInt(c.replace("cs",""))]:v[c]:""})})]})]}),Object(x.jsx)(d.e,{isOpen:l,children:o&&Object(x.jsx)($,{data:o,color:String(c).startsWith("cs")?v[Math.max.apply(Math,Object(r.a)(null===n||void 0===n?void 0:n.clusters))+parseInt(c.replace("cs",""))]:v[c],clusterlabel:String(c).startsWith("cs")?"Custom Selection ".concat(c):"Cluster ".concat(parseInt(c+1)),clusters:I})})]})}}),Object(x.jsxs)("div",{className:"marker-footer",children:[Object(x.jsx)(d.m,{className:"marker-footer-title",children:"Filter Markers"}),Object(x.jsxs)("div",{className:"marker-filter-container",children:[Object(x.jsx)(d.H,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Log-FC"}),J&&Object(x.jsxs)("div",{className:"marker-slider-container",children:[Object(x.jsxs)("div",{className:"marker-filter-gradient",children:[Object(x.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, blue 33%, yellow 50%, red 100%)",width:"100%",height:"5px"}}),"\xa0"]}),Object(x.jsx)(d.C,{className:"marker-filter-slider",min:J[0],max:J[1],labelValues:J,stepSize:parseFloat((Math.abs(J[1]-J[0])/20).toFixed(2)),onChange:function(e){return Te(e,"lfc")},value:(null===Ce||void 0===Ce?void 0:Ce.lfc)?null===Ce||void 0===Ce?void 0:Ce.lfc:[0,J[1]],vertical:!1})]})]}),Object(x.jsxs)("div",{className:"marker-filter-container",children:[Object(x.jsx)(d.H,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"\u0394-detected"}),U&&Object(x.jsxs)("div",{className:"marker-slider-container",children:[Object(x.jsxs)("div",{className:"marker-filter-gradient",children:[Object(x.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, blue 33%, yellow 50%, red 100%)",width:"100%",height:"5px"}}),"\xa0"]}),Object(x.jsx)(d.C,{className:"marker-filter-slider",min:U[0],max:U[1],labelValues:U,stepSize:parseFloat((Math.abs(U[1]-U[0])/20).toFixed(2)),onChange:function(e){return Te(e,"delta")},value:(null===Ce||void 0===Ce?void 0:Ce.delta)?null===Ce||void 0===Ce?void 0:Ce.delta:[0,U[1]],vertical:!1})]})]}),Object(x.jsxs)("div",{className:"marker-filter-container",children:[Object(x.jsx)(d.H,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Mean"}),G&&Object(x.jsxs)("div",{className:"marker-slider-container",children:[Object(x.jsxs)("div",{className:"marker-filter-gradient",children:[Object(x.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, #F5F8FA, #2965CC)",width:"100%",height:"5px"}}),"\xa0"]}),Object(x.jsx)(d.C,{className:"marker-filter-slider",min:G[0],max:G[1],labelValues:G,stepSize:parseFloat((Math.abs(G[1]-G[0])/20).toFixed(2)),onChange:function(e){return Te(e,"mean")},value:(null===Ce||void 0===Ce?void 0:Ce.mean)?null===Ce||void 0===Ce?void 0:Ce.mean:G,vertical:!1})]})]}),Object(x.jsxs)("div",{className:"marker-filter-container",children:[Object(x.jsx)(d.H,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Detected"}),ie&&Object(x.jsx)("div",{className:"marker-slider-container",children:Object(x.jsx)(d.C,{className:"marker-filter-slider",min:ie[0],max:ie[1],labelValues:ie,stepSize:parseFloat((Math.abs(ie[1]-ie[0])/20).toFixed(2)),onChange:function(e){return Te(e,"detected")},value:(null===Ce||void 0===Ce?void 0:Ce.detected)?null===Ce||void 0===Ce?void 0:Ce.detected:ie,vertical:!1})})]})]})]}):""]})},ae=a.a.memo(se),ie=(n(325),n(326),function(){var e=Object(s.useRef)();return Object(s.useEffect)((function(){var t=e.current,n=0,s=1,a=2,i=3,c=4,l=[5,5,3,3,2],r=["#1abc9c","#2ecc71","#3498db","#e74c3c","#9b59b6"],o={new:function(e){return{width:18,height:18,x:this.canvas.width/2-9,y:this.canvas.height/2-9,moveX:n,moveY:n,speed:e||9}}},d={new:function(e){return{width:18,height:70,x:"left"===e?150:this.canvas.width-150,y:this.canvas.height/2-35,score:0,move:n,speed:10}}},u={initialize:function(){this.canvas=t.querySelector("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=1400,this.canvas.height=1e3,this.canvas.style.width=this.canvas.width/2+"px",this.canvas.style.height=this.canvas.height/2+"px",this.player=d.new.call(this,"left"),this.paddle=d.new.call(this,"right"),this.ball=o.new.call(this),this.paddle.speed=8,this.running=this.over=!1,this.turn=this.paddle,this.timer=this.round=0,this.color="#2c3e50",h.menu(),h.listen()},endGameMenu:function(e){h.context.font="50px Courier New",h.context.fillStyle=this.color,h.context.fillRect(h.canvas.width/2-350,h.canvas.height/2-48,700,100),h.context.fillStyle="#ffffff",h.context.fillText(e,h.canvas.width/2,h.canvas.height/2+15),setTimeout((function(){(h=Object.assign({},u)).initialize()}),3e3)},menu:function(){h.draw(),this.context.font="50px Courier New",this.context.fillStyle=this.color,this.context.fillRect(this.canvas.width/2-350,this.canvas.height/2-48,700,100),this.context.fillStyle="#ffffff",this.context.fillText("Press any key to begin",this.canvas.width/2,this.canvas.height/2+15)},update:function(){this.over||(this.ball.x<=0&&h._resetTurn.call(this,this.paddle,this.player),this.ball.x>=this.canvas.width-this.ball.width&&h._resetTurn.call(this,this.player,this.paddle),this.ball.y<=0&&(this.ball.moveY=a),this.ball.y>=this.canvas.height-this.ball.height&&(this.ball.moveY=s),this.player.move===s?this.player.y-=this.player.speed:this.player.move===a&&(this.player.y+=this.player.speed),h._turnDelayIsOver.call(this)&&this.turn&&(this.ball.moveX=this.turn===this.player?i:c,this.ball.moveY=[s,a][Math.round(Math.random())],this.ball.y=Math.floor(Math.random()*this.canvas.height-200)+200,this.turn=null),this.player.y<=0?this.player.y=0:this.player.y>=this.canvas.height-this.player.height&&(this.player.y=this.canvas.height-this.player.height),this.ball.moveY===s?this.ball.y-=this.ball.speed/1.5:this.ball.moveY===a&&(this.ball.y+=this.ball.speed/1.5),this.ball.moveX===i?this.ball.x-=this.ball.speed:this.ball.moveX===c&&(this.ball.x+=this.ball.speed),this.paddle.y>this.ball.y-this.paddle.height/2&&(this.ball.moveX===c?this.paddle.y-=this.paddle.speed/1.5:this.paddle.y-=this.paddle.speed/4),this.paddle.y<this.ball.y-this.paddle.height/2&&(this.ball.moveX===c?this.paddle.y+=this.paddle.speed/1.5:this.paddle.y+=this.paddle.speed/4),this.paddle.y>=this.canvas.height-this.paddle.height?this.paddle.y=this.canvas.height-this.paddle.height:this.paddle.y<=0&&(this.paddle.y=0),this.ball.x-this.ball.width<=this.player.x&&this.ball.x>=this.player.x-this.player.width&&this.ball.y<=this.player.y+this.player.height&&this.ball.y+this.ball.height>=this.player.y&&(this.ball.x=this.player.x+this.ball.width,this.ball.moveX=c),this.ball.x-this.ball.width<=this.paddle.x&&this.ball.x>=this.paddle.x-this.paddle.width&&this.ball.y<=this.paddle.y+this.paddle.height&&this.ball.y+this.ball.height>=this.paddle.y&&(this.ball.x=this.paddle.x-this.ball.width,this.ball.moveX=i)),this.player.score===l[this.round]?l[this.round+1]?(this.color=this._generateRoundColor(),this.player.score=this.paddle.score=0,this.player.speed+=.5,this.paddle.speed+=1,this.ball.speed+=1,this.round+=1):(this.over=!0,setTimeout((function(){h.endGameMenu("Winner!")}),1e3)):this.paddle.score===l[this.round]&&(this.over=!0,setTimeout((function(){h.endGameMenu("Game Over!")}),1e3))},draw:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.color,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle="#ffffff",this.context.fillRect(this.player.x,this.player.y,this.player.width,this.player.height),this.context.fillRect(this.paddle.x,this.paddle.y,this.paddle.width,this.paddle.height),h._turnDelayIsOver.call(this)&&this.context.fillRect(this.ball.x,this.ball.y,this.ball.width,this.ball.height),this.context.beginPath(),this.context.setLineDash([7,15]),this.context.moveTo(this.canvas.width/2,this.canvas.height-140),this.context.lineTo(this.canvas.width/2,140),this.context.lineWidth=10,this.context.strokeStyle="#ffffff",this.context.stroke(),this.context.font="100px Courier New",this.context.textAlign="center",this.context.fillText(this.player.score.toString(),this.canvas.width/2-300,200),this.context.fillText(this.paddle.score.toString(),this.canvas.width/2+300,200),this.context.font="30px Courier New",this.context.fillText("Round "+(h.round+1),this.canvas.width/2,35),this.context.font="40px Courier",this.context.fillText(l[h.round]?l[h.round]:l[h.round-1],this.canvas.width/2,100)},loop:function(){h.update(),h.draw(),h.over||requestAnimationFrame(h.loop)},listen:function(){document.addEventListener("keydown",(function(e){!1===h.running&&(h.running=!0,window.requestAnimationFrame(h.loop)),38!==e.keyCode&&87!==e.keyCode||(h.player.move=s),40!==e.keyCode&&83!==e.keyCode||(h.player.move=a)})),document.addEventListener("keyup",(function(e){h.player.move=n}))},_resetTurn:function(e,t){this.ball=o.new.call(this,this.ball.speed),this.turn=t,this.timer=(new Date).getTime(),e.score++},_turnDelayIsOver:function(){return(new Date).getTime()-this.timer>=1e3},_generateRoundColor:function(){var e=r[Math.floor(Math.random()*r.length)];return e===this.color?h._generateRoundColor():e}},h=Object.assign({},u);h.initialize()}),[]),Object(x.jsxs)("div",{ref:e,className:"pong-container",children:[Object(x.jsx)("canvas",{}),Object(x.jsxs)("p",{className:"credit",children:["Game Credits ",Object(x.jsx)("a",{href:"https://codepen.io/gdube/pen/JybxxZ",target:"_blank",children:"Pong Game"})]})]})}),ce=(n(327),function(){return Object(x.jsx)("div",{className:"dots-bars-5"})});function le(){var e=Object(s.useState)(!0),t=Object(o.a)(e,2),n=t[0],a=t[1],i=Object(s.useContext)(f),c=i.setWasmInitialized,u=i.setTsneData,h=i.setRedDims,j=i.redDims,b=i.setGenesInfo,p=i.setInitDims,m=i.setQcDims,O=i.defaultRedDims,v=i.setDefaultRedDims,g=i.setQcData,y=i.qcData,w=i.setClusterData,N=i.setFSelectionData,C=i.setUmapData,F=i.setPcaVarExp,k=i.logs,S=i.setLogs,E=i.selectedCluster,A=i.clusterRank,M=i.selectedClusterSummary,T=i.setSelectedClusterSummary,I=i.reqGene,q=i.customSelection,L=i.clusterData,R=i.delCustomSelection,B=i.setDelCustomSelection,P=i.setSelectedCluster,_=i.setShowGame,W=i.showGame,G=i.datasetName,z=i.setExportState,V=i.setShowAnimation,H=i.triggerAnimation,K=i.setTriggerAnimation,Q=i.params,X=i.setGeneColSel,J=i.setKanaIDBRecs,Z=i.setLoadParams,$=i.setInitLoadState,ee=i.setIndexedDBState;return Object(s.useEffect)((function(){window.scranWorker.postMessage({type:"INIT",msg:"Initial Load"})}),[]),Object(s.useEffect)((function(){if(null!==E){var e=String(E).startsWith("cs")?"getMarkersForSelection":"getMarkersForCluster";window.scranWorker.postMessage({type:e,payload:{cluster:E,rank_type:A}})}}),[E,A]),Object(s.useEffect)((function(){if(null!==q&&Object.keys(q).length>0){var e="cs".concat(Object.keys(q).length),t=q[e];window.scranWorker.postMessage({type:"computeCustomMarkers",payload:{selection:t,id:e}})}}),[q]),Object(s.useEffect)((function(){null!==R&&(window.scranWorker.postMessage({type:"removeCustomMarkers",payload:{id:R}}),B(null))}),[R]),Object(s.useEffect)((function(){null!==I&&window.scranWorker.postMessage({type:"getGeneExpression",payload:{gene:I}})}),[I]),Object(s.useEffect)((function(){H&&O&&window.scranWorker.postMessage({type:"animate"+O,payload:{params:Q[O.toLowerCase()]}})}),[H]),window.scranWorker.onmessage=function(e){var t=e.data;if(null===t||void 0===t?void 0:t.msg){var n=Object(r.a)(k),s=new Date;n.push("".concat(s.getHours()+":"+s.getMinutes()+":"+s.getSeconds()," - ").concat(null===t||void 0===t?void 0:t.type," - ").concat(null===t||void 0===t?void 0:t.msg)),S(n)}if("INIT"===t.type)a(!1),c(!0);else if("KanaDB_store"===t.type){var i=t.resp;i.length>0&&J(i),ee(!1)}else if("inputs_DATA"===t.type)p("".concat(t.resp.dimensions.num_genes," genes, ").concat(t.resp.dimensions.num_cells," cells")),b(t.resp.genes),X(Object.keys(t.resp.genes)[0]);else if("quality_control_metrics_DATA"===t.type){var o=t.resp;g(o)}else if("quality_control_thresholds_DATA"===t.type){var d=t.resp,x=Object(l.a)({},y);x.thresholds=d,g(x)}else if("quality_control_filtered_DATA"===t.type)m("".concat(t.resp.retained," cells"));else if("feature_selection_DATA"===t.type){var f=t.resp;N(f)}else if("pca_DATA"===t.type){var E=t.resp;F(E)}else if("snn_cluster_graph_DATA"===t.type){var D=t.resp;w(D),P(0)}else if("tsne_DATA"===t.type||"tsne_iter"===t.type){var A=t.resp;if(u(A),V(!0),"tsne_DATA"===t.type){var I=Object(r.a)(j);I.push("TSNE"),O||v("TSNE"),h(I),_(!1),V(!1),K(!1)}}else if("umap_DATA"===t.type||"umap_iter"===t.type){var q=t.resp;if(C(q),V(!0),"umap_DATA"===t.type){var L=Object(r.a)(j);L.push("UMAP"),h(L),V(!1),K(!1)}}else if("markerGene_DATA"===t.type);else if("setMarkersForCluster"===t.type||"setMarkersForCustomSelection"===t.type){var R=t.resp,B=[];R.means.forEach((function(e,t){var n,s,a,i;B.push({index:t,row:null===R||void 0===R||null===(n=R.ordering)||void 0===n?void 0:n[t],mean:e,delta:null===R||void 0===R||null===(s=R.delta_detected)||void 0===s?void 0:s[t],lfc:null===R||void 0===R||null===(a=R.lfc)||void 0===a?void 0:a[t],detected:null===R||void 0===R||null===(i=R.detected)||void 0===i?void 0:i[t],expanded:!1,expr:null})})),T(B)}else if("setGeneExpression"===t.type){for(var W=t.resp,H=Object(r.a)(M),U=0;U<H.length;U++)if(W.gene===H[U].row){H[U].expr=Object.values(W.expr);break}T(H)}else if("exportState"===t.type){var Q=t.resp,Y=document.createElement("a"),te=new Blob([Q],{type:"text/plain"});Y.href=URL.createObjectURL(te),Y.download=G.split(" ").join("_")+".kana",Y.click(),z(!1)}else if("KanaDB"===t.type)ee(!1);else if("loadedParameters"===t.type){var ne=t.resp;Z(ne.params),setTimeout((function(){$(!1)}),1e3)}},Object(x.jsxs)("div",{className:"App",children:[Object(x.jsx)(D,{}),Object(x.jsxs)("div",{className:"App-content",children:[Object(x.jsx)("div",{className:"plot",children:O?Object(x.jsx)(Y,{}):W?Object(x.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:"50px"},children:[Object(x.jsx)(d.q,{children:"Get some coffee or play pong while you wait for the analysis to finish.."}),Object(x.jsx)(d.a,{onClick:function(){_(!1)},children:"I'm good, go back"}),Object(x.jsx)(ie,{})]}):Object(x.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:"50px"},children:[Object(x.jsx)(ce,{}),Object(x.jsx)(d.q,{children:"Get some coffee or play pong while you wait for the analysis to finish.."}),Object(x.jsx)(d.a,{onClick:function(){_(!0)},children:"Play Pong"})]})}),Object(x.jsx)("div",{className:"marker",children:L?Object(x.jsx)(ae,{}):Object(x.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[Object(x.jsx)(ce,{}),Object(x.jsx)(d.q,{children:"Generating nearest neighbor graph to compute clusters...."})]})}),Object(x.jsx)("div",{className:"analysis",children:Object(x.jsx)(U,{})})]}),Object(x.jsx)(d.y,Object(l.a)(Object(l.a)({isOpen:n},{autoFocus:!0,canEscapeKeyClose:!1,canOutsideClickClose:!1,enforceFocus:!0,hasBackdrop:!0,usePortal:!0,useTallContent:!1}),{},{children:Object(x.jsxs)("div",{className:"spinner",children:[Object(x.jsx)(d.D,{size:100}),Object(x.jsx)("p",{children:"Initializing kana"})]})}))]})}var re=a.a.memo(le),oe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,337)).then((function(t){var n=t.getCLS,s=t.getFID,a=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),s(e),a(e),i(e),c(e)}))};c.a.render(Object(x.jsx)(g,{children:Object(x.jsx)(re,{})}),document.getElementById("root")),oe()}},[[328,1,2]]]);
//# sourceMappingURL=main.4ee08021.chunk.js.map