!function(){"use strict";var e={2459:function(e,n,r){var t={};r.r(t),r.d(t,{changed:function(){return D},compute:function(){return W},fetchAnnotations:function(){return Y},fetchCountMatrix:function(){return J},fetchDimensions:function(){return $},fetchGenes:function(){return X},results:function(){return V},serialize:function(){return Q},unserialize:function(){return H}});var a={};r.r(a),r.d(a,{changed:function(){return te},compute:function(){return ie},fetchQCMetrics:function(){return fe},fetchSums:function(){return le},results:function(){return oe},serialize:function(){return ue},unserialize:function(){return ce}});var s={};r.r(s),r.d(s,{changed:function(){return me},compute:function(){return he},fetchDiscards:function(){return we},fetchDiscardsAsWasmArray:function(){return be},results:function(){return ye},serialize:function(){return ve},unserialize:function(){return ge}});var i={};r.r(i),r.d(i,{changed:function(){return _e},compute:function(){return Ee},fetchFilteredMatrix:function(){return Ae},fetchRetained:function(){return Oe},results:function(){return ke},serialize:function(){return Ne},unserialize:function(){return Te}});var o={};r.r(o),r.d(o,{changed:function(){return Ue},compute:function(){return Ce},fetchExpression:function(){return Fe},fetchNormalizedMatrix:function(){return Pe},results:function(){return Ze},serialize:function(){return je},unserialize:function(){return De}});var u={};r.r(u),r.d(u,{changed:function(){return Ie},compute:function(){return Ke},fetchResiduals:function(){return He},fetchSortedResiduals:function(){return Qe},results:function(){return Le},serialize:function(){return We},unserialize:function(){return Ve}});var c={};r.r(c),r.d(c,{changed:function(){return Xe},compute:function(){return en},fetchPCs:function(){return an},results:function(){return nn},serialize:function(){return rn},unserialize:function(){return tn}});var f={};r.r(f),r.d(f,{changed:function(){return un},compute:function(){return fn},fetchIndex:function(){return mn},rawCompute:function(){return cn},results:function(){return ln},serialize:function(){return dn},unserialize:function(){return pn}});var l={};r.r(l),r.d(l,{changed:function(){return vn},compute:function(){return bn},fetchNeighbors:function(){return _n},rawCompute:function(){return gn},results:function(){return wn},serialize:function(){return Sn},unserialize:function(){return xn}});var d={};r.r(d),r.d(d,{changed:function(){return kn},compute:function(){return Tn},fetchGraph:function(){return Gn},results:function(){return An},serialize:function(){return On},unserialize:function(){return zn}});var p={};r.r(p),r.d(p,{changed:function(){return Cn},compute:function(){return jn},fetchClustersAsWasmArray:function(){return Zn},results:function(){return Dn},serialize:function(){return Pn},unserialize:function(){return Fn}});var m={};r.r(m),r.d(m,{changed:function(){return In},compute:function(){return Kn},fetchClustersAsWasmArray:function(){return Qn},results:function(){return Ln},serialize:function(){return Wn},unserialize:function(){return Vn}});var h={};r.r(h),r.d(h,{animate:function(){return lr},changed:function(){return ar},compute:function(){return ir},initialize:function(){return tr},results:function(){return or},serialize:function(){return ur},unserialize:function(){return fr}});var y={};r.r(y),r.d(y,{animate:function(){return _r},changed:function(){return yr},compute:function(){return gr},initialize:function(){return hr},results:function(){return br},serialize:function(){return wr},unserialize:function(){return xr}});var v={};r.r(v),r.d(v,{changed:function(){return Tr},compute:function(){return Ar},fetchGroupResults:function(){return Ur},results:function(){return Or},serialize:function(){return zr},unserialize:function(){return Gr}});var g={};r.r(g),r.d(g,{addSelection:function(){return qr},changed:function(){return jr},compute:function(){return Dr},fetchResults:function(){return Kr},removeSelection:function(){return Ir},results:function(){return Pr},serialize:function(){return Fr},unserialize:function(){return Br}});var b=r(5861),w=r(1413),S=r(7757),x=r.n(S),_=r(9451),M=r(7762),E=r(3324);function k(e){void 0!==e&&null!==e&&e.free()}function N(e){if("reloaded"in e){for(var n=0,r=Object.entries(e.reloaded);n<r.length;n++){var t=(0,E.Z)(r[n],2),a=(t[0],t[1]);a instanceof _.PQ&&a.free()}delete e.reloaded}}function T(e,n){return JSON.stringify(e)!=JSON.stringify(n)}function A(e){var n=-1/0,r=1/0;return e.forEach((function(e){n<e&&(n=e),r>e&&(r=e)})),[r,n]}function O(e,n,r){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"buffer",a=!0;if(t in r){var s=r[t];s.size!=e||s.constructor.className!=n?s.free():a=!1}if(a)switch(n){case"Uint8Array":r[t]=new _.yh(e);break;case"Int32Array":r[t]=new _.do(e);break;case"Float64Array":r[t]=new _.lt(e);break;default:throw"allocating '"+n+"' not yet supported"}return r[t]}function z(e,n){if(Array.isArray(e)){var r,t=(0,M.Z)(e);try{for(t.s();!(r=t.n()).done;){z(r.value,n)}}catch(o){t.e(o)}finally{t.f()}}else if(e.constructor==Object)for(var a=0,s=Object.entries(e);a<s.length;a++){var i=(0,E.Z)(s[a],2);i[0];z(i[1],n)}else if(ArrayBuffer.isView(e)){if(!(e.buffer instanceof ArrayBuffer))throw"only ArrayBuffers should be in the message payload";n.push(e.buffer)}}var G=r(9842),U=r(1414),R=r(8308),C={},Z={},j={},D=!1;function P(e){var n=new _.do(C.matrix.numberOfRows());try{C.matrix.permutation({buffer:n});for(var r=n.array(),t=0,a=Object.entries(e);t<a.length;t++){for(var s=(0,E.Z)(a[t],2),i=s[0],o=s[1],u=o.slice(),c=0;c<r.length;c++)u[r[c]]=o[c];e[i]=u}}finally{n.free()}}function F(e){for(var n=[],r=0;r<e;r++)n.push("Gene ".concat(r+1));return{id:n}}function B(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"\t",t=n.name.split(".").pop();"gz"==t&&(e=R.ec(e));var a=new TextDecoder,s=a.decode(e),i=U.Z(r),o=i.parseRows(s);return o}function q(e){k(C.matrix);var n=e.filter((function(e){return"mtx"==e.type}))[0],r=new Uint8Array(n.buffer),t="gz"==n.name.split(".").pop();if(C.matrix=_.DK(r,{compressed:t}),1==(a=e.filter((function(e){return"genes"==e.type}))).length){var a=a[0],s=B(new Uint8Array(a.buffer),a);if(s.length!=C.matrix.numberOfRows())throw"number of matrix rows is not equal to the number of genes in '"+a.name+"'";var i=[],o=[];s.forEach((function(e){i.push(e[0]),o.push(e[1])})),C.genes={id:i,symbol:o}}else C.genes=F(C.matrix.numberOfRows());if(P(C.genes),1==(u=e.filter((function(e){return"annotations"==e.type}))).length){var u=u[0],c=B(new Uint8Array(u.buffer),u),f=C.matrix.numberOfColumns()-c.length,l=!1;if(0===f)l=!1;else{if(-1!==f)throw"number of annotations rows is not equal to the number of cells in '"+u.name+"'";l=!0}var d=[];l?d=c.shift():c[0].forEach((function(e,n){d.push("Column_".concat(n+1))})),C.annotations={},d.forEach((function(e,n){C.annotations[e]=c.map((function(e){return e[n]}))}))}else C.annotations=null}function I(e){var n=function(e){if(-1==e.keys().indexOf("var"))return null;var n=e.get("var");if(!(n instanceof G.ZA))return null;var r=n.keys();if(-1==r.indexOf("_index"))return null;var t=n.get("_index");if(!(t instanceof G.qz))return null;var a,s={_index:t.value},i=(0,M.Z)(r);try{for(i.s();!(a=i.n()).done;){var o=a.value;if("_index"!=o&&(o.match(/name/i)||o.match(/symbol/i))){var u=n.get(o);u instanceof G.qz&&(s[field]=u.value)}}}catch(c){i.e(c)}finally{i.f()}return s}(e);if(null!==n)return n;var r=function(e){if(-1==e.keys().indexOf("matrix"))return null;var n=e.get("matrix");if(!(n instanceof G.ZA))return null;if(-1==n.keys().indexOf("features"))return null;var r=n.get("features");if(!(r instanceof G.ZA))return null;var t=r.keys();if(-1==t.indexOf("id"))return null;var a=r.get("id");if(!(a instanceof G.qz))return null;var s={id:a.value};if(-1!=t.indexOf("name")){var i=r.get("name");i instanceof G.qz&&(s.name=i.value)}return s}(e);return null!==r?r:null}function K(e){var n=function(e){if(-1==e.keys().indexOf("obs"))return null;var n=e.get("obs");if(n instanceof G.qz){var r,t,a,s=null===(r=n.dtype)||void 0===r||null===(t=r.compound)||void 0===t||null===(a=t.members)||void 0===a?void 0:a.map((function(e){return e.name})),i=n.value,o={};return s.forEach((function(e,n){o[e]=i.map((function(e){return e[n]}))})),o}return null}(e);return null!==n?n:null}function L(e){k(C.matrix);var n=e[0],r="rabbit-temp.h5";try{G.FS.writeFile(r,new Uint8Array(n.buffer));var t=new G.$B(r,"r");try{var a=function(e){var n=e.keys();if(-1!=n.indexOf("X"))return"X";if(-1!=n.indexOf("matrix"))return"matrix";var r,t=[],a=[],s=(0,M.Z)(n);try{for(s.s();!(r=s.n()).done;){var i=r.value,o=e.get(i);if(o instanceof G.ZA){var u=o.keys();-1!=u.indexOf("data")&&u.indexOf("indices")&&u.indexOf("indptr")&&t.push(i)}else o instanceof G.qz&&2==o.shape.length&&a.push(i)}}catch(c){s.e(c)}finally{s.f()}if(t.length)return t[0];if(a.length)return a[0];throw"could not automatically find a suitable 'path' inside the HDF5 file"}(t);C.matrix=_.sT(t,a),C.genes=I(t),C.annotations=K(t)}finally{t.close()}}finally{G.FS.unlink(r)}null===C.genes&&(C.genes=F(C.matrix.numberOfRows())),P(C.genes)}function W(e){switch(e.format){case"mtx":!function(e){for(var n=new FileReaderSync,r=0;r<2;r++){var t,a={type:"MatrixMarket",files:[]};t=0==r?function(e){return e.size}:function(e){return n.readAsArrayBuffer(e)};var s,i=(0,M.Z)(e.mtx);try{for(i.s();!(s=i.n()).done;){var o=s.value;a.files.push({type:"mtx",name:o.name,buffer:t(o)})}}catch(f){i.e(f)}finally{i.f()}if(null!==e.gene){if(1!==e.gene.length)throw"expected no more than one gene file";var u=e.gene[0];a.files.push({type:"genes",name:u.name,buffer:t(u)})}if(null!==e.barcode){if(1!==e.barcode.length)throw"expected no more than one cell annotation file";var c=e.barcode[0];a.files.push({type:"annotations",name:c.name,buffer:t(c)})}if(0==r){if(!T(j,a))return void(D=!1);j=a,D=!0}else Z=a,q(a.files),delete C.reloaded}}(e.files);break;case"hdf5":case"tenx":case"h5ad":!function(e){for(var n=new FileReaderSync,r=0;r<2;r++){var t,a={type:"HDF5",files:[]};t=0==r?function(e){return e.size}:function(e){return n.readAsArrayBuffer(e)};var s,i=(0,M.Z)(e.file);try{for(i.s();!(s=i.n()).done;){var o=s.value;a.files.push({type:"h5",name:o.name,buffer:t(o)})}}catch(u){i.e(u)}finally{i.f()}if(0==r){if(!T(j,a))return void(D=!1);j=a,D=!0}else Z=a,L(a.files),delete C.reloaded}}(e.files);break;case"kana":break;default:throw"unknown matrix file extension: '"+e.format+"'"}}function V(){var e={dimensions:$()};return"reloaded"in C?(e.genes=(0,w.Z)({},C.reloaded.genes),C.annotations&&(e.annotations=Object.keys(C.reloaded.annotations))):(e.genes=(0,w.Z)({},C.genes),C.annotations&&(e.annotations=Object.keys(C.annotations))),e}function Q(){var e={};"reloaded"in C?(e.genes=(0,w.Z)({},C.reloaded.genes),e.num_cells=C.reloaded.num_cells,C.reloaded.annotations&&(e.annotations=C.reloaded.annotations)):(e.genes=(0,w.Z)({},C.genes),e.num_cells=C.matrix.numberOfColumns(),C.annotations&&(e.annotations=C.annotations));var n=(0,w.Z)({},Z);return n.files=Z.files.map((function(e){return(0,w.Z)({},e)})),{parameters:n,contents:e}}function H(e){Z=e.parameters,C.reloaded=e.contents}function J(){if("reloaded"in C)if("MatrixMarket"==Z.type)q(Z.files);else{if("HDF5"!=Z.type)throw"unrecognized count matrix format, ".concat(Z.type);L(Z.files)}return C.matrix}function $(){return"reloaded"in C?{num_genes:Object.values(C.reloaded.genes)[0].length,num_cells:C.reloaded.num_cells}:{num_genes:C.matrix.numberOfRows(),num_cells:C.matrix.numberOfColumns()}}function X(){return"reloaded"in C?C.reloaded.genes:C.genes}function Y(e){var n,r;if("reloaded"in C?(n=C.reloaded.annotations,r=C.reloaded.matrix.numberOfColumns()):(n=C.annotations,r=C.matrix.numberOfColumns()),!(e in n))throw"column ".concat(e," does not exist in col.tsv");var t={},a=new Uint8Array(r);return n[e].map((function(e,n){e in t||(t[e]=Object.keys(t).length),a[n]=t[e]})),{index:Object.keys(t),factor:a}}var ee={};ee.ensembl=new Set(["ENSMUSG00000064336","ENSMUSG00000064337","ENSMUSG00000064338","ENSMUSG00000064339","ENSMUSG00000064340","ENSMUSG00000064341","ENSMUSG00000064342","ENSMUSG00000064343","ENSMUSG00000064344","ENSMUSG00000064345","ENSMUSG00000064346","ENSMUSG00000064347","ENSMUSG00000064348","ENSMUSG00000064349","ENSMUSG00000064350","ENSMUSG00000064351","ENSMUSG00000064352","ENSMUSG00000064353","ENSMUSG00000064354","ENSMUSG00000064355","ENSMUSG00000064356","ENSMUSG00000064357","ENSMUSG00000064358","ENSMUSG00000064359","ENSMUSG00000064360","ENSMUSG00000064361","ENSMUSG00000064363","ENSMUSG00000064364","ENSMUSG00000064365","ENSMUSG00000064366","ENSMUSG00000064367","ENSMUSG00000064368","ENSMUSG00000064369","ENSMUSG00000064370","ENSMUSG00000064371","ENSMUSG00000064372","ENSMUSG00000065947","ENSG00000198695","ENSG00000198712","ENSG00000198727","ENSG00000198763","ENSG00000198786","ENSG00000198804","ENSG00000198840","ENSG00000198886","ENSG00000198888","ENSG00000198899","ENSG00000198938","ENSG00000209082","ENSG00000210049","ENSG00000210077","ENSG00000210082","ENSG00000210100","ENSG00000210107","ENSG00000210112","ENSG00000210117","ENSG00000210127","ENSG00000210135","ENSG00000210140","ENSG00000210144","ENSG00000210151","ENSG00000210154","ENSG00000210156","ENSG00000210164","ENSG00000210174","ENSG00000210176","ENSG00000210184","ENSG00000210191","ENSG00000210194","ENSG00000210195","ENSG00000210196","ENSG00000211459","ENSG00000212907","ENSG00000228253"]),ee.symbol=new Set(["mt-Tf","mt-Rnr1","mt-Tv","mt-Rnr2","mt-Tl1","mt-Nd1","mt-Ti","mt-Tq","mt-Tm","mt-Nd2","mt-Tw","mt-Ta","mt-Tn","mt-Tc","mt-Ty","mt-Co1","mt-Ts1","mt-Td","mt-Co2","mt-Tk","mt-Atp8","mt-Atp6","mt-Co3","mt-Tg","mt-Nd3","mt-Tr","mt-Nd4","mt-Th","mt-Ts2","mt-Tl2","mt-Nd5","mt-Nd6","mt-Te","mt-Cytb","mt-Tt","mt-Tp","mt-Nd4l","MT-ND6","MT-CO2","MT-CYB","MT-ND2","MT-ND5","MT-CO1","MT-ND3","MT-ND4","MT-ND1","MT-ATP6","MT-CO3","MT-TL1","MT-TF","MT-TV","MT-RNR2","MT-TI","MT-TQ","MT-TM","MT-TW","MT-TA","MT-TN","MT-TC","MT-TY","MT-TS1","MT-TD","MT-TK","MT-TG","MT-TR","MT-TH","MT-TS2","MT-TL2","MT-TE","MT-TT","MT-TP","MT-RNR1","MT-ND4L","MT-ATP8"]);var ne={},re={},te=!1;function ae(e){k(ne.raw);var n=O(1*(c=J()).numberOfRows(),"Uint8Array",ne);n.fill(0);for(var r=X(),t=n.array(),a=0,s=Object.entries(r);a<s.length;a++){var i=(0,E.Z)(s[a],2),o=(i[0],i[1]);if(e.use_mito_default)o.forEach((function(e,n){(ee.symbol.has(e)||ee.ensembl.has(e))&&(t[n]=1)}));else{var u=e.mito_prefix.toLowerCase();o.forEach((function(e,n){e.toLowerCase().startsWith(u)&&(t[n]=1)}))}}var c=J();ne.raw=_.i4(c,n),delete ne.reloaded}function se(){var e={};if("reloaded"in ne){var n=ne.reloaded;e.sums=n.sums.slice(),e.detected=n.detected.slice(),e.proportion=n.proportion.slice()}else{n=ne.raw;e.sums=n.sums(),e.detected=n.detected(),e.proportion=n.subsetProportions(0)}return e}function ie(e){D||T(re,e)?(ae(e),re=e,te=!0):te=!1}function oe(){var e=se(),n={};return n.sums=A(e.sums),n.detected=A(e.detected),n.proportion=A(e.proportion),{data:e,ranges:n}}function ue(){return{parameters:re,contents:se()}}function ce(e){re=e.parameters,ne.reloaded=e.contents}function fe(){return"reloaded"in ne&&ae(),ne.raw}function le(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.unsafe,r=void 0===n||n;return"reloaded"in ne?ne.reloaded.sums:ne.raw.sums({copy:!r})}var de={},pe={},me=!1;function he(e){if(te||T(pe,e)){k(de.raw);var n=fe();de.raw=_.rU(n,{numberOfMADs:e.nmads}),N(de),me=!0,pe=e}else me=!1}function ye(){var e;if("reloaded"in de)e={sums:de.reloaded.sums,detected:de.reloaded.detected,proportion:de.reloaded.proportion};else{var n=de.raw;e={sums:n.thresholdsSums()[0],detected:n.thresholdsDetected()[0],proportion:n.thresholdsSubsetProportions(0)[0]}}return e}function ve(){var e=ye();return e.discards=we(),{parameters:pe,contents:e}}function ge(e){pe=e.parameters,N(de),de.reloaded=e.contents;var n=new _.yh(de.reloaded.discards.length);n.set(de.reloaded.discards),de.reloaded.discards=n}function be(){if("reloaded"in de)return de.reloaded.discards;var e=de.raw.discardOverall({copy:!1});return new _.yh(e.length,e.byteOffset)}function we(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.unsafe,t=void 0!==r&&r;return e="reloaded"in de?de.reloaded.discards.array():de.raw.discardOverall(),t?e:e.slice()}var Se={},xe={},_e=!1;function Me(){k(Se.matrix);var e=J(),n=be();Se.matrix=_.b_(e,n),delete Se.reloaded}function Ee(e){D||me||T(xe,e)?(Me(),xe=e,_e=!0):_e=!1}function ke(){return{retained:Oe()}}function Ne(){return{parameters:xe,contents:ke()}}function Te(e){xe=e.parameters,Se.reloaded=e.contents;var n,r=we({unsafe:!0}),t=0,a=(0,M.Z)(r);try{for(a.s();!(n=a.n()).done;){0==n.value&&t++}}catch(s){a.e(s)}finally{a.f()}Se.reloaded.retained=t}function Ae(){return"reloaded"in Se&&Me(),Se.matrix}function Oe(){return"reloaded"in Se?Se.reloaded.retained:Se.matrix.numberOfColumns()}var ze={},Ge={},Ue=!1;function Re(){for(var e=Ae(),n=O(e.numberOfColumns(),"Float64Array",ze),r=le({unsafe:!0}),t=we({unsafe:!0}),a=n.array(),s=0,i=0;i<t.length;++i)t[i]||(a[s]=r[i],s++);if(s!=e.numberOfColumns())throw"normalization and filtering are not in sync";k(ze.matrix),ze.matrix=_.gk(e,{sizeFactors:n}),delete ze.reloaded}function Ce(e){te||_e||T(Ge,e)?(Re(),Ge=e,Ue=!0):Ue=!1}function Ze(){return{}}function je(){return{parameters:Ge,contents:{}}}function De(e){Ge=e.parameters,ze.reloaded=e.contents}function Pe(){return"reloaded"in ze&&Re(),ze.matrix}function Fe(e){var n=Pe(),r=O(n.numberOfColumns(),"Float64Array",ze);return n.row(e,{buffer:r}),r.slice()}var Be={},qe={},Ie=!1;function Ke(e){if(Ue||T(qe,e)){var n=Pe();Be.raw=_.rY(n,{span:e.span}),Be.sorted_residuals=Be.raw.residuals().slice(),Be.sorted_residuals.sort(),qe=e,delete Be.reloaded,Ie=!0}else Ie=!1}function Le(){return"reloaded"in Be?{means:Be.reloaded.means.slice(),vars:Be.reloaded.vars.slice(),fitted:Be.reloaded.fitted.slice(),resids:Be.reloaded.resids.slice()}:function(){var e=Be.raw;return{means:e.means(),vars:e.variances(),fitted:e.fitted(),resids:e.residuals()}}()}function We(){return{parameters:qe,contents:Le()}}function Ve(e){qe=e.parameters,Be.reloaded=e.contents,Be.sorted_residuals=Be.reloaded.resids.slice(),Be.sorted_residuals.sort()}function Qe(){return Be.sorted_residuals}function He(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.unsafe,r=void 0!==n&&n;return"reloaded"in Be?Be.reloaded.resids:Be.raw.residuals({copy:!r})}var Je={},$e={},Xe=!1;function Ye(){if("reloaded"in Je)return Je.reloaded.pcs;var e=Je.raw.principalComponents({copy:!1});return new _.lt(e.length,e.byteOffset)}function en(e){if(Ue||Ie||T($e,e)){var n=Qe(),r=n[n.length-e.num_hvgs],t=Pe(),a=O(t.numberOfRows(),"Uint8Array",Je),s=He({unsafe:!0});a.array().forEach((function(e,n,t){t[n]=s[n]>=r})),k(Je.raw),Je.raw=_.dO(t,{features:a,numberOfPCs:e.num_pcs}),N(Je),Xe=!0,$e=e}else Xe=!1}function nn(){var e;if("reloaded"in Je)e=Je.reloaded.var_exp.slice();else{var n=Je.raw;e=n.varianceExplained();var r=n.totalVariance();e.forEach((function(n,t){e[t]=n/r}))}return{var_exp:e}}function rn(){var e=nn();return e.pcs=Ye().slice(),{parameters:$e,contents:e}}function tn(e){$e=e.parameters,N(Je),Je.reloaded=e.contents;var n=new _.lt(Je.reloaded.pcs.length);n.set(Je.reloaded.pcs),Je.reloaded.pcs=n}function an(){var e=Ye();return{pcs:e,num_pcs:$e.num_pcs,num_obs:e.length/$e.num_pcs}}var sn={},on={},un=!1;function cn(e){k(sn.raw);var n=an();sn.raw=_.Fu(n.pcs,{numberOfDims:n.num_pcs,numberOfCells:n.num_obs}),delete sn.reloaded}function fn(e){Xe||T(on,e)?(cn(),on=e,un=!0):un=!1}function ln(){return{}}function dn(){return{parameters:on,contents:{}}}function pn(e){on=e.parameters,sn.reloaded=e.contents}function mn(){return"reloaded"in sn&&cn(),sn.raw}var hn={},yn={},vn=!1;function gn(e){k(hn.raw);var n=mn();hn.raw=_.wf(n,e.k),delete hn.reloaded}function bn(e){un||T(yn,e)?(gn(e),yn=e,vn=!0):vn=!1}function wn(){return{}}function Sn(){return{parameters:yn,contents:{}}}function xn(e){yn=e.parameters,hn.reloaded=e.contents}function _n(){return"reloaded"in hn&&gn(yn),hn.raw}var Mn={},En={},kn=!1;function Nn(e){k(Mn.raw);var n=_n();Mn.raw=_.bD(n,{scheme:e.scheme}),delete Mn.reloaded}function Tn(e){vn||T(En,e)?(Nn(e),En=e,kn=!0):kn=!1}function An(){return{}}function On(){return{parameters:En,contents:{}}}function zn(e){En=e.parameters,Mn.reloaded=e.contents}function Gn(){return"reloaded"in Mn&&Nn(En),Mn.raw}var Un={},Rn={},Cn=!1;function Zn(){if("reloaded"in Un)return Un.reloaded.clusters;var e=Un.raw.membership({copy:!1});return new _.do(e.length,e.byteOffset)}function jn(e){if(kn||T(Rn,e)){k(Un.raw);var n=Gn();Un.raw=_.ZI(n,{resolution:e.resolution}),Rn=e,Cn=!0,N(Un)}else Cn=!1}function Dn(){return{clusters:Zn().slice()}}function Pn(){return{parameters:Rn,contents:Dn()}}function Fn(e){Rn=e.parameters,N(Un),Un.reloaded=e.contents;var n=new _.do(Un.reloaded.clusters.length);n.set(Un.reloaded.clusters),Un.reloaded.clusters=n}var Bn={},qn={},In=!1;function Kn(e){In=!0,T(qn,e)||"snn_graph"!=e.method||Cn||(In=!1),In&&(delete Bn.reloaded,qn=e,In=!0)}function Ln(){return{}}function Wn(){return{parameters:qn,contents:{}}}function Vn(e){qn=e.parameters,Bn.reloaded=e.contents}function Qn(){return Zn()}function Hn(e){var n=mn(),r={num_obs:n.numberOfCells()},t=null,a=null,s=null,i=null;try{t=_.wf(n,e),a=new _.do(t.numberOfCells()),s=new _.do(t.size()),i=new _.lt(t.size()),t.serialize({runs:a,indices:s,distances:i}),r.size=t.size(),r.runs=a.array().slice(),r.indices=s.array().slice(),r.distances=i.array().slice()}finally{null!==t&&t.free(),null!==a&&a.free(),null!==s&&s.free(),null!==i&&i.free()}return r}function Jn(e,n,r){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=r.counter,s=new Promise((function(e,n){r.promises[a]={resolve:e,reject:n}}));return r.counter++,n.id=a,e.postMessage(n,t),s}function $n(e,n){return e.onmessage=function(e){var r=e.data.type;if(r.endsWith("_iter"))postMessage({type:r,resp:{x:e.data.x,y:e.data.y,iteration:e.data.iteration}},[e.data.x.buffer,e.data.y.buffer]);else{var t=e.data.id,a=n.promises[t];"error"==r?a.reject(e.data.error):a.resolve(e.data.data),delete n.promises[t]}},Jn(e,{cmd:"INIT"},n)}function Xn(e,n,r,t){var a={cmd:"RUN",params:n},s=[];return null!==r&&(a.neighbors=r,z(r,s)),Jn(e,a,t,s)}function Yn(e,n){if("reloaded"in n){var r=(0,w.Z)({},n.reloaded);return r.x=r.x.slice(),r.y=r.y.slice(),new Promise((function(e){return e(r)}))}return n.run.then((function(r){return Jn(e,{cmd:"FETCH"},n)}))}var er={counter:0,promises:{}},nr={},rr=null;function tr(){return $n(rr=new Worker(new URL(r.p+r.u(139),r.b),{type:void 0}),er)}var ar=!1;function sr(e,n){var r=null;n&&(r=Hn(_.Tk(e.perplexity)));er.run=Xn(rr,e,r,er)}function ir(e){un||T(nr,e)?(sr(e,un||T(nr.perplexity,e.perplexity)),nr=e,delete er.reloaded,ar=!0):ar=!1}function or(){return Yn(rr,er)}function ur(){return cr.apply(this,arguments)}function cr(){return(cr=(0,b.Z)(x().mark((function e(){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Yn(rr,er);case 2:return n=e.sent,e.abrupt("return",{parameters:nr,contents:n});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fr(e){nr=e.parameters,er.reloaded=e.contents}function lr(){if("reloaded"in er){var e=(0,w.Z)({},nr);return e.animate=!0,sr(e,!0),delete er.reloaded,er.run.then((function(e){return{type:"tsne_rerun",data:{status:"SUCCESS"}}}))}return Jn(rr,{cmd:"RERUN"},er)}var dr={counter:0,promises:{}},pr={},mr=null;function hr(){mr=new Worker(new URL(r.p+r.u(653),r.b),{type:void 0}),dr.initialized=$n(mr,dr)}var yr=!1;function vr(e,n){var r=null;n&&(r=Hn(e.num_neighbors)),dr.run=Xn(mr,e,r,dr)}function gr(e){un||T(pr,e)?(vr(e,un||T(pr.num_neighbors,e.num_neighbors)),pr=e,delete dr.reloaded,yr=!0):yr=!1}function br(){return Yn(mr,dr)}function wr(){return Sr.apply(this,arguments)}function Sr(){return(Sr=(0,b.Z)(x().mark((function e(){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Yn(mr,dr);case 2:return n=e.sent,e.abrupt("return",{parameters:pr,contents:n});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xr(e){pr=e.parameters,dr.reloaded=e.contents}function _r(){if("reloaded"in dr){var e=(0,w.Z)({},pr);return e.animate=!0,vr(e,!0),delete dr.reloaded,dr.run.then((function(e){return{type:"umap_rerun",data:{status:"SUCCESS"}}}))}return Jn(mr,{cmd:"RERUN"},dr)}function Mr(e,n){return{means:e.means(n),detected:e.detected(n),lfc:{min:e.lfc(n,{summary:0}),mean:e.lfc(n,{summary:1}),"min-rank":e.lfc(n,{summary:4})},delta_detected:{min:e.deltaDetected(n,{summary:0}),mean:e.deltaDetected(n,{summary:1}),"min-rank":e.deltaDetected(n,{summary:4})},cohen:{min:e.cohen(n,{summary:0}),mean:e.cohen(n,{summary:1}),"min-rank":e.cohen(n,{summary:4})},auc:{min:e.auc(n,{summary:0}),mean:e.auc(n,{summary:1}),"min-rank":e.auc(n,{summary:4})}}}function Er(e,n,r,t){r&&void 0!==r||(r="cohen-min-rank");var a,s,i=void 0!==n,o=!1;if(i){var u,c="mean";if(r.match(/-min$/)?c="min":r.match(/-min-rank$/)&&(o=!0,c="min-rank"),r.match(/^cohen-/))u="cohen";else if(r.match(/^auc-/))u="auc";else if(r.match(/^lfc-/))u="lfc";else{if(!r.match(/^delta-d-/))throw"unknown rank type '"+r+"'";u="delta_detected"}s=n[t][u][c]}else{var f=1;if(r.match(/-min$/)?f=0:r.match(/-min-rank$/)&&(o=!0,f=4),r.match(/^cohen-/))s=e.cohen(t,{summary:f,copy:!1});else if(r.match(/^auc-/))s=e.auc(t,{summary:f,copy:!1});else if(r.match(/^lfc-/))s=e.lfc(t,{summary:f,copy:!1});else{if(!r.match(/^delta-d-/))throw"unknown rank type '"+r+"'";s=e.deltaDetected(t,{summary:f,copy:!1})}}a=new Int32Array(s.length);for(var l=0;l<a.length;l++)a[l]=l;o?a.sort((function(e,n){return s[e]-s[n]})):a.sort((function(e,n){return s[n]-s[e]}));var d,p,m,h,y=function(e){for(var n=new Float64Array(e.length),r=0;r<a.length;r++)n[r]=e[a[r]];return n};if(i){var v=n[t];p=y(v.means),d=y(v.detected),m=y(v.lfc.mean),h=y(v.delta_detected.mean)}else d=y(e.detected(t,{copy:!1})),p=y(e.means(t,{copy:!1})),m=y(e.lfc(t,{summary:1,copy:!1})),h=y(e.deltaDetected(t,{summary:1,copy:!1}));return{ordering:a,means:p,detected:d,lfc:m,delta_detected:h}}var kr={},Nr={},Tr=!1;function Ar(e){if(Ue||In||T(Nr,e)){k(kr.raw);var n=Pe(),r=Qn();kr.raw=_.y5(n,r),Nr=e,delete kr.reloaded,Tr=!0}else Tr=!1}function Or(){return{}}function zr(){if("reloaded"in kr)e=kr.reloaded;else for(var e=[],n=kr.raw.numberOfGroups(),r=0;r<n;r++)e.push(Mr(kr.raw,r));return{parameters:Nr,contents:e}}function Gr(e){Nr=e.parameters,kr.reloaded=e.contents}function Ur(e,n){return Er(kr.raw,kr.reloaded,e,n)}var Rr,Cr={results:{}},Zr={selections:{}},jr=!1;function Dr(e){if(_e){Zr.selections={};for(var n=0,r=Object.entries(Cr.results);n<r.length;n++){var t=(0,E.Z)(r[n],2);t[0];k(t[1].raw)}Cr.results={}}jr=!0}function Pr(){return{}}function Fr(){for(var e={},n=0,r=Object.entries(Cr.results);n<r.length;n++){var t=(0,E.Z)(r[n],2),a=t[0],s=t[1];e[a]="reloaded"in s?s.reloaded:Mr(s.raw,1)}return{parameters:Zr,contents:{results:e}}}function Br(e){Zr=e.parameters;for(var n=0,r=Object.entries(e.contents);n<r.length;n++){var t=(0,E.Z)(r[n],2),a=t[0],s=t[1];Cr.results[a]={reloaded:s}}}function qr(e,n){var r=Pe(),t=O(r.numberOfColumns(),"Int32Array",Cr);t.fill(0);var a=t.array();n.forEach((function(e){a[e]=1}));var s=_.y5(r,t);e in Cr.results&&(k(Cr.results[e].raw),delete Cr.results[e]),Cr.results[e]={raw:s},Zr.selections[e]=n}function Ir(e){k(Cr.results[e].raw),delete Cr.results[e],delete Zr.selections[e]}function Kr(e,n){var r=Cr.results[e];return Er(r.raw,r.reloaded,n,1)}var Lr=null;function Wr(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===n&&(n=Rr.result.transaction(["analysis_meta"],"readonly").objectStore("analysis_meta"));var r=n.getAll();r.onsuccess=function(){var n=r.result;n.forEach((function(e){delete e.files})),e(n)},r.onerror=function(){e(null)}}function Vr(e,n){return Qr.apply(this,arguments)}function Qr(){return(Qr=(0,b.Z)(x().mark((function e(n,r){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var t=r.get(n);t.onsuccess=function(){void 0!==t.result?e(t.result):e(null)},t.onerror=function(){e(null)}})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Hr(e){return Promise.allSettled(e).then((function(e){var n,r=(0,M.Z)(e);try{for(r.s();!(n=r.n()).done;){if(!n.value)return!1}}catch(t){r.e(t)}finally{r.f()}return!0}))}function Jr(){return $r.apply(this,arguments)}function $r(){return($r=(0,b.Z)(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Lr;case 2:return e.abrupt("return",new Promise((function(e){Wr(e)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xr(e,n){return Yr.apply(this,arguments)}function Yr(){return(Yr=(0,b.Z)(x().mark((function e(n,r){var t,a,s,i,o,u,c;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Lr;case 2:return t=Rr.result.transaction(["file","file_meta"],"readwrite"),a=t.objectStore("file"),s=t.objectStore("file_meta"),e.next=7,Vr(n,s);case 7:return i=e.sent,o=null===i?0:i.count,o++,u=new Promise((function(e){var t=a.put({id:n,payload:r});t.onsuccess=function(n){e(!0)},t.onerror=function(n){e(!1)}})),c=new Promise((function(e){i.count=o;var n=s.put(i);n.onsuccess=function(n){e(!0)},n.onerror=function(n){e(!1)}})),e.abrupt("return",Hr([u,c]));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function et(e,n,r,t){return nt.apply(this,arguments)}function nt(){return(nt=(0,b.Z)(x().mark((function e(n,r,t,a){var s,i,o,u,c,f;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Lr;case 2:if(s=Rr.result.transaction(["analysis","analysis_meta"],"readwrite"),i=s.objectStore("analysis"),o=s.objectStore("analysis_meta"),null!=n){e.next=10;break}return e.next=8,new Promise((function(e){return Wr(e,o)}));case 8:u=e.sent,n=String(u.length);case 10:return c=new Promise((function(e){var t=i.put({id:n,payload:r});t.onsuccess=function(n){e(!0)},t.onerror=function(n){e(!1)}})),f=new Promise((function(e){var r=o.put({id:n,files:t,time:Number(new Date),title:a});r.onsuccess=function(n){e(!0)},r.onerror=function(n){e(!1)}})),e.next=14,Hr([c,f]);case 14:if(!e.sent){e.next=18;break}return e.abrupt("return",n);case 18:return e.abrupt("return",null);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rt(e){return tt.apply(this,arguments)}function tt(){return(tt=(0,b.Z)(x().mark((function e(n){var r,t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Lr;case 2:return r=Rr.result.transaction(["file"],"readonly").objectStore("file"),e.next=5,Vr(n,r);case 5:return t=e.sent,e.abrupt("return",t.payload);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function at(){return(at=(0,b.Z)(x().mark((function e(n){var r,t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Lr;case 2:return r=Rr.result.transaction(["analysis"],"readonly").objectStore("analysis"),e.next=5,Vr(n,r);case 5:return t=e.sent,e.abrupt("return",t.payload);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function st(e){return it.apply(this,arguments)}function it(){return(it=(0,b.Z)(x().mark((function e(n){var r,t,a,s,i,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Lr;case 2:return r=Rr.result.transaction(["file","file_meta"],"readwrite"),t=r.objectStore("file"),a=r.objectStore("file_meta"),e.next=7,Vr(n,a);case 7:return s=e.sent,i=s.count,i--,o=[],0==i?(o.push(new Promise((function(e){var r=t.remove(n);r.onerror=function(n){e(!1)},r.onsuccess=function(n){e(!0)}}))),o.push(new Promise((function(e){var r=a.delete(n);r.onerror=function(n){e(!1)},r.onsuccess=function(n){e(!0)}})))):o.push(new Promise((function(e){s.count=i;var n=a.put(s);n.onsuccess=function(n){e(!0)},n.onerror=function(n){e(!1)}}))),e.abrupt("return",Hr(o));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ot(){return(ot=(0,b.Z)(x().mark((function e(n){var r,t,a,s,i,o,u,c;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Lr;case 2:return r=Rr.result.transaction(["analysis","analysis_meta"],"readwrite"),t=r.objectStore("analysis"),a=r.objectStore("analysis_meta"),(s=[]).push(new Promise((function(e){var r=t.delete(n);r.onsuccess=function(n){e(!0)},r.onerror=function(n){e(!1)}}))),e.next=9,Vr(n,a);case 9:i=e.sent,o=(0,M.Z)(i.files);try{for(o.s();!(u=o.n()).done;)c=u.value,s.push(st(c))}catch(f){o.e(f)}finally{o.f()}return s.push(new Promise((function(e){var r=a.delete(n);r.onsuccess=function(n){e(!0)},r.onerror=function(n){e(!1)}}))),e.abrupt("return",Hr(s));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ut,ct=r(8109);function ft(e){if(Array.isArray(e))for(var n=0;n<e.length;n++)e[n]=ft(e[n]);else if(ArrayBuffer.isView(e))e={_TypedArray_class:e.constructor.name,_TypedArray_values:Array.from(e)};else if(e instanceof Object)for(var r=0,t=Object.entries(e);r<t.length;r++){var a=(0,E.Z)(t[r],2),s=a[0],i=a[1];e[s]=ft(i)}return e}function lt(e){if(Array.isArray(e))for(var n=0;n<e.length;n++)e[n]=lt(e[n]);else if(e instanceof Object)if("_TypedArray_class"in e){var r=e[["_TypedArray_class"]],t=e[["_TypedArray_values"]];switch(r){case"Uint8Array":case"Uint8Array":e=new Uint8Array(t.length);break;case"Int8Array":e=new Int8Array(t.length);break;case"Uint16Array":e=new Uint16Array(t.length);break;case"Int16Array":e=new Int16Array(t.length);break;case"Uint32Array":e=new Uint32Array(t.length);break;case"Int32Array":e=new Int32Array(t.length);break;case"Uint64Array":e=new Uint64Array(t.length);break;case"Int64Array":e=new Int64Array(t.length);break;case"Float32Array":e=new Float32Array(t.length);break;case"Float64Array":e=new Float64Array(t.length);break;default:throw"unrecognized TypedArray class '"+r}e.set(t)}else for(var a=0,s=Object.entries(e);a<s.length;a++){var i=(0,E.Z)(s[a],2),o=i[0],u=i[1];e[o]=lt(u)}return e}function dt(e){for(var n=new Uint8Array(8),r=0;e>0;)n[r]=e%256,e=Math.floor(e/256),r++;return n}function pt(e){var n,r=0,t=1,a=(0,M.Z)(e);try{for(a.s();!(n=a.n()).done;){r+=t*n.value,t*=256}}catch(s){a.e(s)}finally{a.f()}return r}function mt(e){return ht.apply(this,arguments)}function ht(){return ht=(0,b.Z)(x().mark((function e(n){var r,t,a,s,i,o,u,c,f,l,d,p,m,h,y,v,g,b,w,S,_,E,k=arguments;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=k.length>1&&void 0!==k[1]?k[1]:"full",t=n.inputs.parameters.files,a=[],s=0,"full"!=r){e.next=9;break}i=0,t.forEach((function(e,n){var r=e.buffer;a.push(r),t[n].buffer={offset:s,size:r.byteLength},s+=r.byteLength})),e.next=40;break;case 9:if("KanaDB"!=r){e.next=39;break}i=1,o=(0,M.Z)(t),e.prev=12,o.s();case 14:if((u=o.n()).done){e.next=29;break}return c=u.value,e.next=18,ct.FB(new Uint8Array(c.buffer));case 18:return f=e.sent,l=c.type+"_"+c.name+"_"+c.buffer.byteLength+"_"+f,e.next=22,Xr(l,c.buffer);case 22:if(e.sent){e.next=25;break}throw"failed to save file '"+l+"' to KanaDB";case 25:c.buffer=l,a.push(l);case 27:e.next=14;break;case 29:e.next=34;break;case 31:e.prev=31,e.t0=e.catch(12),o.e(e.t0);case 34:return e.prev=34,o.f(),e.finish(34);case 37:e.next=40;break;case 39:throw"unsupported mode "+r;case 40:if(n=ft(n),d=JSON.stringify(n),p=R.iv(d),m=new ArrayBuffer(24+p.length+s),h=new Uint8Array(m),y=0,v=dt(i),h.set(v,y),y+=v.length,g=dt(0),h.set(g,y),y+=g.length,b=dt(p.length),h.set(b,y),24==(y+=b.length)){e.next=57;break}throw"oops - accounting error in the serialization code!";case 57:if(h.set(p,y),y+=p.length,"full"!=r){e.next=65;break}w=(0,M.Z)(a);try{for(w.s();!(S=w.n()).done;)_=S.value,E=new Uint8Array(_),h.set(E,y),y+=E.length}catch(x){w.e(x)}finally{w.f()}return e.abrupt("return",m);case 65:if("KanaDB"!=r){e.next=69;break}return e.abrupt("return",{file_ids:a,state:m});case 69:throw"unsupported mode "+r;case 70:case"end":return e.stop()}}),e,null,[[12,31,34,37]])}))),ht.apply(this,arguments)}function yt(e){return vt.apply(this,arguments)}function vt(){return(vt=(0,b.Z)(x().mark((function e(n){var r,t,a,s,i,o,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=0,t=pt(new Uint8Array(n,r,8)),r+=8,pt(new Uint8Array(n,r,8)),r+=8,a=pt(new Uint8Array(n,r,8)),r+=8,s=R.ec(new Uint8Array(n,r,a),{to:"string"}),s=lt(s=JSON.parse(s)),r+=a,i=s.inputs.parameters.files,0!=t){e.next=16;break}i.forEach((function(e,t){var a=e.buffer,s=new Uint8Array(n,r+a.offset,a.size),o=new ArrayBuffer(a.size);new Uint8Array(o).set(s),i[t].buffer=o})),e.next=26;break;case 16:if(1!=t){e.next=25;break}return o=[],i.forEach((function(e,n){var r=e.buffer;o.push(rt(r))})),e.next=21,Promise.all(o);case 21:u=e.sent,i.forEach((function(e,n){if(null===u[n])throw"KanaDB loading failed for file ID '"+e.buffer+"'";e.buffer=u[n]})),e.next=26;break;case 25:throw"unsupported format type";case 26:return e.abrupt("return",s);case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gt(e,n,r){var t=[];z(e,t),postMessage({type:"".concat(n,"_DATA"),resp:e,msg:"Success: "+r},t)}function bt(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"run",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("serialize"===n)e={};else{if(null==r)throw"'state' must be supplied if 'mode' is not 'serialize'";"unserialize"===n&&(e={params:{}})}var b=function(e,r,t){(e.changed||"unserialize"==n)&&gt(e.results(),r,t)},S=function(e,r,t){(e.changed||"unserialize"==n)&&e.results().then((function(e){gt(e,r,t)}))},x=function(e,n,r){e[n]=n in e?(0,w.Z)((0,w.Z)({},e[n]),r):r},_="inputs";"serialize"===n?e[_]=Q():("run"==n?W({format:r.files.format,files:r.files.files}):(H(r[_]),e.files={format:"kana",files:[]}),b(t,_,"Count matrix loaded"));var M="quality_control_metrics";"serialize"===n?e[M]=ue():("run"==n?ie({use_mito_default:r.params.qc["qc-usemitodefault"],mito_prefix:r.params.qc["qc-mito"]}):(ce(r[M]),x(e.params,"qc",{"qc-usemitodefault":r[M].parameters.use_mito_default,"qc-mito":r[M].parameters.mito_prefix})),b(a,M,"QC metrics computed"));var E="quality_control_thresholds";"serialize"===n?e[E]=ve():("run"==n?he({nmads:r.params.qc["qc-nmads"]}):(ge(r[E]),x(e.params,"qc",{"qc-nmads":r[E].parameters.nmads})),b(s,E,"QC thresholds computed"));var k="quality_control_filtered";"serialize"==n?e[k]=Ne():("run"==n?Ee({}):Te(r[k]),b(i,k,"QC filtering completed"));var N="normalization";"serialize"==n?e[N]=je():("run"==n?Ce({}):De(r[N]),b(o,N,"Log-normalization completed"));var T="feature_selection";"serialize"==n?e[T]=We():("run"==n?Ke({span:r.params.fSelection["fsel-span"]}):(Ve(r[T]),x(e.params,"fSelection",{"fsel-span":r[T].parameters.span})),b(u,T,"Variance modelling completed"));var A="pca";"serialize"==n?e[A]=rn():("run"==n?en({num_hvgs:r.params.pca["pca-hvg"],num_pcs:r.params.pca["pca-npc"]}):(tn(r[A]),x(e.params,"pca",{"pca-hvg":r[A].parameters.num_hvgs,"pca-npc":r[A].parameters.num_pcs})),b(c,A,"Principal components analysis completed"));var O,z="neighbor_index";"serialize"==n?e[z]=dn():("run"==n?fn({approximate:r.params.cluster["clus-approx"]}):(pn(r[z]),x(e.params,"cluster",{"clus-approx":r[z].parameters.approximate})),b(f,z,"Neighbor search index constructed"));var G,U="tsne";"serialize"==n?O=ur():("run"==n?ir({perplexity:r.params.tsne["tsne-perp"],iterations:r.params.tsne["tsne-iter"],animate:r.params.tsne.animate}):(fr(r[U]),x(e.params,"tsne",{"tsne-perp":r[U].parameters.perplexity,"tsne-iter":r[U].parameters.iterations,animate:r[U].parameters.animate})),S(h,U,"t-SNE completed"));var R="umap";"serialize"==n?G=wr():("run"==n?gr({num_epochs:r.params.umap["umap-epochs"],num_neighbors:r.params.umap["umap-nn"],min_dist:r.params.umap["umap-min_dist"],animate:r.params.umap.animate}):(xr(r[R]),x(e.params,"umap",{num_epochs:r[R].parameters.num_epochs,num_neighbors:r[R].parameters.num_neighbors,min_dist:r[R].parameters.min_dist,animate:r[R].parameters.animate})),S(y,R,"UMAP completed"));var C="snn_find_neighbors";"serialize"==n?e[C]=Sn():("run"==n?bn({k:r.params.cluster["clus-k"]}):(xn(r[C]),x(e.params,"cluster",{"clus-k":r[C].parameters.k})),b(l,C,"Shared nearest neighbor search completed"));var Z="snn_build_graph";"serialize"==n?e[Z]=On():("run"==n?Tn({scheme:r.params.cluster["clus-scheme"]}):(zn(r[Z]),x(e.params,"cluster",{"clus-scheme":r[Z].parameters.scheme})),b(d,Z,"Shared nearest neighbor graph constructed"));var j="snn_cluster_graph";"serialize"==n?e[j]=Pn():("run"==n?jn({resolution:r.params.cluster["clus-res"]}):(Fn(r[j]),x(e.params,"cluster",{"clus-res":r[j].parameters.resolution})),b(p,j,"Community detection from SNN graph complete"));var D="choose_clustering";"serialize"==n?e[D]=Wn():("run"==n?Kn({method:r.params.cluster["clus-method"]}):(Vn(r[D]),x(e.params,"cluster",{"clus-method":r[D].parameters.method})),b(m,D,"Clustering of interest chosen"));var P="marker_detection";"serialize"==n?e[P]=zr():("run"==n?Ar({}):Gr(r[P]),b(v,P,"Marker detection complete"));var F="custom_marker_management";return"serialize"==n?e[F]=Fr():("run"==n?Dr():Br(r[F]),b(g,F,"Pruning of custom markers finished")),"serialize"==n?Promise.all([O,G]).then((function(n){return e.tsne=n[0],e.umap=n[1],e})):e}onmessage=function(e){var n=e.data;if("INIT"==n.type){var r=Math.round(2*navigator.hardwareConcurrency/3),t=_.j2({numberOfThreads:r});t.then((function(e){postMessage({type:n.type,msg:"Success: ScranJS/WASM initialized"})}));var a=Lr=new Promise((function(e){(Rr=indexedDB.open("KanaDB",2)).onupgradeneeded=function(e){var n=e.target.result;try{n.deleteObjectStore("analysis")}catch(e){}try{n.deleteObjectStore("analysis_meta")}catch(e){}try{n.deleteObjectStore("file")}catch(e){}try{n.deleteObjectStore("file_meta")}catch(e){}n.createObjectStore("analysis",{keyPath:"id"}),n.createObjectStore("analysis_meta",{keyPath:"id"}),n.createObjectStore("file",{keyPath:"id"}),n.createObjectStore("file_meta",{keyPath:"id"})},Rr.onsuccess=function(){Wr(e)},Rr.onerror=function(){e(null)}}));a.then((function(e){null!==e?postMessage({type:"KanaDB_store",resp:e,msg:"Success"}):(console.log(error),postMessage({type:"KanaDB_ERROR",msg:"Fail: Cannot initialize DB"}))}));var s=tr(),i=hr();ut=Promise.all([t,a,s,i])}else if("RUN"==n.type)ut.then((function(e){bt("run",n.payload)})).catch((function(e){console.log(e),postMessage({type:"run_ERROR",msg:e.toString()})}));else if("LOAD"==n.type){if("kana"==n.payload.files.format){var o=new FileReaderSync,u=n.payload.files.files.file[0];ut.then(function(){var e=(0,b.Z)(x().mark((function e(n){var r,t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yt(o.readAsArrayBuffer(u));case 2:r=e.sent,t=bt("unserialize",r),postMessage({type:"loadedParameters",resp:t});case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log(e),postMessage({type:"load_ERROR",msg:e.toString()})}))}else if("kanadb"==n.payload.files.format){(function(e){return at.apply(this,arguments)})(f=n.payload.files.files.file).then(function(){var e=(0,b.Z)(x().mark((function e(n){var r,t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n){e.next=4;break}postMessage({type:"KanaDB_ERROR",msg:"Fail: cannot load analysis ID '".concat(f,"'")}),e.next=11;break;case 4:return e.next=6,yt(n);case 6:return r=e.sent,e.next=9,bt("unserialize",r);case 9:t=e.sent,postMessage({type:"loadedParameters",resp:t});case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log(e),postMessage({type:"load_ERROR",msg:e.toString()})}))}}else if("EXPORT"==n.type)ut.then(function(){var e=(0,b.Z)(x().mark((function e(n){var r,t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,bt("serialize");case 2:return r=e.sent,e.next=5,mt(r,"full");case 5:t=e.sent,postMessage({type:"exportState",resp:t,msg:"Success: application state exported"},[t]);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log(e),postMessage({type:"export_ERROR",msg:e.toString()})}));else if("SAVEKDB"==n.type){var c=n.payload.title;ut.then(function(){var e=(0,b.Z)(x().mark((function e(n){var r,t,a,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,bt("serialize");case 2:return r=e.sent,e.next=5,mt(r,"KanaDB");case 5:return t=e.sent,e.next=8,et(null,t.state,t.file_ids,c);case 8:if(null===(a=e.sent)){e.next=16;break}return e.next=12,Jr();case 12:s=e.sent,postMessage({type:"KanaDB_store",resp:s,msg:"Success: Saved analysis to cache (".concat(a,")")}),e.next=18;break;case 16:console.log(error),postMessage({type:"KanaDB_ERROR",msg:"Fail: Cannot save analysis to cache (".concat(a,")")});case 18:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log(e),postMessage({type:"export_ERROR",msg:e.toString()})}))}else if("REMOVEKDB"==n.type){var f;(function(e){return ot.apply(this,arguments)})(f=n.payload.id).then(function(){var e=(0,b.Z)(x().mark((function e(n){var r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=7;break}return e.next=3,Jr();case 3:r=e.sent,postMessage({type:"KanaDB_store",resp:r,msg:"Success: Removed file from cache (".concat(f,")")}),e.next=9;break;case 7:console.log(error),postMessage({type:"KanaDB_ERROR",msg:"fail: cannot remove file from cache (".concat(f,")")});case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())}else"getMarkersForCluster"==n.type?ut.then((function(e){var r=n.payload.cluster,t=Ur(n.payload.rank_type,r),a=[];z(t,a),postMessage({type:"setMarkersForCluster",resp:t,msg:"Success: GET_MARKER_GENE done"},a)})):"getGeneExpression"==n.type?ut.then((function(e){var r=n.payload.gene,t=Fe(r);postMessage({type:"setGeneExpression",resp:{gene:r,expr:t},msg:"Success: GET_GENE_EXPRESSION done"},[t.buffer])})):"computeCustomMarkers"==n.type?ut.then((function(e){qr(n.payload.id,n.payload.selection),postMessage({type:"computeCustomMarkers",msg:"Success: COMPUTE_CUSTOM_MARKERS done"})})):"getMarkersForSelection"==n.type?ut.then((function(e){var r=Kr(n.payload.cluster,n.payload.rank_type),t=[];z(r,t),postMessage({type:"setMarkersForCustomSelection",resp:r,msg:"Success: GET_MARKER_GENE done"},t)})):"removeCustomMarkers"==n.type?ut.then((function(e){Ir(n.payload.id)})):"animateTSNE"==n.type?ut.then(function(){var e=(0,b.Z)(x().mark((function e(n){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lr();case 2:return e.next=4,or();case 4:gt(e.sent,"tsne","Resending t-SNE coordinates");case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()):"animateUMAP"==n.type?ut.then(function(){var e=(0,b.Z)(x().mark((function e(n){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_r();case 2:return e.next=4,br();case 4:gt(e.sent,"umap","Resending UMAP coordinates");case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()):"getAnnotation"==n.type?ut.then((function(e){var r=n.payload.annotation,t=Y(r);postMessage({type:"setAnnotation",resp:{annotation:r,values:{index:t.index,factor:t.factor}},msg:"Success: GET_ANNOTATION done"},[t.factor.buffer])})):console.log("MIM:::msg type incorrect")}}},n={};function r(t){var a=n[t];if(void 0!==a)return a.exports;var s=n[t]={exports:{}};return e[t](s,s.exports,r),s.exports}r.m=e,r.x=function(){var e=r.O(void 0,[537,555],(function(){return r(2459)}));return e=r.O(e)},function(){var e=[];r.O=function(n,t,a,s){if(!t){var i=1/0;for(f=0;f<e.length;f++){t=e[f][0],a=e[f][1],s=e[f][2];for(var o=!0,u=0;u<t.length;u++)(!1&s||i>=s)&&Object.keys(r.O).every((function(e){return r.O[e](t[u])}))?t.splice(u--,1):(o=!1,s<i&&(i=s));if(o){e.splice(f--,1);var c=a();void 0!==c&&(n=c)}}return n}s=s||0;for(var f=e.length;f>0&&e[f-1][2]>s;f--)e[f]=e[f-1];e[f]=[t,a,s]}}(),r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,{a:n}),n},r.d=function(e,n){for(var t in n)r.o(n,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},r.f={},r.e=function(e){return Promise.all(Object.keys(r.f).reduce((function(n,t){return r.f[t](e,n),n}),[]))},r.u=function(e){return"static/js/"+e+"."+{139:"dfff2a0d",495:"5bc8be6f",537:"2057833a",555:"b79ae422",653:"0a0c9a22"}[e]+".chunk.js"},r.miniCssF=function(e){},r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="/kana/",function(){r.b=self.location+"/../../../";var e={459:1};r.f.i=function(n,t){e[n]||importScripts(r.p+r.u(n))};var n=self.webpackChunkkana=self.webpackChunkkana||[],t=n.push.bind(n);n.push=function(n){var a=n[0],s=n[1],i=n[2];for(var o in s)r.o(s,o)&&(r.m[o]=s[o]);for(i&&i(r);a.length;)e[a.pop()]=1;t(n)}}(),function(){var e=r.x;r.x=function(){return Promise.all([r.e(537),r.e(555)]).then(e)}}();r.x()}();
//# sourceMappingURL=459.03520e89.chunk.js.map