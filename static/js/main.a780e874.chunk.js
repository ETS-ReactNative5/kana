(this.webpackJsonpkana=this.webpackJsonpkana||[]).push([[0],{287:function(e,t,n){},288:function(e,t,n){},314:function(e,t,n){},317:function(e,t,n){},318:function(e,t,n){},330:function(e,t,n){},331:function(e,t,n){},332:function(e,t,n){},333:function(e,t,n){},334:function(e,t,n){},335:function(e,t,n){"use strict";n.r(t);var s=n(1),a=n(25),c=n.n(a),i=(n(287),n(5)),r=n(22),l=n(6),o=(n(288),n(343)),d=n(48),u=n(137),h=n(80),j=n(43),b=n(3),p=n(19),O=o.F.create({className:"notifications",position:p.a.TOP_RIGHT,maxToasts:5}),x=n(0),m=Object(s.createContext)(null),f=function(e){var t=e.children,n=Object(s.useState)({gene:null,mtx:null,barcode:null}),a=Object(l.a)(n,2),c=a[0],i=a[1],r=Object(s.useState)({qc:{"qc-nmads":3},fSelection:{"fsel-span":.3},pca:{"pca-npc":5,"pca-hvg":4e3},cluster:{"clus-k":10,"clus-res":.5,"clus-scheme":0,"clus-approx":!0,"clus-method":"snn_graph"},tsne:{"tsne-iter":500,"tsne-perp":30},umap:{"umap-nn":15,"umap-epochs":500,"umap-min_dist":.01},markerGene:{}}),o=Object(l.a)(r,2),d=o[0],u=o[1],h=Object(s.useState)(!1),j=Object(l.a)(h,2),b=j[0],p=j[1],f=Object(s.useState)(!1),v=Object(l.a)(f,2),g=v[0],y=v[1],F=Object(s.useState)("kana-"+String(Date.now()).slice(0,5)),w=Object(l.a)(F,2),C=w[0],N=w[1],k=Object(s.useState)(!1),S=Object(l.a)(k,2),E=S[0],D=S[1],A=Object(s.useState)(!1),M=Object(l.a)(A,2),T=M[0],L=M[1],R=Object(s.useState)(null),I=Object(l.a)(R,2),B=I[0],_=I[1],q=Object(s.useState)(null),P=Object(l.a)(q,2),G=P[0],W=P[1],z=Object(s.useState)(null),U=Object(l.a)(z,2),V=U[0],H=U[1],X=Object(s.useState)(null),Q=Object(l.a)(X,2),Y=Q[0],Z=Q[1],J=Object(s.useState)(null),K=Object(l.a)(J,2),$=K[0],ee=K[1],te=Object(s.useState)(null),ne=Object(l.a)(te,2),se=ne[0],ae=ne[1],ce=Object(s.useState)(null),ie=Object(l.a)(ce,2),re=ie[0],le=ie[1],oe=Object(s.useState)(null),de=Object(l.a)(oe,2),ue=de[0],he=de[1],je=Object(s.useState)([]),be=Object(l.a)(je,2),pe=be[0],Oe=be[1],xe=Object(s.useState)(null),me=Object(l.a)(xe,2),fe=me[0],ve=me[1],ge=Object(s.useState)(null),ye=Object(l.a)(ge,2),Fe=ye[0],we=ye[1],Ce=Object(s.useState)(null),Ne=Object(l.a)(Ce,2),ke=Ne[0],Se=Ne[1],Ee=Object(s.useState)(null),De=Object(l.a)(Ee,2),Ae=De[0],Me=De[1],Te=Object(s.useState)([]),Le=Object(l.a)(Te,2),Re=Le[0],Ie=Le[1],Be=Object(s.useState)(null),_e=Object(l.a)(Be,2),qe=_e[0],Pe=_e[1],Ge=Object(s.useState)(null),We=Object(l.a)(Ge,2),ze=We[0],Ue=We[1],Ve=Object(s.useState)({}),He=Object(l.a)(Ve,2),Xe=He[0],Qe=He[1],Ye=Object(s.useState)(null),Ze=Object(l.a)(Ye,2),Je=Ze[0],Ke=Ze[1],$e=Object(s.useState)(null),et=Object(l.a)($e,2),tt=et[0],nt=et[1],st=Object(s.useState)(null),at=Object(l.a)(st,2),ct=at[0],it=at[1],rt=Object(s.useState)(null),lt=Object(l.a)(rt,2),ot=lt[0],dt=lt[1],ut=Object(s.useState)(null),ht=Object(l.a)(ut,2),jt=ht[0],bt=ht[1],pt=Object(s.useState)(null),Ot=Object(l.a)(pt,2),xt=Ot[0],mt=Ot[1],ft=Object(s.useState)(null),vt=Object(l.a)(ft,2),gt=vt[0],yt=vt[1],Ft=Object(s.useState)([]),wt=Object(l.a)(Ft,2),Ct=wt[0],Nt=wt[1];return Object(s.useEffect)((function(){T&&null!=c.mtx&&window.Worker.postMessage({type:"RUN",payload:{files:[c.mtx,c.barcode?c.barcode[0]:[],c.gene?c.gene[0]:[]],params:d},msg:"not much to pass"})}),[c,d,T]),Object(s.useEffect)((function(){E?(window.Worker.postMessage({type:"EXPORT",payload:{files:[c.mtx,c.barcode?c.barcode[0]:[],c.gene?c.gene[0]:[]],params:d},msg:"not much to pass"}),O.show({icon:"download",intent:"primary",message:"Exporting analysis in the background"})):(null===c||void 0===c?void 0:c.mtx)&&O.show({icon:"download",intent:"primary",message:"Analysis saved. Please check your downloads directory!"})}),[E]),Object(x.jsx)(m.Provider,{value:{inputFiles:c,setInputFiles:i,params:d,setParams:u,error:B,setError:_,wasmInitialized:T,setWasmInitialized:L,pcaData:tt,setPcaData:nt,pcaVarExp:ct,setPcaVarExp:it,tsneData:ot,setTsneData:dt,umapData:jt,setUmapData:bt,genesInfo:$,setGenesInfo:ee,initDims:G,setInitDims:W,qcDims:V,setQcDims:H,qcData:se,setQcData:ae,qcThreshold:re,setQcThreshold:le,fSelDims:Y,setFSelDims:Z,redDims:pe,setRedDims:Oe,defaultRedDims:fe,setDefaultRedDims:ve,plotRedDims:Fe,setPlotRedDims:we,clusterData:ke,setClusterData:Se,fSelectionData:ue,setFSelectionData:he,logs:Ct,setLogs:Nt,selectedCluster:Ae,setSelectedCluster:Me,selectedClusterSummary:Re,setSelectedClusterSummary:Ie,clusterRank:ze,setClusterRank:Ue,gene:xt,setGene:mt,clusterColors:qe,setClusterColors:Pe,reqGene:gt,setReqGene:yt,openInput:b,setOpenInput:p,customSelection:Xe,setCustomSelection:Qe,delCustomSelection:Je,setDelCustomSelection:Ke,showGame:g,setShowGame:y,exportState:E,setExportState:D,datasetName:C,setDatasetName:N},children:t})},v=(n(314),["buttonText","includeFooter"]);var g=function(e){var t=e.buttonText,n=e.includeFooter,a=Object(j.a)(e,v),c=Object(s.useState)(!1),r=Object(l.a)(c,2),d=r[0],h=r[1],p=Object(s.useState)(1),O=Object(l.a)(p,2),f=O[0],g=O[1],y=Object(s.useCallback)((function(){return h(!d)}),[d]),F=Object(s.useCallback)((function(){return h(!1)}),[]),w=Object(s.useContext)(m),C=w.inputFiles,N=w.setInputFiles,k=w.params,S=w.setParams,E=w.openInput,D=Object(s.useState)(C),A=Object(l.a)(D,2),M=A[0],T=A[1],L=Object(s.useState)(k),R=Object(l.a)(L,2),I=R[0],B=R[1],_=Object(s.useState)(!0),q=Object(l.a)(_,2),P=q[0],G=q[1],W=Object(s.useState)({mtx:"Choose Matrix Market file",gene:"Choose feature/gene annotation",barcode:"Choose barcode annotation"}),z=Object(l.a)(W,2),U=z[0],V=z[1];return Object(s.useEffect)((function(){E&&h(!0)}),[E]),Object(s.useEffect)((function(){M&&M.mtx&&(U.mtx.endsWith("mtx")||U.mtx.endsWith("mtx.gz")||U.mtx.endsWith("hdf5")||U.mtx.endsWith("h5")||G(!1))}),[null===M||void 0===M?void 0:M.mtx]),Object(s.useEffect)((function(){M&&M.gene&&(U.gene.endsWith("tsv")||U.gene.endsWith("tsv.gz")||G(!1))}),[null===M||void 0===M?void 0:M.gene]),Object(s.useEffect)((function(){M&&M.barcode&&(U.barcode.endsWith("tsv")||U.barcode.endsWith("tsv.gz")||G(!1))}),[null===M||void 0===M?void 0:M.barcode]),Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(o.a,{onClick:y,icon:"social-media",intent:"primary",text:t}),Object(x.jsxs)(o.g,Object(i.a)(Object(i.a)({className:"analysis-dialog"},a),{},{isOpen:d,onClose:F,children:[Object(x.jsxs)("div",{className:b.a.DIALOG_BODY+" inputs-container",children:[Object(x.jsxs)("div",{className:"row-input",children:[Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(o.m,{children:[Object(x.jsx)(o.D,{round:!0,children:"1"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(1)},onMouseLeave:function(){return g(null)},children:"Load input files"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsx)(o.q,{className:"row-input",children:Object(x.jsx)(o.k,{text:U.mtx,onInputChange:function(e){V(Object(i.a)(Object(i.a)({},U),{},{mtx:e.target.files[0].name})),T(Object(i.a)(Object(i.a)({},M),{},{mtx:e.target.files}))}})}),Object(x.jsx)(o.q,{className:"row-input",children:Object(x.jsx)(o.k,{text:U.gene,onInputChange:function(e){V(Object(i.a)(Object(i.a)({},U),{},{gene:e.target.files[0].name})),T(Object(i.a)(Object(i.a)({},M),{},{gene:e.target.files}))}})}),Object(x.jsx)(o.q,{className:"row-input",children:Object(x.jsx)(o.k,{text:U.barcode,onInputChange:function(e){V(Object(i.a)(Object(i.a)({},U),{},{barcode:e.target.files[0].name})),T(Object(i.a)(Object(i.a)({},M),{},{barcode:e.target.files}))}})})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(o.m,{children:[Object(x.jsx)(o.D,{round:!0,children:"2"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(2)},onMouseLeave:function(){return g(null)},children:"Quality control"})]}),Object(x.jsx)("div",{className:"row",children:Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.E,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(2)},onMouseLeave:function(){return g(null)},children:"Number of MADs"})}),Object(x.jsx)(o.x,{placeholder:"3",value:I.qc["qc-nmads"],onValueChange:function(e,t){B(Object(i.a)(Object(i.a)({},I),{},{qc:Object(i.a)(Object(i.a)({},I.qc),{},{"qc-nmads":e})}))}})]})})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(o.m,{children:[Object(x.jsx)(o.D,{round:!0,children:"3"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(3)},onMouseLeave:function(){return g(null)},children:"Feature Selection"})]}),Object(x.jsx)("div",{className:"row",children:Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.E,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(3)},onMouseLeave:function(){return g(null)},children:"Lowess span"})}),Object(x.jsx)(o.x,{placeholder:"0.3",value:I.fSelection["fsel-span"],onValueChange:function(e,t){B(Object(i.a)(Object(i.a)({},I),{},{fSelection:Object(i.a)(Object(i.a)({},I.fSelection),{},{"fsel-span":e})}))}})]})})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(o.m,{children:[Object(x.jsx)(o.D,{round:!0,children:"4"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(4)},onMouseLeave:function(){return g(null)},children:"Principal components analysis"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.E,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(4)},onMouseLeave:function(){return g(null)},children:"Number of HVGs"})}),Object(x.jsx)(o.x,{placeholder:"2500",value:I.pca["pca-hvg"],onValueChange:function(e,t){B(Object(i.a)(Object(i.a)({},I),{},{pca:Object(i.a)(Object(i.a)({},I.pca),{},{"pca-hvg":e})}))}})]}),Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.E,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(4)},onMouseLeave:function(){return g(null)},children:"Number of PCs"})}),Object(x.jsx)(o.x,{placeholder:"25",value:I.pca["pca-npc"],onValueChange:function(e,t){B(Object(i.a)(Object(i.a)({},I),{},{pca:Object(i.a)(Object(i.a)({},I.pca),{},{"pca-npc":e})}))}})]})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(o.m,{children:[Object(x.jsx)(o.D,{round:!0,children:"5"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Clustering"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.E,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Method"})}),Object(x.jsx)(o.n,{defaultValue:I.cluster["clus-method"],children:Object(x.jsx)("option",{children:I.cluster["clus-method"]})})]}),Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.E,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Number of neighbors"})}),Object(x.jsx)(o.x,{placeholder:"10",value:I.cluster["clus-k"],onValueChange:function(e,t){B(Object(i.a)(Object(i.a)({},I),{},{cluster:Object(i.a)(Object(i.a)({},I.cluster),{},{"clus-k":e})}))}})]}),Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.E,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Use ANN"})}),Object(x.jsx)(o.C,{style:{marginTop:"10px"},large:!0,checked:I.cluster["clus-approx"],innerLabelChecked:"true",innerLabel:"false",onChange:function(e){B(Object(i.a)(Object(i.a)({},I),{},{cluster:Object(i.a)(Object(i.a)({},I.cluster),{},{"clus-approx":e.target.checked})}))}})]}),Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.E,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Weighting scheme"})}),Object(x.jsxs)(o.n,{onChange:function(e,t){var n;return B(Object(i.a)(Object(i.a)({},I),{},{cluster:Object(i.a)(Object(i.a)({},I.cluster),{},{"clus-scheme":parseInt(null===e||void 0===e||null===(n=e.currentTarget)||void 0===n?void 0:n.value)})}))},children:[Object(x.jsx)("option",{children:"Rank"},"0"),Object(x.jsx)("option",{children:"Number"},"1"),Object(x.jsx)("option",{children:"Jaccard"},"2")]})]}),Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.E,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Resolution"})}),Object(x.jsx)(o.x,{placeholder:"0.5",value:I.cluster["clus-res"],onValueChange:function(e,t){B(Object(i.a)(Object(i.a)({},I),{},{cluster:Object(i.a)(Object(i.a)({},I.cluster),{},{"clus-res":e})}))}})]})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(o.m,{children:[Object(x.jsx)(o.D,{round:!0,children:"6"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(6)},onMouseLeave:function(){return g(null)},children:"t-SNE"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.E,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(6)},onMouseLeave:function(){return g(null)},children:"Perplexity"})}),Object(x.jsx)(o.x,{placeholder:"30",value:I.tsne["tsne-perp"],onValueChange:function(e,t){B(Object(i.a)(Object(i.a)({},I),{},{tsne:Object(i.a)(Object(i.a)({},I.tsne),{},{"tsne-perp":e})}))}})]}),Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.E,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(6)},onMouseLeave:function(){return g(null)},children:"Iterations"})}),Object(x.jsx)(o.x,{placeholder:"500",value:I.tsne["tsne-iter"],onValueChange:function(e,t){B(Object(i.a)(Object(i.a)({},I),{},{tsne:Object(i.a)(Object(i.a)({},I.tsne),{},{"tsne-iter":e})}))}})]})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(o.m,{children:[Object(x.jsx)(o.D,{round:!0,children:"7"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(7)},onMouseLeave:function(){return g(null)},children:"UMAP"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.E,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(7)},onMouseLeave:function(){return g(null)},children:"Number of neighbors"})}),Object(x.jsx)(o.x,{placeholder:"15",value:I.umap["umap-nn"],onValueChange:function(e,t){B(Object(i.a)(Object(i.a)({},I),{},{umap:Object(i.a)(Object(i.a)({},I.umap),{},{"umap-nn":e})}))}})]}),Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.E,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(7)},onMouseLeave:function(){return g(null)},children:"Minimum distance"})}),Object(x.jsx)(o.x,{placeholder:"0.01",value:I.umap["umap-min_dist"],onValueChange:function(e,t){B(Object(i.a)(Object(i.a)({},I),{},{umap:Object(i.a)(Object(i.a)({},I.umap),{},{"umap-min_dist":e})}))}})]}),Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.E,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(7)},onMouseLeave:function(){return g(null)},children:"Epochs"})}),Object(x.jsx)(o.x,{placeholder:"500",value:I.umap["umap-epoch"],onValueChange:function(e,t){B(Object(i.a)(Object(i.a)({},I),{},{umap:Object(i.a)(Object(i.a)({},I.umap),{},{"umap-epoch":e})}))}})]})]})]})})]}),Object(x.jsxs)("div",{className:"row-input-tooltips",children:[!P&&Object(x.jsx)(o.c,{intent:"danger",title:"Incorrect file format",style:{marginBottom:"10px"},children:Object(x.jsxs)("p",{children:["Upload files that in one of these formats;",Object(x.jsxs)("ul",{children:[Object(x.jsxs)("li",{children:["Matrix Market - ",Object(x.jsx)("code",{children:"*.mtx"})," or ",Object(x.jsx)("code",{children:"*.mtx.gz"})]}),Object(x.jsxs)("li",{children:["features or genes, ",Object(x.jsx)("code",{children:"*.tsv"})," or ",Object(x.jsx)("code",{children:"*.tsv.gz"})]})]})]})}),1==f&&Object(x.jsx)(o.c,{intent:"primary",children:Object(x.jsxs)("p",{children:["We currently support files in the Cellranger format - namely, a Matrix Market file containing the count matrix. We also recommend supplying the feature annotation (",Object(x.jsx)("code",{children:"features.tsv.gz"})," or ",Object(x.jsx)("code",{children:"genes.tsv.gz"}),"). Users may also provide a TSV file containing the barcode annotations, if any."]})}),2==f&&Object(x.jsxs)(o.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"At this step, we compute per-cell quality control (QC) metrics such as the total count per cell, the total number of detected features and (if the feature annotation is supplied) the mitochondrial proportion in each cell."}),Object(x.jsx)("p",{children:"We remove low-quality cells based on these metrics - specifically, cells with low total counts/number of detected features or high mitochondrial proportions are filtered out."}),Object(x.jsx)("p",{children:"We use an outlier-based approach to define the filter threshold under the assumption that most cells in the dataset are of acceptable quality."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of MADs"}),": Number of median absolute deviations (MADs) from the median, used to define a filter threshold in the appropriate direction for each QC metric. Increasing this value will reduce the stringency of the filtering."]})]}),3==f&&Object(x.jsxs)(o.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Identify highly variable genes while accounting for the mean-variance relationship. We do so by fitting a mean-dependent trend to the variances, computed from the log-transformed normalized expression values. The residuals from the trend are then used to rank highly variable genes."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Lowess span"}),": The span of the LOWESS smoother for fitting the mean-variance trend. Larger values increase the smoothness of the global trend at the cost of decreasing sensitivity to local variations."]})]}),4==f&&Object(x.jsxs)(o.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Perform a principal components analysis (PCA) to obtain per-cell coordinates in a low-dimensional space. This is used to compact the data for faster downstream computation, as well as to remove uninteresting high-dimensional noise."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of HVGs"}),": Number of highly variable genes to use to perform the PCA. Larger values will capture more biological signal at the cost of increasing noise and computational work."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of PCs"}),": Number of principal components with the highest variance to retain in downstream analyses. Larger values will capture more biological signal at the cost of increasing noise and computational work."]})]}),5==f&&Object(x.jsxs)(o.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Cluster cells into discrete groupings based on their relative similarity in the low-dimensional space. The set of clusters serve as a summary of the cellular heterogeneity in the population, allowing us to easily perform further characterization on subpopulations of interest."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Method"}),": Clustering algorithm to use. Currently, we use multi-level community detection on an shared nearest neighbor (SNN) graph where cells are the nodes and edges are created between neighboring cells."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of neighbors"}),": Number of neighbors to use to construct the shared nearest neighbor graph. Larger values result in broader clusters."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Use ANN ?"}),": Use an approximate method to speed up the nearest neighbor search. This sacrifices some accuracy for speed in larger datasets."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Weighting scheme"}),": Weighting scheme to use for the edges of the shared nearest neighbor graph. The Rank approach derives a weight from the rank of the closest shared neighbor; the Number approach uses the number of shared neighbors; and the Jaccard approach uses the Jaccard index of the neighbor sets."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Resolution"}),": Resolution parameter for the multi-level clustering, used to adjust the modularity calculation during community optimization. Larger values yield more fine-grained clusters."]})]}),6==f&&Object(x.jsxs)(o.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Create a t-SNE plot to visualize cells in two dimensions, because our feeble human minds cannot interpret high-dimensional spaces. Cells that were neighbors in the original space are kept close together in the 2D embedding, while dissimilar cells are placed (arbitrarily) far away."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Perplexity"}),": Perplexity parameter, which determines the size of the neighborhood of each cell. Larger values will favor preservation of global structure in the 2D embedding."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Iterations"}),": Number of t-SNE iterations. Doesn't usually have much of an effect if you leave it as it is."]})]}),7==f&&Object(x.jsxs)(o.c,{title:"Visually important content",intent:"primary",children:[Object(x.jsx)("p",{children:"Create a UMAP plot to visualize cells in two dimensions. Like the t-SNE, this aims to map cells from a high-dimensional space into a 2D embedding, where neighboring cells are kept close together and dissimilar cells are placed far apart."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of neighbors"}),": Number of neighbors to use when defining the size of the local neighborhood. Larger values will favor preservation of global structure."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Minimum distance"}),": Minimum distance between points. Smaller values result in more tightly packed embedding and favor local structure."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Epochs"}),": Number of epochs to use for convergence. This doesn't really change all too much."]})]})]})]}),n?Object(x.jsx)("div",{className:b.a.DIALOG_FOOTER,children:Object(x.jsx)("div",{className:b.a.DIALOG_FOOTER_ACTIONS,children:Object(x.jsx)(u.a,{content:"Run Analysis",children:Object(x.jsx)(o.a,{disabled:!P,icon:"function",onClick:function(){S(I),N(M),F()},children:"Analyze"})})})}):Object(x.jsx)("div",{style:{margin:"0 20px"}})]}))]})},y=function(){var e=Object(s.useContext)(m),t=e.initDims,n=e.qcDims;return Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)("span",{children:["Dataset dimensions: ",t?"".concat(t):" ???",n?" (after QC: ".concat(n,")"):""]})})},F=function(){var e=Object(s.useContext)(m).logs,t=Object(s.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!0,enforceFocus:!0,hasBackdrop:!0,isOpen:!1,position:p.a.RIGHT,size:void 0,usePortal:!0}),n=Object(l.a)(t,2),a=n[0],c=n[1];return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(o.a,{onClick:function(){return c({isOpen:!0})},icon:"wrench",outlined:!0,intent:"warning",children:"What's happening ?"}),Object(x.jsx)(o.i,Object(i.a)(Object(i.a)({icon:"info-sign",onClose:function(){return c({isOpen:!1})},title:"What's happening ?"},a),{},{children:Object(x.jsx)("div",{className:b.a.DRAWER_BODY,children:Object(x.jsx)("div",{className:b.a.DIALOG_BODY,children:Object(x.jsx)("ul",{className:"list",children:e.map((function(e,t){return Object(x.jsx)("li",{children:e},t)}))})})})}))]})},w=n(34),C=["buttonText","includeFooter"];var N=function(e){e.buttonText,e.includeFooter;var t=Object(j.a)(e,C),n=Object(s.useContext)(m).setOpenInput,a=Object(s.useState)(!0),c=Object(l.a)(a,2),r=c[0],d=c[1],h=Object(s.useState)(!1),p=Object(l.a)(h,2),O=p[0],f=p[1],v=Object(s.useCallback)((function(){d(!r),f(!0)}),[r]),g=Object(s.useCallback)((function(){return d(!1)}),[]);return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(o.a,{onClick:v,icon:"info-sign",intent:"primary",text:"Info"}),Object(x.jsxs)(o.g,Object(i.a)(Object(i.a)({},t),{},{isOpen:r,onClose:g,children:[Object(x.jsx)("div",{className:b.a.DIALOG_BODY,children:Object(x.jsxs)(o.d,{elevation:w.a.ZERO,children:[Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"kana"})," performs a standard scRNA-seq data analysis directly inside the browser."]}),Object(x.jsxs)("p",{children:["With just a few clicks, you can get a UMAP/t-SNE and marker genes in an intuitive interface for further exploration. No need to transfer data, no need to install software, no need to configure a backend server - just point to a Matrix Market file and we'll analyze ",Object(x.jsx)("em",{children:"your"})," data on ",Object(x.jsx)("em",{children:"your"})," computer, no questions asked."]}),Object(x.jsxs)("p",{children:["Check out our ",Object(x.jsx)("a",{href:"https://github.com/jkanche/scran.js.app",target:"_blank",children:"GitHub page"})," for more details. Or you could just play around with the app to see what it can do - after all, it's totally free!"]}),Object(x.jsx)(o.m,{children:"Authors"}),"Jayaram Kancherla (",Object(x.jsx)("a",{href:"https://github.com/jkanche",target:"_blank",children:Object(x.jsx)("strong",{children:"@jkanche"})}),"), Aaron Lun (",Object(x.jsx)("a",{href:"https://github.com/LTLA",target:"_blank",children:Object(x.jsx)("strong",{children:"@LTLA"})}),")"]})}),Object(x.jsx)("div",{className:b.a.DIALOG_FOOTER,children:Object(x.jsx)("div",{className:b.a.DIALOG_FOOTER_ACTIONS,children:O?Object(x.jsx)(o.a,{icon:"cross",onClick:g,children:"Close"}):Object(x.jsx)(u.a,{content:"\u884c\u304f\u305e!",children:Object(x.jsx)(o.a,{icon:"bring-data",onClick:function(){n(!0),g()},children:"Get started"})})})})]}))]})},k=function(){var e=Object(s.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!1,enforceFocus:!0,shouldReturnFocusOnClose:!0}),t=Object(l.a)(e,1)[0],n=Object(s.useContext)(m),a=n.setExportState,c=n.datasetName,r=n.setDatasetName;return Object(x.jsx)(x.Fragment,{children:Object(x.jsx)(o.t,{className:"bp3-dark",children:Object(x.jsxs)(o.v,{className:"navbar-group",align:d.a.LEFT,children:[Object(x.jsx)(o.w,{children:"kana"}),Object(x.jsx)(o.u,{}),Object(x.jsx)("span",{children:"Single cell RNA-seq analysis in the browser"}),Object(x.jsx)(o.u,{}),Object(x.jsx)(g,Object(i.a)({icon:"document",title:"Import dataset & update parameters (mouseover for more info)",buttonText:"Start Analysis",includeFooter:!0},t)),Object(x.jsx)(o.u,{}),Object(x.jsx)(u.a,{content:"Modify dataset title",children:Object(x.jsx)(o.j,{defaultValue:c,intent:"primary",onConfirm:function(e){r(e)}})}),Object(x.jsx)(o.u,{}),Object(x.jsx)(y,{}),Object(x.jsx)(o.u,{}),Object(x.jsx)(o.b,{children:Object(x.jsx)(h.a,{content:Object(x.jsxs)(o.r,{children:[Object(x.jsx)(o.s,{text:"Save",icon:"floppy-disk",disabled:!0}),Object(x.jsx)(o.s,{text:"Download",icon:"download",onClick:function(){a(!0)}})]}),placement:"bottom-start",children:Object(x.jsx)(o.a,{intent:"warning",rightIcon:"caret-down",icon:"document",text:"Export"})})}),Object(x.jsx)(o.u,{}),Object(x.jsx)(F,{}),Object(x.jsx)(o.u,{}),Object(x.jsx)(N,Object(i.a)({icon:"document",title:"Single-cell RNA-seq analysis in the browser",isOpen:!0},t))]})})})},S=n(15),E=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color,c=null===e||void 0===e?void 0:e.ymax;if(c||(c=Math.max.apply(Math,Object(r.a)(n.map((function(e){return e.value}))))),s||(s=325),a||(a="#00B3A4"),!n)return"";var i=t.current;i.innerHTML="";var l=10,o=30,d=30,u=40,h=s-u-o,j=200-l-d,b=S.m(i).append("svg").attr("width",h+u+o).attr("height",j+l+d).append("g").attr("transform","translate(".concat(u,",").concat(l,")")),p=S.j().range([0,h]).domain(n.map((function(e){return e.key}))).padding(.2);b.append("g").attr("transform","translate(0,"+j+")").call(S.b(p)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");var O=S.k().domain([0,c]).range([j,0]);b.append("g").call(S.c(O)),b.selectAll("bars").data(n).enter().append("rect").attr("x",(function(e){return p(e.key)})).attr("y",(function(e){return O(e.value)})).attr("width",p.bandwidth()).attr("height",(function(e){return j-O(e.value)})).attr("fill",(function(e,t){return Array.isArray(a)?a[t]:a}))}),[]),Object(x.jsx)("div",{ref:t})},D=function(e){var t,n,s=null===e||void 0===e||null===(t=e.pca)||void 0===t?void 0:t.var_exp;if(!s)return"";var a=[];return null===(n=Object.values(s))||void 0===n||n.forEach((function(e,t){a.push({key:t+1,value:100*e})})),Object(x.jsx)(E,{data:a})},A=n(63),M=function(e){var t,n,a=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.clusters,c=Object(s.useContext)(m).setClusterColors,i=Object(s.useState)(null),r=Object(l.a)(i,2),o=r[0],d=r[1];if(Object(s.useEffect)((function(){var e=Object.keys(h).length,t=null;t=e>Object.keys(u).length?Object(A.randomColor)({luminosity:"dark",count:e+1}):u[e.toString()],d(t)}),[]),Object(s.useEffect)((function(){c(o)}),[o]),!a)return"";for(var u={1:["#1b9e77"],2:["#1b9e77","#d95f02"],3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},h={},j=0;j<(null===a||void 0===a?void 0:a.length);j++){var b=a[j];"CLUS_"+b in h?h["CLUS_"+b]++:h["CLUS_"+b]=0}var p=[];return null===(n=Object.values(h))||void 0===n||n.forEach((function(e,t){p.push({key:t+1,value:e})})),o&&Object(x.jsx)(E,{data:p,color:o})},T=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.rdata,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color;if(s||(s=200),a||(a="#00B3A4"),!n)return"";var c=t.current;c.innerHTML="";var i=10,r=30,l=30,o=40,d=s-o-r,u=200-i-l,h=S.m(c).append("svg").attr("width",d+o+r).attr("height",u+i+l).append("g").attr("transform","translate(".concat(o,",").concat(i,")")),j=S.k().domain(null===e||void 0===e?void 0:e.range).range([u,0]).nice();h.append("g").call(S.c(j));var b=S.j().range([0,d]).domain([null===e||void 0===e?void 0:e.showLabel]).padding(.05);h.append("g").attr("transform","translate(0,"+u+")").call(S.b(b));var p=S.f().domain(j.domain()).thresholds(j.ticks(20)).value((function(e){return e}))(n),O=S.i(p,(function(e){return e.length})),x=S.k().range([0,b.bandwidth()]).domain([-O,O]);h.selectAll("violins").data([null===e||void 0===e?void 0:e.label]).enter().append("g").attr("transform",(function(e){return"translate("+b(e)+" ,0)"})).append("path").datum((function(){return p})).style("stroke","none").style("fill",a).attr("d",S.a().x0((function(e){return x(-e.length)})).x1((function(e){return x(e.length)})).y((function(e){return j(e.x0)})).curve(S.d)),h.selectAll("threshold").data([null===e||void 0===e?void 0:e.threshold]).enter().append("line").attr("transform",(function(){return"translate("+b(null===e||void 0===e?void 0:e.label)+" ,0)"})).attr("class","threshold").attr("x1",5).attr("y1",(function(e){return j(e)})).attr("x2",b.bandwidth()-5).attr("y2",(function(e){return j(e)})).attr("stroke-width",2).attr("stroke","Orange").on("mouseover",(function(){var e=S.m(this);e.attr("stroke","black"),e.attr("stroke-width","8")})).on("mouseout",(function(){var e=S.m(this);e.attr("stroke","Orange"),e.attr("stroke-width","5")}))}),[]),Object(x.jsx)("div",{ref:t})},L=(n(317),function(e){var t=e.data;return Object(x.jsx)("div",{className:"qc-plots",children:["sums","detected","proportion"].map((function(e){var n,s,a,c,r,l,o={threshold:"proportion"!==e?Math.log2(null===t||void 0===t||null===(n=t.thresholds)||void 0===n?void 0:n[e]):100*(null===t||void 0===t||null===(s=t.thresholds)||void 0===s?void 0:s[e]),range:"proportion"!==e?null===t||void 0===t||null===(a=t.ranges)||void 0===a?void 0:a[e].map((function(e){return Math.log2(e+1)})):null===t||void 0===t||null===(c=t.ranges)||void 0===c?void 0:c[e].map((function(e){return 100*e})),label:e,showLabel:"proportion"!==e?e+" (log)":e+" (%)",rdata:"proportion"!==e?null===t||void 0===t||null===(r=t.data)||void 0===r?void 0:r[e].map((function(e){return Math.log2(e+1)})):null===t||void 0===t||null===(l=t.data)||void 0===l?void 0:l[e].map((function(e){return 100*e}))};return Object(x.jsx)("div",{children:Object(x.jsx)(T,Object(i.a)({},o))},e)}))})}),R=(n(318),function(){var e=Object(s.useContext)(m),t=e.pcaVarExp,n=e.qcData,a=e.clusterData;return Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)("div",{className:"gallery-cont",children:[a?Object(x.jsxs)(o.d,{className:"gallery-elem",elevation:w.a.ONE,children:[Object(x.jsx)("h5",{children:"# of cells per cluster"}),Object(x.jsx)(M,{data:a})]}):"",t?Object(x.jsxs)(o.d,{className:"gallery-elem",elevation:w.a.ONE,children:[Object(x.jsx)("h5",{children:"PCA (% variance explained)"}),Object(x.jsx)(D,{pca:t})]}):"",n&&(null===n||void 0===n?void 0:n.thresholds)?Object(x.jsxs)(o.d,{className:"gallery-elem",elevation:w.a.ONE,children:[Object(x.jsx)("h5",{children:"QC Statistics"}),Object(x.jsx)(L,{data:n})]}):""]})})}),I=n(79),B=function(e){var t=-Number.MAX_VALUE,n=Number.MAX_VALUE;return e.forEach((function(e){t<e&&(t=e),n>e&&(n=e)})),[n,t]};function _(){var e=null,t=0,n=100,s=["ff0000","ffff00","00ff00","0000ff"];function a(a){if(a.length<2)throw new Error("Rainbow must have two or more colours.");var c=(n-t)/(a.length-1),i=new q;i.setGradient(a[0],a[1]),i.setNumberRange(t,t+c),e=[i];for(var r=1;r<a.length-1;r++){var l=new q;l.setGradient(a[r],a[r+1]),l.setNumberRange(t+c*r,t+c*(r+1)),e[r]=l}s=a}a(s),this.setSpectrum=function(){return a(arguments),this},this.setSpectrumByArray=function(e){return a(e),this},this.colourAt=function(s){if(isNaN(s))throw new TypeError(s+" is not a number");if(1===e.length)return e[0].colourAt(s);var a=(n-t)/e.length,c=Math.min(Math.floor((Math.max(s,t)-t)/a),e.length-1);return e[c].colourAt(s)},this.colorAt=this.colourAt,this.setNumberRange=function(e,c){if(!(c>e))throw new RangeError("maxNumber ("+c+") is not greater than minNumber ("+e+")");return t=e,n=c,a(s),this}}function q(){var e="ff0000",t="0000ff",n=0,s=100;function a(e,t,a){var c=e;c<n&&(c=n),c>s&&(c=s);var i,r=s-n,l=parseInt(t,16),o=(parseInt(a,16)-l)/r,d=Math.round(o*(c-n)+l);return 1===(i=d.toString(16)).length?"0"+i:i}function c(e){if(function(e){return/^#?[0-9a-fA-F]{6}$/i.test(e)}(e))return e.substring(e.length-6,e.length);var t=e.toLowerCase();if(i.hasOwnProperty(t))return i[t];throw new Error(e+" is not a valid colour.")}this.setGradient=function(n,s){e=c(n),t=c(s)},this.setNumberRange=function(e,t){if(!(t>e))throw new RangeError("maxNumber ("+t+") is not greater than minNumber ("+e+")");n=e,s=t},this.colourAt=function(n){return a(n,e.substring(0,2),t.substring(0,2))+a(n,e.substring(2,4),t.substring(2,4))+a(n,e.substring(4,6),t.substring(4,6))};var i={aliceblue:"F0F8FF",antiquewhite:"FAEBD7",aqua:"00FFFF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000000",blanchedalmond:"FFEBCD",blue:"0000FF",blueviolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetblue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerblue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"00FFFF",darkblue:"00008B",darkcyan:"008B8B",darkgoldenrod:"B8860B",darkgray:"A9A9A9",darkgreen:"006400",darkgrey:"A9A9A9",darkkhaki:"BDB76B",darkmagenta:"8B008B",darkolivegreen:"556B2F",darkorange:"FF8C00",darkorchid:"9932CC",darkred:"8B0000",darksalmon:"E9967A",darkseagreen:"8FBC8F",darkslateblue:"483D8B",darkslategray:"2F4F4F",darkslategrey:"2F4F4F",darkturquoise:"00CED1",darkviolet:"9400D3",deeppink:"FF1493",deepskyblue:"00BFFF",dimgray:"696969",dimgrey:"696969",dodgerblue:"1E90FF",firebrick:"B22222",floralwhite:"FFFAF0",forestgreen:"228B22",fuchsia:"FF00FF",gainsboro:"DCDCDC",ghostwhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"808080",green:"008000",greenyellow:"ADFF2F",grey:"808080",honeydew:"F0FFF0",hotpink:"FF69B4",indianred:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderblush:"FFF0F5",lawngreen:"7CFC00",lemonchiffon:"FFFACD",lightblue:"ADD8E6",lightcoral:"F08080",lightcyan:"E0FFFF",lightgoldenrodyellow:"FAFAD2",lightgray:"D3D3D3",lightgreen:"90EE90",lightgrey:"D3D3D3",lightpink:"FFB6C1",lightsalmon:"FFA07A",lightseagreen:"20B2AA",lightskyblue:"87CEFA",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"B0C4DE",lightyellow:"FFFFE0",lime:"00FF00",limegreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumaquamarine:"66CDAA",mediumblue:"0000CD",mediumorchid:"BA55D3",mediumpurple:"9370DB",mediumseagreen:"3CB371",mediumslateblue:"7B68EE",mediumspringgreen:"00FA9A",mediumturquoise:"48D1CC",mediumvioletred:"C71585",midnightblue:"191970",mintcream:"F5FFFA",mistyrose:"FFE4E1",moccasin:"FFE4B5",navajowhite:"FFDEAD",navy:"000080",oldlace:"FDF5E6",olive:"808000",olivedrab:"6B8E23",orange:"FFA500",orangered:"FF4500",orchid:"DA70D6",palegoldenrod:"EEE8AA",palegreen:"98FB98",paleturquoise:"AFEEEE",palevioletred:"DB7093",papayawhip:"FFEFD5",peachpuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderblue:"B0E0E6",purple:"800080",red:"FF0000",rosybrown:"BC8F8F",royalblue:"4169E1",saddlebrown:"8B4513",salmon:"FA8072",sandybrown:"F4A460",seagreen:"2E8B57",seashell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyblue:"87CEEB",slateblue:"6A5ACD",slategray:"708090",slategrey:"708090",snow:"FFFAFA",springgreen:"00FF7F",steelblue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFFFFF",whitesmoke:"F5F5F5",yellow:"FFFF00",yellowgreen:"9ACD32"}}n(330);var P=function(){var e,t,n=Object(s.useRef)(),a=Object(s.useState)(null),c=Object(l.a)(a,2),d=c[0],h=c[1],j=Object(s.useState)(null),b=Object(l.a)(j,2),p=b[0],O=b[1],f=Object(s.useState)(!1),v=Object(l.a)(f,2),g=v[0],y=v[1],F=Object(s.useState)(null),w=Object(l.a)(F,2),C=w[0],N=w[1],k=Object(s.useState)(C),S=Object(l.a)(k,2),E=S[0],D=S[1],M=Object(s.useState)(null),T=Object(l.a)(M,2),L=T[0],R=T[1],q=Object(s.useContext)(m),P=q.plotRedDims,G=q.redDims,W=q.defaultRedDims,z=q.setDefaultRedDims,U=q.clusterData,V=q.tsneData,H=q.umapData,X=q.setPlotRedDims,Q=q.clusterColors,Y=q.setClusterColors,Z=q.gene,J=q.selectedClusterSummary,K=q.customSelection,$=q.setCustomSelection,ee=q.setDelCustomSelection,te=Object(s.useState)(null),ne=Object(l.a)(te,2),se=ne[0],ae=ne[1],ce=Object(s.useState)("PAN"),ie=Object(l.a)(ce,2),re=ie[0],le=ie[1];Object(s.useEffect)((function(){var e;if(null===Z&&(y(!1),R(null)),null===J||void 0===J||null===(e=J[Z])||void 0===e?void 0:e.expr){var t,n=B(null===J||void 0===J||null===(t=J[Z])||void 0===t?void 0:t.expr),s=0===n[1]?.01:n[1],a=new _;a.setSpectrum("#F5F8FA","#2965CC"),a.setNumberRange(0,s),y(!0),R(a),D([0,s]),N([0,s])}}),[null===J||void 0===J||null===(e=J[Z])||void 0===e?void 0:e.expr],Z),Object(s.useEffect)((function(){if(Array.isArray(E)){var e=new _;e.setSpectrum("#F5F8FA","#2965CC"),e.setNumberRange.apply(e,Object(r.a)(E)),R(e),y(!0)}}),[E]),Object(s.useEffect)((function(){if(n.current){var e=d;if(!e){var t=n.current;t.style.width="95%",t.style.height="95%",e=new I.ScatterGL(t,{onSelect:function(e){0!==e.length&&ae(e)},orbitControls:{zoomSpeed:1.25},styles:{point:{scaleDefault:1.75,scaleSelected:2,scaleHover:2}}}),e.setPanMode(),h(e)}if(null===P||void 0===P?void 0:P.plot){var s=null===P||void 0===P?void 0:P.clusters,a=Q,c=[];null===P||void 0===P||P.plot.x.forEach((function(e,t){c.push([e,null===P||void 0===P?void 0:P.plot.y[t]])}));var i={clusters:s},l=new I.ScatterGL.Dataset(c,i),o=Math.max.apply(Math,Object(r.a)(null===U||void 0===U?void 0:U.clusters));e.render(l),e.setPointColorer((function(e,t,n){var c,i,r;if(t.has(e))return"#30404D";if(null!=p)if(String(p).startsWith("cs")){if(!K[p].includes(e))return"#D3D3D3"}else if(p!==s[e])return"#D3D3D3";if(null!==Z&&Array.isArray(null===J||void 0===J||null===(c=J[Z])||void 0===c?void 0:c.expr))return"#"+L.colorAt(null===J||void 0===J||null===(i=J[Z])||void 0===i||null===(r=i.expr)||void 0===r?void 0:r[e]);if(null!=p&&String(p).startsWith("cs")){var l=parseInt(p.replace("cs",""));return a[o+l]}return a[s[e]]}))}}}),[P,L,p]),Object(s.useEffect)((function(){oe(W)}),[W]);var oe=function(e){"TSNE"===W?X({plot:V,clusters:null===U||void 0===U?void 0:U.clusters}):"UMAP"===W&&X({plot:H,clusters:null===U||void 0===U?void 0:U.clusters})},de=function(e){"PAN"===e?(d.setPanMode(),le("PAN")):"SELECT"===e&&(d.setSelectMode(),le("SELECT"))};return Object(x.jsxs)("div",{className:"scatter-plot",children:[Object(x.jsxs)(o.b,{style:{minWidth:75,minHeight:150},fill:!1,large:!1,minimal:!1,vertical:!0,className:"left-sidebar",children:[Object(x.jsxs)(o.a,{className:"dim-button",disabled:-1===G.indexOf("TSNE"),onClick:function(){return z("TSNE")},intent:"TSNE"===W?"primary":"",children:[Object(x.jsx)(o.o,{icon:"database"}),Object(x.jsx)("br",{}),Object(x.jsx)("span",{children:"TSNE"})]}),Object(x.jsxs)(o.a,{className:"dim-button",disabled:-1===G.indexOf("UMAP"),onClick:function(){return z("UMAP")},intent:"UMAP"===W?"primary":"",children:[Object(x.jsx)(o.o,{icon:"database"}),Object(x.jsx)("br",{}),Object(x.jsx)("span",{children:"UMAP"})]})]}),Object(x.jsxs)(o.f,{className:"top-header",fill:!1,vertical:!1,children:[Object(x.jsx)(o.a,{active:"PAN"==re,intent:"PAN"===re?"primary":"none",icon:"hand-up",onClick:function(e){return de("PAN")},children:"Pan"}),Object(x.jsx)(o.a,{active:"SELECT"==re,intent:"SELECT"===re?"primary":"none",icon:"widget",onClick:function(e){return de("SELECT")},children:"Selection"})]}),Object(x.jsx)("div",{className:"dim-plot",children:(null===P||void 0===P?void 0:P.plot)?Object(x.jsx)("div",{ref:n}):"Choose an Embedding... or Embeddings are being computed..."}),Object(x.jsx)("div",{className:"right-sidebar",children:Object(x.jsxs)("div",{style:{width:"100%"},children:[Object(x.jsxs)("div",{className:"right-sidebar-cluster",children:[Object(x.jsxs)(o.c,{title:"CLUSTERS",children:[Object(x.jsx)("ul",{children:null===Q||void 0===Q?void 0:Q.map((function(e,t){return t<Q.length-Object.keys(K).length?Object(x.jsxs)("li",{className:p==t?"legend-highlight":"",style:{color:e},onClick:function(){O(t===p?null:t)},children:[" Cluster ",t+1," "]},t):""}))}),Object.keys(K).length>0?Object(x.jsxs)("div",{style:{paddingTop:"5px"},children:[Object(x.jsxs)("span",{children:["Custom Selection \xa0",Object(x.jsx)(u.a,{content:"Custom selection of cells",openOnTargetFocus:!1,children:Object(x.jsx)(o.o,{icon:"help"})})]}),Object(x.jsx)("ul",{children:null===(t=Object.keys(K))||void 0===t?void 0:t.map((function(e,t){return Object(x.jsx)("li",{className:p==e?"legend-highlight":"",style:{color:Q[Math.max.apply(Math,Object(r.a)(null===U||void 0===U?void 0:U.clusters))+1+t]},children:Object(x.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",flexDirection:"row"},children:[Object(x.jsxs)("span",{style:{alignSelf:"center"},onClick:function(){O(e===p?null:e)},children:["Custom Selection ",e.replace("cs","")]}),Object(x.jsx)(o.o,{size:12,icon:"trash",style:{paddingLeft:"2px"},onClick:function(){var t=Object(i.a)({},K);delete t[e],$(t);var n=Object(r.a)(Q);n=n.slice(0,n.length-1),Y(n),ee(e),p===e&&O(null)}})]})},e)}))})]}):""]}),se&&se.length>0?Object(x.jsxs)("div",{children:[Object(x.jsx)(o.h,{}),Object(x.jsxs)("span",{children:["Selection \xa0",Object(x.jsx)(u.a,{content:"save this selection of cells",openOnTargetFocus:!1,children:Object(x.jsx)(o.o,{icon:"help"})})]}),Object(x.jsxs)("div",{className:"selection-container",children:[Object(x.jsxs)("span",{children:[se.length," cells selected"]}),Object(x.jsxs)("div",{className:"selection-button-container",children:[Object(x.jsx)(o.a,{small:!0,intent:"primary",onClick:function(){var e=Object(A.randomColor)({luminosity:"dark",count:1}),t=Object(r.a)(Q);t.push(e[0]),Y(t);var n=Object.keys(K).length,s=Object(i.a)({},K);s["cs".concat(n+1)]=se,$(s),ae(null),d.select(null)},children:"Save"}),Object(x.jsx)(o.a,{small:!0,onClick:function(){ae(null),d.select(null)},children:"Clear"})]})]})]}):""]}),g?Object(x.jsxs)("div",{className:"right-sidebar-slider",children:[Object(x.jsx)(o.h,{}),Object(x.jsxs)(o.c,{children:[Object(x.jsxs)("span",{children:["Customize Gradient \xa0",Object(x.jsx)(u.a,{content:"Use the slider to adjust the color gradient of the plot. Useful when data is skewed by either a few lowly or highly expressed cells",openOnTargetFocus:!1,children:Object(x.jsx)(o.o,{icon:"help"})})]}),Object(x.jsxs)("div",{className:"dim-slider-container",children:[Object(x.jsxs)("div",{className:"dim-slider-gradient",children:[Object(x.jsx)("span",{children:Math.round(C[0])}),"\xa0",Object(x.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, #F5F8FA ".concat(100*(E[0]-C[0])/(C[1]-C[0]),"%, ").concat(100*(E[1]+E[0]-2*C[0])/(2*(C[1]-C[0])),"%, #2965CC ").concat(100-100*(C[1]-E[1])/(C[1]-C[0]),"%)"),width:"175px",height:"15px"}}),"\xa0",Object(x.jsx)("span",{children:Math.round(C[1])})]}),Object(x.jsx)("div",{className:"dim-range-slider",children:Object(x.jsx)(o.A,{min:Math.round(C[0]),max:Math.round(C[1]),stepSize:Math.round(C[1]-C[0])/25,onChange:function(e){D(e)},value:[Math.round(E[0]),Math.round(E[1])],vertical:!1})})]})]})]}):""]})})]})},G=n(136),W=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color,c=null===e||void 0===e?void 0:e.clusters;if(s||(s=325),a||(a="#00B3A4"),!n)return"";var i=t.current;i.innerHTML="";var l=10,o=30,d=30,u=40,h=s-u-o,j=150-l-d,b=S.m(i).append("svg").attr("width",h+u+o).attr("height",j+l+d).append("g").attr("transform","translate(".concat(u,",").concat(l,")")),p=S.k().domain([0,Math.max.apply(Math,Object(r.a)(n))]).range([0,h]);b.append("g").attr("transform","translate(0, ".concat(j,")")).call(S.b(p));var O=S.f().value((function(e){return e})).domain(p.domain()).thresholds(p.ticks(25)),x=O(n),m=O(n.filter((function(e,t){return 0===(null===c||void 0===c?void 0:c[t])}))),f=O(n.filter((function(e,t){return 1===(null===c||void 0===c?void 0:c[t])}))),v=S.k().range([j,0]).domain([0,S.i(x,(function(e){return e.length}))]);b.selectAll("rectAll").data(m).join("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(p(e.x0)," , ").concat(v(e.length),")")})).attr("width",(function(e){return p(e.x1)-p(e.x0)-1})).attr("height",(function(e){return j-v(e.length)})).style("fill","#D3D3D3").style("opacity",.6),b.selectAll("rectCluster").data(f).enter().append("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(p(e.x0),", ").concat(v(e.length),")")})).attr("width",(function(e){return p(e.x1)-p(e.x0)-1})).attr("height",(function(e){return j-v(e.length)})).style("fill",a).style("opacity",.6),b.append("circle").attr("cx",h-50).attr("cy",5).attr("r",3).style("fill","#D3D3D3"),b.append("circle").attr("cx",h-50).attr("cy",15).attr("r",3).style("fill",a),b.append("text").attr("x",h-40).attr("y",5).text("all cells").style("font-size","10px").attr("alignment-baseline","middle"),b.append("text").attr("x",h-40).attr("y",15).text("this cluster").style("font-size","10px").attr("alignment-baseline","middle")}),[]),Object(x.jsx)("div",{ref:t})},z=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.height,c=null===e||void 0===e?void 0:e.color;if(s||(s=325),a||(a=150),c||(c="#00B3A4"),!n)return"";var i=t.current;i.innerHTML="";var l=5,o=5,d=5,u=5,h=s-u-o,j=a-l-d,b=S.m(i).append("svg").attr("width",h+u+o).attr("height",j+l+d).append("g").attr("transform","translate(".concat(u,",").concat(l,")")),p=S.k().domain([0,Math.max.apply(Math,Object(r.a)(n))]).range([0,h]);b.append("g").attr("transform","translate(0, ".concat(j,")")).call(S.b(p));var O=S.f().value((function(e){return e})).domain(p.domain()).thresholds(p.ticks(25))(n),x=S.k().range([j,0]);x.domain([0,S.i(O,(function(e){return e.length}))]),b.selectAll("rect").data(O).join("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(p(e.x0)," , ").concat(x(e.length),")")})).attr("width",(function(e){return p(e.x1)-p(e.x0)-1})).attr("height",(function(e){return j-x(e.length)})).style("fill",c)}),[null===e||void 0===e?void 0:e.data]),Object(x.jsx)("div",{ref:t})},U=function(e){var t=Object(s.useRef)(),n=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.minmax,c=null===e||void 0===e?void 0:e.score,i=null===e||void 0===e?void 0:e.colorscale,r=null===e||void 0===e?void 0:e.colorscore,l=null===e||void 0===e?void 0:e.color,o=(c-a[0])/(a[1]-a[0]);return n||(n="100%"),l||(l="#00B3A4"),Object(x.jsx)("div",{ref:t,style:{width:n,height:"15px",margin:"5px",border:"1px solid gainsboro",alignItems:"center"},children:i?Object(x.jsx)("div",{style:{width:"".concat(100*r,"%"),backgroundColor:i(r),height:"100%"}}):Object(x.jsx)("div",{style:{width:"".concat(100*o,"%"),backgroundColor:l,height:"100%"}})})},V=function(e){var t=Object(s.useRef)(),n=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.score,c=null===e||void 0===e?void 0:e.minmax,i=S.l(S.h).domain([c[1],c[0]]);return n||(n="100%"),Object(x.jsx)("div",{ref:t,style:{width:n,height:"15px",margin:"5px",border:"1px solid gainsboro",alignItems:"center",backgroundColor:i(a)},children:Object(x.jsx)("div",{style:{width:"100%",backgroundColor:i(a),height:"100%"}})})},H=(n(331),["children"]),X=function(){var e=Object(s.useContext)(m),t=e.genesInfo,n=e.clusterData,a=e.selectedClusterSummary,c=e.setSelectedClusterSummary,d=e.selectedCluster,p=e.setSelectedCluster,O=e.setClusterRank,f=e.setReqGene,v=e.clusterColors,g=e.gene,y=e.setGene,F=e.customSelection,C=Object(s.useState)(null),N=Object(l.a)(C,2),k=N[0],E=N[1],D=Object(s.useState)(null),A=Object(l.a)(D,2),M=A[0],T=A[1],L=Object(s.useState)(null),R=Object(l.a)(L,2),I=R[0],B=R[1],_=Object(s.useState)(null),q=Object(l.a)(_,2),P=q[0],X=q[1],Q=Object(s.useState)(null),Y=Object(l.a)(Q,2),Z=Y[0],J=Y[1],K=Object(s.useState)(null),$=Object(l.a)(K,2),ee=$[0],te=$[1],ne=Object(s.useState)(null),se=Object(l.a)(ne,2),ae=se[0],ce=se[1],ie=Object(s.useState)(null),re=Object(l.a)(ie,2),le=re[0],oe=re[1],de=Object(s.useState)(null),ue=Object(l.a)(de,2),he=ue[0],je=ue[1],be=Object(s.useState)(null),pe=Object(l.a)(be,2),Oe=pe[0],xe=pe[1],me=Object(s.useState)(null),fe=Object(l.a)(me,2),ve=fe[0],ge=fe[1],ye=Object(s.useState)(null),Fe=Object(l.a)(ye,2),we=Fe[0],Ce=Fe[1],Ne=Object(s.useState)({}),ke=Object(l.a)(Ne,2),Se=ke[0],Ee=ke[1],De=Object(s.useState)(null),Ae=Object(l.a)(De,2),Me=Ae[0],Te=Ae[1],Le=S.h;Object(s.useEffect)((function(){if(!a)return a;var e=a;if(0===e.length)return e;var t=e.map((function(e){return null===e||void 0===e?void 0:e.mean})),n=S.e(t),s=0===n[1]?.01:n[1];X([parseFloat(n[0].toFixed(2)),parseFloat(s.toFixed(2))]),je(t);var c=e.map((function(e){return null===e||void 0===e?void 0:e.delta})),i=S.e(c),l=0===i[1]?.01:i[1];J([parseFloat(i[0].toFixed(2)),parseFloat(l.toFixed(2))]),xe(c);var o=e.map((function(e){return null===e||void 0===e?void 0:e.lfc})),d=S.e(o),u=0===d[1]?.01:d[1];te([parseFloat(d[0].toFixed(2)),parseFloat(u.toFixed(2))]),ge(o);var h=e.map((function(e){return null===e||void 0===e?void 0:e.detected})),j=S.e(h),b=0===j[1]?.01:j[1];ce([parseFloat(j[0].toFixed(2)),parseFloat(b.toFixed(2))]),Ce(h),oe({lfc:[parseFloat(d[0].toFixed(2)),parseFloat(u.toFixed(2))],mean:[parseFloat(n[0].toFixed(2)),parseFloat(s.toFixed(2))],detected:[parseFloat(j[0].toFixed(2)),parseFloat(b.toFixed(2))],delta:[parseFloat(i[0].toFixed(2)),parseFloat(l.toFixed(2))]});var p=Object(r.a)(e);Te(p)}),[a]);var Re=Object(s.useMemo)((function(){if(!Me)return[];var e=Me;if(Se){var n=function(t){var n=Se[t];if(n[0]==le[t][0]&&n[1]==le[t][1])return"continue";e=e.filter((function(e){return e[t]>=n[0]&&e[t]<=n[1]}))};for(var s in Se)n(s)}return I&&""!==I?e=e.filter((function(e){return-1!==t[e.row].toLowerCase().indexOf(I.toLowerCase())})):e}),[Me,I,Se]);Object(s.useEffect)((function(){if(null===n||void 0===n?void 0:n.clusters){for(var e=Math.max.apply(Math,Object(r.a)(n.clusters)),t=[],s=0;s<e+1;s++)t.push(s+1);t=t.concat(Object.keys(F)),E(t),null==d&&p(0)}}),[n,F,d]),Object(s.useEffect)((function(){var e,t,s=[];String(d).startsWith("cs")?null===n||void 0===n||null===(e=n.clusters)||void 0===e||e.forEach((function(e,t){return F[d].includes(t)?s.push(1):s.push(0)})):null===n||void 0===n||null===(t=n.clusters)||void 0===t||t.forEach((function(e){return e===d?s.push(1):s.push(0)}));T(s)}),[d]);var Ie=function(e,t){var n=Object(i.a)({},Se);n[t]=e,Ee(n)};return Object(x.jsxs)("div",{className:"marker-container",children:[Object(x.jsx)(o.l,{children:"Marker Genes"}),k?Object(x.jsx)(o.n,{onChange:function(e){var t;y(null);var n=null===(t=e.currentTarget)||void 0===t?void 0:t.value;n.startsWith("Cluster")?n=parseInt(n.replace("Cluster ",""))-1:n.startsWith("Custom")&&(n=n.replace("Custom Selection ","")),p(n),Ee({}),y(null)},children:k.map((function(e,t){return Object(x.jsxs)("option",{children:[String(e).startsWith("cs")?"Custom Selection":"Cluster"," ",e]},t)}))}):"",a?Object(x.jsxs)("div",{className:"marker-table",children:[Object(x.jsxs)("div",{className:"marker-header",children:[Object(x.jsx)(o.p,{leftIcon:"search",small:!0,placeholder:"Search gene...",type:"text",onChange:function(e){return B(e.target.value)}}),Object(x.jsxs)("span",{children:[Object(x.jsx)(o.o,{icon:"sort",style:{paddingRight:"5px"}}),Object(x.jsxs)(o.n,{onChange:function(e){O(e.currentTarget.value)},defaultValue:"cohen-min-rank",children:[Object(x.jsx)("option",{children:"cohen-min"}),Object(x.jsx)("option",{children:"cohen-mean"}),Object(x.jsx)("option",{children:"cohen-min-rank"}),Object(x.jsx)("option",{children:"auc-min"}),Object(x.jsx)("option",{children:"auc-mean"}),Object(x.jsx)("option",{children:"auc-min-rank"}),Object(x.jsx)("option",{children:"lfc-min"}),Object(x.jsx)("option",{children:"lfc-mean"}),Object(x.jsx)("option",{children:"lfc-min-rank"}),Object(x.jsx)("option",{children:"delta-d-min"}),Object(x.jsx)("option",{children:"delta-d-mean"}),Object(x.jsx)("option",{children:"delta-d-min-rank"})]})]})]}),Object(x.jsx)(G.a,{components:{Item:function(e){var t=e.children,n=Object(j.a)(e,H);return Object(x.jsx)("div",Object(i.a)(Object(i.a)({className:"row-card"},n),{},{children:t}))},Header:function(){return Object(x.jsxs)("div",{className:"row-container row-header",children:[Object(x.jsx)("span",{children:"Gene"}),Object(x.jsx)("span",{children:"Log-FC"}),Object(x.jsx)("span",{children:"\u0394-detected"}),Object(x.jsxs)("span",{children:["Expression \xa0",Object(x.jsx)(u.a,{content:"bar represents the mean expression of the gene and the color gradient represents detected.",openOnTargetFocus:!1,children:Object(x.jsx)(o.o,{size:12,icon:"help"})})]}),Object(x.jsx)("span",{})]})}},className:"marker-list",totalCount:Re.length,itemContent:function(e){var s=Re[e],i=s.expanded,l=s.expr;return Object(x.jsxs)("div",{children:[Object(x.jsxs)("div",{className:"row-container",children:[Object(x.jsx)("span",{children:t[s.row]}),Object(x.jsx)(h.a,{popoverClassName:b.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(x.jsx)(o.d,{elevation:w.a.ZERO,children:Object(x.jsxs)("table",{children:[Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{}),Object(x.jsx)("th",{scope:"col",children:t[s.row]}),Object(x.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Log-FC"}),Object(x.jsx)("td",{children:s.lfc.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ee[0].toFixed(2),", ",ee[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(x.jsx)("td",{children:s.delta.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",Z[0].toFixed(2),", ",Z[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Detected"}),Object(x.jsx)("td",{children:s.detected.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ae[0].toFixed(2),", ",ae[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Expression"}),Object(x.jsx)("td",{children:s.mean.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",P[0].toFixed(2),", ",P[1].toFixed(2),"]"]})]})]})}),children:Object(x.jsx)(V,{minmax:ee,colorscale:S.g,score:s.lfc})}),Object(x.jsx)(h.a,{popoverClassName:b.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(x.jsx)(o.d,{elevation:w.a.ZERO,children:Object(x.jsxs)("table",{children:[Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{}),Object(x.jsx)("th",{scope:"col",children:t[s.row]}),Object(x.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(x.jsx)("td",{children:s.delta.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",Z[0].toFixed(2),", ",Z[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Detected"}),Object(x.jsx)("td",{children:s.detected.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ae[0].toFixed(2),", ",ae[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Log-FC"}),Object(x.jsx)("td",{children:s.lfc.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ee[0].toFixed(2),", ",ee[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Expression"}),Object(x.jsx)("td",{children:s.mean.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",P[0].toFixed(2),", ",P[1].toFixed(2),"]"]})]})]})}),children:Object(x.jsx)(V,{minmax:Z,colorscale:S.g,score:s.delta})}),Object(x.jsx)(h.a,{popoverClassName:b.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(x.jsx)(o.d,{elevation:w.a.ZERO,children:Object(x.jsxs)("table",{children:[Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{}),Object(x.jsx)("th",{scope:"col",children:t[s.row]}),Object(x.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Expression"}),Object(x.jsx)("td",{children:s.mean.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",P[0].toFixed(2),", ",P[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Log-FC"}),Object(x.jsx)("td",{children:s.lfc.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ee[0].toFixed(2),", ",ee[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(x.jsx)("td",{children:s.delta.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",Z[0].toFixed(2),", ",Z[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Detected"}),Object(x.jsx)("td",{children:s.detected.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ae[0].toFixed(2),", ",ae[1].toFixed(2),"]"]})]})]})}),children:Object(x.jsx)(U,{minmax:P,colorscale:Le,score:s.mean,colorscore:s.detected})}),Object(x.jsxs)("div",{className:"row-action",children:[Object(x.jsx)(o.a,{icon:i?"minus":"plus",small:!0,fill:!1,className:"row-action",onClick:function(){var e=Object(r.a)(a);e[s.index].expanded=!e[s.index].expanded,c(e),l||f(s.row)}}),Object(x.jsx)(o.a,{small:!0,fill:!1,className:"row-action",onClick:function(){s.index===g?y(null):(y(s.index),l||f(s.row))},children:Object(x.jsx)(o.o,{icon:"tint",color:s.index===g&&String(d).startsWith("cs")?v[Math.max.apply(Math,Object(r.a)(null===n||void 0===n?void 0:n.clusters))+parseInt(d.replace("cs",""))]:""})})]})]}),Object(x.jsx)(o.e,{isOpen:i,children:l&&Object(x.jsx)(W,{data:l,color:String(d).startsWith("cs")?v[Math.max.apply(Math,Object(r.a)(null===n||void 0===n?void 0:n.clusters))+parseInt(d.replace("cs",""))]:v[d],clusters:M})})]})}}),Object(x.jsxs)("div",{className:"marker-footer",children:[Object(x.jsx)(o.m,{className:"marker-footer-title",children:"Filter Markers"}),Object(x.jsxs)("div",{className:"marker-filter-container",children:[Object(x.jsx)(o.D,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Log-FC"}),Object(x.jsx)(z,{data:ve,height:35,color:"#F5498B"}),Object(x.jsx)("div",{className:"marker-filter-slider",children:ee&&Object(x.jsx)(o.A,{min:ee[0],max:ee[1],stepSize:parseFloat((Math.abs(ee[1]-ee[0])/20).toFixed(2)),onChange:function(e){return Ie(e,"lfc")},value:(null===Se||void 0===Se?void 0:Se.lfc)?null===Se||void 0===Se?void 0:Se.lfc:ee,vertical:!1})})]}),Object(x.jsxs)("div",{className:"marker-filter-container",children:[Object(x.jsx)(o.D,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"\u0394-detected"}),Object(x.jsx)(z,{data:Oe,height:35,color:"#4580E6"}),Object(x.jsx)("div",{className:"marker-filter-slider",children:Z&&Object(x.jsx)(o.A,{min:Z[0],max:Z[1],stepSize:parseFloat((Math.abs(Z[1]-Z[0])/20).toFixed(2)),onChange:function(e){return Ie(e,"delta")},value:(null===Se||void 0===Se?void 0:Se.delta)?null===Se||void 0===Se?void 0:Se.delta:Z,vertical:!1})})]}),Object(x.jsxs)("div",{className:"marker-filter-container",children:[Object(x.jsx)(o.D,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Mean"}),Object(x.jsx)(z,{data:he,height:35}),Object(x.jsx)("div",{className:"marker-filter-slider",children:P&&Object(x.jsx)(o.A,{min:P[0],max:P[1],stepSize:parseFloat((Math.abs(P[1]-P[0])/20).toFixed(2)),onChange:function(e){return Ie(e,"mean")},value:(null===Se||void 0===Se?void 0:Se.mean)?null===Se||void 0===Se?void 0:Se.mean:P,vertical:!1})})]}),Object(x.jsxs)("div",{className:"marker-filter-container",children:[Object(x.jsx)(o.D,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Detected"}),Object(x.jsx)(z,{data:we,height:35}),Object(x.jsx)("div",{className:"marker-filter-slider",children:ae&&Object(x.jsx)(o.A,{min:ae[0],max:ae[1],stepSize:parseFloat((Math.abs(ae[1]-ae[0])/20).toFixed(2)),onChange:function(e){return Ie(e,"detected")},value:(null===Se||void 0===Se?void 0:Se.detected)?null===Se||void 0===Se?void 0:Se.detected:ae,vertical:!1})})]})]})]}):""]})},Q=(n(332),n(333),function(){var e=Object(s.useRef)();return Object(s.useEffect)((function(){var t=e.current,n=0,s=1,a=2,c=3,i=4,r=[5,5,3,3,2],l=["#1abc9c","#2ecc71","#3498db","#e74c3c","#9b59b6"],o={new:function(e){return{width:18,height:18,x:this.canvas.width/2-9,y:this.canvas.height/2-9,moveX:n,moveY:n,speed:e||9}}},d={new:function(e){return{width:18,height:70,x:"left"===e?150:this.canvas.width-150,y:this.canvas.height/2-35,score:0,move:n,speed:10}}},u={initialize:function(){this.canvas=t.querySelector("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=1400,this.canvas.height=1e3,this.canvas.style.width=this.canvas.width/2+"px",this.canvas.style.height=this.canvas.height/2+"px",this.player=d.new.call(this,"left"),this.paddle=d.new.call(this,"right"),this.ball=o.new.call(this),this.paddle.speed=8,this.running=this.over=!1,this.turn=this.paddle,this.timer=this.round=0,this.color="#2c3e50",h.menu(),h.listen()},endGameMenu:function(e){h.context.font="50px Courier New",h.context.fillStyle=this.color,h.context.fillRect(h.canvas.width/2-350,h.canvas.height/2-48,700,100),h.context.fillStyle="#ffffff",h.context.fillText(e,h.canvas.width/2,h.canvas.height/2+15),setTimeout((function(){(h=Object.assign({},u)).initialize()}),3e3)},menu:function(){h.draw(),this.context.font="50px Courier New",this.context.fillStyle=this.color,this.context.fillRect(this.canvas.width/2-350,this.canvas.height/2-48,700,100),this.context.fillStyle="#ffffff",this.context.fillText("Press any key to begin",this.canvas.width/2,this.canvas.height/2+15)},update:function(){this.over||(this.ball.x<=0&&h._resetTurn.call(this,this.paddle,this.player),this.ball.x>=this.canvas.width-this.ball.width&&h._resetTurn.call(this,this.player,this.paddle),this.ball.y<=0&&(this.ball.moveY=a),this.ball.y>=this.canvas.height-this.ball.height&&(this.ball.moveY=s),this.player.move===s?this.player.y-=this.player.speed:this.player.move===a&&(this.player.y+=this.player.speed),h._turnDelayIsOver.call(this)&&this.turn&&(this.ball.moveX=this.turn===this.player?c:i,this.ball.moveY=[s,a][Math.round(Math.random())],this.ball.y=Math.floor(Math.random()*this.canvas.height-200)+200,this.turn=null),this.player.y<=0?this.player.y=0:this.player.y>=this.canvas.height-this.player.height&&(this.player.y=this.canvas.height-this.player.height),this.ball.moveY===s?this.ball.y-=this.ball.speed/1.5:this.ball.moveY===a&&(this.ball.y+=this.ball.speed/1.5),this.ball.moveX===c?this.ball.x-=this.ball.speed:this.ball.moveX===i&&(this.ball.x+=this.ball.speed),this.paddle.y>this.ball.y-this.paddle.height/2&&(this.ball.moveX===i?this.paddle.y-=this.paddle.speed/1.5:this.paddle.y-=this.paddle.speed/4),this.paddle.y<this.ball.y-this.paddle.height/2&&(this.ball.moveX===i?this.paddle.y+=this.paddle.speed/1.5:this.paddle.y+=this.paddle.speed/4),this.paddle.y>=this.canvas.height-this.paddle.height?this.paddle.y=this.canvas.height-this.paddle.height:this.paddle.y<=0&&(this.paddle.y=0),this.ball.x-this.ball.width<=this.player.x&&this.ball.x>=this.player.x-this.player.width&&this.ball.y<=this.player.y+this.player.height&&this.ball.y+this.ball.height>=this.player.y&&(this.ball.x=this.player.x+this.ball.width,this.ball.moveX=i),this.ball.x-this.ball.width<=this.paddle.x&&this.ball.x>=this.paddle.x-this.paddle.width&&this.ball.y<=this.paddle.y+this.paddle.height&&this.ball.y+this.ball.height>=this.paddle.y&&(this.ball.x=this.paddle.x-this.ball.width,this.ball.moveX=c)),this.player.score===r[this.round]?r[this.round+1]?(this.color=this._generateRoundColor(),this.player.score=this.paddle.score=0,this.player.speed+=.5,this.paddle.speed+=1,this.ball.speed+=1,this.round+=1):(this.over=!0,setTimeout((function(){h.endGameMenu("Winner!")}),1e3)):this.paddle.score===r[this.round]&&(this.over=!0,setTimeout((function(){h.endGameMenu("Game Over!")}),1e3))},draw:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.color,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle="#ffffff",this.context.fillRect(this.player.x,this.player.y,this.player.width,this.player.height),this.context.fillRect(this.paddle.x,this.paddle.y,this.paddle.width,this.paddle.height),h._turnDelayIsOver.call(this)&&this.context.fillRect(this.ball.x,this.ball.y,this.ball.width,this.ball.height),this.context.beginPath(),this.context.setLineDash([7,15]),this.context.moveTo(this.canvas.width/2,this.canvas.height-140),this.context.lineTo(this.canvas.width/2,140),this.context.lineWidth=10,this.context.strokeStyle="#ffffff",this.context.stroke(),this.context.font="100px Courier New",this.context.textAlign="center",this.context.fillText(this.player.score.toString(),this.canvas.width/2-300,200),this.context.fillText(this.paddle.score.toString(),this.canvas.width/2+300,200),this.context.font="30px Courier New",this.context.fillText("Round "+(h.round+1),this.canvas.width/2,35),this.context.font="40px Courier",this.context.fillText(r[h.round]?r[h.round]:r[h.round-1],this.canvas.width/2,100)},loop:function(){h.update(),h.draw(),h.over||requestAnimationFrame(h.loop)},listen:function(){document.addEventListener("keydown",(function(e){!1===h.running&&(h.running=!0,window.requestAnimationFrame(h.loop)),38!==e.keyCode&&87!==e.keyCode||(h.player.move=s),40!==e.keyCode&&83!==e.keyCode||(h.player.move=a)})),document.addEventListener("keyup",(function(e){h.player.move=n}))},_resetTurn:function(e,t){this.ball=o.new.call(this,this.ball.speed),this.turn=t,this.timer=(new Date).getTime(),e.score++},_turnDelayIsOver:function(){return(new Date).getTime()-this.timer>=1e3},_generateRoundColor:function(){var e=l[Math.floor(Math.random()*l.length)];return e===this.color?h._generateRoundColor():e}},h=Object.assign({},u);h.initialize()}),[]),Object(x.jsxs)("div",{ref:e,className:"pong-container",children:[Object(x.jsx)("canvas",{}),Object(x.jsxs)("p",{className:"credit",children:["Game Credits ",Object(x.jsx)("a",{href:"https://codepen.io/gdube/pen/JybxxZ",target:"_blank",children:"Pong Game"})]})]})}),Y=(n(334),function(){return Object(x.jsx)("div",{className:"dots-bars-5"})});var Z=function(){var e=Object(s.useState)(!0),t=Object(l.a)(e,2),n=t[0],a=t[1],c=Object(s.useContext)(m),d=c.setWasmInitialized,u=c.setTsneData,h=c.setRedDims,j=c.redDims,b=c.setGenesInfo,p=c.setInitDims,O=c.setQcDims,f=c.defaultRedDims,v=c.setDefaultRedDims,g=c.setQcData,y=c.qcData,F=c.setClusterData,w=c.setFSelectionData,C=c.setUmapData,N=c.setPcaVarExp,S=c.logs,E=c.setLogs,D=c.selectedCluster,A=c.clusterRank,M=c.selectedClusterSummary,T=c.setSelectedClusterSummary,L=c.reqGene,I=c.customSelection,B=c.clusterData,_=c.delCustomSelection,q=c.setDelCustomSelection,G=c.setSelectedCluster,W=c.setShowGame,z=c.showGame,U=c.datasetName,V=c.setExportState;return Object(s.useEffect)((function(){window.Worker.postMessage({type:"INIT",msg:"Initial Load"})}),[]),Object(s.useEffect)((function(){if(null!==D){var e=String(D).startsWith("cs")?"getMarkersForSelection":"getMarkersForCluster";window.Worker.postMessage({type:e,payload:{cluster:D,rank_type:A}})}}),[D,A]),Object(s.useEffect)((function(){if(null!==I&&Object.keys(I).length>0){var e="cs".concat(Object.keys(I).length),t=I[e];window.Worker.postMessage({type:"computeCustomMarkers",payload:{selection:t,id:e}})}}),[I]),Object(s.useEffect)((function(){null!==_&&(window.Worker.postMessage({type:"removeCustomMarkers",payload:{id:_}}),q(null))}),[_]),Object(s.useEffect)((function(){null!==L&&window.Worker.postMessage({type:"getGeneExpression",payload:{gene:L}})}),[L]),window.Worker.onmessage=function(e){var t=e.data;if(null===t||void 0===t?void 0:t.msg){var n=Object(r.a)(S),s=new Date;n.push("".concat(s.getHours()+":"+s.getMinutes()+":"+s.getSeconds()," - ").concat(null===t||void 0===t?void 0:t.type," - ").concat(null===t||void 0===t?void 0:t.msg)),E(n)}if("INIT"===t.type)a(!1),d(!0);else if("inputs_DATA"===t.type)p("".concat(t.resp.dimensions.num_genes," genes, ").concat(t.resp.dimensions.num_cells," cells")),b(t.resp.gene_names);else if("quality_control_metrics_DATA"===t.type){var c=t.resp;g(c)}else if("quality_control_thresholds_DATA"===t.type){var l=t.resp,o=Object(i.a)({},y);o.thresholds=l,g(o)}else if("quality_control_filtered_DATA"===t.type)O("".concat(t.resp.retained," cells"));else if("feature_selection_DATA"===t.type){var x=t.resp;w(x)}else if("pca_DATA"===t.type){var m=t.resp;N(m)}else if("snn_cluster_graph_DATA"===t.type){var k=t.resp;F(k),G(0)}else if("tsne_DATA"===t.type||"tsne_iter"===t.type){var D=t.resp;u(D);var A=Object(r.a)(j);A.push("TSNE"),f||v("TSNE"),h(A),W(!1)}else if("umap_DATA"===t.type){var L=t.resp;C(L);var R=Object(r.a)(j);R.push("UMAP"),h(R)}else if("markerGene_DATA"===t.type);else if("setMarkersForCluster"===t.type||"setMarkersForCustomSelection"===t.type){var I=t.resp,B=[];I.means.forEach((function(e,t){var n,s,a,c;B.push({index:t,row:null===I||void 0===I||null===(n=I.ordering)||void 0===n?void 0:n[t],mean:e,delta:null===I||void 0===I||null===(s=I.delta_detected)||void 0===s?void 0:s[t],lfc:null===I||void 0===I||null===(a=I.lfc)||void 0===a?void 0:a[t],detected:null===I||void 0===I||null===(c=I.detected)||void 0===c?void 0:c[t],expanded:!1,expr:null})})),T(B)}else if("setGeneExpression"===t.type){for(var _=t.resp,q=Object(r.a)(M),P=0;P<q.length;P++)if(_.gene===q[P].row){q[P].expr=Object.values(_.expr);break}T(q)}else if("exportState"===t.type){var z=t.resp,H=document.createElement("a"),X=new Blob([z],{type:"text/plain"});H.href=URL.createObjectURL(X),H.download=U.split(" ").join("_")+".kana.gz",H.click(),V(!1)}},Object(x.jsxs)("div",{className:"App",children:[Object(x.jsx)(k,{}),Object(x.jsxs)("div",{className:"App-content",children:[Object(x.jsx)("div",{className:"plot",children:f?Object(x.jsx)(P,{}):z?Object(x.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:"50px"},children:[Object(x.jsx)(o.q,{children:"Get some coffee or play pong while you wait for the analysis to finish.."}),Object(x.jsx)(o.a,{onClick:function(){W(!1)},children:"I'm good, go back"}),Object(x.jsx)(Q,{})]}):Object(x.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:"50px"},children:[Object(x.jsx)(Y,{}),Object(x.jsx)(o.q,{children:"Get some coffee or play pong while you wait for the analysis to finish.."}),Object(x.jsx)(o.a,{onClick:function(){W(!0)},children:"Play Pong"})]})}),Object(x.jsx)("div",{className:"marker",children:B?Object(x.jsx)(X,{}):Object(x.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[Object(x.jsx)(Y,{}),Object(x.jsx)(o.q,{children:"Generating nearest neighbor graph to compute clusters...."})]})}),Object(x.jsx)("div",{className:"analysis",children:Object(x.jsx)(R,{})})]}),Object(x.jsx)(o.y,Object(i.a)(Object(i.a)({isOpen:n},{autoFocus:!0,canEscapeKeyClose:!1,canOutsideClickClose:!1,enforceFocus:!0,hasBackdrop:!0,usePortal:!0,useTallContent:!1}),{},{children:Object(x.jsxs)("div",{className:"spinner",children:[Object(x.jsx)(o.B,{size:100}),Object(x.jsx)("p",{children:"Initializing kana"})]})}))]})},J=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,344)).then((function(t){var n=t.getCLS,s=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),s(e),a(e),c(e),i(e)}))};c.a.render(Object(x.jsx)(f,{children:Object(x.jsx)(Z,{})}),document.getElementById("root")),J()}},[[335,1,2]]]);
//# sourceMappingURL=main.a780e874.chunk.js.map