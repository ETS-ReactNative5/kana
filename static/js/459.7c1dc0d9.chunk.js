!function(){"use strict";var e={2459:function(e,r,n){var t={};n.r(t),n.d(t,{changed:function(){return D},compute:function(){return K},fetchCountMatrix:function(){return Q},fetchDimensions:function(){return J},fetchGenes:function(){return $},results:function(){return L},serialize:function(){return W},unserialize:function(){return V}});var a={};n.r(a),n.d(a,{changed:function(){return ee},compute:function(){return te},fetchQCMetrics:function(){return ue},fetchSums:function(){return oe},results:function(){return ae},serialize:function(){return se},unserialize:function(){return ie}});var s={};n.r(s),n.d(s,{changed:function(){return le},compute:function(){return de},fetchDiscards:function(){return ve},fetchDiscardsAsWasmArray:function(){return ye},results:function(){return pe},serialize:function(){return me},unserialize:function(){return he}});var i={};n.r(i),n.d(i,{changed:function(){return be},compute:function(){return xe},fetchFilteredMatrix:function(){return ke},fetchRetained:function(){return Ne},results:function(){return _e},serialize:function(){return Me},unserialize:function(){return Ee}});var u={};n.r(u),n.d(u,{changed:function(){return Oe},compute:function(){return Ge},fetchExpression:function(){return Pe},fetchNormalizedMatrix:function(){return Ce},results:function(){return Ue},serialize:function(){return Re},unserialize:function(){return Ze}});var o={};n.r(o),n.d(o,{changed:function(){return Fe},compute:function(){return Be},fetchResiduals:function(){return We},fetchSortedResiduals:function(){return Le},results:function(){return Ie},serialize:function(){return qe},unserialize:function(){return Ke}});var c={};n.r(c),n.d(c,{changed:function(){return Je},compute:function(){return He},fetchPCs:function(){return rr},results:function(){return Xe},serialize:function(){return Ye},unserialize:function(){return er}});var f={};n.r(f),n.d(f,{changed:function(){return ar},compute:function(){return ir},fetchIndex:function(){return fr},rawCompute:function(){return sr},results:function(){return ur},serialize:function(){return or},unserialize:function(){return cr}});var l={};n.r(l),n.d(l,{changed:function(){return pr},compute:function(){return hr},fetchNeighbors:function(){return wr},rawCompute:function(){return mr},results:function(){return yr},serialize:function(){return vr},unserialize:function(){return gr}});var d={};n.r(d),n.d(d,{changed:function(){return xr},compute:function(){return Mr},fetchGraph:function(){return Tr},results:function(){return Er},serialize:function(){return kr},unserialize:function(){return Nr}});var p={};n.r(p),n.d(p,{changed:function(){return zr},compute:function(){return Ur},fetchClustersAsWasmArray:function(){return Gr},results:function(){return Rr},serialize:function(){return Zr},unserialize:function(){return Cr}});var m={};n.r(m),n.d(m,{changed:function(){return jr},compute:function(){return Fr},fetchClustersAsWasmArray:function(){return Kr},results:function(){return Br},serialize:function(){return Ir},unserialize:function(){return qr}});var h={};n.r(h),n.d(h,{animate:function(){return on},changed:function(){return en},compute:function(){return nn},initialize:function(){return Yr},results:function(){return tn},serialize:function(){return an},unserialize:function(){return un}});var y={};n.r(y),n.d(y,{animate:function(){return bn},changed:function(){return pn},compute:function(){return hn},initialize:function(){return dn},results:function(){return yn},serialize:function(){return vn},unserialize:function(){return wn}});var v={};n.r(v),n.d(v,{changed:function(){return En},compute:function(){return kn},fetchGroupResults:function(){return On},results:function(){return Nn},serialize:function(){return Tn},unserialize:function(){return An}});var g={};n.r(g),n.d(g,{addSelection:function(){return jn},changed:function(){return Rn},compute:function(){return Zn},fetchResults:function(){return Bn},removeSelection:function(){return Fn},results:function(){return Cn},serialize:function(){return Pn},unserialize:function(){return Dn}});var w=n(5861),b=n(1413),S=n(7757),x=n.n(S),_=n(9451),M=n(7762),E=n(3324);function k(e){void 0!==e&&null!==e&&e.free()}function N(e){if("reloaded"in e){for(var r=0,n=Object.entries(e.reloaded);r<n.length;r++){var t=(0,E.Z)(n[r],2),a=(t[0],t[1]);a instanceof _.PQ&&a.free()}delete e.reloaded}}function T(e,r){return JSON.stringify(e)!=JSON.stringify(r)}function A(e){var r=-1/0,n=1/0;return e.forEach((function(e){r<e&&(r=e),n>e&&(n=e)})),[n,r]}function O(e,r,n){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"buffer",a=!0;if(t in n){var s=n[t];s.size!=e||s.constructor.className!=r?s.free():a=!1}if(a)switch(r){case"Uint8Array":n[t]=new _.yh(e);break;case"Int32Array":n[t]=new _.do(e);break;case"Float64Array":n[t]=new _.lt(e);break;default:throw"allocating '"+r+"' not yet supported"}return n[t]}function z(e,r){if(Array.isArray(e)){var n,t=(0,M.Z)(e);try{for(t.s();!(n=t.n()).done;){z(n.value,r)}}catch(u){t.e(u)}finally{t.f()}}else if(e.constructor==Object)for(var a=0,s=Object.entries(e);a<s.length;a++){var i=(0,E.Z)(s[a],2);i[0];z(i[1],r)}else if(ArrayBuffer.isView(e)){if(!(e.buffer instanceof ArrayBuffer))throw"only ArrayBuffers should be in the message payload";r.push(e.buffer)}}var G=n(9842),U=n(1414),R=n(8308),Z={},C={},P={},D=!1;function j(e){var r=new _.do(Z.matrix.numberOfRows());try{Z.matrix.permutation({buffer:r});for(var n=r.array(),t=0,a=Object.entries(e);t<a.length;t++){for(var s=(0,E.Z)(a[t],2),i=s[0],u=s[1],o=u.slice(),c=0;c<n.length;c++)o[n[c]]=u[c];e[i]=o}}finally{r.free()}}function F(e){for(var r=[],n=0;n<e;n++)r.push("Gene ".concat(n+1));return{id:r}}function B(e){k(Z.matrix);var r=e.filter((function(e){return"mtx"==e.type}))[0],n=new Uint8Array(r.buffer),t="gz"==r.name.split(".").pop();if(Z.matrix=_.DK(n,{compressed:t}),1==(a=e.filter((function(e){return"genes"==e.type}))).length){var a=a[0],s=new Uint8Array(a.buffer);"gz"==a.name.split(".").pop()&&(s=R.ec(s));var i=(new TextDecoder).decode(s),u=U.Z("\t").parseRows(i);if(u.length!=Z.matrix.numberOfRows())throw"number of matrix rows is not equal to the number of genes in '"+a.name+"'";var o=[],c=[];u.forEach((function(e){o.push(e[0]),c.push(e[1])})),Z.genes={id:o,symbol:c}}else Z.genes=F(Z.matrix.numberOfRows());j(Z.genes)}function I(e){var r=function(e){if(-1==e.keys().indexOf("var"))return null;var r=e.get("var");if(!(r instanceof G.ZA))return null;var n=r.keys();if(-1==n.indexOf("_index"))return null;var t=r.get("_index");if(!(t instanceof G.qz))return null;var a,s={_index:t.value},i=(0,M.Z)(n);try{for(i.s();!(a=i.n()).done;){var u=a.value;if("_index"!=u&&(u.match(/name/i)||u.match(/symbol/i))){var o=r.get(u);o instanceof G.qz&&(s[field]=o.value)}}}catch(c){i.e(c)}finally{i.f()}return s}(e);if(null!==r)return r;var n=function(e){if(-1==e.keys().indexOf("matrix"))return null;var r=e.get("matrix");if(!(r instanceof G.ZA))return null;if(-1==r.keys().indexOf("features"))return null;var n=r.get("features");if(!(n instanceof G.ZA))return null;var t=n.keys();if(-1==t.indexOf("id"))return null;var a=n.get("id");if(!(a instanceof G.qz))return null;var s={id:a.value};if(-1!=t.indexOf("name")){var i=n.get("name");i instanceof G.qz&&(s.name=i.value)}return s}(e);return null!==n?n:null}function q(e){k(Z.matrix);var r=e[0],n="rabbit-temp.h5";try{G.FS.writeFile(n,new Uint8Array(r.buffer));var t=new G.$B(n,"r");try{var a=function(e){var r=e.keys();if(-1!=r.indexOf("X"))return"X";if(-1!=r.indexOf("matrix"))return"matrix";var n,t=[],a=[],s=(0,M.Z)(r);try{for(s.s();!(n=s.n()).done;){var i=n.value,u=e.get(i);if(u instanceof G.ZA){var o=u.keys();-1!=o.indexOf("data")&&o.indexOf("indices")&&o.indexOf("indptr")&&t.push(i)}else u instanceof G.qz&&2==u.shape.length&&a.push(i)}}catch(c){s.e(c)}finally{s.f()}if(t.length)return t[0];if(a.length)return a[0];throw"could not automatically find a suitable 'path' inside the HDF5 file"}(t);Z.matrix=_.sT(t,a),Z.genes=I(t)}finally{t.close()}}finally{G.FS.unlink(n)}null===Z.genes&&(Z.genes=F(Z.matrix.numberOfRows())),j(Z.genes)}function K(e){switch(e.format){case"mtx":!function(e){for(var r=new FileReaderSync,n=0;n<2;n++){var t,a={type:"MatrixMarket",files:[]};t=0==n?function(e){return e.size}:function(e){return r.readAsArrayBuffer(e)};var s,i=(0,M.Z)(e.mtx);try{for(i.s();!(s=i.n()).done;){var u=s.value;a.files.push({type:"mtx",name:u.name,buffer:t(u)})}}catch(c){i.e(c)}finally{i.f()}if(null!==e.gene){if(1!==e.gene.length)throw"expected no more than one gene file";var o=e.gene[0];a.files.push({type:"genes",name:o.name,buffer:t(o)})}if(0==n){if(!T(P,a))return void(D=!1);P=a,D=!0}else C=a,B(a.files),delete Z.reloaded}}(e.files);break;case"hdf5":case"tenx":case"h5ad":!function(e){for(var r=new FileReaderSync,n=0;n<2;n++){var t,a={type:"HDF5",files:[]};t=0==n?function(e){return e.size}:function(e){return r.readAsArrayBuffer(e)};var s,i=(0,M.Z)(e.file);try{for(i.s();!(s=i.n()).done;){var u=s.value;a.files.push({type:"h5",name:u.name,buffer:t(u)})}}catch(o){i.e(o)}finally{i.f()}if(0==n){if(!T(P,a))return void(D=!1);P=a,D=!0}else C=a,q(a.files),delete Z.reloaded}}(e.files);break;case"kana":break;default:throw"unknown matrix file extension: '"+e.format+"'"}}function L(){var e={dimensions:J()};return e.genes="reloaded"in Z?(0,b.Z)({},Z.reloaded.genes):(0,b.Z)({},Z.genes),e}function W(){var e={};"reloaded"in Z?(e.genes=(0,b.Z)({},Z.reloaded.genes),e.num_cells=Z.reloaded.num_cells):(e.genes=(0,b.Z)({},Z.genes),e.num_cells=Z.matrix.numberOfColumns());var r=(0,b.Z)({},C);return r.files=C.files.map((function(e){return(0,b.Z)({},e)})),{parameters:r,contents:e}}function V(e){C=e.parameters,Z.reloaded=e.contents}function Q(){return"reloaded"in Z&&("MatrixMarket"==C.type?B(C.files):q(C.files)),Z.matrix}function J(){return"reloaded"in Z?{num_genes:Object.values(Z.reloaded.genes)[0].length,num_cells:Z.reloaded.num_cells}:{num_genes:Z.matrix.numberOfRows(),num_cells:Z.matrix.numberOfColumns()}}function $(){return"reloaded"in Z?Z.reloaded.genes:Z.genes}var H={};H.ensembl=new Set(["ENSMUSG00000064336","ENSMUSG00000064337","ENSMUSG00000064338","ENSMUSG00000064339","ENSMUSG00000064340","ENSMUSG00000064341","ENSMUSG00000064342","ENSMUSG00000064343","ENSMUSG00000064344","ENSMUSG00000064345","ENSMUSG00000064346","ENSMUSG00000064347","ENSMUSG00000064348","ENSMUSG00000064349","ENSMUSG00000064350","ENSMUSG00000064351","ENSMUSG00000064352","ENSMUSG00000064353","ENSMUSG00000064354","ENSMUSG00000064355","ENSMUSG00000064356","ENSMUSG00000064357","ENSMUSG00000064358","ENSMUSG00000064359","ENSMUSG00000064360","ENSMUSG00000064361","ENSMUSG00000064363","ENSMUSG00000064364","ENSMUSG00000064365","ENSMUSG00000064366","ENSMUSG00000064367","ENSMUSG00000064368","ENSMUSG00000064369","ENSMUSG00000064370","ENSMUSG00000064371","ENSMUSG00000064372","ENSMUSG00000065947","ENSG00000198695","ENSG00000198712","ENSG00000198727","ENSG00000198763","ENSG00000198786","ENSG00000198804","ENSG00000198840","ENSG00000198886","ENSG00000198888","ENSG00000198899","ENSG00000198938","ENSG00000209082","ENSG00000210049","ENSG00000210077","ENSG00000210082","ENSG00000210100","ENSG00000210107","ENSG00000210112","ENSG00000210117","ENSG00000210127","ENSG00000210135","ENSG00000210140","ENSG00000210144","ENSG00000210151","ENSG00000210154","ENSG00000210156","ENSG00000210164","ENSG00000210174","ENSG00000210176","ENSG00000210184","ENSG00000210191","ENSG00000210194","ENSG00000210195","ENSG00000210196","ENSG00000211459","ENSG00000212907","ENSG00000228253"]),H.symbol=new Set(["mt-Tf","mt-Rnr1","mt-Tv","mt-Rnr2","mt-Tl1","mt-Nd1","mt-Ti","mt-Tq","mt-Tm","mt-Nd2","mt-Tw","mt-Ta","mt-Tn","mt-Tc","mt-Ty","mt-Co1","mt-Ts1","mt-Td","mt-Co2","mt-Tk","mt-Atp8","mt-Atp6","mt-Co3","mt-Tg","mt-Nd3","mt-Tr","mt-Nd4","mt-Th","mt-Ts2","mt-Tl2","mt-Nd5","mt-Nd6","mt-Te","mt-Cytb","mt-Tt","mt-Tp","mt-Nd4l","MT-ND6","MT-CO2","MT-CYB","MT-ND2","MT-ND5","MT-CO1","MT-ND3","MT-ND4","MT-ND1","MT-ATP6","MT-CO3","MT-TL1","MT-TF","MT-TV","MT-RNR2","MT-TI","MT-TQ","MT-TM","MT-TW","MT-TA","MT-TN","MT-TC","MT-TY","MT-TS1","MT-TD","MT-TK","MT-TG","MT-TR","MT-TH","MT-TS2","MT-TL2","MT-TE","MT-TT","MT-TP","MT-RNR1","MT-ND4L","MT-ATP8"]);var X={},Y={},ee=!1;function re(e){k(X.raw);var r=O(1*(c=Q()).numberOfRows(),"Uint8Array",X);r.fill(0);for(var n=$(),t=r.array(),a=0,s=Object.entries(n);a<s.length;a++){var i=(0,E.Z)(s[a],2),u=(i[0],i[1]);if(e.use_mito_default)u.forEach((function(e,r){(H.symbol.has(e)||H.ensembl.has(e))&&(t[r]=1)}));else{var o=e.mito_prefix.toLowerCase();u.forEach((function(e,r){e.toLowerCase().startsWith(o)&&(t[r]=1)}))}}var c=Q();X.raw=_.i4(c,r),delete X.reloaded}function ne(){var e={};if("reloaded"in X){var r=X.reloaded;e.sums=r.sums.slice(),e.detected=r.detected.slice(),e.proportion=r.proportion.slice()}else{r=X.raw;e.sums=r.sums(),e.detected=r.detected(),e.proportion=r.subsetProportions(0)}return e}function te(e){D||T(Y,e)?(re(e),Y=e,ee=!0):ee=!1}function ae(){var e=ne(),r={};return r.sums=A(e.sums),r.detected=A(e.detected),r.proportion=A(e.proportion),{data:e,ranges:r}}function se(){return{parameters:Y,contents:ne()}}function ie(e){Y=e.parameters,X.reloaded=e.contents}function ue(){return"reloaded"in X&&re(),X.raw}function oe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.unsafe,n=void 0===r||r;return"reloaded"in X?X.reloaded.sums:X.raw.sums({copy:!n})}var ce={},fe={},le=!1;function de(e){if(ee||T(fe,e)){k(ce.raw);var r=ue();ce.raw=_.rU(r,{numberOfMADs:e.nmads}),N(ce),le=!0,fe=e}else le=!1}function pe(){var e;if("reloaded"in ce)e={sums:ce.reloaded.sums,detected:ce.reloaded.detected,proportion:ce.reloaded.proportion};else{var r=ce.raw;e={sums:r.thresholdsSums()[0],detected:r.thresholdsDetected()[0],proportion:r.thresholdsSubsetProportions(0)[0]}}return e}function me(){var e=pe();return e.discards=ve(),{parameters:fe,contents:e}}function he(e){fe=e.parameters,N(ce),ce.reloaded=e.contents;var r=new _.yh(ce.reloaded.discards.length);r.set(ce.reloaded.discards),ce.reloaded.discards=r}function ye(){if("reloaded"in ce)return ce.reloaded.discards;var e=ce.raw.discardOverall({copy:!1});return new _.yh(e.length,e.byteOffset)}function ve(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.unsafe,t=void 0!==n&&n;return e="reloaded"in ce?ce.reloaded.discards.array():ce.raw.discardOverall(),t?e:e.slice()}var ge={},we={},be=!1;function Se(){k(ge.matrix);var e=Q(),r=ye();ge.matrix=_.b_(e,r),delete ge.reloaded}function xe(e){D||le||T(we,e)?(Se(),we=e,be=!0):be=!1}function _e(){return{retained:Ne()}}function Me(){return{parameters:we,contents:_e()}}function Ee(e){we=e.parameters,ge.reloaded=e.contents;var r,n=ve({unsafe:!0}),t=0,a=(0,M.Z)(n);try{for(a.s();!(r=a.n()).done;){0==r.value&&t++}}catch(s){a.e(s)}finally{a.f()}ge.reloaded.retained=t}function ke(){return"reloaded"in ge&&Se(),ge.matrix}function Ne(){return"reloaded"in ge?ge.reloaded.retained:ge.matrix.numberOfColumns()}var Te={},Ae={},Oe=!1;function ze(){for(var e=ke(),r=O(e.numberOfColumns(),"Float64Array",Te),n=oe({unsafe:!0}),t=ve({unsafe:!0}),a=r.array(),s=0,i=0;i<t.length;++i)t[i]||(a[s]=n[i],s++);if(s!=e.numberOfColumns())throw"normalization and filtering are not in sync";k(Te.matrix),Te.matrix=_.gk(e,{sizeFactors:r}),delete Te.reloaded}function Ge(e){ee||be||T(Ae,e)?(ze(),Ae=e,Oe=!0):Oe=!1}function Ue(){return{}}function Re(){return{parameters:Ae,contents:{}}}function Ze(e){Ae=e.parameters,Te.reloaded=e.contents}function Ce(){return"reloaded"in Te&&ze(),Te.matrix}function Pe(e){var r=Ce(),n=O(r.numberOfColumns(),"Float64Array",Te);return r.row(e,{buffer:n}),n.slice()}var De={},je={},Fe=!1;function Be(e){if(Oe||T(je,e)){var r=Ce();De.raw=_.rY(r,{span:e.span}),De.sorted_residuals=De.raw.residuals().slice(),De.sorted_residuals.sort(),je=e,delete De.reloaded,Fe=!0}else Fe=!1}function Ie(){return"reloaded"in De?{means:De.reloaded.means.slice(),vars:De.reloaded.vars.slice(),fitted:De.reloaded.fitted.slice(),resids:De.reloaded.resids.slice()}:function(){var e=De.raw;return{means:e.means(),vars:e.variances(),fitted:e.fitted(),resids:e.residuals()}}()}function qe(){return{parameters:je,contents:Ie()}}function Ke(e){je=e.parameters,De.reloaded=e.contents,De.sorted_residuals=De.reloaded.resids.slice(),De.sorted_residuals.sort()}function Le(){return De.sorted_residuals}function We(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.unsafe,n=void 0!==r&&r;return"reloaded"in De?De.reloaded.resids:De.raw.residuals({copy:!n})}var Ve={},Qe={},Je=!1;function $e(){if("reloaded"in Ve)return Ve.reloaded.pcs;var e=Ve.raw.principalComponents({copy:!1});return new _.lt(e.length,e.byteOffset)}function He(e){if(Oe||Fe||T(Qe,e)){var r=Le(),n=r[r.length-e.num_hvgs],t=Ce(),a=O(t.numberOfRows(),"Uint8Array",Ve),s=We({unsafe:!0});a.array().forEach((function(e,r,t){t[r]=s[r]>=n})),k(Ve.raw),Ve.raw=_.dO(t,{features:a,numberOfPCs:e.num_pcs}),N(Ve),Je=!0,Qe=e}else Je=!1}function Xe(){var e;if("reloaded"in Ve)e=Ve.reloaded.var_exp.slice();else{var r=Ve.raw;e=r.varianceExplained();var n=r.totalVariance();e.forEach((function(r,t){e[t]=r/n}))}return{var_exp:e}}function Ye(){var e=Xe();return e.pcs=$e().slice(),{parameters:Qe,contents:e}}function er(e){Qe=e.parameters,N(Ve),Ve.reloaded=e.contents;var r=new _.lt(Ve.reloaded.pcs.length);r.set(Ve.reloaded.pcs),Ve.reloaded.pcs=r}function rr(){var e=$e();return{pcs:e,num_pcs:Qe.num_pcs,num_obs:e.length/Qe.num_pcs}}var nr={},tr={},ar=!1;function sr(e){k(nr.raw);var r=rr();nr.raw=_.Fu(r.pcs,{numberOfDims:r.num_pcs,numberOfCells:r.num_obs}),delete nr.reloaded}function ir(e){Je||T(tr,e)?(sr(),tr=e,ar=!0):ar=!1}function ur(){return{}}function or(){return{parameters:tr,contents:{}}}function cr(e){tr=e.parameters,nr.reloaded=e.contents}function fr(){return"reloaded"in nr&&sr(),nr.raw}var lr={},dr={},pr=!1;function mr(e){k(lr.raw);var r=fr();lr.raw=_.wf(r,e.k),delete lr.reloaded}function hr(e){ar||T(dr,e)?(mr(e),dr=e,pr=!0):pr=!1}function yr(){return{}}function vr(){return{parameters:dr,contents:{}}}function gr(e){dr=e.parameters,lr.reloaded=e.contents}function wr(){return"reloaded"in lr&&mr(dr),lr.raw}var br={},Sr={},xr=!1;function _r(e){k(br.raw);var r=wr();br.raw=_.bD(r,{scheme:e.scheme}),delete br.reloaded}function Mr(e){pr||T(Sr,e)?(_r(e),Sr=e,xr=!0):xr=!1}function Er(){return{}}function kr(){return{parameters:Sr,contents:{}}}function Nr(e){Sr=e.parameters,br.reloaded=e.contents}function Tr(){return"reloaded"in br&&_r(Sr),br.raw}var Ar={},Or={},zr=!1;function Gr(){if("reloaded"in Ar)return Ar.reloaded.clusters;var e=Ar.raw.membership({copy:!1});return new _.do(e.length,e.byteOffset)}function Ur(e){if(xr||T(Or,e)){k(Ar.raw);var r=Tr();Ar.raw=_.ZI(r,{resolution:e.resolution}),Or=e,zr=!0,N(Ar)}else zr=!1}function Rr(){return{clusters:Gr().slice()}}function Zr(){return{parameters:Or,contents:Rr()}}function Cr(e){Or=e.parameters,N(Ar),Ar.reloaded=e.contents;var r=new _.do(Ar.reloaded.clusters.length);r.set(Ar.reloaded.clusters),Ar.reloaded.clusters=r}var Pr={},Dr={},jr=!1;function Fr(e){jr=!0,T(Dr,e)||"snn_graph"!=e.method||zr||(jr=!1),jr&&(delete Pr.reloaded,Dr=e,jr=!0)}function Br(){return{}}function Ir(){return{parameters:Dr,contents:{}}}function qr(e){Dr=e.parameters,Pr.reloaded=e.contents}function Kr(){return Gr()}function Lr(e){var r=fr(),n={num_obs:r.numberOfCells()},t=null,a=null,s=null,i=null;try{t=_.wf(r,e),a=new _.do(t.numberOfCells()),s=new _.do(t.size()),i=new _.lt(t.size()),t.serialize({runs:a,indices:s,distances:i}),n.size=t.size(),n.runs=a.array().slice(),n.indices=s.array().slice(),n.distances=i.array().slice()}finally{null!==t&&t.free(),null!==a&&a.free(),null!==s&&s.free(),null!==i&&i.free()}return n}function Wr(e,r,n){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=n.counter,s=new Promise((function(e,r){n.promises[a]={resolve:e,reject:r}}));return n.counter++,r.id=a,e.postMessage(r,t),s}function Vr(e,r){return e.onmessage=function(e){var n=e.data.type;if(n.endsWith("_iter"))postMessage({type:n,resp:{x:e.data.x,y:e.data.y,iteration:e.data.iteration}},[e.data.x.buffer,e.data.y.buffer]);else{var t=e.data.id,a=r.promises[t];"error"==n?a.reject(e.data.error):a.resolve(e.data.data),delete r.promises[t]}},Wr(e,{cmd:"INIT"},r)}function Qr(e,r,n,t){var a={cmd:"RUN",params:r},s=[];return null!==n&&(a.neighbors=n,z(n,s)),Wr(e,a,t,s)}function Jr(e,r){if("reloaded"in r){var n=(0,b.Z)({},r.reloaded);return n.x=n.x.slice(),n.y=n.y.slice(),new Promise((function(e){return e(n)}))}return r.run.then((function(n){return Wr(e,{cmd:"FETCH"},r)}))}var $r={counter:0,promises:{}},Hr={},Xr=null;function Yr(){return Vr(Xr=new Worker(new URL(n.p+n.u(139),n.b),{type:void 0}),$r)}var en=!1;function rn(e,r){var n=null;r&&(n=Lr(_.Tk(e.perplexity)));$r.run=Qr(Xr,e,n,$r)}function nn(e){ar||T(Hr,e)?(rn(e,ar||T(Hr.perplexity,e.perplexity)),Hr=e,delete $r.reloaded,en=!0):en=!1}function tn(){return Jr(Xr,$r)}function an(){return sn.apply(this,arguments)}function sn(){return(sn=(0,w.Z)(x().mark((function e(){var r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jr(Xr,$r);case 2:return r=e.sent,e.abrupt("return",{parameters:Hr,contents:r});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function un(e){Hr=e.parameters,$r.reloaded=e.contents}function on(){if("reloaded"in $r){var e=(0,b.Z)({},Hr);return e.animate=!0,rn(e,!0),delete $r.reloaded,$r.run.then((function(e){return{type:"tsne_rerun",data:{status:"SUCCESS"}}}))}return Wr(Xr,{cmd:"RERUN"},$r)}var cn={counter:0,promises:{}},fn={},ln=null;function dn(){ln=new Worker(new URL(n.p+n.u(653),n.b),{type:void 0}),cn.initialized=Vr(ln,cn)}var pn=!1;function mn(e,r){var n=null;r&&(n=Lr(e.num_neighbors)),cn.run=Qr(ln,e,n,cn)}function hn(e){ar||T(fn,e)?(mn(e,ar||T(fn.num_neighbors,e.num_neighbors)),fn=e,delete cn.reloaded,pn=!0):pn=!1}function yn(){return Jr(ln,cn)}function vn(){return gn.apply(this,arguments)}function gn(){return(gn=(0,w.Z)(x().mark((function e(){var r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jr(ln,cn);case 2:return r=e.sent,e.abrupt("return",{parameters:fn,contents:r});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wn(e){fn=e.parameters,cn.reloaded=e.contents}function bn(){if("reloaded"in cn){var e=(0,b.Z)({},fn);return e.animate=!0,mn(e,!0),delete cn.reloaded,cn.run.then((function(e){return{type:"umap_rerun",data:{status:"SUCCESS"}}}))}return Wr(ln,{cmd:"RERUN"},cn)}function Sn(e,r){return{means:e.means(r),detected:e.detected(r),lfc:{min:e.lfc(r,{summary:0}),mean:e.lfc(r,{summary:1}),"min-rank":e.lfc(r,{summary:4})},delta_detected:{min:e.deltaDetected(r,{summary:0}),mean:e.deltaDetected(r,{summary:1}),"min-rank":e.deltaDetected(r,{summary:4})},cohen:{min:e.cohen(r,{summary:0}),mean:e.cohen(r,{summary:1}),"min-rank":e.cohen(r,{summary:4})},auc:{min:e.auc(r,{summary:0}),mean:e.auc(r,{summary:1}),"min-rank":e.auc(r,{summary:4})}}}function xn(e,r,n,t){n&&void 0!==n||(n="cohen-min-rank");var a,s,i=void 0!==r,u=!1;if(i){var o,c="mean";if(n.match(/-min$/)?c="min":n.match(/-min-rank$/)&&(u=!0,c="min-rank"),n.match(/^cohen-/))o="cohen";else if(n.match(/^auc-/))o="auc";else if(n.match(/^lfc-/))o="lfc";else{if(!n.match(/^delta-d-/))throw"unknown rank type '"+n+"'";o="delta_detected"}s=r[t][o][c]}else{var f=1;if(n.match(/-min$/)?f=0:n.match(/-min-rank$/)&&(u=!0,f=4),n.match(/^cohen-/))s=e.cohen(t,{summary:f,copy:!1});else if(n.match(/^auc-/))s=e.auc(t,{summary:f,copy:!1});else if(n.match(/^lfc-/))s=e.lfc(t,{summary:f,copy:!1});else{if(!n.match(/^delta-d-/))throw"unknown rank type '"+n+"'";s=e.deltaDetected(t,{summary:f,copy:!1})}}a=new Int32Array(s.length);for(var l=0;l<a.length;l++)a[l]=l;u?a.sort((function(e,r){return s[e]-s[r]})):a.sort((function(e,r){return s[r]-s[e]}));var d,p,m,h,y=function(e){for(var r=new Float64Array(e.length),n=0;n<a.length;n++)r[n]=e[a[n]];return r};if(i){var v=r[t];p=y(v.means),d=y(v.detected),m=y(v.lfc.mean),h=y(v.delta_detected.mean)}else d=y(e.detected(t,{copy:!1})),p=y(e.means(t,{copy:!1})),m=y(e.lfc(t,{summary:1,copy:!1})),h=y(e.deltaDetected(t,{summary:1,copy:!1}));return{ordering:a,means:p,detected:d,lfc:m,delta_detected:h}}var _n={},Mn={},En=!1;function kn(e){if(Oe||jr||T(Mn,e)){k(_n.raw);var r=Ce(),n=Kr();_n.raw=_.y5(r,n),Mn=e,delete _n.reloaded,En=!0}else En=!1}function Nn(){return{}}function Tn(){if("reloaded"in _n)e=_n.reloaded;else for(var e=[],r=_n.raw.numberOfGroups(),n=0;n<r;n++)e.push(Sn(_n.raw,n));return{parameters:Mn,contents:e}}function An(e){Mn=e.parameters,_n.reloaded=e.contents}function On(e,r){return xn(_n.raw,_n.reloaded,e,r)}var zn,Gn={results:{}},Un={selections:{}},Rn=!1;function Zn(e){if(be){Un.selections={};for(var r=0,n=Object.entries(Gn.results);r<n.length;r++){var t=(0,E.Z)(n[r],2);t[0];k(t[1].raw)}Gn.results={}}Rn=!0}function Cn(){return{}}function Pn(){for(var e={},r=0,n=Object.entries(Gn.results);r<n.length;r++){var t=(0,E.Z)(n[r],2),a=t[0],s=t[1];e[a]="reloaded"in s?s.reloaded:Sn(s.raw,1)}return{parameters:Un,contents:{results:e}}}function Dn(e){Un=e.parameters;for(var r=0,n=Object.entries(e.contents);r<n.length;r++){var t=(0,E.Z)(n[r],2),a=t[0],s=t[1];Gn.results[a]={reloaded:s}}}function jn(e,r){var n=Ce(),t=O(n.numberOfColumns(),"Int32Array",Gn);t.fill(0);var a=t.array();r.forEach((function(e){a[e]=1}));var s=_.y5(n,t);e in Gn.results&&(k(Gn.results[e].raw),delete Gn.results[e]),Gn.results[e]={raw:s},Un.selections[e]=r}function Fn(e){k(Gn.results[e].raw),delete Gn.results[e],delete Un.selections[e]}function Bn(e,r){var n=Gn.results[e];return xn(n.raw,n.reloaded,r,1)}var In=null;function qn(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===r&&(r=zn.result.transaction(["analysis_meta"],"readonly").objectStore("analysis_meta"));var n=r.getAll();n.onsuccess=function(){var r=n.result;r.forEach((function(e){delete e.files})),e(r)},n.onerror=function(){e(null)}}function Kn(e,r){return Ln.apply(this,arguments)}function Ln(){return(Ln=(0,w.Z)(x().mark((function e(r,n){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var t=n.get(r);t.onsuccess=function(){void 0!==t.result?e(t.result):e(null)},t.onerror=function(){e(null)}})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wn(e){return Promise.allSettled(e).then((function(e){var r,n=(0,M.Z)(e);try{for(n.s();!(r=n.n()).done;){if(!r.value)return!1}}catch(t){n.e(t)}finally{n.f()}return!0}))}function Vn(){return Qn.apply(this,arguments)}function Qn(){return(Qn=(0,w.Z)(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,In;case 2:return e.abrupt("return",new Promise((function(e){qn(e)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jn(e,r){return $n.apply(this,arguments)}function $n(){return($n=(0,w.Z)(x().mark((function e(r,n){var t,a,s,i,u,o,c;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,In;case 2:return t=zn.result.transaction(["file","file_meta"],"readwrite"),a=t.objectStore("file"),s=t.objectStore("file_meta"),e.next=7,Kn(r,s);case 7:return i=e.sent,u=null===i?0:i.count,u++,o=new Promise((function(e){var t=a.put({id:r,payload:n});t.onsuccess=function(r){e(!0)},t.onerror=function(r){e(!1)}})),c=new Promise((function(e){i.count=u;var r=s.put(i);r.onsuccess=function(r){e(!0)},r.onerror=function(r){e(!1)}})),e.abrupt("return",Wn([o,c]));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Hn(e,r,n,t){return Xn.apply(this,arguments)}function Xn(){return(Xn=(0,w.Z)(x().mark((function e(r,n,t,a){var s,i,u,o,c,f;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,In;case 2:if(s=zn.result.transaction(["analysis","analysis_meta"],"readwrite"),i=s.objectStore("analysis"),u=s.objectStore("analysis_meta"),null!=r){e.next=10;break}return e.next=8,new Promise((function(e){return qn(e,u)}));case 8:o=e.sent,r=String(o.length);case 10:return c=new Promise((function(e){var t=i.put({id:r,payload:n});t.onsuccess=function(r){e(!0)},t.onerror=function(r){e(!1)}})),f=new Promise((function(e){var n=u.put({id:r,files:t,time:Number(new Date),title:a});n.onsuccess=function(r){e(!0)},n.onerror=function(r){e(!1)}})),e.next=14,Wn([c,f]);case 14:if(!e.sent){e.next=18;break}return e.abrupt("return",r);case 18:return e.abrupt("return",null);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yn(e){return et.apply(this,arguments)}function et(){return(et=(0,w.Z)(x().mark((function e(r){var n,t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,In;case 2:return n=zn.result.transaction(["file"],"readonly").objectStore("file"),e.next=5,Kn(r,n);case 5:return t=e.sent,e.abrupt("return",t.payload);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rt(){return(rt=(0,w.Z)(x().mark((function e(r){var n,t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,In;case 2:return n=zn.result.transaction(["analysis"],"readonly").objectStore("analysis"),e.next=5,Kn(r,n);case 5:return t=e.sent,e.abrupt("return",t.payload);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nt(e){return tt.apply(this,arguments)}function tt(){return(tt=(0,w.Z)(x().mark((function e(r){var n,t,a,s,i,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,In;case 2:return n=zn.result.transaction(["file","file_meta"],"readwrite"),t=n.objectStore("file"),a=n.objectStore("file_meta"),e.next=7,Kn(r,a);case 7:return s=e.sent,i=s.count,i--,u=[],0==i?(u.push(new Promise((function(e){var n=t.remove(r);n.onerror=function(r){e(!1)},n.onsuccess=function(r){e(!0)}}))),u.push(new Promise((function(e){var n=a.delete(r);n.onerror=function(r){e(!1)},n.onsuccess=function(r){e(!0)}})))):u.push(new Promise((function(e){s.count=i;var r=a.put(s);r.onsuccess=function(r){e(!0)},r.onerror=function(r){e(!1)}}))),e.abrupt("return",Wn(u));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function at(){return(at=(0,w.Z)(x().mark((function e(r){var n,t,a,s,i,u,o,c;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,In;case 2:return n=zn.result.transaction(["analysis","analysis_meta"],"readwrite"),t=n.objectStore("analysis"),a=n.objectStore("analysis_meta"),(s=[]).push(new Promise((function(e){var n=t.delete(r);n.onsuccess=function(r){e(!0)},n.onerror=function(r){e(!1)}}))),e.next=9,Kn(r,a);case 9:i=e.sent,u=(0,M.Z)(i.files);try{for(u.s();!(o=u.n()).done;)c=o.value,s.push(nt(c))}catch(f){u.e(f)}finally{u.f()}return s.push(new Promise((function(e){var n=a.delete(r);n.onsuccess=function(r){e(!0)},n.onerror=function(r){e(!1)}}))),e.abrupt("return",Wn(s));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var st,it=n(8109);function ut(e){if(Array.isArray(e))for(var r=0;r<e.length;r++)e[r]=ut(e[r]);else if(ArrayBuffer.isView(e))e={_TypedArray_class:e.constructor.name,_TypedArray_values:Array.from(e)};else if(e instanceof Object)for(var n=0,t=Object.entries(e);n<t.length;n++){var a=(0,E.Z)(t[n],2),s=a[0],i=a[1];e[s]=ut(i)}return e}function ot(e){if(Array.isArray(e))for(var r=0;r<e.length;r++)e[r]=ot(e[r]);else if(e instanceof Object)if("_TypedArray_class"in e){var n=e[["_TypedArray_class"]],t=e[["_TypedArray_values"]];switch(n){case"Uint8Array":case"Uint8Array":e=new Uint8Array(t.length);break;case"Int8Array":e=new Int8Array(t.length);break;case"Uint16Array":e=new Uint16Array(t.length);break;case"Int16Array":e=new Int16Array(t.length);break;case"Uint32Array":e=new Uint32Array(t.length);break;case"Int32Array":e=new Int32Array(t.length);break;case"Uint64Array":e=new Uint64Array(t.length);break;case"Int64Array":e=new Int64Array(t.length);break;case"Float32Array":e=new Float32Array(t.length);break;case"Float64Array":e=new Float64Array(t.length);break;default:throw"unrecognized TypedArray class '"+n}e.set(t)}else for(var a=0,s=Object.entries(e);a<s.length;a++){var i=(0,E.Z)(s[a],2),u=i[0],o=i[1];e[u]=ot(o)}return e}function ct(e){for(var r=new Uint8Array(8),n=0;e>0;)r[n]=e%256,e=Math.floor(e/256),n++;return r}function ft(e){var r,n=0,t=1,a=(0,M.Z)(e);try{for(a.s();!(r=a.n()).done;){n+=t*r.value,t*=256}}catch(s){a.e(s)}finally{a.f()}return n}function lt(e){return dt.apply(this,arguments)}function dt(){return dt=(0,w.Z)(x().mark((function e(r){var n,t,a,s,i,u,o,c,f,l,d,p,m,h,y,v,g,w,b,S,_,E,k=arguments;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=k.length>1&&void 0!==k[1]?k[1]:"full",t=r.inputs.parameters.files,a=[],s=0,"full"!=n){e.next=9;break}i=0,t.forEach((function(e,r){var n=e.buffer;a.push(n),t[r].buffer={offset:s,size:n.byteLength},s+=n.byteLength})),e.next=40;break;case 9:if("KanaDB"!=n){e.next=39;break}i=1,u=(0,M.Z)(t),e.prev=12,u.s();case 14:if((o=u.n()).done){e.next=29;break}return c=o.value,e.next=18,it.FB(new Uint8Array(c.buffer));case 18:return f=e.sent,l=c.type+"_"+c.name+"_"+c.buffer.byteLength+"_"+f,e.next=22,Jn(l,c.buffer);case 22:if(e.sent){e.next=25;break}throw"failed to save file '"+l+"' to KanaDB";case 25:c.buffer=l,a.push(l);case 27:e.next=14;break;case 29:e.next=34;break;case 31:e.prev=31,e.t0=e.catch(12),u.e(e.t0);case 34:return e.prev=34,u.f(),e.finish(34);case 37:e.next=40;break;case 39:throw"unsupported mode "+n;case 40:if(r=ut(r),d=JSON.stringify(r),p=R.iv(d),m=new ArrayBuffer(24+p.length+s),h=new Uint8Array(m),y=0,v=ct(i),h.set(v,y),y+=v.length,g=ct(0),h.set(g,y),y+=g.length,w=ct(p.length),h.set(w,y),24==(y+=w.length)){e.next=57;break}throw"oops - accounting error in the serialization code!";case 57:if(h.set(p,y),y+=p.length,"full"!=n){e.next=65;break}b=(0,M.Z)(a);try{for(b.s();!(S=b.n()).done;)_=S.value,E=new Uint8Array(_),h.set(E,y),y+=E.length}catch(x){b.e(x)}finally{b.f()}return e.abrupt("return",m);case 65:if("KanaDB"!=n){e.next=69;break}return e.abrupt("return",{file_ids:a,state:m});case 69:throw"unsupported mode "+n;case 70:case"end":return e.stop()}}),e,null,[[12,31,34,37]])}))),dt.apply(this,arguments)}function pt(e){return mt.apply(this,arguments)}function mt(){return(mt=(0,w.Z)(x().mark((function e(r){var n,t,a,s,i,u,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=0,t=ft(new Uint8Array(r,n,8)),n+=8,ft(new Uint8Array(r,n,8)),n+=8,a=ft(new Uint8Array(r,n,8)),n+=8,s=R.ec(new Uint8Array(r,n,a),{to:"string"}),s=ot(s=JSON.parse(s)),n+=a,i=s.inputs.parameters.files,0!=t){e.next=16;break}i.forEach((function(e,t){var a=e.buffer,s=new Uint8Array(r,n+a.offset,a.size),u=new ArrayBuffer(a.size);new Uint8Array(u).set(s),i[t].buffer=u})),e.next=26;break;case 16:if(1!=t){e.next=25;break}return u=[],i.forEach((function(e,r){var n=e.buffer;u.push(Yn(n))})),e.next=21,Promise.all(u);case 21:o=e.sent,i.forEach((function(e,r){if(null===o[r])throw"KanaDB loading failed for file ID '"+e.buffer+"'";e.buffer=o[r]})),e.next=26;break;case 25:throw"unsupported format type";case 26:return e.abrupt("return",s);case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ht(e,r,n){var t=[];z(e,t),postMessage({type:"".concat(r,"_DATA"),resp:e,msg:"Success: "+n},t)}function yt(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"run",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("serialize"===r)e={};else{if(null==n)throw"'state' must be supplied if 'mode' is not 'serialize'";"unserialize"===r&&(e={params:{}})}var w=function(e,n,t){(e.changed||"unserialize"==r)&&ht(e.results(),n,t)},S=function(e,n,t){(e.changed||"unserialize"==r)&&e.results().then((function(e){ht(e,n,t)}))},x=function(e,r,n){e[r]=r in e?(0,b.Z)((0,b.Z)({},e[r]),n):n},_="inputs";"serialize"===r?e[_]=W():("run"==r?K({format:n.files.format,files:n.files.files}):(V(n[_]),e.files={format:"kana",files:[]}),w(t,_,"Count matrix loaded"));var M="quality_control_metrics";"serialize"===r?e[M]=se():("run"==r?te({use_mito_default:n.params.qc["qc-usemitodefault"],mito_prefix:n.params.qc["qc-mito"]}):(ie(n[M]),x(e.params,"qc",{"qc-usemitodefault":n[M].parameters.use_mito_default,"qc-mito":n[M].parameters.mito_prefix})),w(a,M,"QC metrics computed"));var E="quality_control_thresholds";"serialize"===r?e[E]=me():("run"==r?de({nmads:n.params.qc["qc-nmads"]}):(he(n[E]),x(e.params,"qc",{"qc-nmads":n[E].parameters.nmads})),w(s,E,"QC thresholds computed"));var k="quality_control_filtered";"serialize"==r?e[k]=Me():("run"==r?xe({}):Ee(n[k]),w(i,k,"QC filtering completed"));var N="normalization";"serialize"==r?e[N]=Re():("run"==r?Ge({}):Ze(n[N]),w(u,N,"Log-normalization completed"));var T="feature_selection";"serialize"==r?e[T]=qe():("run"==r?Be({span:n.params.fSelection["fsel-span"]}):(Ke(n[T]),x(e.params,"fSelection",{"fsel-span":n[T].parameters.span})),w(o,T,"Variance modelling completed"));var A="pca";"serialize"==r?e[A]=Ye():("run"==r?He({num_hvgs:n.params.pca["pca-hvg"],num_pcs:n.params.pca["pca-npc"]}):(er(n[A]),x(e.params,"pca",{"pca-hvg":n[A].parameters.num_hvgs,"pca-npc":n[A].parameters.num_pcs})),w(c,A,"Principal components analysis completed"));var O,z="neighbor_index";"serialize"==r?e[z]=or():("run"==r?ir({approximate:n.params.cluster["clus-approx"]}):(cr(n[z]),x(e.params,"cluster",{"clus-approx":n[z].parameters.approximate})),w(f,z,"Neighbor search index constructed"));var G,U="tsne";"serialize"==r?O=an():("run"==r?nn({perplexity:n.params.tsne["tsne-perp"],iterations:n.params.tsne["tsne-iter"],animate:n.params.tsne.animate}):(un(n[U]),x(e.params,"tsne",{"tsne-perp":n[U].parameters.perplexity,"tsne-iter":n[U].parameters.iterations,animate:n[U].parameters.animate})),S(h,U,"t-SNE completed"));var R="umap";"serialize"==r?G=vn():("run"==r?hn({num_epochs:n.params.umap["umap-epochs"],num_neighbors:n.params.umap["umap-nn"],min_dist:n.params.umap["umap-min_dist"],animate:n.params.umap.animate}):(wn(n[R]),x(e.params,"umap",{num_epochs:n[R].parameters.num_epochs,num_neighbors:n[R].parameters.num_neighbors,min_dist:n[R].parameters.min_dist,animate:n[R].parameters.animate})),S(y,R,"UMAP completed"));var Z="snn_find_neighbors";"serialize"==r?e[Z]=vr():("run"==r?hr({k:n.params.cluster["clus-k"]}):(gr(n[Z]),x(e.params,"cluster",{"clus-k":n[Z].parameters.k})),w(l,Z,"Shared nearest neighbor search completed"));var C="snn_build_graph";"serialize"==r?e[C]=kr():("run"==r?Mr({scheme:n.params.cluster["clus-scheme"]}):(Nr(n[C]),x(e.params,"cluster",{"clus-scheme":n[C].parameters.scheme})),w(d,C,"Shared nearest neighbor graph constructed"));var P="snn_cluster_graph";"serialize"==r?e[P]=Zr():("run"==r?Ur({resolution:n.params.cluster["clus-res"]}):(Cr(n[P]),x(e.params,"cluster",{"clus-res":n[P].parameters.resolution})),w(p,P,"Community detection from SNN graph complete"));var D="choose_clustering";"serialize"==r?e[D]=Ir():("run"==r?Fr({method:n.params.cluster["clus-method"]}):(qr(n[D]),x(e.params,"cluster",{"clus-method":n[D].parameters.method})),w(m,D,"Clustering of interest chosen"));var j="marker_detection";"serialize"==r?e[j]=Tn():("run"==r?kn({}):An(n[j]),w(v,j,"Marker detection complete"));var F="custom_marker_management";return"serialize"==r?e[F]=Pn():("run"==r?Zn():Dn(n[F]),w(g,F,"Pruning of custom markers finished")),"serialize"==r?Promise.all([O,G]).then((function(r){return e.tsne=r[0],e.umap=r[1],e})):e}onmessage=function(e){var r=e.data;if("INIT"==r.type){var n=Math.round(2*navigator.hardwareConcurrency/3),t=_.j2({numberOfThreads:n});t.then((function(e){postMessage({type:r.type,msg:"Success: ScranJS/WASM initialized"})}));var a=In=new Promise((function(e){(zn=indexedDB.open("KanaDB",2)).onupgradeneeded=function(e){var r=e.target.result;try{r.deleteObjectStore("analysis")}catch(e){}try{r.deleteObjectStore("analysis_meta")}catch(e){}try{r.deleteObjectStore("file")}catch(e){}try{r.deleteObjectStore("file_meta")}catch(e){}r.createObjectStore("analysis",{keyPath:"id"}),r.createObjectStore("analysis_meta",{keyPath:"id"}),r.createObjectStore("file",{keyPath:"id"}),r.createObjectStore("file_meta",{keyPath:"id"})},zn.onsuccess=function(){qn(e)},zn.onerror=function(){e(null)}}));a.then((function(e){null!==e?postMessage({type:"KanaDB_store",resp:e,msg:"Success"}):(console.log(error),postMessage({type:"KanaDB_ERROR",msg:"Fail: Cannot initialize DB"}))}));var s=Yr(),i=dn();st=Promise.all([t,a,s,i])}else if("RUN"==r.type)st.then((function(e){yt("run",r.payload)})).catch((function(e){console.log(e),postMessage({type:"run_ERROR",msg:e.toString()})}));else if("LOAD"==r.type){if("kana"==r.payload.files.format){var u=new FileReaderSync,o=r.payload.files.files.file[0];st.then(function(){var e=(0,w.Z)(x().mark((function e(r){var n,t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pt(u.readAsArrayBuffer(o));case 2:n=e.sent,t=yt("unserialize",n),postMessage({type:"loadedParameters",resp:t});case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()).catch((function(e){console.log(e),postMessage({type:"load_ERROR",msg:e.toString()})}))}else if("kanadb"==r.payload.files.format){(function(e){return rt.apply(this,arguments)})(f=r.payload.files.files.file).then(function(){var e=(0,w.Z)(x().mark((function e(r){var n,t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r){e.next=4;break}postMessage({type:"KanaDB_ERROR",msg:"Fail: cannot load analysis ID '".concat(f,"'")}),e.next=11;break;case 4:return e.next=6,pt(r);case 6:return n=e.sent,e.next=9,yt("unserialize",n);case 9:t=e.sent,postMessage({type:"loadedParameters",resp:t});case 11:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()).catch((function(e){console.log(e),postMessage({type:"load_ERROR",msg:e.toString()})}))}}else if("EXPORT"==r.type)st.then(function(){var e=(0,w.Z)(x().mark((function e(r){var n,t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yt("serialize");case 2:return n=e.sent,e.next=5,lt(n,"full");case 5:t=e.sent,postMessage({type:"exportState",resp:t,msg:"Success: application state exported"},[t]);case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()).catch((function(e){console.log(e),postMessage({type:"export_ERROR",msg:e.toString()})}));else if("SAVEKDB"==r.type){var c=r.payload.title;st.then(function(){var e=(0,w.Z)(x().mark((function e(r){var n,t,a,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yt("serialize");case 2:return n=e.sent,e.next=5,lt(n,"KanaDB");case 5:return t=e.sent,e.next=8,Hn(null,t.state,t.file_ids,c);case 8:if(null===(a=e.sent)){e.next=16;break}return e.next=12,Vn();case 12:s=e.sent,postMessage({type:"KanaDB_store",resp:s,msg:"Success: Saved analysis to cache (".concat(a,")")}),e.next=18;break;case 16:console.log(error),postMessage({type:"KanaDB_ERROR",msg:"Fail: Cannot save analysis to cache (".concat(a,")")});case 18:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()).catch((function(e){console.log(e),postMessage({type:"export_ERROR",msg:e.toString()})}))}else if("REMOVEKDB"==r.type){var f;(function(e){return at.apply(this,arguments)})(f=r.payload.id).then(function(){var e=(0,w.Z)(x().mark((function e(r){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=7;break}return e.next=3,Vn();case 3:n=e.sent,postMessage({type:"KanaDB_store",resp:n,msg:"Success: Removed file from cache (".concat(f,")")}),e.next=9;break;case 7:console.log(error),postMessage({type:"KanaDB_ERROR",msg:"fail: cannot remove file from cache (".concat(f,")")});case 9:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}())}else"getMarkersForCluster"==r.type?st.then((function(e){var n=r.payload.cluster,t=On(r.payload.rank_type,n),a=[];z(t,a),postMessage({type:"setMarkersForCluster",resp:t,msg:"Success: GET_MARKER_GENE done"},a)})):"getGeneExpression"==r.type?st.then((function(e){var n=r.payload.gene,t=Pe(n);postMessage({type:"setGeneExpression",resp:{gene:n,expr:t},msg:"Success: GET_GENE_EXPRESSION done"},[t.buffer])})):"computeCustomMarkers"==r.type?st.then((function(e){jn(r.payload.id,r.payload.selection),postMessage({type:"computeCustomMarkers",msg:"Success: COMPUTE_CUSTOM_MARKERS done"})})):"getMarkersForSelection"==r.type?st.then((function(e){var n=Bn(r.payload.cluster,r.payload.rank_type),t=[];z(n,t),postMessage({type:"setMarkersForCustomSelection",resp:n,msg:"Success: GET_MARKER_GENE done"},t)})):"removeCustomMarkers"==r.type?st.then((function(e){Fn(r.payload.id)})):"animateTSNE"==r.type?st.then(function(){var e=(0,w.Z)(x().mark((function e(r){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,on();case 2:return e.next=4,tn();case 4:ht(e.sent,"tsne","Resending t-SNE coordinates");case 6:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()):"animateUMAP"==r.type?st.then(function(){var e=(0,w.Z)(x().mark((function e(r){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,bn();case 2:return e.next=4,yn();case 4:ht(e.sent,"umap","Resending UMAP coordinates");case 6:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()):console.log("MIM:::msg type incorrect")}}},r={};function n(t){var a=r[t];if(void 0!==a)return a.exports;var s=r[t]={exports:{}};return e[t](s,s.exports,n),s.exports}n.m=e,n.x=function(){var e=n.O(void 0,[537,555],(function(){return n(2459)}));return e=n.O(e)},function(){var e=[];n.O=function(r,t,a,s){if(!t){var i=1/0;for(f=0;f<e.length;f++){t=e[f][0],a=e[f][1],s=e[f][2];for(var u=!0,o=0;o<t.length;o++)(!1&s||i>=s)&&Object.keys(n.O).every((function(e){return n.O[e](t[o])}))?t.splice(o--,1):(u=!1,s<i&&(i=s));if(u){e.splice(f--,1);var c=a();void 0!==c&&(r=c)}}return r}s=s||0;for(var f=e.length;f>0&&e[f-1][2]>s;f--)e[f]=e[f-1];e[f]=[t,a,s]}}(),n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,{a:r}),r},n.d=function(e,r){for(var t in r)n.o(r,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(r,t){return n.f[t](e,r),r}),[]))},n.u=function(e){return"static/js/"+e+"."+{139:"978430f7",495:"5bc8be6f",537:"2057833a",555:"01abbdb9",653:"efc11270"}[e]+".chunk.js"},n.miniCssF=function(e){},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/kana/",function(){n.b=self.location+"/../../../";var e={459:1};n.f.i=function(r,t){e[r]||importScripts(n.p+n.u(r))};var r=self.webpackChunkkana=self.webpackChunkkana||[],t=r.push.bind(r);r.push=function(r){var a=r[0],s=r[1],i=r[2];for(var u in s)n.o(s,u)&&(n.m[u]=s[u]);for(i&&i(n);a.length;)e[a.pop()]=1;t(r)}}(),function(){var e=n.x;n.x=function(){return Promise.all([n.e(537),n.e(555)]).then(e)}}();n.x()}();
//# sourceMappingURL=459.7c1dc0d9.chunk.js.map