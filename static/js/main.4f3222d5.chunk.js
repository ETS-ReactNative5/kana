(this["webpackJsonpscran.js"]=this["webpackJsonpscran.js"]||[]).push([[0],{288:function(e,t,n){},289:function(e,t,n){},291:function(e,t,n){},318:function(e,t,n){},319:function(e,t,n){},331:function(e,t,n){},332:function(e,t,n){},333:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n(24),c=n.n(r),l=(n(288),n(9)),s=n(26),i=n(5),o=(n(289),n(341)),d=n(45),u=n(56),j=n(3),b=n(19),h=n(340),O=n(1),f=Object(a.createContext)(null),m=function(e){var t=e.children,n=Object(a.useState)({gene:null,mtx:null,barcode:null}),r=Object(i.a)(n,2),c=r[0],l=r[1],s=Object(a.useState)({qc:{"qc-nmads":3},fSelection:{"fsel-span":.3},pca:{"pca-npc":5},cluster:{"clus-k":10,"clus-res":.5,"clus-scheme":0},tsne:{"tsne-iter":500,"tsne-perp":30},umap:{"umap-nn":15,"umap-epochs":500,"umap-min_dist":.01,"umap-approx_nn":!0},markerGene:{}}),o=Object(i.a)(s,2),d=o[0],u=o[1],j=Object(a.useState)(!1),b=Object(i.a)(j,2),h=b[0],m=b[1],p=Object(a.useState)(null),v=Object(i.a)(p,2),x=v[0],g=v[1],F=Object(a.useState)(null),C=Object(i.a)(F,2),y=C[0],D=C[1],N=Object(a.useState)(null),A=Object(i.a)(N,2),w=A[0],S=A[1],k=Object(a.useState)(null),E=Object(i.a)(k,2),B=E[0],T=E[1],M=Object(a.useState)(null),R=Object(i.a)(M,2),I=R[0],_=R[1],q=Object(a.useState)(null),z=Object(i.a)(q,2),P=z[0],G=z[1],L=Object(a.useState)(null),V=Object(i.a)(L,2),U=V[0],H=V[1],W=Object(a.useState)([]),Q=Object(i.a)(W,2),J=Q[0],K=Q[1],X=Object(a.useState)(null),Y=Object(i.a)(X,2),$=Y[0],Z=Y[1],ee=Object(a.useState)(null),te=Object(i.a)(ee,2),ne=te[0],ae=te[1],re=Object(a.useState)(null),ce=Object(i.a)(re,2),le=ce[0],se=ce[1],ie=Object(a.useState)(null),oe=Object(i.a)(ie,2),de=oe[0],ue=oe[1],je=Object(a.useState)({}),be=Object(i.a)(je,2),he=be[0],Oe=be[1],fe=Object(a.useState)(null),me=Object(i.a)(fe,2),pe=me[0],ve=me[1],xe=Object(a.useState)(null),ge=Object(i.a)(xe,2),Fe=ge[0],Ce=ge[1],ye=Object(a.useState)(null),De=Object(i.a)(ye,2),Ne=De[0],Ae=De[1],we=Object(a.useState)(null),Se=Object(i.a)(we,2),ke=Se[0],Ee=Se[1],Be=Object(a.useState)(null),Te=Object(i.a)(Be,2),Me=Te[0],Re=Te[1],Ie=Object(a.useState)(null),_e=Object(i.a)(Ie,2),qe=_e[0],ze=_e[1],Pe=Object(a.useState)(null),Ge=Object(i.a)(Pe,2),Le=Ge[0],Ve=Ge[1],Ue=Object(a.useState)(null),He=Object(i.a)(Ue,2),We=He[0],Qe=He[1],Je=Object(a.useState)([]),Ke=Object(i.a)(Je,2),Xe=Ke[0],Ye=Ke[1];return Object(a.useEffect)((function(){h&&null!=c.mtx&&window.Worker.postMessage({type:"RUN",payload:{files:[c.mtx,c.barcode?c.barcode[0]:[],c.gene?c.gene[0]:[]],params:d},msg:"not much to pass"})}),[c,d,h]),Object(O.jsx)(f.Provider,{value:{inputFiles:c,setInputFiles:l,params:d,setParams:u,error:x,setError:g,wasmInitialized:h,setWasmInitialized:m,pcaData:Ne,setPcaData:Ae,pcaVarExp:ke,setPcaVarExp:Ee,tsneData:Me,setTsneData:Re,umapData:qe,setUmapData:ze,initDims:y,setInitDims:D,qcDims:w,setQcDims:S,qcData:I,setQcData:_,qcThreshold:P,setQcThreshold:G,fSelDims:B,setFSelDims:T,redDims:J,setRedDims:K,defaultRedDims:$,setDefaultRedDims:Z,plotRedDims:ne,setPlotRedDims:ae,clusterData:le,setClusterData:se,fSelectionData:U,setFSelectionData:H,logs:Xe,setLogs:Ye,selectedCluster:de,setSelectedCluster:ue,selectedClusterSummary:he,setSelectedClusterSummary:Oe,clusterRank:Fe,setClusterRank:Ce,gene:Le,setGene:Ve,clusterColors:pe,setClusterColors:ve,reqGene:We,setReqGene:Qe},children:t})},p=(n(291),["buttonText","includeFooter"]);var v=function(e){var t=e.buttonText,n=e.includeFooter,r=Object(u.a)(e,p),c=Object(a.useState)(!1),s=Object(i.a)(c,2),d=s[0],m=s[1],v=Object(a.useCallback)((function(){return m(!d)}),[d]),x=Object(a.useCallback)((function(){return m(!1)}),[]),g=Object(a.useContext)(f),F=g.inputFiles,C=g.setInputFiles,y=g.params,D=g.setParams,N=Object(a.useState)(F),A=Object(i.a)(N,2),w=A[0],S=A[1],k=Object(a.useState)(y),E=Object(i.a)(k,2),B=E[0],T=E[1],M=Object(a.useState)({mtx:"Choose mtx file...",gene:"Choose gene file...",barcode:"Choose barcode file..."}),R=Object(i.a)(M,2),I=R[0],_=R[1];return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(o.a,{onClick:v,icon:"social-media",intent:"primary",text:t}),Object(O.jsxs)(o.g,Object(l.a)(Object(l.a)({className:"analysis-dialog"},r),{},{isOpen:d,onClose:x,children:[Object(O.jsxs)("div",{className:j.a.DIALOG_BODY,children:[Object(O.jsx)("div",{className:"col",children:Object(O.jsxs)("div",{children:[Object(O.jsxs)(o.j,{children:[Object(O.jsx)(o.y,{large:!0,round:!0,children:"1"})," Import Single cell dataset"]}),Object(O.jsxs)("div",{className:"row",children:[Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Choose mtx file"}),Object(O.jsx)(o.i,{text:null===I||void 0===I?void 0:I.mtx,onInputChange:function(e){_(Object(l.a)(Object(l.a)({},I),{},{mtx:e.target.files[0].name})),S(Object(l.a)(Object(l.a)({},w),{},{mtx:e.target.files}))}})]}),Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Choose gene file"}),Object(O.jsx)(o.i,{text:null===I||void 0===I?void 0:I.gene,onInputChange:function(e){_(Object(l.a)(Object(l.a)({},I),{},{gene:e.target.files[0].name})),S(Object(l.a)(Object(l.a)({},w),{},{gene:e.target.files}))}})]}),Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Choose barcode file"}),Object(O.jsx)(o.i,{text:null===I||void 0===I?void 0:I.barcode,onInputChange:function(e){_(Object(l.a)(Object(l.a)({},I),{},{barcode:e.target.files[0].name})),S(Object(l.a)(Object(l.a)({},w),{},{barcode:e.target.files}))}})]})]})]})}),Object(O.jsx)("div",{className:"col",children:Object(O.jsxs)("div",{children:[Object(O.jsxs)(o.j,{children:[Object(O.jsx)(o.y,{large:!0,round:!0,children:"2"})," QC: Generate per cell QC metrics and filter cells"]}),Object(O.jsx)("div",{className:"row",children:Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsxs)(o.z,{className:"text-100",children:["NMADS",Object(O.jsx)(h.a,{className:"row-tooltip",content:"Number of MADs from the median, to use for defining outliers.(defaults to 3)",position:b.a.RIGHT,openOnTargetFocus:!1,children:Object(O.jsx)(o.m,{icon:"help"})})]}),Object(O.jsx)(o.t,{placeholder:"3",value:B.qc["qc-nmads"],onValueChange:function(e,t){T(Object(l.a)(Object(l.a)({},B),{},{qc:{"qc-nmads":e}}))}})]})})]})}),Object(O.jsx)("div",{className:"col",children:Object(O.jsxs)("div",{children:[Object(O.jsxs)(o.j,{children:[Object(O.jsx)(o.y,{large:!0,round:!0,children:"3"})," Feature Selection: Model the variance of the log-expression values for each gene, accounting for the mean-variance trend"]}),Object(O.jsx)("div",{className:"row",children:Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsxs)(o.z,{className:"text-100",children:["Span factor",Object(O.jsx)(h.a,{className:"row-tooltip",content:"The span of the LOWESS smoother for fitting the mean-variance trend.(defaults to 0.3)",position:b.a.RIGHT,openOnTargetFocus:!1,children:Object(O.jsx)(o.m,{icon:"help"})})]}),Object(O.jsx)(o.t,{placeholder:"0.3",value:B.fSelection["fsel-span"],onValueChange:function(e,t){T(Object(l.a)(Object(l.a)({},B),{},{fSelection:{"fsel-span":e}}))}})]})})]})}),Object(O.jsx)("div",{className:"col",children:Object(O.jsxs)("div",{children:[Object(O.jsxs)(o.j,{children:[Object(O.jsx)(o.y,{large:!0,round:!0,children:"4"})," PCA: Perform a principal components analysis to obtain per-cell coordinates in low-dimensional space"]}),Object(O.jsx)("div",{className:"row",children:Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"# of PCs (defaults to 5)"}),Object(O.jsx)(o.t,{placeholder:"5",value:B.pca["pca-npc"],onValueChange:function(e,t){T(Object(l.a)(Object(l.a)({},B),{},{pca:{"pca-npc":e}}))}})]})})]})}),Object(O.jsx)("div",{className:"col",children:Object(O.jsxs)("div",{children:[Object(O.jsxs)(o.j,{children:[Object(O.jsx)(o.y,{large:!0,round:!0,children:"5"})," Cluster Analysis: Generate SNN graph and cluster cells"]}),Object(O.jsxs)("div",{className:"row",children:[Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsxs)(o.z,{className:"text-100",children:["# of neighbors",Object(O.jsx)(h.a,{className:"row-tooltip",content:"Number of neighbors to use to construct the nearest neighbor graph.(defaults to 10)",position:b.a.RIGHT,openOnTargetFocus:!1,children:Object(O.jsx)(o.m,{icon:"help"})})]}),Object(O.jsx)(o.t,{placeholder:"10",value:B.cluster["clus-k"],onValueChange:function(e,t){T(Object(l.a)(Object(l.a)({},B),{},{cluster:{"clus-k":e}}))}})]}),Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsxs)(o.z,{className:"text-100",children:["Scheme",Object(O.jsx)(h.a,{className:"row-tooltip",content:"0 for approx, 1 ..., 2 for jaccard index",position:b.a.RIGHT,openOnTargetFocus:!1,children:Object(O.jsx)(o.m,{icon:"help"})})]}),Object(O.jsxs)(o.l,{onChange:function(e,t){var n;return T(Object(l.a)(Object(l.a)({},B),{},{cluster:{"clus-scheme":parseInt(null===e||void 0===e||null===(n=e.currentTarget)||void 0===n?void 0:n.value)}}))},children:[Object(O.jsx)("option",{children:"0"},"0"),Object(O.jsx)("option",{children:"1"},"1"),Object(O.jsx)("option",{children:"2"},"2")]})]}),Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsxs)(o.z,{className:"text-100",children:["Resolution",Object(O.jsx)(h.a,{className:"row-tooltip",content:"Resolution of the multi-level clustering, used in the modularity calculation.Larger values yield more fine-grained clusters.(defaults to 0.5)",position:b.a.RIGHT,openOnTargetFocus:!1,children:Object(O.jsx)(o.m,{icon:"help"})})]}),Object(O.jsx)(o.t,{placeholder:"0.5",value:B.cluster["clus-res"],onValueChange:function(e,t){T(Object(l.a)(Object(l.a)({},B),{},{cluster:{"clus-res":e}}))}})]})]})]})}),Object(O.jsx)("div",{className:"col",children:Object(O.jsxs)("div",{children:[Object(O.jsxs)(o.j,{children:[Object(O.jsx)(o.y,{large:!0,round:!0,children:"6"})," t-SNE: Compute t-SNE embeddings and Visualize cells"]}),Object(O.jsxs)("div",{className:"row",children:[Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Iterations (defaults to 500)"}),Object(O.jsx)(o.t,{placeholder:"500",value:B.tsne["tsne-iter"],onValueChange:function(e,t){T(Object(l.a)(Object(l.a)({},B),{},{tsne:{"tsne-iter":e}}))}})]}),Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Perplexity (defaults to 30)"}),Object(O.jsx)(o.t,{placeholder:"30",value:B.tsne["tsne-perp"],onValueChange:function(e,t){T(Object(l.a)(Object(l.a)({},B),{},{tsne:{"tsne-perp":e}}))}})]})]})]})}),Object(O.jsx)("div",{className:"col",children:Object(O.jsxs)("div",{children:[Object(O.jsxs)(o.j,{children:[Object(O.jsx)(o.y,{large:!0,round:!0,children:"6"})," UMAP: Compute UMAP embeddings and Visualize cells"]}),Object(O.jsxs)("div",{className:"row",children:[Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Num of Neighbors (defaults to 15)"}),Object(O.jsx)(o.t,{placeholder:"15",value:B.umap["umap-nn"],onValueChange:function(e,t){T(Object(l.a)(Object(l.a)({},B),{},{umap:{"umap-nn":e}}))}})]}),Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Epochs (defaults to 500)"}),Object(O.jsx)(o.t,{placeholder:"500",value:B.umap["umap-epoch"],onValueChange:function(e,t){T(Object(l.a)(Object(l.a)({},B),{},{umap:{"umap-epoch":e}}))}})]}),Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Min Distance (defaults to 0.01)"}),Object(O.jsx)(o.t,{placeholder:"0.01",value:B.umap["umap-min_dist"],onValueChange:function(e,t){T(Object(l.a)(Object(l.a)({},B),{},{umap:{"umap-min_dist":e}}))}})]}),Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Use Approximate Neighbor Search ? (true for fast UMAP calculation))"}),Object(O.jsx)(o.t,{placeholder:"0.01",value:B.umap["umap-approx_nn"],onValueChange:function(e,t){T(Object(l.a)(Object(l.a)({},B),{},{umap:{"umap-approx_nn":e}}))}})]})]})]})})]}),n?Object(O.jsx)("div",{className:j.a.DIALOG_FOOTER,children:Object(O.jsx)("div",{className:j.a.DIALOG_FOOTER_ACTIONS,children:Object(O.jsx)(h.a,{content:"Run Analysis",children:Object(O.jsx)(o.a,{icon:"function",onClick:function(){D(B),C(w),x()},children:"Analyze"})})})}):Object(O.jsx)("div",{style:{margin:"0 20px"}})]}))]})},x=function(){var e=Object(a.useContext)(f),t=e.initDims,n=e.qcDims;return Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("span",{children:["Dataset Dims: ",t,n?" (After QC: ".concat(n,")"):" (After QC: ??? X ???)"]})})},g=function(){var e=Object(a.useContext)(f).logs,t=Object(a.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!0,enforceFocus:!0,hasBackdrop:!0,isOpen:!1,position:b.a.RIGHT,size:void 0,usePortal:!0}),n=Object(i.a)(t,2),r=n[0],c=n[1];return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(o.a,{onClick:function(){return c({isOpen:!0})},icon:"wrench",outlined:!0,intent:"warning",children:"What's happening ?"}),Object(O.jsx)(o.h,Object(l.a)(Object(l.a)({icon:"info-sign",onClose:function(){return c({isOpen:!1})},title:"What's happening ?"},r),{},{children:Object(O.jsx)("div",{className:j.a.DRAWER_BODY,children:Object(O.jsx)("div",{className:j.a.DIALOG_BODY,children:Object(O.jsx)("ul",{className:"list",children:e.map((function(e,t){return Object(O.jsx)("li",{children:e},t)}))})})})}))]})},F=function(){var e=Object(a.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!0,enforceFocus:!0,shouldReturnFocusOnClose:!0}),t=Object(i.a)(e,1)[0];return Object(O.jsx)(O.Fragment,{children:Object(O.jsx)(o.p,{className:"bp3-dark",children:Object(O.jsxs)(o.r,{align:d.a.LEFT,children:[Object(O.jsx)(o.s,{children:"SCRAN.JS"}),Object(O.jsx)(o.q,{}),Object(O.jsx)("span",{children:"Analyze Single-cell RNA-seq Datasets"}),Object(O.jsx)(o.q,{}),Object(O.jsx)(v,Object(l.a)({icon:"document",title:"Import dataset and update parameters",buttonText:"Start Analysis",includeFooter:!0},t)),Object(O.jsx)(o.q,{}),Object(O.jsx)(x,{}),Object(O.jsx)(o.q,{}),Object(O.jsx)(g,{})]})})})},C=n(12),y=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,a=null===e||void 0===e?void 0:e.width,r=null===e||void 0===e?void 0:e.color,c=null===e||void 0===e?void 0:e.ymax;if(c||(c=Math.max.apply(Math,Object(s.a)(n.map((function(e){return e.value}))))),a||(a=325),r||(r="#00B3A4"),!n)return"";var l=t.current;l.innerHTML="";var i=10,o=30,d=30,u=40,j=a-u-o,b=200-i-d,h=C.n(l).append("svg").attr("width",j+u+o).attr("height",b+i+d).append("g").attr("transform","translate(".concat(u,",").concat(i,")")),O=C.k().range([0,j]).domain(n.map((function(e){return e.key}))).padding(.2);h.append("g").attr("transform","translate(0,"+b+")").call(C.b(O)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");var f=C.l().domain([0,c]).range([b,0]);h.append("g").call(C.c(f)),h.selectAll("bars").data(n).enter().append("rect").attr("x",(function(e){return O(e.key)})).attr("y",(function(e){return f(e.value)})).attr("width",O.bandwidth()).attr("height",(function(e){return b-f(e.value)})).attr("fill",(function(e,t){return Array.isArray(r)?r[t]:r}))}),[]),Object(O.jsx)("div",{ref:t})},D=function(e){var t,n,a=null===e||void 0===e||null===(t=e.pca)||void 0===t?void 0:t.var_exp;if(!a)return"";var r=[];return null===(n=Object.values(a))||void 0===n||n.forEach((function(e,t){r.push({key:t+1,value:100*e})})),Object(O.jsx)(y,{data:r})},N=n(128),A=function(e){var t,n,r=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.clusters,c=Object(a.useContext)(f).setClusterColors,l=Object(a.useState)(null),s=Object(i.a)(l,2),o=s[0],d=s[1];if(Object(a.useEffect)((function(){var e=Object.keys(j).length,t=null;t=e>Object.keys(u).length?Object(N.randomColor)({luminosity:"dark",count:e+1}):u[e.toString()],d(t)}),[]),Object(a.useEffect)((function(){c(o)}),[o]),!r)return"";for(var u={1:["#1b9e77"],2:["#1b9e77","#d95f02"],3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},j={},b=0;b<(null===r||void 0===r?void 0:r.length);b++){var h=r[b];"CLUS_"+h in j?j["CLUS_"+h]++:j["CLUS_"+h]=0}var m=[];return null===(n=Object.values(j))||void 0===n||n.forEach((function(e,t){m.push({key:t+1,value:e})})),o&&Object(O.jsx)(y,{data:m,color:o})},w=n(33),S=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){var n=null===e||void 0===e?void 0:e.rdata,a=null===e||void 0===e?void 0:e.width,r=null===e||void 0===e?void 0:e.color;if(a||(a=275),r||(r="#00B3A4"),!n)return"";var c=t.current;c.innerHTML="";var l=10,s=30,i=30,o=40,d=a-o-s,u=200-l-i,j=C.n(c).append("svg").attr("width",d+o+s).attr("height",u+l+i).append("g").attr("transform","translate(".concat(o,",").concat(l,")")),b=C.l().domain(null===e||void 0===e?void 0:e.range).range([u,0]).nice();j.append("g").call(C.c(b));var h=C.k().range([0,d]).domain([null===e||void 0===e?void 0:e.label]).padding(.05);j.append("g").attr("transform","translate(0,"+u+")").call(C.b(h));var O=C.f().domain(b.domain()).thresholds(b.ticks(20)).value((function(e){return e}))(n),f=C.j(O,(function(e){return e.length})),m=C.l().range([0,h.bandwidth()]).domain([-f,f]),p=C.m().interpolator(C.g).domain(null===e||void 0===e?void 0:e.range);j.selectAll("violins").data([null===e||void 0===e?void 0:e.label]).enter().append("g").attr("transform",(function(e){return"translate("+h(e)+" ,0)"})).append("path").datum((function(){return O})).style("stroke","none").style("fill","#A7B6C2").attr("d",C.a().x0(m(0)).x1((function(e){return m(e.length)})).y((function(e){return b(e.x0)})).curve(C.d));j.selectAll("jitter").data(n).enter().append("circle").attr("cx",(function(t){return h(null===e||void 0===e?void 0:e.label)+h.bandwidth()/2-70*Math.random()})).attr("cy",(function(e){return b(e)})).attr("r",3).style("fill",(function(e){return p(e)})).attr("stroke","white"),j.selectAll("threshold").data([null===e||void 0===e?void 0:e.threshold]).enter().append("line").attr("transform",(function(){return"translate("+h(null===e||void 0===e?void 0:e.label)+" ,0)"})).attr("class","threshold").attr("x1",5).attr("y1",(function(e){return b(e)})).attr("x2",h.bandwidth()-5).attr("y2",(function(e){return b(e)})).attr("stroke-width",2).attr("stroke","Orange").on("mouseover",(function(){var e=C.n(this);e.attr("stroke","black"),e.attr("stroke-width","8")})).on("mouseout",(function(){var e=C.n(this);e.attr("stroke","Orange"),e.attr("stroke-width","5")}))}),[]),Object(O.jsx)("div",{ref:t})},k=(n(318),function(e){var t=e.data;return Object(O.jsx)("div",{className:"qc-plots",children:["sums","detected","proportion"].map((function(e){var n,a,r,c={threshold:null===t||void 0===t||null===(n=t.thresholds)||void 0===n?void 0:n[e],range:null===t||void 0===t||null===(a=t.ranges)||void 0===a?void 0:a[e],label:e,rdata:null===t||void 0===t||null===(r=t.data)||void 0===r?void 0:r[e]};return Object(O.jsx)("div",{children:Object(O.jsx)(S,Object(l.a)({},c))},e)}))})}),E=(n(319),function(){var e=Object(a.useContext)(f),t=e.pcaVarExp,n=e.qcData,r=e.clusterData;return Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("div",{className:"gallery-cont",children:[r?Object(O.jsxs)(o.d,{className:"gallery-elem",elevation:w.a.ONE,children:[Object(O.jsx)("h5",{children:"# of cells per cluster"}),Object(O.jsx)(A,{data:r})]}):"",t?Object(O.jsxs)(o.d,{className:"gallery-elem",elevation:w.a.ONE,children:[Object(O.jsx)("h5",{children:"PCA (% variance explained)"}),Object(O.jsx)(D,{pca:t})]}):"",n&&(null===n||void 0===n?void 0:n.thresholds)?Object(O.jsxs)(o.d,{className:"gallery-elem",elevation:w.a.ONE,children:[Object(O.jsx)("h5",{children:"QC Statistics"}),Object(O.jsx)(k,{data:n})]}):""]})})}),B=n(72),T=function(e){var t=-Number.MAX_VALUE,n=Number.MAX_VALUE;return e.forEach((function(e){t<e&&(t=e),n>e&&(n=e)})),[n,t]};function M(){var e=null,t=0,n=100,a=["ff0000","ffff00","00ff00","0000ff"];function r(r){if(r.length<2)throw new Error("Rainbow must have two or more colours.");var c=(n-t)/(r.length-1),l=new R;l.setGradient(r[0],r[1]),l.setNumberRange(t,t+c),e=[l];for(var s=1;s<r.length-1;s++){var i=new R;i.setGradient(r[s],r[s+1]),i.setNumberRange(t+c*s,t+c*(s+1)),e[s]=i}a=r}r(a),this.setSpectrum=function(){return r(arguments),this},this.setSpectrumByArray=function(e){return r(e),this},this.colourAt=function(a){if(isNaN(a))throw new TypeError(a+" is not a number");if(1===e.length)return e[0].colourAt(a);var r=(n-t)/e.length,c=Math.min(Math.floor((Math.max(a,t)-t)/r),e.length-1);return e[c].colourAt(a)},this.colorAt=this.colourAt,this.setNumberRange=function(e,c){if(!(c>e))throw new RangeError("maxNumber ("+c+") is not greater than minNumber ("+e+")");return t=e,n=c,r(a),this}}function R(){var e="ff0000",t="0000ff",n=0,a=100;function r(e,t,r){var c=e;c<n&&(c=n),c>a&&(c=a);var l,s=a-n,i=parseInt(t,16),o=(parseInt(r,16)-i)/s,d=Math.round(o*(c-n)+i);return 1===(l=d.toString(16)).length?"0"+l:l}function c(e){if(function(e){return/^#?[0-9a-fA-F]{6}$/i.test(e)}(e))return e.substring(e.length-6,e.length);var t=e.toLowerCase();if(l.hasOwnProperty(t))return l[t];throw new Error(e+" is not a valid colour.")}this.setGradient=function(n,a){e=c(n),t=c(a)},this.setNumberRange=function(e,t){if(!(t>e))throw new RangeError("maxNumber ("+t+") is not greater than minNumber ("+e+")");n=e,a=t},this.colourAt=function(n){return r(n,e.substring(0,2),t.substring(0,2))+r(n,e.substring(2,4),t.substring(2,4))+r(n,e.substring(4,6),t.substring(4,6))};var l={aliceblue:"F0F8FF",antiquewhite:"FAEBD7",aqua:"00FFFF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000000",blanchedalmond:"FFEBCD",blue:"0000FF",blueviolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetblue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerblue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"00FFFF",darkblue:"00008B",darkcyan:"008B8B",darkgoldenrod:"B8860B",darkgray:"A9A9A9",darkgreen:"006400",darkgrey:"A9A9A9",darkkhaki:"BDB76B",darkmagenta:"8B008B",darkolivegreen:"556B2F",darkorange:"FF8C00",darkorchid:"9932CC",darkred:"8B0000",darksalmon:"E9967A",darkseagreen:"8FBC8F",darkslateblue:"483D8B",darkslategray:"2F4F4F",darkslategrey:"2F4F4F",darkturquoise:"00CED1",darkviolet:"9400D3",deeppink:"FF1493",deepskyblue:"00BFFF",dimgray:"696969",dimgrey:"696969",dodgerblue:"1E90FF",firebrick:"B22222",floralwhite:"FFFAF0",forestgreen:"228B22",fuchsia:"FF00FF",gainsboro:"DCDCDC",ghostwhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"808080",green:"008000",greenyellow:"ADFF2F",grey:"808080",honeydew:"F0FFF0",hotpink:"FF69B4",indianred:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderblush:"FFF0F5",lawngreen:"7CFC00",lemonchiffon:"FFFACD",lightblue:"ADD8E6",lightcoral:"F08080",lightcyan:"E0FFFF",lightgoldenrodyellow:"FAFAD2",lightgray:"D3D3D3",lightgreen:"90EE90",lightgrey:"D3D3D3",lightpink:"FFB6C1",lightsalmon:"FFA07A",lightseagreen:"20B2AA",lightskyblue:"87CEFA",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"B0C4DE",lightyellow:"FFFFE0",lime:"00FF00",limegreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumaquamarine:"66CDAA",mediumblue:"0000CD",mediumorchid:"BA55D3",mediumpurple:"9370DB",mediumseagreen:"3CB371",mediumslateblue:"7B68EE",mediumspringgreen:"00FA9A",mediumturquoise:"48D1CC",mediumvioletred:"C71585",midnightblue:"191970",mintcream:"F5FFFA",mistyrose:"FFE4E1",moccasin:"FFE4B5",navajowhite:"FFDEAD",navy:"000080",oldlace:"FDF5E6",olive:"808000",olivedrab:"6B8E23",orange:"FFA500",orangered:"FF4500",orchid:"DA70D6",palegoldenrod:"EEE8AA",palegreen:"98FB98",paleturquoise:"AFEEEE",palevioletred:"DB7093",papayawhip:"FFEFD5",peachpuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderblue:"B0E0E6",purple:"800080",red:"FF0000",rosybrown:"BC8F8F",royalblue:"4169E1",saddlebrown:"8B4513",salmon:"FA8072",sandybrown:"F4A460",seagreen:"2E8B57",seashell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyblue:"87CEEB",slateblue:"6A5ACD",slategray:"708090",slategrey:"708090",snow:"FFFAFA",springgreen:"00FF7F",steelblue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFFFFF",whitesmoke:"F5F5F5",yellow:"FFFF00",yellowgreen:"9ACD32"}}n(331);var I=function(){var e=Object(a.useRef)(),t=Object(a.useState)(null),n=Object(i.a)(t,2),r=n[0],c=n[1],l=Object(a.useState)(null),s=Object(i.a)(l,2),d=s[0],u=s[1],j=Object(a.useState)(!1),b=Object(i.a)(j,2),h=b[0],m=b[1],p=Object(a.useState)(null),v=Object(i.a)(p,2),x=v[0],g=v[1],F=Object(a.useContext)(f),C=F.plotRedDims,y=F.redDims,D=F.defaultRedDims,N=F.setDefaultRedDims,A=F.clusterData,w=F.tsneData,S=F.umapData,k=F.setPlotRedDims,E=F.clusterColors,R=F.gene,I=F.selectedClusterSummary;Object(a.useEffect)((function(){if(e.current){var t=r;if(!t){var n=e.current;n.style.width="95%",n.style.height="95%";(t=new B.ScatterGL(n,{orbitControls:{zoomSpeed:1.25},styles:{point:{scaleDefault:2.5,scaleSelected:2.5,scaleHover:2.5}}})).setPanMode(),c(t)}if(null===C||void 0===C?void 0:C.plot){var a=null===C||void 0===C?void 0:C.clusters,l=E,s=[];null===C||void 0===C||C.plot.x.forEach((function(e,t){s.push([e,null===C||void 0===C?void 0:C.plot.y[t]])}));var i={clusters:a},o=new B.ScatterGL.Dataset(s,i);t.render(o),t.setPointColorer((function(e,t,n){var r;if(null!=d&&d!==a[e])return"#D3D3D3";if(R&&Array.isArray(null===I||void 0===I||null===(r=I[R])||void 0===r?void 0:r.expr)){var c,s,i=T(I[R].expr),o=new M;o.setSpectrum("#F5F8FA","#2965CC");var u=0===i[1]?.01:i[1];return o.setNumberRange(0,u),g([0,u]),m(!0),"#"+o.colorAt(null===I||void 0===I||null===(c=I[R])||void 0===c||null===(s=c.expr)||void 0===s?void 0:s[e])}return m(!1),l[a[e]]}))}}}),[C,I,R,d]),Object(a.useEffect)((function(){_(D)}),[D]);var _=function(e){"TSNE"===D?k({plot:w,clusters:null===A||void 0===A?void 0:A.clusters}):"UMAP"===D&&k({plot:S,clusters:null===A||void 0===A?void 0:A.clusters})},q=function(e){"PAN"===e?r.setPanMode():"SELECT"===e&&r.setSelectMode()};return Object(O.jsxs)("div",{className:"scatter-plot",children:[Object(O.jsxs)(o.b,{style:{minWidth:75,minHeight:150},fill:!1,large:!1,minimal:!1,vertical:!0,className:"left-sidebar",children:[Object(O.jsxs)(o.a,{className:"dim-button",disabled:-1===y.indexOf("TSNE"),onClick:function(){return N("TSNE")},intent:"TSNE"===D?"primary":"",children:[Object(O.jsx)(o.m,{icon:"database"}),Object(O.jsx)("br",{}),Object(O.jsx)("span",{children:"TSNE"})]}),Object(O.jsxs)(o.a,{className:"dim-button",disabled:-1===y.indexOf("UMAP"),onClick:function(){return N("UMAP")},intent:"UMAP"===D?"primary":"",children:[Object(O.jsx)(o.m,{icon:"database"}),Object(O.jsx)("br",{}),Object(O.jsx)("span",{children:"UMAP"})]})]}),Object(O.jsxs)(o.f,{className:"top-header",fill:!1,vertical:!1,children:[Object(O.jsx)(o.a,{icon:"hand-up",onClick:function(e){return q("PAN")},children:"Pan"}),Object(O.jsx)(o.a,{icon:"widget",onClick:function(e){return q("SELECT")},children:"Selection"})]}),Object(O.jsx)("div",{className:"dim-plot",children:(null===C||void 0===C?void 0:C.plot)?Object(O.jsx)("div",{ref:e}):"Choose an Embedding... or Embeddings are being computed..."}),Object(O.jsx)("div",{className:"right-sidebar",children:h?Object(O.jsx)("div",{children:Object(O.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",children:[Object(O.jsx)("defs",{children:Object(O.jsxs)("linearGradient",{id:"geneGradient",gradientTransform:"rotate(90)",children:[Object(O.jsx)("stop",{offset:"5%","stop-color":"#F5F8FA"}),Object(O.jsx)("stop",{offset:"95%","stop-color":"#2965CC"})]})}),Object(O.jsx)("rect",{x:"25%",y:"25%",width:"13",height:"150",fill:"url('#geneGradient')"}),Object(O.jsx)("text",{x:"25%",y:"15%",style:{font:"8px sans-serif;"},children:R}),Object(O.jsx)("text",{x:"30%",y:"25%",style:{font:"8px sans-serif;"},children:x[0]}),Object(O.jsx)("text",{x:"30%",y:"100%",style:{font:"8px sans-serif;"},children:x[1].toFixed(2)})]})}):Object(O.jsx)(o.c,{title:"CLUSTERS",icon:"circle-arrow-left",children:Object(O.jsx)("ul",{children:null===E||void 0===E?void 0:E.map((function(e,t){return Object(O.jsxs)("li",{className:d==t?"legend-highlight":"",style:{color:e},onClick:function(){u(t===d?null:t)},children:[" Cluster ",t+1," "]},t)}))})})})]})},_=n(129),q=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,a=null===e||void 0===e?void 0:e.width,r=null===e||void 0===e?void 0:e.color,c=null===e||void 0===e?void 0:e.clusters;if(a||(a=325),r||(r="#00B3A4"),!n)return"";var l=t.current;l.innerHTML="";var i=10,o=30,d=30,u=40,j=a-u-o,b=150-i-d,h=C.n(l).append("svg").attr("width",j+u+o).attr("height",b+i+d).append("g").attr("transform","translate(".concat(u,",").concat(i,")")),O=C.l().domain([0,Math.max.apply(Math,Object(s.a)(n))]).range([0,j]);h.append("g").attr("transform","translate(0, ".concat(b,")")).call(C.b(O));var f=C.f().value((function(e){return e})).domain(O.domain()).thresholds(O.ticks(25)),m=f(n),p=f(n.filter((function(e,t){return 0===(null===c||void 0===c?void 0:c[t])}))),v=f(n.filter((function(e,t){return 1===(null===c||void 0===c?void 0:c[t])}))),x=C.l().range([b,0]).domain([0,C.j(m,(function(e){return e.length}))]);h.selectAll("rectAll").data(p).join("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(O(e.x0)," , ").concat(x(e.length),")")})).attr("width",(function(e){return O(e.x1)-O(e.x0)-1})).attr("height",(function(e){return b-x(e.length)})).style("fill","#D3D3D3").style("opacity",.6),h.selectAll("rectCluster").data(v).enter().append("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(O(e.x0),", ").concat(x(e.length),")")})).attr("width",(function(e){return O(e.x1)-O(e.x0)-1})).attr("height",(function(e){return b-x(e.length)})).style("fill",r).style("opacity",.6),h.append("circle").attr("cx",j-50).attr("cy",5).attr("r",3).style("fill","#D3D3D3"),h.append("circle").attr("cx",j-50).attr("cy",15).attr("r",3).style("fill",r),h.append("text").attr("x",j-40).attr("y",5).text("all cells").style("font-size","10px").attr("alignment-baseline","middle"),h.append("text").attr("x",j-40).attr("y",15).text("this cluster").style("font-size","10px").attr("alignment-baseline","middle")}),[]),Object(O.jsx)("div",{ref:t})},z=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,a=null===e||void 0===e?void 0:e.width,r=null===e||void 0===e?void 0:e.height,c=null===e||void 0===e?void 0:e.color;if(a||(a=325),r||(r=150),c||(c="#00B3A4"),!n)return"";var l=t.current;l.innerHTML="";var i=5,o=5,d=5,u=5,j=a-u-o,b=r-i-d,h=C.n(l).append("svg").attr("width",j+u+o).attr("height",b+i+d).append("g").attr("transform","translate(".concat(u,",").concat(i,")")),O=C.l().domain([0,Math.max.apply(Math,Object(s.a)(n))]).range([0,j]);h.append("g").attr("transform","translate(0, ".concat(b,")")).call(C.b(O));var f=C.f().value((function(e){return e})).domain(O.domain()).thresholds(O.ticks(25))(n),m=C.l().range([b,0]);m.domain([0,C.j(f,(function(e){return e.length}))]),h.selectAll("rect").data(f).join("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(O(e.x0)," , ").concat(m(e.length),")")})).attr("width",(function(e){return O(e.x1)-O(e.x0)-1})).attr("height",(function(e){return b-m(e.length)})).style("fill",c)}),[null===e||void 0===e?void 0:e.data]),Object(O.jsx)("div",{ref:t})},P=function(e){var t=Object(a.useRef)(),n=null===e||void 0===e?void 0:e.width,r=null===e||void 0===e?void 0:e.minmax,c=null===e||void 0===e?void 0:e.score,l=null===e||void 0===e?void 0:e.colorscale,s=null===e||void 0===e?void 0:e.colorscore,i=null===e||void 0===e?void 0:e.color,o=(c-r[0])/(r[1]-r[0]);return n||(n="100%"),i||(i="#00B3A4"),Object(O.jsx)("div",{ref:t,style:{width:n,height:"66%",margin:"5px",border:"1px solid gainsboro",alignItems:"center"},children:l?Object(O.jsx)("div",{style:{width:"".concat(100*s,"%"),backgroundColor:l(s),height:"100%"}}):Object(O.jsx)("div",{style:{width:"".concat(100*o,"%"),backgroundColor:i,height:"100%"}})})},G=function(e){var t=Object(a.useRef)(),n=null===e||void 0===e?void 0:e.width,r=(null===e||void 0===e||e.colorscale,null===e||void 0===e?void 0:e.score),c=null===e||void 0===e?void 0:e.minmax,l=C.m(C.i).domain([c[1],c[0]]);return n||(n="100%"),Object(O.jsx)("div",{ref:t,style:{width:n,height:"66%",margin:"5px",border:"1px solid gainsboro",alignItems:"center",backgroundColor:l(r)},children:Object(O.jsx)("div",{style:{width:"100%",backgroundColor:l(r),height:"100%"}})})},L=(n(332),["children"]),V=function(){var e=Object(a.useContext)(f),t=e.clusterData,n=e.selectedClusterSummary,r=e.setSelectedClusterSummary,c=e.selectedCluster,d=e.setSelectedCluster,j=e.setClusterRank,b=e.setReqGene,m=e.clusterColors,p=e.gene,v=e.setGene,x=Object(a.useState)(null),g=Object(i.a)(x,2),F=g[0],y=g[1],D=Object(a.useState)(null),N=Object(i.a)(D,2),A=N[0],w=N[1],S=Object(a.useState)(null),k=Object(i.a)(S,2),E=k[0],B=k[1],T=Object(a.useState)(null),M=Object(i.a)(T,2),R=M[0],I=M[1],V=Object(a.useState)(null),U=Object(i.a)(V,2),H=U[0],W=U[1],Q=Object(a.useState)(null),J=Object(i.a)(Q,2),K=J[0],X=J[1],Y=Object(a.useState)(null),$=Object(i.a)(Y,2),Z=$[0],ee=$[1],te=Object(a.useState)(null),ne=Object(i.a)(te,2),ae=ne[0],re=ne[1],ce=Object(a.useState)(null),le=Object(i.a)(ce,2),se=le[0],ie=le[1],oe=Object(a.useState)(null),de=Object(i.a)(oe,2),ue=de[0],je=de[1],be=Object(a.useState)(null),he=Object(i.a)(be,2),Oe=he[0],fe=he[1],me=Object(a.useState)(null),pe=Object(i.a)(me,2),ve=pe[0],xe=pe[1],ge=Object(a.useState)({}),Fe=Object(i.a)(ge,2),Ce=Fe[0],ye=Fe[1],De=Object(a.useState)(null),Ne=Object(i.a)(De,2),Ae=Ne[0],we=Ne[1],Se=Object(a.useState)(null),ke=Object(i.a)(Se,2),Ee=(ke[0],ke[1],Object(a.useState)(null)),Be=Object(i.a)(Ee,2),Te=(Be[0],Be[1],C.i);Object(a.useEffect)((function(){if(!n)return n;var e=Object.values(n);if(0===e.length)return e;var t=e.map((function(e){return null===e||void 0===e?void 0:e.mean})),a=C.e(t),r=0===a[1]?.01:a[1];I([parseFloat(a[0].toFixed(2)),parseFloat(r.toFixed(2))]),ie(t);var c=e.map((function(e){return null===e||void 0===e?void 0:e.delta})),l=C.e(c),i=0===l[1]?.01:l[1];W([parseFloat(l[0].toFixed(2)),parseFloat(i.toFixed(2))]),je(c);var o=e.map((function(e){return null===e||void 0===e?void 0:e.lfc})),d=C.e(o),u=0===d[1]?.01:d[1];X([parseFloat(d[0].toFixed(2)),parseFloat(u.toFixed(2))]),fe(o);var j=e.map((function(e){return null===e||void 0===e?void 0:e.detected})),b=C.e(j),h=0===b[1]?.01:b[1];ee([parseFloat(b[0].toFixed(2)),parseFloat(h.toFixed(2))]),xe(j),re({lfc:[parseFloat(d[0].toFixed(2)),parseFloat(u.toFixed(2))],mean:[parseFloat(a[0].toFixed(2)),parseFloat(r.toFixed(2))],detected:[parseFloat(b[0].toFixed(2)),parseFloat(h.toFixed(2))],delta:[parseFloat(l[0].toFixed(2)),parseFloat(i.toFixed(2))]});var O=Object(s.a)(e);we(O)}),[n]);var Me=Object(a.useMemo)((function(){if(!Ae)return[];var e=Ae;if(Ce){var t=function(t){var n=Ce[t];if(n[0]==ae[t][0]&&n[1]==ae[t][1])return"continue";e=e.filter((function(e){return e[t]>=n[0]&&e[t]<=n[1]}))};for(var n in Ce)t(n)}return E&&""!==E?e=e.filter((function(e){return-1!==e.gene.toLowerCase().indexOf(E.toLowerCase())})):e}),[Ae,E,Ce]);Object(a.useEffect)((function(){if(null===t||void 0===t?void 0:t.clusters){for(var e,n=Math.max.apply(Math,Object(s.a)(t.clusters)),a=[],r=0;r<n+1;r++)a.push(r+1);y(a),d(0);var c=[];null===t||void 0===t||null===(e=t.clusters)||void 0===e||e.forEach((function(e){return 0===e?c.push(1):c.push(0)})),w(c)}}),[t]),Object(a.useEffect)((function(){var e,n=[];null===t||void 0===t||null===(e=t.clusters)||void 0===e||e.forEach((function(e){return e===c?n.push(1):n.push(0)})),w(n)}),[c]);var Re=function(e,t){var n=Object(l.a)({},Ce);n[t]=e,ye(n)};return Object(O.jsxs)("div",{className:"marker-container",children:[Object(O.jsx)(o.j,{children:"Marker Genes"}),F?Object(O.jsx)("select",{onChange:function(e){var t;d(parseInt(null===(t=e.currentTarget)||void 0===t?void 0:t.value.replace("Cluster ",""))-1),v(null)},children:F.map((function(e,t){return Object(O.jsxs)("option",{children:["Cluster ",e]},t)}))}):"",n?Object(O.jsxs)("div",{className:"marker-table",children:[Object(O.jsxs)("div",{className:"marker-header",children:[Object(O.jsx)(o.n,{leftIcon:"search",small:!0,placeholder:"Search gene...",type:"text",onChange:function(e){return B(e.target.value)}}),Object(O.jsxs)(o.o,{children:["sort by \xa0",Object(O.jsxs)("select",{onChange:function(e){j(e.currentTarget.value)},defaultValue:"cohen-min-rank",children:[Object(O.jsx)("option",{children:"cohen-min"}),Object(O.jsx)("option",{children:"cohen-mean"}),Object(O.jsx)("option",{children:"cohen-min-rank"}),Object(O.jsx)("option",{children:"auc-min"}),Object(O.jsx)("option",{children:"auc-mean"}),Object(O.jsx)("option",{children:"auc-min-rank"}),Object(O.jsx)("option",{children:"lfc-min"}),Object(O.jsx)("option",{children:"lfc-mean"}),Object(O.jsx)("option",{children:"lfc-min-rank"}),Object(O.jsx)("option",{children:"delta-d-min"}),Object(O.jsx)("option",{children:"delta-d-mean"}),Object(O.jsx)("option",{children:"delta-d-min-rank"})]})]})]}),Object(O.jsx)(_.a,{components:{Item:function(e){var t=e.children,n=Object(u.a)(e,L);return Object(O.jsx)("div",Object(l.a)(Object(l.a)({className:"row-card"},n),{},{children:t}))},Header:function(){return Object(O.jsxs)("div",{className:"row-container row-header",children:[Object(O.jsx)("span",{children:"Gene"}),Object(O.jsx)("span",{children:"Log-FC"}),Object(O.jsx)("span",{children:"\u0394-detected"}),Object(O.jsxs)("span",{children:["Expression \xa0",Object(O.jsx)(h.a,{content:"bar represents the mean expression of the gene and the color gradient represents detected.",openOnTargetFocus:!1,children:Object(O.jsx)(o.m,{size:12,icon:"help"})})]}),Object(O.jsx)("span",{})]})}},className:"marker-list",totalCount:Me.length,itemContent:function(e){var t=Me[e],a=t.expanded,s=t.expr;return Object(O.jsxs)("div",{children:[Object(O.jsxs)("div",{className:"row-container",children:[Object(O.jsx)("span",{children:t.gene}),Object(O.jsx)(G,{minmax:K,colorscale:C.h,score:t.lfc}),Object(O.jsx)(G,{minmax:H,colorscale:C.h,score:t.delta}),Object(O.jsx)(P,{minmax:R,colorscale:Te,score:t.mean,colorscore:t.detected}),Object(O.jsxs)("div",{className:"row-action",children:[Object(O.jsx)(o.a,{icon:a?"minus":"plus",small:!0,fill:!1,className:"row-action",onClick:function(){var e=Object(l.a)({},n);e[t.gene].expanded=!e[t.gene].expanded,r(e),s||b(t.gene)}}),Object(O.jsx)(o.a,{small:!0,fill:!1,className:"row-action",onClick:function(){t.gene===p?v(null):(v(t.gene),s||b(t.gene))},children:Object(O.jsx)(o.m,{icon:"tint",color:t.gene===p?m[c]:""})})]})]}),Object(O.jsx)(o.e,{isOpen:a,children:A&&Object(O.jsx)(q,{data:s,color:m[c],clusters:A})})]})}}),Object(O.jsxs)("div",{className:"marker-footer",children:[Object(O.jsx)(o.k,{className:"marker-footer-title",children:"Filter Markers"}),Object(O.jsxs)("div",{className:"marker-filter-container",children:[Object(O.jsx)(o.y,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Log-FC"}),Object(O.jsx)(z,{data:Oe,height:35,color:"#F5498B"}),Object(O.jsx)("div",{className:"marker-filter-slider",children:K&&Object(O.jsx)(o.w,{min:K[0],max:K[1],stepSize:Math.round(K[1]-K[0])/25,onChange:function(e){return Re(e,"lfc")},value:(null===Ce||void 0===Ce?void 0:Ce.lfc)?null===Ce||void 0===Ce?void 0:Ce.lfc:K,vertical:!1})})]}),Object(O.jsxs)("div",{className:"marker-filter-container",children:[Object(O.jsx)(o.y,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"\u0394-detected"}),Object(O.jsx)(z,{data:ue,height:35,color:"#4580E6"}),Object(O.jsx)("div",{className:"marker-filter-slider",children:H&&Object(O.jsx)(o.w,{min:H[0],max:H[1],stepSize:Math.round(H[1]-H[0])/25,onChange:function(e){return Re(e,"delta")},value:(null===Ce||void 0===Ce?void 0:Ce.delta)?null===Ce||void 0===Ce?void 0:Ce.delta:H,vertical:!1})})]}),Object(O.jsxs)("div",{className:"marker-filter-container",children:[Object(O.jsx)(o.y,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Mean"}),Object(O.jsx)(z,{data:se,height:35}),Object(O.jsx)("div",{className:"marker-filter-slider",children:R&&Object(O.jsx)(o.w,{min:R[0],max:R[1],stepSize:Math.round(R[1]-R[0])/25,onChange:function(e){return Re(e,"mean")},value:(null===Ce||void 0===Ce?void 0:Ce.mean)?null===Ce||void 0===Ce?void 0:Ce.mean:R,vertical:!1})})]}),Object(O.jsxs)("div",{className:"marker-filter-container",children:[Object(O.jsx)(o.y,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Detected"}),Object(O.jsx)(z,{data:ve,height:35}),Object(O.jsx)("div",{className:"marker-filter-slider",children:Z&&Object(O.jsx)(o.w,{min:Z[0],max:Z[1],stepSize:Math.round(Z[1]-Z[0])/25,onChange:function(e){return Re(e,"detected")},value:(null===Ce||void 0===Ce?void 0:Ce.detected)?null===Ce||void 0===Ce?void 0:Ce.detected:Z,vertical:!1})})]})]})]}):""]})};var U=function(){var e=Object(a.useState)(!0),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(a.useContext)(f),d=c.setWasmInitialized,u=c.setTsneData,j=c.setRedDims,b=c.redDims,h=c.setInitDims,m=c.setQcDims,p=c.defaultRedDims,v=c.setDefaultRedDims,x=c.setQcData,g=c.qcData,C=c.setClusterData,y=c.setFSelectionData,D=c.setUmapData,N=c.setPcaVarExp,A=c.logs,w=c.setLogs,S=c.selectedCluster,k=c.clusterRank,B=c.selectedClusterSummary,T=c.setSelectedClusterSummary,M=c.reqGene;return Object(a.useEffect)((function(){window.Worker.postMessage({type:"INIT",msg:"Initial Load"})}),[]),Object(a.useEffect)((function(){null!==S&&window.Worker.postMessage({type:"getMarkersForCluster",payload:{cluster:S,rank_type:k}})}),[S,k]),Object(a.useEffect)((function(){null!==M&&window.Worker.postMessage({type:"getGeneExpression",payload:{gene:M}})}),[M]),window.Worker.onmessage=function(e){var t=e.data;if(null===t||void 0===t?void 0:t.msg){var n=Object(s.a)(A),a=new Date;n.push("".concat(a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()," - ").concat(null===t||void 0===t?void 0:t.type," - ").concat(null===t||void 0===t?void 0:t.msg)),w(n)}if("INIT"===t.type)r(!1),d(!0);else if("input_DIMS"===t.type)h(t.resp);else if("quality_control_filtered_DIMS"===t.type)m(t.resp);else if("quality_control_metrics_DATA"===t.type){var c=t.resp;x(c)}else if("quality_control_thresholds_DATA"===t.type){var i=t.resp,o=Object(l.a)({},g);o.thresholds=i,x(o)}else if("feature_selection_DIMS"===t.type);else if("feature_selection_DATA"===t.type){var O=t.resp;y(O)}else if("pca_DATA"===t.type){var f=t.resp,F=Object(s.a)(b);F.push("PCA"),j(F),N(f)}else if("snn_cluster_graph_DATA"===t.type){var S=t.resp;C(S)}else if("tsne_DATA"===t.type||"tsne_iter"===t.type){var k=t.resp;u(k);var E=Object(s.a)(b);E.push("TSNE"),p||v("TSNE"),j(E)}else if("umap_DATA"===t.type){var M=t.resp;D(M);var R=Object(s.a)(b);R.push("UMAP"),j(R)}else if("markerGene_DATA"===t.type);else if("setMarkersForCluster"===t.type){var I=t.resp,_={};I.means.forEach((function(e,t){var n,a,r,c,l;_[null===I||void 0===I||null===(n=I.genes)||void 0===n?void 0:n[t]]={gene:null===I||void 0===I||null===(a=I.genes)||void 0===a?void 0:a[t],mean:e,delta:null===I||void 0===I||null===(r=I.delta_d)||void 0===r?void 0:r[t],lfc:null===I||void 0===I||null===(c=I.lfc)||void 0===c?void 0:c[t],detected:null===I||void 0===I||null===(l=I.detected)||void 0===l?void 0:l[t],expanded:!1,expr:null}})),T(_)}else if("setGeneExpression"===t.type){var q=t.resp,z=Object(l.a)({},B);z[q.gene].expr=Object.values(q.expr),T(z)}},Object(O.jsxs)("div",{className:"App",children:[Object(O.jsx)(F,{}),Object(O.jsxs)("div",{className:"App-content",children:[Object(O.jsx)("div",{className:"plot",children:Object(O.jsx)(I,{})}),Object(O.jsx)("div",{className:"marker",children:Object(O.jsx)(V,{})}),Object(O.jsx)("div",{className:"analysis",children:Object(O.jsx)(E,{})})]}),Object(O.jsx)(o.u,Object(l.a)(Object(l.a)({isOpen:n},{autoFocus:!0,canEscapeKeyClose:!1,canOutsideClickClose:!1,enforceFocus:!0,hasBackdrop:!0,usePortal:!0,useTallContent:!1}),{},{children:Object(O.jsxs)("div",{className:"spinner",children:[Object(O.jsx)(o.x,{size:100}),Object(O.jsx)("p",{children:"Initializing SCRAN.JS"})]})}))]})},H=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,342)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,l=t.getTTFB;n(e),a(e),r(e),c(e),l(e)}))};c.a.render(Object(O.jsx)(m,{children:Object(O.jsx)(U,{})}),document.getElementById("root")),H()}},[[333,1,2]]]);
//# sourceMappingURL=main.4f3222d5.chunk.js.map