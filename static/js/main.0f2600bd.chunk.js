(this.webpackJsonpkana=this.webpackJsonpkana||[]).push([[0],{279:function(e,t,n){},280:function(e,t,n){},306:function(e,t,n){},308:function(e,t,n){},309:function(e,t,n){},310:function(e,t,n){},323:function(e,t,n){},324:function(e,t,n){},325:function(e,t,n){},326:function(e,t,n){},327:function(e,t,n){},328:function(e,t,n){"use strict";n.r(t);var s=n(1),a=n.n(s),i=n(26),l=n.n(i),c=(n(279),n(4)),r=n(22),o=n(5),d=(n(280),n(336)),h=n(48),u=n(20),j=n(136),b=n(79),p=n(43),m=n(3),O=d.J.create({className:"notifications",position:u.a.TOP_RIGHT,maxToasts:5}),f=n(0),x=Object(s.createContext)(null),v=function(e){var t=e.children,n=Object(s.useState)({format:null,files:null}),a=Object(o.a)(n,2),i=a[0],l=a[1],c=Object(s.useState)({qc:{"qc-nmads":3,"qc-usemitodefault":!0,"qc-mito":"mt-"},fSelection:{"fsel-span":.3},pca:{"pca-npc":25,"pca-hvg":2500},cluster:{"clus-k":10,"clus-res":.5,"clus-scheme":0,"clus-approx":!0,"clus-method":"snn_graph"},tsne:{"tsne-iter":500,"tsne-perp":30,animate:!1},umap:{"umap-nn":15,"umap-epochs":500,"umap-min_dist":.01,animate:!1},markerGene:{}}),r=Object(o.a)(c,2),d=r[0],h=r[1],u=Object(s.useState)(!1),j=Object(o.a)(u,2),b=j[0],p=j[1],m=Object(s.useState)(!1),v=Object(o.a)(m,2),g=v[0],y=v[1],w=Object(s.useState)("new"),F=Object(o.a)(w,2),C=F[0],N=F[1],k=Object(s.useState)([]),S=Object(o.a)(k,2),D=S[0],E=S[1],A=Object(s.useState)(null),T=Object(o.a)(A,2),M=T[0],I=T[1],R=Object(s.useState)(null),L=Object(o.a)(R,2),B=L[0],P=L[1],_=Object(s.useState)(null),q=Object(o.a)(_,2),G=q[0],W=q[1],z=Object(s.useState)("My Analysis Title"),V=Object(o.a)(z,2),H=V[0],U=V[1],Z=Object(s.useState)(!1),K=Object(o.a)(Z,2),X=K[0],Q=K[1],Y=Object(s.useState)(!1),J=Object(o.a)(Y,2),$=J[0],ee=J[1],te=Object(s.useState)(!1),ne=Object(o.a)(te,2),se=ne[0],ae=ne[1],ie=Object(s.useState)(!1),le=Object(o.a)(ie,2),ce=le[0],re=le[1],oe=Object(s.useState)(null),de=Object(o.a)(oe,2),he=de[0],ue=de[1],je=Object(s.useState)(null),be=Object(o.a)(je,2),pe=be[0],me=be[1],Oe=Object(s.useState)(null),fe=Object(o.a)(Oe,2),xe=fe[0],ve=fe[1],ge=Object(s.useState)(null),ye=Object(o.a)(ge,2),we=ye[0],Fe=ye[1],Ce=Object(s.useState)(null),Ne=Object(o.a)(Ce,2),ke=Ne[0],Se=Ne[1],De=Object(s.useState)("id"),Ee=Object(o.a)(De,2),Ae=Ee[0],Te=Ee[1],Me=Object(s.useState)(null),Ie=Object(o.a)(Me,2),Re=Ie[0],Le=Ie[1],Be=Object(s.useState)(null),Pe=Object(o.a)(Be,2),_e=Pe[0],qe=Pe[1],Ge=Object(s.useState)(null),We=Object(o.a)(Ge,2),ze=We[0],Ve=We[1],He=Object(s.useState)([]),Ue=Object(o.a)(He,2),Ze=Ue[0],Ke=Ue[1],Xe=Object(s.useState)(null),Qe=Object(o.a)(Xe,2),Ye=Qe[0],Je=Qe[1],$e=Object(s.useState)(null),et=Object(o.a)($e,2),tt=et[0],nt=et[1],st=Object(s.useState)(null),at=Object(o.a)(st,2),it=at[0],lt=at[1],ct=Object(s.useState)(null),rt=Object(o.a)(ct,2),ot=rt[0],dt=rt[1],ht=Object(s.useState)([]),ut=Object(o.a)(ht,2),jt=ut[0],bt=ut[1],pt=Object(s.useState)([]),mt=Object(o.a)(pt,2),Ot=mt[0],ft=mt[1],xt=Object(s.useState)(null),vt=Object(o.a)(xt,2),gt=vt[0],yt=vt[1],wt=Object(s.useState)(null),Ft=Object(o.a)(wt,2),Ct=Ft[0],Nt=Ft[1],kt=Object(s.useState)({}),St=Object(o.a)(kt,2),Dt=St[0],Et=St[1],At=Object(s.useState)(null),Tt=Object(o.a)(At,2),Mt=Tt[0],It=Tt[1],Rt=Object(s.useState)(null),Lt=Object(o.a)(Rt,2),Bt=Lt[0],Pt=Lt[1],_t=Object(s.useState)(null),qt=Object(o.a)(_t,2),Gt=qt[0],Wt=qt[1],zt=Object(s.useState)(!1),Vt=Object(o.a)(zt,2),Ht=Vt[0],Ut=Vt[1],Zt=Object(s.useState)(!1),Kt=Object(o.a)(Zt,2),Xt=Kt[0],Qt=Kt[1],Yt=Object(s.useState)(null),Jt=Object(o.a)(Yt,2),$t=Jt[0],en=Jt[1],tn=Object(s.useState)(null),nn=Object(o.a)(tn,2),sn=nn[0],an=nn[1],ln=Object(s.useState)(null),cn=Object(o.a)(ln,2),rn=cn[0],on=cn[1],dn=Object(s.useState)(null),hn=Object(o.a)(dn,2),un=hn[0],jn=hn[1],bn=Object(s.useState)([]),pn=Object(o.a)(bn,2),mn=pn[0],On=pn[1],fn=Object(s.useState)([]),xn=Object(o.a)(fn,2),vn=xn[0],gn=xn[1];return Object(s.useEffect)((function(){ce&&null!=i.files&&!se&&("new"===C?window.scranWorker.postMessage({type:"RUN",payload:{files:i,params:d},msg:"not much to pass"}):"load"===C&&(null==B||(null===i||void 0===i?void 0:i.reset)?window.scranWorker.postMessage({type:"LOAD",payload:{files:i},msg:"not much to pass"}):window.scranWorker.postMessage({type:"RUN",payload:{files:i,params:d},msg:"not much to pass"}),ae(!0)))}),[i,d,ce]),Object(s.useEffect)((function(){X?(window.scranWorker.postMessage({type:"EXPORT",payload:{files:i,params:d},msg:"not much to pass"}),O.show({icon:"download",intent:"primary",message:"Exporting analysis in the background"})):(null===i||void 0===i?void 0:i.files)&&O.show({icon:"download",intent:"primary",message:"Analysis saved. Please check your downloads directory!"})}),[X]),Object(s.useEffect)((function(){$?(window.scranWorker.postMessage({type:"SAVEKDB",payload:{title:H},msg:"not much to pass"}),O.show({icon:"floppy-disk",intent:"primary",message:"Saving analysis in the background. Note: analysis is saved within the browser!!"})):(null===i||void 0===i?void 0:i.files)&&O.show({icon:"floppy-disk",intent:"primary",message:"Analysis saved!"})}),[$]),Object(s.useEffect)((function(){M&&(window.scranWorker.postMessage({type:"REMOVEKDB",payload:{id:M},msg:"not much to pass"}),O.show({icon:"floppy-disk",intent:"danger",message:"Deleting Analysis in the background"}))}),[M]),Object(f.jsx)(x.Provider,{value:{inputFiles:i,setInputFiles:l,params:d,setParams:h,error:he,setError:ue,wasmInitialized:ce,setWasmInitialized:re,pcaData:Bt,setPcaData:Pt,pcaVarExp:Gt,setPcaVarExp:Wt,tsneData:$t,setTsneData:en,umapData:sn,setUmapData:an,genesInfo:ke,setGenesInfo:Se,initDims:pe,setInitDims:me,qcDims:xe,setQcDims:ve,qcData:Re,setQcData:Le,qcThreshold:_e,setQcThreshold:qe,fSelDims:we,setFSelDims:Fe,redDims:Ze,setRedDims:Ke,defaultRedDims:Ye,setDefaultRedDims:Je,plotRedDims:tt,setPlotRedDims:nt,clusterData:it,setClusterData:lt,fSelectionData:ze,setFSelectionData:Ve,logs:mn,setLogs:On,selectedCluster:ot,setSelectedCluster:dt,selectedClusterSummary:jt,setSelectedClusterSummary:bt,selectedClusterIndex:Ot,setSelectedClusterIndex:ft,clusterRank:Ct,setClusterRank:Nt,gene:rn,setGene:on,clusterColors:gt,setClusterColors:yt,reqGene:un,setReqGene:jn,openInput:b,setOpenInput:p,customSelection:Dt,setCustomSelection:Et,delCustomSelection:Mt,setDelCustomSelection:It,showGame:g,setShowGame:y,exportState:X,setExportState:Q,datasetName:H,setDatasetName:U,tabSelected:C,setTabSelected:N,loadParams:B,setLoadParams:P,showAnimation:Ht,setShowAnimation:Ut,triggerAnimation:Xt,setTriggerAnimation:Qt,savedPlot:vn,setSavedPlot:gn,geneColSel:Ae,setGeneColSel:Te,indexedDBState:$,setIndexedDBState:ee,kanaIDBRecs:D,setKanaIDBRecs:E,initLoadState:se,setInitLoadState:ae,loadParamsFor:G,setLoadParamsFor:W,deletekdb:M,setDeletekdb:I},children:t})},g=a.a.memo(v),y=(n(306),["buttonText","includeFooter"]);var w=function(e){var t,n,a,i,l,r,h=e.buttonText,b=e.includeFooter,O=Object(p.a)(e,y),v=Object(s.useState)(!1),g=Object(o.a)(v,2),w=g[0],F=g[1],C=Object(s.useState)(1),N=Object(o.a)(C,2),k=N[0],S=N[1],D=Object(s.useCallback)((function(){return F(!w)}),[w]),E=Object(s.useCallback)((function(){return F(!1)}),[]),A=Object(s.useContext)(x),T=A.inputFiles,M=A.setInputFiles,I=A.params,R=A.setParams,L=A.openInput,B=A.tabSelected,P=A.setTabSelected,_=A.loadParams,q=A.kanaIDBRecs,G=A.setLoadParamsFor,W=A.loadParamsFor,z=A.setDeletekdb,V=A.setDatasetName,H=Object(s.useState)({gene:null,mtx:null,barcode:null}),U=Object(o.a)(H,2),Z=U[0],K=U[1],X=Object(s.useState)({mtx:"Choose Matrix Market file",gene:"Choose feature/gene annotation",barcode:"Choose barcode annotation"}),Q=Object(o.a)(X,2),Y=Q[0],J=Q[1],$=Object(s.useState)(!0),ee=Object(o.a)($,2),te=ee[0],ne=ee[1],se=Object(s.useState)("mtx"),ae=Object(o.a)(se,2),ie=ae[0],le=ae[1],ce=Object(s.useState)("kana"),re=Object(o.a)(ce,2),oe=re[0],de=re[1],he=Object(s.useState)("new"===B?I:_),ue=Object(o.a)(he,2),je=ue[0],be=ue[1];function pe(e,t){"mtx"===e?(K({gene:null,mtx:null,barcode:null}),J({mtx:"Choose Matrix Market file",gene:"Choose gene annotation",barcode:"Choose barcode annotation"})):"tenx"===e?(K({file:null}),J({file:"Choose 10x HDF5 matrix file"})):"h5ad"===e&&(K({file:null}),J({file:"Choose H5AD file"})),be(I),le(e)}function me(e){var t=new Date(e);return t.toDateString()+", "+t.toLocaleTimeString()}Object(s.useEffect)((function(){L&&F(!0)}),[L]),Object(s.useEffect)((function(){_&&"load"===B&&be(_)}),[_]),Object(s.useEffect)((function(){"load"===B&&"kanadb"===oe&&null===(null===Z||void 0===Z?void 0:Z.file)&&q.length>0&&K({file:q[0].id})}),[q,oe]),Object(s.useEffect)((function(){Z&&("new"===B?"mtx"===ie?(null===Z||void 0===Z?void 0:Z.mtx)&&!(null===Y||void 0===Y?void 0:Y.mtx.toLowerCase().endsWith("mtx"))&&!(null===Y||void 0===Y?void 0:Y.mtx.toLowerCase().endsWith("mtx.gz"))||(null===Z||void 0===Z?void 0:Z.gene)&&!(null===Y||void 0===Y?void 0:Y.gene.toLowerCase().endsWith("tsv"))&&!(null===Y||void 0===Y?void 0:Y.gene.toLowerCase().endsWith("tsv.gz"))||(null===Z||void 0===Z?void 0:Z.barcode)&&!(null===Y||void 0===Y?void 0:Y.barcode.toLowerCase().endsWith("tsv"))&&!(null===Y||void 0===Y?void 0:Y.barcode.toLowerCase().endsWith("tsv.gz"))?ne(!1):ne(!0):"tenx"!==ie&&"h5ad"!==ie||((null===Z||void 0===Z?void 0:Z.file)&&!((null===Y||void 0===Y?void 0:Y.file.toLowerCase().endsWith("hdf5"))||(null===Y||void 0===Y?void 0:Y.file.toLowerCase().endsWith("h5"))||(null===Y||void 0===Y?void 0:Y.file.toLowerCase().endsWith("h5ad")))?ne(!1):ne(!0)):"load"===B&&(null===Y||void 0===Y?void 0:Y.file)&&("kana"!==oe||null==(null===Z||void 0===Z?void 0:Z.file)||(null===Y||void 0===Y?void 0:Y.file.toLowerCase().endsWith("kana"))?ne(!0):ne(!1)))}),[Z]);var Oe=function(){return Object(f.jsxs)(f.Fragment,{children:[2===k&&Object(f.jsxs)(d.c,{intent:"primary",children:[Object(f.jsx)("p",{children:"Remove low-quality cells to ensure that they do not interfere with downstream steps. This is achieved by computing per-cell quality control (QC) metrics such as the total count per cell, the total number of detected features and (if the feature annotation is supplied) the mitochondrial proportion in each cell. Cells with low total counts/number of detected features or high mitochondrial proportions are filtered out. We use an outlier-based approach to define the filter threshold for each metric, under the assumption that most cells in the dataset are of acceptable quality."}),Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"Number of MADs"}),": Number of median absolute deviations (MADs) from the median, used to define a filter threshold in the appropriate direction for each QC metric. Increasing this value will reduce the stringency of the filtering."]}),Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"Use default mitochondrial list"}),": Should we identify mitochondrial genes in the dataset based on the ",Object(f.jsx)("a",{target:"_blank",href:"https://github.com/jkanche/kana/blob/master/public/scran/mito.js",children:Object(f.jsx)("strong",{children:"in-built list of Ensembl identifiers and gene symbols for mitochondrial genes in human and mouse genomes?"})}),"This assumes that the dataset contains feature annotation with Ensembl identifiers or gene symbols."]}),Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"Mitochondrial gene prefix"}),": Prefix to use to identify the mitochondrial genes from the feature annotation. Only used if we choose to not use the default mitochondrial list."]})]}),3===k&&Object(f.jsxs)(d.c,{intent:"primary",children:[Object(f.jsx)("p",{children:"Identify highly variable genes (HVGs) while accounting for the mean-variance relationship. We do so by fitting a mean-dependent trend to the variances computed from the log-transformed normalized expression values. HVGs are defined as those genes with the largest positive residuals from the trend, as these are more variable than expected from the trend. The aim is to only use the HVGs in some downstream steps like the principal components analysis, thereby improving computational efficiency and reducing uninteresting technical noise."}),Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"Lowess span"}),": The span of the LOWESS smoother for fitting the mean-variance trend. Larger values increase the smoothness of the global trend at the cost of decreasing sensitivity to local variations."]})]}),4===k&&Object(f.jsxs)(d.c,{intent:"primary",children:[Object(f.jsx)("p",{children:"Perform a principal components analysis (PCA) to obtain per-cell coordinates in a low-dimensional space. Specifically, we obtain a compact representation of the dataset by only taking the top principal components (PCs) that explain the largest variance. This improves the efficiency of downstream steps as we only have to perform calculations on a few (usually 10-50) PCs rather than the thousands of gene expression profiles. It also has the advantage of removing uninteresting high-dimensional noise by discarding the later PCs. This ensures that downstream steps focus on the largest factors of variation that - hopefully - correspond to biologically interesting heterogeneity."}),Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"Number of HVGs"}),": Number of highly variable genes to use to perform the PCA. Larger values will capture more biological signal at the cost of increasing noise and computational work."]}),Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"Number of PCs"}),": Number of principal components with the highest variance to retain in downstream analyses. Larger values will capture more biological signal at the cost of increasing noise and computational work."]})]}),5===k&&Object(f.jsxs)(d.c,{intent:"primary",children:[Object(f.jsx)("p",{children:"Cluster cells into discrete groupings based on their relative similarity in the low-dimensional PC space. The set of clusters should be treated as a summary of the cellular heterogeneity in the population, allowing us to easily perform further characterization on subpopulations of interest, e.g., with marker detection. Different clustering methods or parameters may provide different perspectives on the population structure in the dataset."}),Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"Method"}),": Clustering algorithm to use. Currently, we only support multi-level community detection on an shared nearest neighbor (SNN) graph, where cells are the nodes and edges are created between neighboring cells."]}),Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"Number of neighbors"}),": Number of neighbors to use to construct the SNN graph. Larger values result in broader clusters."]}),Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"Use ANN"}),": Use an approximate method to speed up the nearest neighbor search. This sacrifices some accuracy for speed in larger datasets."]}),Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"Weighting scheme"}),": Weighting scheme to use for the edges of the SNN graph. The ",Object(f.jsx)("em",{children:"Rank"})," approach derives a weight from the rank of the closest shared neighbor; the ",Object(f.jsx)("em",{children:"Number"})," approach uses the number of shared neighbors; and the Jaccard approach uses the ",Object(f.jsx)("em",{children:"Jaccard"})," index of the neighbor sets."]}),Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"Resolution"}),": Resolution parameter for the multi-level clustering, used to adjust the modularity calculation during community optimization. Larger values yield more fine-grained clusters."]})]}),6===k&&Object(f.jsxs)(d.c,{intent:"primary",children:[Object(f.jsx)("p",{children:"Compute a t-SNE to visualize cells in two dimensions, because our feeble human minds cannot interpret high-dimensional spaces. Neighboring cells in the PC space are kept adjacent in the 2D embedding, while dissimilar cells are placed (arbitrarily) far away."}),Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"Perplexity"}),": Perplexity parameter, which determines the size of the neighborhood of each cell. Larger values will favor preservation of global structure in the 2D embedding."]}),Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"Iterations"}),": Number of t-SNE iterations. Doesn't usually have much of an effect if you leave it as it is."]})]}),7===k&&Object(f.jsxs)(d.c,{intent:"primary",children:[Object(f.jsx)("p",{children:"Create a UMAP plot to visualize cells in two dimensions. Like the t-SNE, this aims to map cells from a high-dimensional space into a 2D embedding, where neighboring cells are kept close together and dissimilar cells are placed far apart."}),Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"Number of neighbors"}),": Number of neighbors to use when defining the size of the local neighborhood. Larger values will favor preservation of global structure."]}),Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"Minimum distance"}),": Minimum distance between points. Smaller values result in a more tightly packed embedding and favor local structure."]}),Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"Epochs"}),": Number of epochs to use for convergence. This doesn't really change all too much in the results."]})]})]})},fe=function(){return Object(f.jsx)("div",{className:"col",children:Object(f.jsxs)("div",{children:[Object(f.jsxs)(d.m,{children:[Object(f.jsx)(d.H,{round:!0,children:"2"}),Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(2)},children:"Quality control"})]}),Object(f.jsxs)("div",{className:"row",children:[Object(f.jsxs)(d.q,{className:"row-input",children:[Object(f.jsx)(d.I,{className:"text-100",children:Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(2)},children:"Number of MADs"})}),Object(f.jsx)(d.x,{placeholder:"3",value:je.qc["qc-nmads"],onValueChange:function(e,t){be(Object(c.a)(Object(c.a)({},je),{},{qc:Object(c.a)(Object(c.a)({},je.qc),{},{"qc-nmads":e})}))}})]}),Object(f.jsxs)(d.q,{className:"row-input",children:[Object(f.jsx)(d.I,{className:"text-100",children:Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(2)},children:"Use default mitochondrial list ?"})}),Object(f.jsx)(d.E,{style:{marginTop:"10px"},large:!0,checked:je.qc["qc-usemitodefault"],innerLabelChecked:"yes",innerLabel:"no",onChange:function(e){be(Object(c.a)(Object(c.a)({},je),{},{qc:Object(c.a)(Object(c.a)({},je.qc),{},{"qc-usemitodefault":e.target.checked})}))}})]}),!je.qc["qc-usemitodefault"]&&Object(f.jsxs)(d.q,{className:"row-input",children:[Object(f.jsx)(d.I,{className:"text-100",children:Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(2)},children:"Mitochondrial gene prefix"})}),Object(f.jsx)(d.p,{leftIcon:"filter",onChange:function(e,t){var n;be(Object(c.a)(Object(c.a)({},je),{},{qc:Object(c.a)(Object(c.a)({},je.qc),{},{"qc-mito":null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value})}))},placeholder:"mt-",value:je.qc["qc-mito"]})]})]})]})})},xe=function(){return Object(f.jsx)("div",{className:"col",children:Object(f.jsxs)("div",{children:[Object(f.jsxs)(d.m,{children:[Object(f.jsx)(d.H,{round:!0,children:"3"}),Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(3)},children:"Feature Selection"})]}),Object(f.jsx)("div",{className:"row",children:Object(f.jsxs)(d.q,{className:"row-input",children:[Object(f.jsx)(d.I,{className:"text-100",children:Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(3)},children:"Lowess span"})}),Object(f.jsx)(d.x,{placeholder:"0.3",value:je.fSelection["fsel-span"],onValueChange:function(e,t){be(Object(c.a)(Object(c.a)({},je),{},{fSelection:Object(c.a)(Object(c.a)({},je.fSelection),{},{"fsel-span":e})}))}})]})})]})})},ve=function(){return Object(f.jsx)("div",{className:"col",children:Object(f.jsxs)("div",{children:[Object(f.jsxs)(d.m,{children:[Object(f.jsx)(d.H,{round:!0,children:"4"}),Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(4)},children:"Principal components analysis"})]}),Object(f.jsxs)("div",{className:"row",children:[Object(f.jsxs)(d.q,{className:"row-input",children:[Object(f.jsx)(d.I,{className:"text-100",children:Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(4)},children:"Number of HVGs"})}),Object(f.jsx)(d.x,{placeholder:"2500",value:je.pca["pca-hvg"],onValueChange:function(e,t){be(Object(c.a)(Object(c.a)({},je),{},{pca:Object(c.a)(Object(c.a)({},je.pca),{},{"pca-hvg":e})}))}})]}),Object(f.jsxs)(d.q,{className:"row-input",children:[Object(f.jsx)(d.I,{className:"text-100",children:Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(4)},children:"Number of PCs"})}),Object(f.jsx)(d.x,{placeholder:"25",value:je.pca["pca-npc"],onValueChange:function(e,t){be(Object(c.a)(Object(c.a)({},je),{},{pca:Object(c.a)(Object(c.a)({},je.pca),{},{"pca-npc":e})}))}})]})]})]})})},ge=function(){return Object(f.jsx)("div",{className:"col",children:Object(f.jsxs)("div",{children:[Object(f.jsxs)(d.m,{children:[Object(f.jsx)(d.H,{round:!0,children:"5"}),Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Clustering"})]}),Object(f.jsxs)("div",{className:"row",children:[Object(f.jsxs)(d.q,{className:"row-input",children:[Object(f.jsx)(d.I,{className:"text-100",children:Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Method"})}),Object(f.jsx)(d.n,{defaultValue:je.cluster["clus-method"],children:Object(f.jsx)("option",{children:je.cluster["clus-method"]})})]}),Object(f.jsxs)(d.q,{className:"row-input",children:[Object(f.jsx)(d.I,{className:"text-100",children:Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Number of neighbors"})}),Object(f.jsx)(d.x,{placeholder:"10",value:je.cluster["clus-k"],onValueChange:function(e,t){be(Object(c.a)(Object(c.a)({},je),{},{cluster:Object(c.a)(Object(c.a)({},je.cluster),{},{"clus-k":e})}))}})]}),Object(f.jsxs)(d.q,{className:"row-input",children:[Object(f.jsx)(d.I,{className:"text-100",children:Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Use ANN"})}),Object(f.jsx)(d.E,{style:{marginTop:"10px"},large:!0,checked:je.cluster["clus-approx"],innerLabelChecked:"yes",innerLabel:"no",onChange:function(e){be(Object(c.a)(Object(c.a)({},je),{},{cluster:Object(c.a)(Object(c.a)({},je.cluster),{},{"clus-approx":e.target.checked})}))}})]}),Object(f.jsxs)(d.q,{className:"row-input",children:[Object(f.jsx)(d.I,{className:"text-100",children:Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Weighting scheme"})}),Object(f.jsxs)(d.n,{onChange:function(e,t){var n;return be(Object(c.a)(Object(c.a)({},je),{},{cluster:Object(c.a)(Object(c.a)({},je.cluster),{},{"clus-scheme":parseInt(null===e||void 0===e||null===(n=e.currentTarget)||void 0===n?void 0:n.value)})}))},children:[Object(f.jsx)("option",{children:"Rank"},"0"),Object(f.jsx)("option",{children:"Number"},"1"),Object(f.jsx)("option",{children:"Jaccard"},"2")]})]}),Object(f.jsxs)(d.q,{className:"row-input",children:[Object(f.jsx)(d.I,{className:"text-100",children:Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(5)},children:"Resolution"})}),Object(f.jsx)(d.x,{placeholder:"0.5",value:je.cluster["clus-res"],stepSize:.1,onValueChange:function(e,t){be(Object(c.a)(Object(c.a)({},je),{},{cluster:Object(c.a)(Object(c.a)({},je.cluster),{},{"clus-res":t})}))}})]})]})]})})},ye=function(){return Object(f.jsx)("div",{className:"col",children:Object(f.jsxs)("div",{children:[Object(f.jsxs)(d.m,{children:[Object(f.jsx)(d.H,{round:!0,children:"6"}),Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(6)},children:"t-SNE"})]}),Object(f.jsxs)("div",{className:"row",children:[Object(f.jsxs)(d.q,{className:"row-input",children:[Object(f.jsx)(d.I,{className:"text-100",children:Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(6)},children:"Perplexity"})}),Object(f.jsx)(d.x,{placeholder:"30",value:je.tsne["tsne-perp"],onValueChange:function(e,t){be(Object(c.a)(Object(c.a)({},je),{},{tsne:Object(c.a)(Object(c.a)({},je.tsne),{},{"tsne-perp":e})}))}})]}),Object(f.jsxs)(d.q,{className:"row-input",children:[Object(f.jsx)(d.I,{className:"text-100",children:Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(6)},children:"Iterations"})}),Object(f.jsx)(d.x,{placeholder:"500",value:je.tsne["tsne-iter"],onValueChange:function(e,t){be(Object(c.a)(Object(c.a)({},je),{},{tsne:Object(c.a)(Object(c.a)({},je.tsne),{},{"tsne-iter":e})}))}})]})]})]})})},we=function(){return Object(f.jsx)("div",{className:"col",children:Object(f.jsxs)("div",{children:[Object(f.jsxs)(d.m,{children:[Object(f.jsx)(d.H,{round:!0,children:"7"}),Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(7)},children:"UMAP"})]}),Object(f.jsxs)("div",{className:"row",children:[Object(f.jsxs)(d.q,{className:"row-input",children:[Object(f.jsx)(d.I,{className:"text-100",children:Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(7)},children:"Number of neighbors"})}),Object(f.jsx)(d.x,{placeholder:"15",value:je.umap["umap-nn"],onValueChange:function(e,t){be(Object(c.a)(Object(c.a)({},je),{},{umap:Object(c.a)(Object(c.a)({},je.umap),{},{"umap-nn":e})}))}})]}),Object(f.jsxs)(d.q,{className:"row-input",children:[Object(f.jsx)(d.I,{className:"text-100",children:Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(7)},children:"Minimum distance"})}),Object(f.jsx)(d.x,{placeholder:"0.01",value:je.umap["umap-min_dist"],onValueChange:function(e,t){be(Object(c.a)(Object(c.a)({},je),{},{umap:Object(c.a)(Object(c.a)({},je.umap),{},{"umap-min_dist":e})}))}})]}),Object(f.jsxs)(d.q,{className:"row-input",children:[Object(f.jsx)(d.I,{className:"text-100",children:Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(7)},children:"Epochs"})}),Object(f.jsx)(d.x,{placeholder:"500",value:je.umap["umap-epochs"],onValueChange:function(e,t){be(Object(c.a)(Object(c.a)({},je),{},{umap:Object(c.a)(Object(c.a)({},je.umap),{},{"umap-epochs":e})}))}})]})]})]})})};return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(j.a,{content:"Start new analysis or modify parameters",position:u.a.BOTTOM,children:Object(f.jsx)(d.a,{onClick:D,icon:"social-media",intent:"primary",text:h})}),Object(f.jsxs)(d.g,Object(c.a)(Object(c.a)({className:"analysis-dialog"},O),{},{isOpen:w,onClose:E,children:[Object(f.jsx)("div",{className:m.a.DIALOG_BODY,children:Object(f.jsxs)(d.G,{animate:!0,renderActiveTabPanelOnly:!0,vertical:!1,onChange:function(e,t){"new"===e&&pe(ie),P(e),S(0)},defaultSelectedTabId:B,children:[Object(f.jsx)(d.F,{id:"new",title:"Import new dataset",panel:Object(f.jsxs)("div",{className:"inputs-container",children:[Object(f.jsxs)("div",{className:"row-input",children:[Object(f.jsx)("div",{className:"col",style:{paddingBottom:"15px"},children:Object(f.jsxs)("div",{children:[Object(f.jsxs)(d.m,{children:[Object(f.jsx)(d.H,{round:!0,children:"1"}),Object(f.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return S(1)},children:"Load input files"})]}),Object(f.jsxs)(d.G,{animate:!0,renderActiveTabPanelOnly:!0,vertical:!0,onChange:pe,defaultSelectedTabId:ie,children:[Object(f.jsx)(d.F,{id:"mtx",title:"Matrix Market file",panel:Object(f.jsxs)("div",{className:"row",children:[Object(f.jsx)(d.q,{className:"row-input",children:Object(f.jsx)(d.k,{text:Y.mtx,onInputChange:function(e){J(Object(c.a)(Object(c.a)({},Y),{},{mtx:e.target.files[0].name})),K(Object(c.a)(Object(c.a)({},Z),{},{mtx:e.target.files}))}})}),Object(f.jsx)(d.q,{className:"row-input",children:Object(f.jsx)(d.k,{text:Y.gene,onInputChange:function(e){J(Object(c.a)(Object(c.a)({},Y),{},{gene:e.target.files[0].name})),K(Object(c.a)(Object(c.a)({},Z),{},{gene:e.target.files}))}})})]})}),Object(f.jsx)(d.F,{id:"tenx",title:"10x HDF5 matrix",panel:Object(f.jsx)("div",{className:"row",children:Object(f.jsx)(d.q,{className:"row-input",children:Object(f.jsx)(d.k,{style:{marginTop:"5px"},text:Y.file,onInputChange:function(e){J(Object(c.a)(Object(c.a)({},Y),{},{file:e.target.files[0].name})),K(Object(c.a)(Object(c.a)({},Z),{},{file:e.target.files}))}})})})}),Object(f.jsx)(d.F,{id:"h5ad",title:"H5AD",panel:Object(f.jsx)("div",{className:"row",children:Object(f.jsx)(d.q,{className:"row-input",children:Object(f.jsx)(d.k,{style:{marginTop:"5px"},text:Y.file,onInputChange:function(e){J(Object(c.a)(Object(c.a)({},Y),{},{file:e.target.files[0].name})),K(Object(c.a)(Object(c.a)({},Z),{},{file:e.target.files}))}})})})})]})]})}),fe(),xe(),ve(),ge(),ye(),we()]}),Object(f.jsxs)("div",{className:"row-input-tooltips",children:[!te&&Object(f.jsxs)(d.c,{intent:"danger",title:"Incorrect file format",style:{marginBottom:"10px"},children:[Object(f.jsx)("p",{children:"Upload files that in one of these formats;"}),Object(f.jsxs)("ul",{children:[Object(f.jsxs)("li",{children:["Matrix Market - ",Object(f.jsx)("code",{children:"*.mtx"})," or ",Object(f.jsx)("code",{children:"*.mtx.gz"})]}),Object(f.jsxs)("li",{children:["features or genes, ",Object(f.jsx)("code",{children:"*.tsv"})," or ",Object(f.jsx)("code",{children:"*.tsv.gz"})]}),Object(f.jsxs)("li",{children:["HDF5 (10x or h5ad) - ",Object(f.jsx)("code",{children:"*.h5"})," or ",Object(f.jsx)("code",{children:"*.hdf5"})," or ",Object(f.jsx)("code",{children:"*.h5ad"})]})]})]}),1===k&&Object(f.jsxs)(d.c,{intent:"primary",children:[Object(f.jsx)("p",{children:"We currently support several common file formats for single-cell RNA-seq count data."}),Object(f.jsxs)("p",{children:[Object(f.jsxs)("strong",{children:["A count matrix in the Matrix Market (",Object(f.jsx)("code",{children:"*.mtx"}),") format. "]}),"This file may be Gzip-compressed, in which case we expect it to have a ",Object(f.jsx)("code",{children:"*.mtx.gz"})," extension. We assume that the matrix has already been filtered to remove empty droplets. We also recommend supplying the feature annotation as an additional TSV file with gene identifiers and symbols - this is usually called ",Object(f.jsx)("code",{children:"features.tsv.gz"})," or ",Object(f.jsx)("code",{children:"genes.tsv"})," in the output of processing pipelines like Cellranger."]}),Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"A count matrix in the 10X HDF5 feature-barcode matrix format. "}),"We assume that the matrix has already been filtered to remove empty droplets. This is usually called something like ",Object(f.jsx)("code",{children:"filtered_feature_bc_matrix.h5"})," in the output of processing pipelines like Cellranger. (See ",Object(f.jsx)("a",{href:"https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/advanced/h5_matrices",children:"here"})," for details. Do not confuse this with the molecule information file, which is something different altogether.)"]}),Object(f.jsxs)("p",{children:[Object(f.jsxs)("strong",{children:["A count matrix in the H5AD (",Object(f.jsx)("code",{children:"*.h5ad"}),") format. "]}),"We assume that the count matrix is stored in the ",Object(f.jsx)("code",{children:"X"})," group. We will also try to guess which field in the ",Object(f.jsx)("code",{children:"obs"})," annotation contains gene symbols."]})]}),Oe()]})]})}),Object(f.jsx)(d.F,{id:"load",title:"Load saved analysis",panel:Object(f.jsxs)("div",{className:"inputs-container",children:[Object(f.jsxs)("div",{className:"row-input",children:[Object(f.jsx)("div",{className:"col",children:Object(f.jsxs)(d.G,{animate:!0,renderActiveTabPanelOnly:!0,vertical:!0,onChange:function(e,t){"kana"===e?(K({file:null}),J({file:"Choose kana analysis file"})):"kanadb"===e&&(K({file:null}),ne(!0)),_&&be(_),de(e)},defaultSelectedTabId:oe,children:[Object(f.jsx)(d.F,{id:"kana",title:"Load from file",panel:Object(f.jsxs)("div",{children:[Object(f.jsxs)(d.m,{children:[Object(f.jsx)(d.H,{round:!0,children:"1"}),Object(f.jsx)("span",{className:"row-tooltip",children:"Load analysis from file"})]}),Object(f.jsx)("div",{className:"row",children:Object(f.jsx)(d.q,{className:"row-input",children:Object(f.jsx)(d.k,{text:Y.file,onInputChange:function(e){J(Object(c.a)(Object(c.a)({},Y),{},{file:e.target.files[0].name})),K(Object(c.a)(Object(c.a)({},Z),{},{file:e.target.files}))}})})})]})}),Object(f.jsx)(d.F,{id:"kanadb",title:"Load from browser",panel:Object(f.jsxs)("div",{children:[Object(f.jsxs)(d.m,{children:[Object(f.jsx)(d.H,{round:!0,children:"1"}),Object(f.jsx)("span",{className:"row-tooltip",children:"Load analysis from browser cache"})]}),q.length>0?Object(f.jsx)("div",{className:"row",children:Object(f.jsx)(d.B,{onChange:function(e){var t;K(Object(c.a)(Object(c.a)({},Z),{},{file:null===(t=e.currentTarget)||void 0===t?void 0:t.value})),ne(!0)},selectedValue:null===Z||void 0===Z?void 0:Z.file,children:q.map((function(e,t){return Object(f.jsxs)(d.A,{style:{display:"flex",flexDirection:"row",alignItems:"center"},label:e.title,value:e.id,children:[" \xa0",Object(f.jsx)("span",{className:"kana-date",children:me(e.time)}),"  \xa0",Object(f.jsx)(d.o,{icon:"trash",size:"10",style:{alignSelf:"baseline",paddingTop:"4px",paddingLeft:"5px"},onClick:function(){z(e.id)}})]},t)}))})}):Object(f.jsx)("div",{className:"row",children:Object(f.jsx)(d.q,{children:"No saved analysis found in the browser!!"})})]})})]})}),_&&W===oe&&(null===Z||void 0===Z?void 0:Z.file)===(null===T||void 0===T||null===(t=T.files)||void 0===t?void 0:t.file)?fe():"",_&&W===oe&&(null===Z||void 0===Z?void 0:Z.file)===(null===T||void 0===T||null===(n=T.files)||void 0===n?void 0:n.file)?xe():"",_&&W===oe&&(null===Z||void 0===Z?void 0:Z.file)===(null===T||void 0===T||null===(a=T.files)||void 0===a?void 0:a.file)?ve():"",_&&W===oe&&(null===Z||void 0===Z?void 0:Z.file)===(null===T||void 0===T||null===(i=T.files)||void 0===i?void 0:i.file)?ge():"",_&&W===oe&&(null===Z||void 0===Z?void 0:Z.file)===(null===T||void 0===T||null===(l=T.files)||void 0===l?void 0:l.file)?ye():"",_&&W===oe&&(null===Z||void 0===Z?void 0:Z.file)===(null===T||void 0===T||null===(r=T.files)||void 0===r?void 0:r.file)?we():""]}),Object(f.jsxs)("div",{className:"row-input-tooltips",children:[!te&&Object(f.jsx)(d.c,{intent:"danger",title:"Incorrect file format",style:{marginBottom:"10px"}}),Object(f.jsxs)(d.c,{intent:"primary",children:["Import a saved analysis from ",Object(f.jsx)("strong",{children:"kana"}),". These files are stored as ",Object(f.jsx)("strong",{children:Object(f.jsx)("code",{children:"*.kana"})}),"."]}),1===k&&Object(f.jsx)(d.c,{intent:"primary",children:Object(f.jsxs)("p",{children:["We currently support files in the Cellranger format - namely, a Matrix Market file containing the count matrix. We also recommend supplying the feature annotation (",Object(f.jsx)("code",{children:"features.tsv.gz"})," or ",Object(f.jsx)("code",{children:"genes.tsv.gz"}),"). Users may also provide a TSV file containing the barcode annotations, if any."]})}),Oe()]})]})})]})}),b?Object(f.jsx)("div",{className:m.a.DIALOG_FOOTER,children:Object(f.jsx)("div",{className:m.a.DIALOG_FOOTER_ACTIONS,children:Object(f.jsx)(j.a,{content:"Run Analysis",children:Object(f.jsx)(d.a,{disabled:!te,icon:"function",onClick:function(){var e,t,n,s;je.cluster["clus-res"]=Number(je.cluster["clus-res"]),R(je),"load"===B&&V("kanadb"===oe?null===(t=q[parseInt(null===Z||void 0===Z?void 0:Z.file)])||void 0===t?void 0:t.title:null===Z||void 0===Z||null===(n=Z.file)||void 0===n||null===(s=n[0])||void 0===s?void 0:s.name.split(".")[0]),M({format:"new"===B?ie:oe,files:Z,reset:"new"!==B&&(null===Z||void 0===Z?void 0:Z.file)!==(null===T||void 0===T||null===(e=T.files)||void 0===e?void 0:e.file)}),G("new"===B?ie:oe),E()},children:"Analyze"})})})}):Object(f.jsx)("div",{style:{margin:"0 20px"}})]}))]})},F=function(){var e=Object(s.useContext)(x),t=e.initDims,n=e.qcDims;return Object(f.jsx)(f.Fragment,{children:Object(f.jsxs)("span",{children:[t?": ".concat(t):" ",n?" (".concat(n," after QC)"):""]})})},C=function(){var e=Object(s.useContext)(x).logs,t=Object(s.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!0,enforceFocus:!0,hasBackdrop:!0,isOpen:!1,position:u.a.RIGHT,size:void 0,usePortal:!0}),n=Object(o.a)(t,2),a=n[0],i=n[1];return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(d.a,{onClick:function(){return i({isOpen:!0})},icon:"wrench",outlined:!0,intent:"warning"}),Object(f.jsx)(d.i,Object(c.a)(Object(c.a)({icon:"info-sign",onClose:function(){return i({isOpen:!1})},title:"What's happening ?"},a),{},{children:Object(f.jsx)("div",{className:m.a.DRAWER_BODY,children:Object(f.jsx)("div",{className:m.a.DIALOG_BODY,children:Object(f.jsx)("ul",{className:"list",children:e.map((function(e,t){return Object(f.jsx)("li",{children:e},t)}))})})})}))]})},N=n(34),k=["buttonText","includeFooter"];var S=function(e){e.buttonText,e.includeFooter;var t=Object(p.a)(e,k),n=Object(s.useContext)(x).setOpenInput,a=Object(s.useState)(!0),i=Object(o.a)(a,2),l=i[0],r=i[1],h=Object(s.useState)(!1),b=Object(o.a)(h,2),O=b[0],v=b[1],g=Object(s.useCallback)((function(){r(!l),v(!0)}),[l]),y=Object(s.useCallback)((function(){return r(!1)}),[]);return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(j.a,{content:"Some information about the app.",position:u.a.BOTTOM,children:Object(f.jsx)(d.a,{onClick:g,icon:"info-sign",intent:"primary",text:""})}),Object(f.jsxs)(d.g,Object(c.a)(Object(c.a)({},t),{},{isOpen:l,onClose:y,children:[Object(f.jsx)("div",{className:m.a.DIALOG_BODY,children:Object(f.jsxs)(d.d,{elevation:N.a.ZERO,children:[Object(f.jsxs)("p",{children:[Object(f.jsx)("strong",{children:"kana"})," performs a standard scRNA-seq data analysis directly inside the browser."]}),Object(f.jsxs)("p",{children:["With just a few clicks, you can get a UMAP/t-SNE, clusters and their marker genes in an intuitive interface for further exploration. No need to transfer data, no need to install software, no need to configure a backend server - just point to a Matrix Market file and we'll analyze ",Object(f.jsx)("em",{children:"your"})," data on ",Object(f.jsx)("em",{children:"your"})," computer, no questions asked."]}),Object(f.jsxs)("p",{children:["Check out our ",Object(f.jsx)("a",{href:"https://github.com/jkanche/scran.js.app",target:"_blank",children:"GitHub page"})," for more details. Or you could just play around with the app to see what it can do."]}),Object(f.jsx)(d.m,{children:"Authors"}),"Jayaram Kancherla (",Object(f.jsx)("a",{href:"https://github.com/jkanche",target:"_blank",children:Object(f.jsx)("strong",{children:"@jkanche"})}),"), Aaron Lun (",Object(f.jsx)("a",{href:"https://github.com/LTLA",target:"_blank",children:Object(f.jsx)("strong",{children:"@LTLA"})}),")"]})}),Object(f.jsx)("div",{className:m.a.DIALOG_FOOTER,children:Object(f.jsx)("div",{className:m.a.DIALOG_FOOTER_ACTIONS,children:O?Object(f.jsx)(d.a,{icon:"cross",onClick:y,children:"Close"}):Object(f.jsx)(j.a,{content:"\u884c\u304f\u305e!",children:Object(f.jsx)(d.a,{icon:"bring-data",onClick:function(){n(!0),y()},children:"Get started"})})})})]}))]})},D=function(){var e=Object(s.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!1,enforceFocus:!1,shouldReturnFocusOnClose:!0}),t=Object(o.a)(e,1)[0],n=Object(s.useContext)(x),a=n.setExportState,i=n.datasetName,l=n.setDatasetName,r=n.setIndexedDBState;return Object(f.jsx)(f.Fragment,{children:Object(f.jsx)(d.t,{className:"bp3-dark",children:Object(f.jsxs)(d.v,{className:"navbar-group",align:h.a.LEFT,children:[Object(f.jsx)(d.w,{children:"kana"}),Object(f.jsx)(d.u,{}),Object(f.jsx)("span",{children:"Single cell RNA-seq analysis in the browser"}),Object(f.jsx)(d.u,{}),Object(f.jsx)(w,Object(c.a)({icon:"document",title:"Import dataset & update parameters (mouseover for info)",buttonText:"Start Analysis",includeFooter:!0},t)),Object(f.jsx)(d.u,{}),Object(f.jsx)(j.a,{content:"Modify the dataset title here.",position:u.a.BOTTOM,children:Object(f.jsx)(d.j,{value:i,intent:"primary",onConfirm:function(e){l(e)},onChange:function(e){l(e)}})}),Object(f.jsx)(F,{}),Object(f.jsx)(d.u,{}),Object(f.jsx)(j.a,{content:"Save the analysis, either in your browser's cache or to a file on your computer.",position:u.a.BOTTOM,children:Object(f.jsx)(d.b,{children:Object(f.jsx)(b.a,{content:Object(f.jsxs)(d.r,{children:[Object(f.jsx)(d.s,{text:"Save to browser",icon:"floppy-disk",onClick:function(){r(!0)}}),Object(f.jsx)(d.s,{text:"Download to file",icon:"download",onClick:function(){a(!0)}})]}),placement:"bottom-start",children:Object(f.jsx)(d.a,{intent:"warning",rightIcon:"caret-down",text:"Export"})})})}),Object(f.jsx)(d.u,{}),Object(f.jsx)(j.a,{content:"What's happening under the hood? See the blow-by-blow logs as the analysis runs.",position:u.a.BOTTOM,children:Object(f.jsx)(C,{})}),Object(f.jsx)(d.u,{}),Object(f.jsx)(S,Object(c.a)({icon:"document",title:"Single-cell RNA-seq analysis in the browser",isOpen:!0},t))]})})})},E=a.a.memo(D),A=n(11);function T(e,t,n,s){var a=function(e){e.setAttribute("xlink","http://www.w3.org/1999/xlink"),function(e,t){var n=document.createElement("style");n.setAttribute("type","text/css"),n.innerHTML=e;var s=t.hasChildNodes()?t.children[0]:null;t.insertBefore(n,s)}(function(e){var t=[];t.push("#"+e.id);for(var n=0;n<e.classList.length;n++)j("."+e.classList[n],t)||t.push("."+e.classList[n]);for(var s=e.getElementsByTagName("*"),a=0;a<s.length;a++){var i=s[a].id;j("#"+i,t)||t.push("#"+i);for(var l=s[a].classList,c=0;c<l.length;c++)j("."+l[c],t)||t.push("."+l[c])}for(var r="",o=0;o<document.styleSheets.length;o++){var d=document.styleSheets[o];try{if(!d.cssRules)continue}catch(b){if("SecurityError"!==b.name)throw b;continue}for(var h=d.cssRules,u=0;u<h.length;u++)j(h[u].selectorText,t)&&(r+=h[u].cssText)}return r;function j(e,t){return-1!==t.indexOf(e)}}(e),e);var t=(new XMLSerializer).serializeToString(e);return(t=t.replace(/(\w+)?:?xlink=/g,"xmlns:xlink=")).replace(/NS\d+:href/g,"xlink:href")}(e),i="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(a))),l=document.createElement("canvas"),c=l.getContext("2d");l.width=t,l.height=n;var r=new Image;r.onload=function(){c.clearRect(0,0,t,n),c.drawImage(r,0,0,t,n);var e=l.toDataURL(),a=document.createElement("a");a.href=e,a.download=s||"plot.png",a.click()},r.src=i}var M=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color,i=null===e||void 0===e?void 0:e.ymax;if(i||(i=Math.max.apply(Math,Object(r.a)(n.map((function(e){return e.value}))))),s||(s=325),a||(a="#00B3A4"),!n)return"";var l=t.current;l.innerHTML="";var c=10,o=30,d=30,h=40,u=s-h-o,j=200-c-d;l.querySelector("svg")&&(l.querySelector("svg").innerHTML="");var b=A.o(l).append("svg").attr("width",u+h+o).attr("height",j+c+d).append("g").attr("transform","translate(".concat(h,",").concat(c,")")),p=A.l().range([0,u]).domain(n.map((function(e){return e.key}))).padding(.2);b.append("g").attr("transform","translate(0,"+j+")").call(A.b(p)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");var m=A.m().domain([0,i]).range([j,0]);b.append("g").call(A.c(m)),b.selectAll("bars").data(n).enter().append("rect").attr("x",(function(e){return p(e.key)})).attr("y",(function(e){return m(e.value)})).attr("width",p.bandwidth()).attr("height",(function(e){return j-m(e.value)})).attr("fill",(function(e,t){return Array.isArray(a)?a[t]:a}))}),[null===e||void 0===e?void 0:e.data]),Object(f.jsxs)("div",{className:"imgplot-container",children:[Object(f.jsx)(d.a,{small:!0,className:"imgplot-save",icon:"download",onClick:function(){T(A.o(t.current.querySelector("svg")).node(),650,400,null===e||void 0===e?void 0:e.filename)},children:"Download"}),Object(f.jsx)("div",{ref:t})]})},I=a.a.memo(M),R=function(e){var t,n,s=null===e||void 0===e||null===(t=e.pca)||void 0===t?void 0:t.var_exp;if(!s)return"";var a=[];return null===(n=Object.values(s))||void 0===n||n.forEach((function(e,t){a.push({key:t+1,value:100*e})})),Object(f.jsx)(I,{filename:(null===e||void 0===e?void 0:e.title)+"_pca.png",data:a})},L=a.a.memo(R),B=function(e){var t=Object(s.useState)(null),n=Object(o.a)(t,2),a=n[0],i=n[1],l=Object(s.useContext)(x),c=l.clusterColors,r=l.datasetName;return Object(s.useEffect)((function(){var t,n,s=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.clusters;if(s){for(var a={},l=0;l<(null===s||void 0===s?void 0:s.length);l++){var c=s[l];"CLUS_"+c in a?a["CLUS_"+c]++:a["CLUS_"+c]=0}var r=[];null===(n=Object.values(a))||void 0===n||n.forEach((function(e,t){r.push({key:t+1,value:e})})),i(r)}}),[null===e||void 0===e?void 0:e.data,c]),c&&a&&Object(f.jsx)(I,{filename:r.split(" ").join("_")+"_clusters.png",data:a,color:c})},P=a.a.memo(B),_=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.rdata,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color;if(s||(s=200),a||(a="#00B3A4"),!n)return"";var i=null===e||void 0===e?void 0:e.dataTransform,l=null===e||void 0===e?void 0:e.range,c=null===e||void 0===e?void 0:e.threshold;"log"===i&&(n=n.map((function(e){return Math.log2(e+1)})),l=l.map((function(e){return Math.log2(e+1)})),c=Math.log2(c+1));var r=t.current;r.innerHTML="";var o=10,d=30,h=30,u=40,j=s-u-d,b=200-o-h,p=A.o(r).append("svg").attr("width",j+u+d).attr("height",b+o+h).append("g").attr("transform","translate(".concat(u,",").concat(o,")")),m=A.m().domain(l).range([b,0]).nice();p.append("g").call(A.c(m).tickFormat((function(t){return"log"===i?A.h(null===e||void 0===e?void 0:e.transform)(Math.pow(2,t)):A.h(null===e||void 0===e?void 0:e.transform)(t)})));var O=A.l().range([0,j]).domain([null===e||void 0===e?void 0:e.showLabel]).padding(.05);p.append("g").attr("transform","translate(0,"+b+")").call(A.b(O));var f=A.d().domain(m.domain()).thresholds("log"===i?m.ticks(10):m.ticks(40)).value((function(e){return e}))(n),x=A.k(f,(function(e){return e.length})),v=A.m().range([0,O.bandwidth()]).domain([-1,1]);p.selectAll("violins").data([null===e||void 0===e?void 0:e.label]).enter().append("g").attr("transform",(function(e){return"translate("+O(e)+" ,0)"})).append("path").datum((function(){return f})).style("stroke","none").style("fill",a).attr("d",A.a().x0((function(e){return v(-e.length/x)})).x1((function(e){return v(e.length/x)})).y((function(e){return m(e.x0)})).curve("log"===i?A.e:A.f)),p.selectAll("threshold").data([c]).enter().append("line").attr("transform",(function(){return"translate("+O(null===e||void 0===e?void 0:e.label)+" ,0)"})).attr("class","threshold").attr("x1",5).attr("y1",(function(e){return m(e)})).attr("x2",O.bandwidth()-5).attr("y2",(function(e){return m(e)})).attr("stroke-width",2).attr("stroke","Orange").on("mouseover",(function(){var e=A.o(this);e.attr("stroke","black"),e.attr("stroke-width","8")})).on("mouseout",(function(){var e=A.o(this);e.attr("stroke","Orange"),e.attr("stroke-width","5")}))}),[e]),Object(f.jsxs)("div",{className:"imgplot-container",children:[Object(f.jsx)(d.a,{small:!0,className:"imgplot-save",icon:"download",onClick:function(){T(A.o(t.current.querySelector("svg")).node(),650,400,null===e||void 0===e?void 0:e.filename)},children:"Download"}),Object(f.jsx)("div",{ref:t})]})},q=a.a.memo(_),G=(n(308),function(e){var t=Object(s.useState)(null),n=Object(o.a)(t,2),a=n[0],i=n[1];return Object(s.useEffect)((function(){i(e.data)}),[e]),a&&Object(f.jsx)("div",{className:"qc-plots",children:["sums","detected","proportion"].map((function(t){var n,s,i,l={threshold:null===a||void 0===a||null===(n=a.thresholds)||void 0===n?void 0:n[t],range:null===a||void 0===a||null===(s=a.ranges)||void 0===s?void 0:s[t],label:t,transform:"proportion"===t?".2":".2s",showLabel:t,dataTransform:"proportion"===t?null:"log",rdata:null===a||void 0===a||null===(i=a.data)||void 0===i?void 0:i[t]};return Object(f.jsx)("div",{children:Object(f.jsx)(q,Object(c.a)({filename:(null===e||void 0===e?void 0:e.title)+"_"+t+".png"},l))},t)}))})}),W=a.a.memo(G),z=(n(309),n(310),function(e){var t=Object(s.useRef)(),n=Object(s.useState)(null),a=Object(o.a)(n,2),i=a[0],l=a[1],c=Object(s.useContext)(x),r=c.genesInfo,h=c.gene,u=c.geneColSel,j=null===e||void 0===e?void 0:e.data,b=null===e||void 0===e?void 0:e.width,p=null===e||void 0===e?void 0:e.height,m=null===e||void 0===e?void 0:e.color;return b||(b=325),p||(p=200),m||(m="#00B3A4"),Object(s.useEffect)((function(){var e=t.current;if(e){var n,s,a;if(null===j||void 0===j?void 0:j.image){var i=e.getContext("2d"),c=new Image;c.onload=function(){i.drawImage(c,0,0,b,p)},c.src=null===j||void 0===j?void 0:j.image}var o,d,m,O=" ".concat(null===j||void 0===j||null===(n=j.config)||void 0===n?void 0:n.embedding," ");if((null===j||void 0===j||null===(s=j.config)||void 0===s?void 0:s.gene)&&(O+="\u2283 ".concat(r[u][h]," ")),null===j||void 0===j||null===(a=j.config)||void 0===a?void 0:a.highlight)String(null===j||void 0===j||null===(o=j.config)||void 0===o?void 0:o.highlight).startsWith("cs")?O+="\u2283 Custom Selection ".concat(null===j||void 0===j||null===(d=j.config)||void 0===d?void 0:d.highlight," "):O+="\u2283 Cluster ".concat(parseInt(null===j||void 0===j||null===(m=j.config)||void 0===m?void 0:m.highlight)+1," ");l(O)}}),[]),Object(f.jsxs)("div",{className:"imgplot-container",children:[Object(f.jsx)("h5",{children:i}),Object(f.jsx)(d.a,{small:!0,className:"imgplot-save",icon:"download",onClick:function(){var e=document.createElement("a");e.href=null===j||void 0===j?void 0:j.image,e.download="".concat(i.replace("\u2283","").split(" ").join("_"),".png"),e.click()},children:"Download"}),Object(f.jsx)("canvas",{className:"imgplot-canvas",width:b,height:p,ref:t})]})}),V=function(){var e=Object(s.useContext)(x),t=e.pcaVarExp,n=e.qcData,a=e.clusterData,i=e.savedPlot,l=e.datasetName;return Object(f.jsx)(f.Fragment,{children:Object(f.jsxs)("div",{className:"gallery-cont",children:[n&&(null===n||void 0===n?void 0:n.thresholds)?Object(f.jsxs)(d.d,{className:"gallery-elem",elevation:N.a.ONE,children:[Object(f.jsx)("h5",{children:"QC Statistics"}),Object(f.jsx)(W,{title:l.split(" ").join("_"),data:n})]}):"",t?Object(f.jsxs)(d.d,{className:"gallery-elem",elevation:N.a.ONE,children:[Object(f.jsx)("h5",{children:"PCA (% variance explained)"}),Object(f.jsx)(L,{title:l.split(" ").join("_"),pca:t})]}):"",a?Object(f.jsxs)(d.d,{className:"gallery-elem",elevation:N.a.ONE,children:[Object(f.jsx)("h5",{children:"# of cells per cluster"}),Object(f.jsx)(P,{data:a})]}):"",i?i.map((function(e,t){return Object(f.jsx)(d.d,{className:"gallery-elem",elevation:N.a.ONE,children:Object(f.jsx)(z,{data:e})},t)})):""]})})},H=a.a.memo(V),U=n(63),Z=n(78);function K(){var e=null,t=0,n=100,s=["ff0000","ffff00","00ff00","0000ff"];function a(a){if(a.length<2)throw new Error("Rainbow must have two or more colours.");var i=(n-t)/(a.length-1),l=new X;l.setGradient(a[0],a[1]),l.setNumberRange(t,t+i),e=[l];for(var c=1;c<a.length-1;c++){var r=new X;r.setGradient(a[c],a[c+1]),r.setNumberRange(t+i*c,t+i*(c+1)),e[c]=r}s=a}a(s),this.setSpectrum=function(){return a(arguments),this},this.setSpectrumByArray=function(e){return a(e),this},this.colourAt=function(s){if(isNaN(s))throw new TypeError(s+" is not a number");if(1===e.length)return e[0].colourAt(s);var a=(n-t)/e.length,i=Math.min(Math.floor((Math.max(s,t)-t)/a),e.length-1);return e[i].colourAt(s)},this.colorAt=this.colourAt,this.setNumberRange=function(e,i){if(!(i>e))throw new RangeError("maxNumber ("+i+") is not greater than minNumber ("+e+")");return t=e,n=i,a(s),this}}function X(){var e="ff0000",t="0000ff",n=0,s=100;function a(e,t,a){var i=e;i<n&&(i=n),i>s&&(i=s);var l,c=s-n,r=parseInt(t,16),o=(parseInt(a,16)-r)/c,d=Math.round(o*(i-n)+r);return 1===(l=d.toString(16)).length?"0"+l:l}function i(e){if(function(e){return/^#?[0-9a-fA-F]{6}$/i.test(e)}(e))return e.substring(e.length-6,e.length);var t=e.toLowerCase();if(l.hasOwnProperty(t))return l[t];throw new Error(e+" is not a valid colour.")}this.setGradient=function(n,s){e=i(n),t=i(s)},this.setNumberRange=function(e,t){if(!(t>e))throw new RangeError("maxNumber ("+t+") is not greater than minNumber ("+e+")");n=e,s=t},this.colourAt=function(n){return a(n,e.substring(0,2),t.substring(0,2))+a(n,e.substring(2,4),t.substring(2,4))+a(n,e.substring(4,6),t.substring(4,6))};var l={aliceblue:"F0F8FF",antiquewhite:"FAEBD7",aqua:"00FFFF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000000",blanchedalmond:"FFEBCD",blue:"0000FF",blueviolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetblue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerblue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"00FFFF",darkblue:"00008B",darkcyan:"008B8B",darkgoldenrod:"B8860B",darkgray:"A9A9A9",darkgreen:"006400",darkgrey:"A9A9A9",darkkhaki:"BDB76B",darkmagenta:"8B008B",darkolivegreen:"556B2F",darkorange:"FF8C00",darkorchid:"9932CC",darkred:"8B0000",darksalmon:"E9967A",darkseagreen:"8FBC8F",darkslateblue:"483D8B",darkslategray:"2F4F4F",darkslategrey:"2F4F4F",darkturquoise:"00CED1",darkviolet:"9400D3",deeppink:"FF1493",deepskyblue:"00BFFF",dimgray:"696969",dimgrey:"696969",dodgerblue:"1E90FF",firebrick:"B22222",floralwhite:"FFFAF0",forestgreen:"228B22",fuchsia:"FF00FF",gainsboro:"DCDCDC",ghostwhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"808080",green:"008000",greenyellow:"ADFF2F",grey:"808080",honeydew:"F0FFF0",hotpink:"FF69B4",indianred:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderblush:"FFF0F5",lawngreen:"7CFC00",lemonchiffon:"FFFACD",lightblue:"ADD8E6",lightcoral:"F08080",lightcyan:"E0FFFF",lightgoldenrodyellow:"FAFAD2",lightgray:"D3D3D3",lightgreen:"90EE90",lightgrey:"D3D3D3",lightpink:"FFB6C1",lightsalmon:"FFA07A",lightseagreen:"20B2AA",lightskyblue:"87CEFA",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"B0C4DE",lightyellow:"FFFFE0",lime:"00FF00",limegreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumaquamarine:"66CDAA",mediumblue:"0000CD",mediumorchid:"BA55D3",mediumpurple:"9370DB",mediumseagreen:"3CB371",mediumslateblue:"7B68EE",mediumspringgreen:"00FA9A",mediumturquoise:"48D1CC",mediumvioletred:"C71585",midnightblue:"191970",mintcream:"F5FFFA",mistyrose:"FFE4E1",moccasin:"FFE4B5",navajowhite:"FFDEAD",navy:"000080",oldlace:"FDF5E6",olive:"808000",olivedrab:"6B8E23",orange:"FFA500",orangered:"FF4500",orchid:"DA70D6",palegoldenrod:"EEE8AA",palegreen:"98FB98",paleturquoise:"AFEEEE",palevioletred:"DB7093",papayawhip:"FFEFD5",peachpuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderblue:"B0E0E6",purple:"800080",red:"FF0000",rosybrown:"BC8F8F",royalblue:"4169E1",saddlebrown:"8B4513",salmon:"FA8072",sandybrown:"F4A460",seagreen:"2E8B57",seashell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyblue:"87CEEB",slateblue:"6A5ACD",slategray:"708090",slategrey:"708090",snow:"FFFAFA",springgreen:"00FF7F",steelblue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFFFFF",whitesmoke:"F5F5F5",yellow:"FFFF00",yellowgreen:"9ACD32"}}n(323);var Q=function(e){var t,n,a,i=Object(s.useRef)(),l=Object(s.useState)(null),h=Object(o.a)(l,2),u=h[0],b=h[1],p=Object(s.useState)(null),m=Object(o.a)(p,2),v=m[0],g=m[1],y=Object(s.useState)(!1),w=Object(o.a)(y,2),F=w[0],C=w[1],N=Object(s.useState)(null),k=Object(o.a)(N,2),S=k[0],D=k[1],E=Object(s.useState)(S),A=Object(o.a)(E,2),T=A[0],M=A[1],I=Object(s.useState)(null),R=Object(o.a)(I,2),L=R[0],B=R[1],P=Object(s.useState)(!0),_=Object(o.a)(P,2),q=_[0],G=_[1],W=Object(s.useContext)(x),z=W.redDims,V=W.defaultRedDims,H=W.setDefaultRedDims,X=W.clusterData,Q=W.tsneData,Y=W.umapData,J=W.clusterColors,$=W.setClusterColors,ee=W.gene,te=W.setGene,ne=W.selectedClusterIndex,se=W.selectedClusterSummary,ae=W.customSelection,ie=W.setCustomSelection,le=W.setDelCustomSelection,ce=W.setShowAnimation,re=W.showAnimation,oe=W.setTriggerAnimation,de=W.savedPlot,he=W.setSavedPlot,ue=W.selectedCluster,je=W.genesInfo,be=W.geneColSel,pe=Object(s.useState)(null),me=Object(o.a)(pe,2),Oe=me[0],fe=me[1],xe=Object(s.useState)("PAN"),ve=Object(o.a)(xe,2),ge=ve[0],ye=ve[1],we=Math.max.apply(Math,Object(r.a)(null===X||void 0===X?void 0:X.clusters));Object(s.useEffect)((function(){var e;null===ee&&(C(!1),B(null));var t=null===ne||void 0===ne?void 0:ne[ee],n=null===se||void 0===se||null===(e=se[t])||void 0===e?void 0:e.expr;if(n){var s=function(e){var t=-Number.MAX_VALUE,n=Number.MAX_VALUE;return e.forEach((function(e){t<e&&(t=e),n>e&&(n=e)})),[n,t]}(n),a=0===s[1]?.01:s[1],i=new K;i.setSpectrum("#F5F8FA","#2965CC"),i.setNumberRange(0,a),s[0]!==s[1]?(C(!0),M([0,a]),D([0,a])):(C(!1),O.show({icon:"warning-sign",intent:"warning",message:"".concat(je[be][ee]," is not expressed in any cell (mean = 0)")})),B(i)}}),[null===ne||void 0===ne?void 0:ne[ee],null===se||void 0===se||null===(t=se[null===ne||void 0===ne?void 0:ne[ee]])||void 0===t?void 0:t.expr],ee),Object(s.useEffect)((function(){if(Array.isArray(T)){var e=new K;e.setSpectrum("#F5F8FA","#2965CC"),e.setNumberRange.apply(e,Object(r.a)(T)),B(e),C(!0)}}),[T]),Object(s.useEffect)((function(){if(i.current){var t=u;if(!t){var n=i.current;n.style.width="95%",n.style.height="95%",t=new Z.ScatterGL(n,{onSelect:function(e){0!==e.length&&fe(e)},orbitControls:{zoomSpeed:1.25},styles:{point:{scaleDefault:1,scaleSelected:1.25,scaleHover:1.25}}}),t.setPanMode(),b(t)}var s=null;if(re?s=null===e||void 0===e?void 0:e.animateData:"TSNE"===V?s=Q:"UMAP"===V&&(s=Y),s){var a=null===X||void 0===X?void 0:X.clusters,l=J,c=[];s.x.forEach((function(e,t){c.push([e,s.y[t]])}));var r={clusters:a},o=new Z.ScatterGL.Dataset(c,r);q?(t.render(o),G(!1)):t.updateDataset(o),t.setPointColorer((function(e,t,n){if(t.has(e))return"#30404D";if(null!=v)if(String(v).startsWith("cs")){if(!ae[v].includes(e))return"#D3D3D3"}else if(v!==a[e])return"#D3D3D3";if(null!==ee){var s,i=null===ne||void 0===ne?void 0:ne[ee],c=null===se||void 0===se||null===(s=se[i])||void 0===s?void 0:s.expr;if(Array.isArray(c))return"#"+L.colorAt(null===c||void 0===c?void 0:c[e])}if(null!=v&&String(v).startsWith("cs")){var r=parseInt(v.replace("cs",""));return l[we+r]}return l[a[e]]}))}}}),[Q,Y,null===e||void 0===e?void 0:e.animateData,J,X,V,L,v]);var Fe=function(e){"SELECT"===e?(u.setSelectMode(),ye("SELECT")):(u.setPanMode(),ye("PAN"))};return Object(f.jsxs)("div",{className:"scatter-plot",children:[Object(f.jsxs)(d.b,{style:{minWidth:75,minHeight:150},fill:!1,large:!1,minimal:!1,vertical:!0,className:"left-sidebar",children:[Object(f.jsxs)(d.a,{className:"dim-button",disabled:-1===z.indexOf("TSNE"),onClick:function(){return H("TSNE")},intent:"TSNE"===V?"primary":"",children:[Object(f.jsx)(d.o,{icon:"heatmap"}),Object(f.jsx)("br",{}),Object(f.jsx)("span",{children:"t-SNE"})]}),Object(f.jsxs)(d.a,{className:"dim-button",disabled:-1===z.indexOf("UMAP"),onClick:function(){return H("UMAP")},intent:"UMAP"===V?"primary":"",children:[Object(f.jsx)(d.o,{icon:"heatmap"}),Object(f.jsx)("br",{}),Object(f.jsx)("span",{children:"UMAP"})]}),Object(f.jsxs)(d.a,{className:"dim-button",disabled:!0,children:[Object(f.jsx)(d.o,{icon:"heat-grid"}),Object(f.jsx)("br",{}),Object(f.jsx)("span",{children:"HEATMAP (coming soon)"})]})]}),Object(f.jsxs)("div",{className:"top-header",children:[Object(f.jsxs)(d.f,{fill:!1,vertical:!1,style:{marginRight:"4px"},children:[Object(f.jsx)(j.a,{content:"Interactively visualize embeddings",children:Object(f.jsx)(d.a,{icon:"play",onClick:function(){ce(!0),oe(!0)},children:"Animate"})}),Object(f.jsx)(j.a,{content:"Save this embedding",children:Object(f.jsx)(d.a,{icon:"inheritance",onClick:function(){if(console.log("handleSaveEmbedding"),i.current){u.renderScatterPlot();var e=u.scatterPlot.renderer.domElement.toDataURL(),t=Object(r.a)(de);t.push({image:e,config:{cluster:ue,gene:ee,highlight:v,embedding:V}}),he(t)}},children:"Save"})})]}),Object(f.jsxs)(d.f,{fill:!1,vertical:!1,children:[Object(f.jsx)(d.a,{active:"PAN"===ge,intent:"PAN"===ge?"primary":"none",icon:"hand-up",onClick:function(e){return Fe("PAN")},children:"Pan"}),Object(f.jsx)(d.a,{active:"SELECT"===ge,intent:"SELECT"===ge?"primary":"none",icon:"widget",onClick:function(e){return Fe("SELECT")},children:"Selection"})]})]}),re?Object(f.jsxs)(d.q,{className:"iter",children:["Iteration: ",null===e||void 0===e||null===(n=e.animateData)||void 0===n?void 0:n.iteration]}):"",Object(f.jsx)("div",{className:"dim-plot",children:V?Object(f.jsx)("div",{ref:i}):"Choose an Embedding... or Embeddings are being computed..."}),Object(f.jsx)("div",{className:"right-sidebar",children:Object(f.jsxs)("div",{style:{width:"100%"},children:[Object(f.jsxs)("div",{className:"right-sidebar-cluster",children:[Object(f.jsx)(d.c,{title:"CLUSTERS",children:Object(f.jsx)("ul",{children:null===J||void 0===J?void 0:J.map((function(e,t){return t<J.length-Object.keys(ae).length?Object(f.jsxs)("li",{className:v===t?"legend-highlight":"",style:{color:e},onClick:function(){g(t===v?null:t)},children:[" Cluster ",t+1," "]},t):""}))})}),Object.keys(ae).length>0||Oe&&Oe.length>0?Object(f.jsxs)(d.c,{title:"CUSTOM SELECTIONS",children:[Object(f.jsx)("div",{style:{paddingTop:"5px"},children:Object(f.jsx)("ul",{children:null===(a=Object.keys(ae))||void 0===a?void 0:a.map((function(e,t){return Object(f.jsx)("li",{className:v===e?"legend-highlight":"",style:{color:J[Math.max.apply(Math,Object(r.a)(null===X||void 0===X?void 0:X.clusters))+1+t]},children:Object(f.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",flexDirection:"row"},children:[Object(f.jsxs)("span",{style:{alignSelf:"center"},onClick:function(){g(e===v?null:e)},children:["Custom Selection ",e.replace("cs","")]}),Object(f.jsx)(d.o,{size:12,icon:"trash",style:{paddingLeft:"2px"},onClick:function(){var t=Object(c.a)({},ae);delete t[e],ie(t);var n=Object(r.a)(J);n=n.slice(0,n.length-1),$(n),le(e),v===e&&g(null)}})]})},e)}))})}),Oe&&Oe.length>0?Object(f.jsxs)("div",{children:[Object(f.jsx)(d.h,{}),Object(f.jsxs)("div",{className:"selection-container",children:[Object(f.jsxs)("span",{children:[Oe.length," cells selected"]}),Object(f.jsxs)("div",{className:"selection-button-container",children:[Object(f.jsx)(d.a,{small:!0,intent:"primary",onClick:function(){var e=Object(U.randomColor)({luminosity:"dark",count:1}),t=Object(r.a)(J);t.push(e[0]),$(t);var n=Object.keys(ae).length,s=Object(c.a)({},ae);s["cs".concat(n+1)]=Oe,ie(s),fe(null),u.select(null)},children:"Save"}),Object(f.jsx)(d.a,{small:!0,onClick:function(){fe(null),u.select(null)},children:"Clear"})]})]})]}):""]}):""]}),F?Object(f.jsx)("div",{className:"right-sidebar-slider",children:Object(f.jsxs)(d.c,{children:[Object(f.jsxs)("span",{children:["Gradient for ",Object(f.jsx)(d.H,{minimal:!0,intent:"primary",onRemove:function(){te(null)},children:je[be][ee]}),"\xa0",Object(f.jsx)(j.a,{content:"Use the slider to adjust the color gradient of the plot. Useful when data is skewed by either a few lowly or highly expressed cells",openOnTargetFocus:!1,children:Object(f.jsx)(d.o,{icon:"help"})})]}),Object(f.jsxs)("div",{className:"dim-slider-container",children:[Object(f.jsxs)("div",{className:"dim-slider-gradient",children:[Object(f.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, #F5F8FA ".concat(100*(T[0]-S[0])/(S[1]-S[0]),"%, ").concat(100*(T[1]+T[0]-2*S[0])/(2*(S[1]-S[0])),"%, #2965CC ").concat(100-100*(S[1]-T[1])/(S[1]-S[0]),"%)"),width:"175px",height:"15px"}}),"\xa0"]}),Object(f.jsx)("div",{className:"dim-range-slider",children:Object(f.jsx)(d.C,{min:Math.round(S[0]),max:Math.round(S[1]),stepSize:Math.round(S[1]-S[0])/10,labelValues:[Math.round(S[0]),Math.round(S[1])],onChange:function(e){M(e)},value:[Math.round(T[0]),Math.round(T[1])],vertical:!1})})]})]})}):""]})})]})},Y=a.a.memo(Q),J=n(135),$=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color,i=null===e||void 0===e?void 0:e.clusters,l=null===e||void 0===e?void 0:e.clusterlabel;if(s||(s=325),a||(a="#00B3A4"),!n)return"";var c=t.current;c.innerHTML="";var r=10,o=30,d=30,h=40,u=s-h-o,j=150-r-d,b=A.o(c).append("svg").attr("width",u+h+o).attr("height",j+r+d).append("g").attr("transform","translate(".concat(h,",").concat(r,")")),p=A.m().domain(A.g(n)).range([0,u]);b.append("g").attr("transform","translate(0, ".concat(j/2,")")).call(A.b(p).ticks(5).tickValues(A.g(n)));var m=A.d().value((function(e){return e})).domain(p.domain()).thresholds(A.p),O=m(n.filter((function(e,t){return 0===(null===i||void 0===i?void 0:i[t])}))),f=m(n.filter((function(e,t){return 1===(null===i||void 0===i?void 0:i[t])}))),x=A.k(O,(function(e){return e.length})),v=A.k(f,(function(e){return e.length})),g=A.m().range([j,0]).domain([-1,1]);(b.selectAll("rectAll").data(O).join("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(p(e.x0)," , ").concat(g(0),")")})).attr("width",(function(e){return p(e.x1)-p(e.x0)-1})).attr("height",(function(e){return g(-e.length/x)-j/2})).style("fill","#D3D3D3").style("opacity",.6),b.selectAll("rectCluster").data(f).enter().append("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(p(e.x0),", ").concat(g(e.length/v),")")})).attr("width",(function(e){return p(e.x1)-p(e.x0)-1})).attr("height",(function(e){return j/2-g(e.length/v)})).style("fill",a).style("opacity",.6),b.append("text").attr("x",u-20).attr("y",g(-.5)).text("other cells").style("font-size","10px").attr("alignment-baseline","middle"),l.startsWith("Custom"))?l.split(" ").forEach((function(e,t){b.append("text").attr("x",u-20).attr("y",g(.7-.17*t)).text(e).style("font-size","10px").attr("alignment-baseline","middle").style("fill",a)})):b.append("text").attr("x",u-20).attr("y",g(.5)).text(l).style("font-size","10px").attr("alignment-baseline","middle").style("fill",a)}),[]),Object(f.jsx)("div",{ref:t})},ee=function(e){var t=Object(s.useRef)(),n=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.minmax,i=null===e||void 0===e?void 0:e.score,l=null===e||void 0===e?void 0:e.colorscale,c=null===e||void 0===e?void 0:e.colorscore,r=null===e||void 0===e?void 0:e.color,o=(i-a[0])/(a[1]-a[0]);return n||(n="100%"),r||(r="#00B3A4"),Object(f.jsx)("div",{ref:t,style:{width:n,height:"15px",margin:"1px",border:"1px solid gainsboro",alignItems:"center"},children:l?Object(f.jsx)("div",{style:{width:"".concat(100*c,"%"),backgroundColor:l(c),height:"100%"}}):Object(f.jsx)("div",{style:{width:"".concat(100*o,"%"),backgroundColor:r,height:"100%"}})})},te=function(e){var t=Object(s.useRef)(),n=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.score,i=null===e||void 0===e?void 0:e.minmax,l=i[0],c=i[1],r=0;l<0&&(r=-l),c>0&&c>r&&(r=c);var o=A.n(A.j).domain([r,-r]);return n||(n="100%"),Object(f.jsx)("div",{ref:t,style:{width:n,height:"15px",margin:"1px",border:"1px solid gainsboro",alignItems:"center",backgroundColor:o(a)},children:Object(f.jsx)("div",{style:{width:"100%",backgroundColor:o(a),height:"100%"}})})},ne=(n(324),["children"]),se=function(){var e=Object(s.useContext)(x),t=e.genesInfo,n=e.clusterData,a=e.selectedClusterSummary,i=e.setSelectedClusterSummary,l=e.selectedCluster,h=e.setSelectedCluster,u=e.setClusterRank,j=e.setReqGene,O=e.clusterColors,v=e.gene,g=e.setGene,y=e.selectedClusterIndex,w=e.customSelection,F=e.geneColSel,C=e.setGeneColSel,k=Object(s.useState)(null),S=Object(o.a)(k,2),D=S[0],E=S[1],T=Object(s.useState)(null),M=Object(o.a)(T,2),I=M[0],R=M[1],L=Object(s.useState)(null),B=Object(o.a)(L,2),P=B[0],_=B[1],q=Object(s.useState)(null),G=Object(o.a)(q,2),W=G[0],z=G[1],V=Object(s.useState)(null),H=Object(o.a)(V,2),U=H[0],Z=H[1],K=Object(s.useState)(null),X=Object(o.a)(K,2),Q=X[0],Y=X[1],se=Object(s.useState)(null),ae=Object(o.a)(se,2),ie=ae[0],le=ae[1],ce=Object(s.useState)(null),re=Object(o.a)(ce,2),oe=re[0],de=re[1],he=Object(s.useState)({}),ue=Object(o.a)(he,2),je=ue[0],be=ue[1],pe=Object(s.useState)(null),me=Object(o.a)(pe,2),Oe=me[0],fe=me[1],xe=A.j;Object(s.useEffect)((function(){if(!a)return a;var e=a;if(0===e.length)return e;var t=e.map((function(e){return null===e||void 0===e?void 0:e.mean})),n=A.g(t),s=0===n[1]?.01:n[1];z([parseFloat(n[0].toFixed(2)),parseFloat(s.toFixed(2))]);var i=e.map((function(e){return null===e||void 0===e?void 0:e.delta})),l=A.g(i),c=0===l[1]?.01:l[1];Z([parseFloat(l[0].toFixed(2)),parseFloat(c.toFixed(2))]);var o=e.map((function(e){return null===e||void 0===e?void 0:e.lfc})),d=A.g(o),h=0===d[1]?.01:d[1];Y([parseFloat(d[0].toFixed(2)),parseFloat(h.toFixed(2))]);var u=e.map((function(e){return null===e||void 0===e?void 0:e.detected})),j=A.g(u),b=0===j[1]?.01:j[1];le([parseFloat(j[0].toFixed(2)),parseFloat(b.toFixed(2))]),de({lfc:[parseFloat(d[0].toFixed(2)),parseFloat(h.toFixed(2))],mean:[parseFloat(n[0].toFixed(2)),parseFloat(s.toFixed(2))],detected:[parseFloat(j[0].toFixed(2)),parseFloat(b.toFixed(2))],delta:[parseFloat(l[0].toFixed(2)),parseFloat(c.toFixed(2))]});var p=Object(r.a)(e);be({lfc:(null===je||void 0===je?void 0:je.lfc)?null===je||void 0===je?void 0:je.lfc:[0,parseFloat(h.toFixed(2))],delta:(null===je||void 0===je?void 0:je.delta)?null===je||void 0===je?void 0:je.delta:[0,parseFloat(c.toFixed(2))],mean:(null===je||void 0===je?void 0:je.mean)?null===je||void 0===je?void 0:je.mean:[parseFloat(n[0].toFixed(2)),parseFloat(s.toFixed(2))],detected:(null===je||void 0===je?void 0:je.detected)?null===je||void 0===je?void 0:je.detected:[parseFloat(j[0].toFixed(2)),parseFloat(b.toFixed(2))]}),fe(p)}),[a]);var ve=Object(s.useMemo)((function(){if(!Oe)return[];var e=Oe;if(je){var n=function(t){var n=je[t];return n?n[0]===oe[t][0]&&n[1]===oe[t][1]?"continue":void(e=e.filter((function(e){return e[t]>=n[0]&&e[t]<=n[1]}))):"continue"};for(var s in je)n(s)}return P&&""!==P?e=e.filter((function(e){return-1!==t[F][e.gene].toLowerCase().indexOf(P.toLowerCase())})):e}),[Oe,P,je]);Object(s.useEffect)((function(){if(null===n||void 0===n?void 0:n.clusters){for(var e=Math.max.apply(Math,Object(r.a)(n.clusters)),t=[],s=0;s<e+1;s++)t.push(s+1);t=t.concat(Object.keys(w)),E(t),null===l&&h(0)}}),[n,w,l]),Object(s.useEffect)((function(){var e,t,s=[];String(l).startsWith("cs")?null===n||void 0===n||null===(e=n.clusters)||void 0===e||e.forEach((function(e,t){return w[l].includes(t)?s.push(1):s.push(0)})):null===n||void 0===n||null===(t=n.clusters)||void 0===t||t.forEach((function(e){return e===l?s.push(1):s.push(0)}));R(s)}),[l]);var ge=function(e,t){var n=Object(c.a)({},je);n[t]=e,be(n)},ye=function(e,t){if(e>0)return"linear-gradient(to right, yellow 0%, red 100%)";if(t<0)return"linear-gradient(to right, blue 0%, yellow 100%)";var n=0;e<0&&(n=-e),t>0&&t>n&&(n=t);var s=A.n(A.j).domain([n,-n]),a=s(e),i=s(t),l=Math.round(-e/(t-e)*100);return"linear-gradient(to right, ".concat(a," 0%, yellow ").concat(l,"%, ").concat(i," 100%)")};return Object(f.jsxs)("div",{className:"marker-container",children:[Object(f.jsx)(b.a,{popoverClassName:m.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"left",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(f.jsx)(d.d,{style:{width:"450px"},elevation:N.a.ZERO,children:Object(f.jsx)("p",{children:"This panel shows the marker genes that are upregulated in the cluster of interest compared to some or all of the other clusters. Hopefully, this allows us to assign some kind of biological meaning to each cluster based on the functions of the top markers. Several ranking schemes are available depending on how we choose to quantify the strength of the upregulation."})}),children:Object(f.jsx)(d.l,{style:{textDecoration:"underline",cursor:"help"},children:"Marker Genes"})}),D?Object(f.jsx)(d.n,{onChange:function(e){var t,n=null===(t=e.currentTarget)||void 0===t?void 0:t.value;n.startsWith("Cluster")?n=parseInt(n.replace("Cluster ",""))-1:n.startsWith("Custom")&&(n=n.replace("Custom Selection ","")),h(n),be({}),g(null)},children:D.map((function(e,t){return Object(f.jsxs)("option",{children:[String(e).startsWith("cs")?"Custom Selection":"Cluster"," ",e]},t)}))}):"",a?Object(f.jsxs)("div",{className:"marker-table",children:[Object(f.jsxs)("div",{className:"marker-header",children:[Object(f.jsx)(d.p,{leftIcon:"search",small:!0,placeholder:"Search gene...",type:"text",onChange:function(e){return _(e.target.value)}}),Object(f.jsxs)("span",{style:{textDecoration:"underline",cursor:"help"},children:[Object(f.jsx)(b.a,{popoverClassName:m.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"left",hoverOpenDelay:50,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(f.jsxs)(d.d,{style:{width:"450px"},elevation:N.a.ZERO,children:[Object(f.jsx)("p",{children:"Choose the effect size and summary statistic to use for ranking markers. For each gene, effect sizes are computed by pairwise comparisons between clusters:"}),Object(f.jsxs)("ul",{children:[Object(f.jsxs)("li",{children:[Object(f.jsx)("strong",{children:Object(f.jsx)("em",{children:"Cohen's d"})})," is the ratio of the log-fold change to the average standard deviation between two clusters."]}),Object(f.jsxs)("li",{children:["The area under the curve (",Object(f.jsx)("strong",{children:Object(f.jsx)("em",{children:"AUC"})}),") is the probability that a randomly chosen observation from one cluster is greater than a randomly chosen observation from another cluster."]}),Object(f.jsxs)("li",{children:["The log-fold change (",Object(f.jsx)("strong",{children:Object(f.jsx)("em",{children:"lfc"})}),") is the difference in the mean log-expression between two clusters."]}),Object(f.jsxs)("li",{children:["The ",Object(f.jsx)("strong",{children:Object(f.jsx)("em",{children:"\u0394-detected"})})," is the difference in the detected proportions between two clusters."]})]}),Object(f.jsx)("p",{children:"For each cluster, the effect sizes from the comparisons to all other clusters are summarized into a single statistic for ranking purposes:"}),Object(f.jsxs)("ul",{children:[Object(f.jsxs)("li",{children:[Object(f.jsx)("strong",{children:Object(f.jsx)("em",{children:"mean"})})," uses the mean effect sizes from all pairwise comparisons. This generally provides a good compromise between exclusitivity and robustness."]}),Object(f.jsxs)("li",{children:[Object(f.jsx)("strong",{children:Object(f.jsx)("em",{children:"min"})})," uses the minimum effect size from all pairwise comparisons. This promotes markers that are exclusively expressed in the chosen cluster, but will perform poorly if no such genes exist."]}),Object(f.jsxs)("li",{children:[Object(f.jsx)("strong",{children:Object(f.jsx)("em",{children:"min-rank"})})," ranks genes according to their best rank in each of the individual pairwise comparisons. This is the most robust as the combination of top-ranked genes will always be able to distinguish the chosen cluster from the other clusters, but may not give high rankings to exclusive genes."]})]})]}),children:Object(f.jsx)(d.o,{intent:"warning",icon:"sort",style:{paddingRight:"5px"}})}),Object(f.jsxs)(d.n,{onChange:function(e){u(e.currentTarget.value)},defaultValue:"cohen-min-rank",children:[Object(f.jsx)("option",{children:"cohen-min"}),Object(f.jsx)("option",{children:"cohen-mean"}),Object(f.jsx)("option",{children:"cohen-min-rank"}),Object(f.jsx)("option",{children:"auc-min"}),Object(f.jsx)("option",{children:"auc-mean"}),Object(f.jsx)("option",{children:"auc-min-rank"}),Object(f.jsx)("option",{children:"lfc-min"}),Object(f.jsx)("option",{children:"lfc-mean"}),Object(f.jsx)("option",{children:"lfc-min-rank"}),Object(f.jsx)("option",{children:"delta-d-min"}),Object(f.jsx)("option",{children:"delta-d-mean"}),Object(f.jsx)("option",{children:"delta-d-min-rank"})]})]})]}),Object(f.jsx)(J.a,{components:{Item:function(e){var t=e.children,n=Object(p.a)(e,ne);return Object(f.jsx)("div",Object(c.a)(Object(c.a)({className:"row-card"},n),{},{children:t}))},Header:function(){return Object(f.jsxs)("div",{className:"row-container row-header",children:[Object(f.jsx)("span",{children:Object(f.jsx)(d.n,{large:!1,minimal:!0,defaultValue:F,onChange:function(e,t){var n;return C(null===e||void 0===e||null===(n=e.currentTarget)||void 0===n?void 0:n.value)},children:Object.keys(t).map((function(e,t){return Object(f.jsx)("option",{children:e},t)}))})}),Object(f.jsx)(b.a,{popoverClassName:m.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:50,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(f.jsxs)(d.d,{style:{width:"250px"},elevation:N.a.ZERO,children:[Object(f.jsx)("p",{children:"Log-fold change in mean expression between cells inside and outside the cluster."}),Object(f.jsx)("p",{children:"Use the color scale below to apply a filter on this statistic."})]}),children:Object(f.jsx)("span",{style:{textDecoration:"underline",cursor:"help"},children:"Log-FC"})}),Object(f.jsx)(b.a,{popoverClassName:m.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:50,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(f.jsxs)(d.d,{style:{width:"250px"},elevation:N.a.ZERO,children:[Object(f.jsx)("p",{children:"Difference in the proportion of detected genes inside and outside the cluster."}),Object(f.jsx)("p",{children:"Use the color scale below to apply a filter on this statistic."})]}),children:Object(f.jsx)("span",{style:{textDecoration:"underline",cursor:"help"},children:"\u0394-detected"})}),Object(f.jsx)(b.a,{popoverClassName:m.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:50,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(f.jsx)(d.d,{style:{width:"250px"},elevation:N.a.ZERO,children:Object(f.jsx)("p",{children:"The intensity of color represents the mean expression of the gene in this cluster, while the length of the bar represents the percentage of cells in which any expression is detected."})}),children:Object(f.jsx)("span",{style:{textDecoration:"underline",cursor:"help"},children:"Expression"})})]})}},className:"marker-list",totalCount:ve.length,itemContent:function(e){var s=ve[e],c=s.expanded,o=s.expr;return Object(f.jsxs)("div",{children:[Object(f.jsxs)("div",{className:"row-container",children:[Object(f.jsx)("span",{style:{color:s.gene===v?String(l).startsWith("cs")?O[Math.max.apply(Math,Object(r.a)(null===n||void 0===n?void 0:n.clusters))+parseInt(l.replace("cs",""))]:O[l]:"black"},className:s.gene===v?"marker-gene-title-selected":"marker-gene-title",children:t[F][s.gene]}),Object(f.jsx)(b.a,{popoverClassName:m.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(f.jsx)(d.d,{elevation:N.a.ZERO,children:Object(f.jsxs)("table",{children:[Object(f.jsxs)("tr",{children:[Object(f.jsx)("td",{}),Object(f.jsx)("th",{scope:"col",children:t[F][s.gene]}),Object(f.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(f.jsxs)("tr",{children:[Object(f.jsx)("th",{scope:"row",children:"Log-FC"}),Object(f.jsx)("td",{children:s.lfc.toFixed(2)}),Object(f.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",Q[0].toFixed(2),", ",Q[1].toFixed(2),"]"]})]}),Object(f.jsxs)("tr",{children:[Object(f.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(f.jsx)("td",{children:s.delta.toFixed(2)}),Object(f.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",U[0].toFixed(2),", ",U[1].toFixed(2),"]"]})]}),Object(f.jsxs)("tr",{children:[Object(f.jsx)("th",{scope:"row",children:"Detected"}),Object(f.jsx)("td",{children:s.detected.toFixed(2)}),Object(f.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ie[0].toFixed(2),", ",ie[1].toFixed(2),"]"]})]}),Object(f.jsxs)("tr",{children:[Object(f.jsx)("th",{scope:"row",children:"Expression"}),Object(f.jsx)("td",{children:s.mean.toFixed(2)}),Object(f.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",W[0].toFixed(2),", ",W[1].toFixed(2),"]"]})]})]})}),children:Object(f.jsx)(te,{minmax:Q,colorscale:A.i,score:s.lfc})}),Object(f.jsx)(b.a,{popoverClassName:m.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(f.jsx)(d.d,{elevation:N.a.ZERO,children:Object(f.jsxs)("table",{children:[Object(f.jsxs)("tr",{children:[Object(f.jsx)("td",{}),Object(f.jsx)("th",{scope:"col",children:t[F][s.gene]}),Object(f.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(f.jsxs)("tr",{children:[Object(f.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(f.jsx)("td",{children:s.delta.toFixed(2)}),Object(f.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",U[0].toFixed(2),", ",U[1].toFixed(2),"]"]})]}),Object(f.jsxs)("tr",{children:[Object(f.jsx)("th",{scope:"row",children:"Detected"}),Object(f.jsx)("td",{children:s.detected.toFixed(2)}),Object(f.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ie[0].toFixed(2),", ",ie[1].toFixed(2),"]"]})]}),Object(f.jsxs)("tr",{children:[Object(f.jsx)("th",{scope:"row",children:"Log-FC"}),Object(f.jsx)("td",{children:s.lfc.toFixed(2)}),Object(f.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",Q[0].toFixed(2),", ",Q[1].toFixed(2),"]"]})]}),Object(f.jsxs)("tr",{children:[Object(f.jsx)("th",{scope:"row",children:"Expression"}),Object(f.jsx)("td",{children:s.mean.toFixed(2)}),Object(f.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",W[0].toFixed(2),", ",W[1].toFixed(2),"]"]})]})]})}),children:Object(f.jsx)(te,{minmax:U,colorscale:A.i,score:s.delta})}),Object(f.jsx)(b.a,{popoverClassName:m.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(f.jsx)(d.d,{elevation:N.a.ZERO,children:Object(f.jsxs)("table",{children:[Object(f.jsxs)("tr",{children:[Object(f.jsx)("td",{}),Object(f.jsx)("th",{scope:"col",children:t[F][s.gene]}),Object(f.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(f.jsxs)("tr",{children:[Object(f.jsx)("th",{scope:"row",children:"Expression"}),Object(f.jsx)("td",{children:s.mean.toFixed(2)}),Object(f.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",W[0].toFixed(2),", ",W[1].toFixed(2),"]"]})]}),Object(f.jsxs)("tr",{children:[Object(f.jsx)("th",{scope:"row",children:"Log-FC"}),Object(f.jsx)("td",{children:s.lfc.toFixed(2)}),Object(f.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",Q[0].toFixed(2),", ",Q[1].toFixed(2),"]"]})]}),Object(f.jsxs)("tr",{children:[Object(f.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(f.jsx)("td",{children:s.delta.toFixed(2)}),Object(f.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",U[0].toFixed(2),", ",U[1].toFixed(2),"]"]})]}),Object(f.jsxs)("tr",{children:[Object(f.jsx)("th",{scope:"row",children:"Detected"}),Object(f.jsx)("td",{children:s.detected.toFixed(2)}),Object(f.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ie[0].toFixed(2),", ",ie[1].toFixed(2),"]"]})]})]})}),children:Object(f.jsx)(ee,{minmax:W,colorscale:xe,score:s.mean,colorscore:s.detected})}),Object(f.jsxs)("div",{className:"row-action",children:[Object(f.jsx)(d.a,{icon:c?"minus":"plus",small:!0,fill:!1,className:"row-action",onClick:function(){var e=Object(r.a)(a),t=y[s.gene];e[t].expanded=!e[t].expanded,i(e),!o&&e[t].expanded?j(s.gene):j(null)}}),Object(f.jsx)(d.a,{small:!0,fill:!1,className:"row-action",onClick:function(){s.gene===v?g(null):(g(s.gene),o||j(s.gene))},children:Object(f.jsx)(d.o,{icon:"tint",color:s.gene===v?String(l).startsWith("cs")?O[Math.max.apply(Math,Object(r.a)(null===n||void 0===n?void 0:n.clusters))+parseInt(l.replace("cs",""))]:O[l]:""})})]})]}),Object(f.jsx)(d.e,{isOpen:c,children:o&&Object(f.jsx)($,{data:o,color:String(l).startsWith("cs")?O[Math.max.apply(Math,Object(r.a)(null===n||void 0===n?void 0:n.clusters))+parseInt(l.replace("cs",""))]:O[l],clusterlabel:String(l).startsWith("cs")?"Custom Selection ".concat(l):"Cluster ".concat(parseInt(l+1)),clusters:I})})]})}}),Object(f.jsxs)("div",{className:"marker-footer",children:[Object(f.jsx)(d.m,{children:Object(f.jsx)(b.a,{popoverClassName:m.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"left",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(f.jsxs)(d.d,{style:{width:"450px"},elevation:N.a.ZERO,children:[Object(f.jsxs)("p",{children:["Filter the set of marker genes according to various statistics. For example, this can be used to apply a minimum threshold on the ",Object(f.jsx)("strong",{children:Object(f.jsx)("em",{children:"log-fold change"})})," or ",Object(f.jsx)("strong",{children:Object(f.jsx)("em",{children:"\u0394-detected"})}),", to focus on genes with strong upregulation; or to apply a maximum threshold on the expression, to remove constitutively expressed genes."]}),Object(f.jsx)("p",{children:"Note that this does not change the relative ordering in the table above."})]}),children:Object(f.jsx)(d.I,{style:{textDecoration:"underline",cursor:"help"},children:"Filter Markers"})})}),Object(f.jsxs)("div",{className:"marker-filter-container",children:[Object(f.jsx)(d.H,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Log-FC"}),Q&&Object(f.jsxs)("div",{className:"marker-slider-container",children:[Object(f.jsxs)("div",{className:"marker-filter-gradient",children:[Object(f.jsx)("div",{style:{backgroundImage:ye(Q[0],Q[1]),width:"100%",height:"5px"}}),"\xa0"]}),Object(f.jsx)(d.C,{className:"marker-filter-slider",min:Q[0],max:Q[1],labelValues:Q,stepSize:parseFloat((Math.abs(Q[1]-Q[0])/20).toFixed(2)),onChange:function(e){return ge(e,"lfc")},value:null===je||void 0===je?void 0:je.lfc,vertical:!1})]})]}),Object(f.jsxs)("div",{className:"marker-filter-container",children:[Object(f.jsx)(d.H,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"\u0394-detected"}),U&&Object(f.jsxs)("div",{className:"marker-slider-container",children:[Object(f.jsxs)("div",{className:"marker-filter-gradient",children:[Object(f.jsx)("div",{style:{backgroundImage:ye(U[0],U[1]),width:"100%",height:"5px"}}),"\xa0"]}),Object(f.jsx)(d.C,{className:"marker-filter-slider",min:U[0],max:U[1],labelValues:U,stepSize:parseFloat((Math.abs(U[1]-U[0])/20).toFixed(2)),onChange:function(e){return ge(e,"delta")},value:null===je||void 0===je?void 0:je.delta,vertical:!1})]})]}),Object(f.jsxs)("div",{className:"marker-filter-container",children:[Object(f.jsx)(d.H,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Expression (mean)"}),W&&Object(f.jsxs)("div",{className:"marker-slider-container",children:[Object(f.jsxs)("div",{className:"marker-filter-gradient",children:[Object(f.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, #F5F8FA, #2965CC)",width:"100%",height:"5px"}}),"\xa0"]}),Object(f.jsx)(d.C,{className:"marker-filter-slider",min:W[0],max:W[1],labelValues:W,stepSize:parseFloat((Math.abs(W[1]-W[0])/20).toFixed(2)),onChange:function(e){return ge(e,"mean")},value:null===je||void 0===je?void 0:je.mean,vertical:!1})]})]}),Object(f.jsxs)("div",{className:"marker-filter-container",children:[Object(f.jsx)(d.H,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Expression (detected)"}),ie&&Object(f.jsx)("div",{className:"marker-slider-container",children:Object(f.jsx)(d.C,{className:"marker-filter-slider",min:ie[0],max:ie[1],labelValues:ie,stepSize:parseFloat((Math.abs(ie[1]-ie[0])/20).toFixed(2)),onChange:function(e){return ge(e,"detected")},value:null===je||void 0===je?void 0:je.detected,vertical:!1})})]})]})]}):""]})},ae=a.a.memo(se),ie=(n(325),n(326),function(){var e=Object(s.useRef)();return Object(s.useEffect)((function(){var t=e.current,n=0,s=1,a=2,i=3,l=4,c=[5,5,3,3,2],r=["#1abc9c","#2ecc71","#3498db","#e74c3c","#9b59b6"],o={new:function(e){return{width:18,height:18,x:this.canvas.width/2-9,y:this.canvas.height/2-9,moveX:n,moveY:n,speed:e||9}}},d={new:function(e){return{width:18,height:70,x:"left"===e?150:this.canvas.width-150,y:this.canvas.height/2-35,score:0,move:n,speed:10}}},h={initialize:function(){this.canvas=t.querySelector("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=1400,this.canvas.height=1e3,this.canvas.style.width=this.canvas.width/2+"px",this.canvas.style.height=this.canvas.height/2+"px",this.player=d.new.call(this,"left"),this.paddle=d.new.call(this,"right"),this.ball=o.new.call(this),this.paddle.speed=8,this.running=this.over=!1,this.turn=this.paddle,this.timer=this.round=0,this.color="#2c3e50",u.menu(),u.listen()},endGameMenu:function(e){u.context.font="50px Courier New",u.context.fillStyle=this.color,u.context.fillRect(u.canvas.width/2-350,u.canvas.height/2-48,700,100),u.context.fillStyle="#ffffff",u.context.fillText(e,u.canvas.width/2,u.canvas.height/2+15),setTimeout((function(){(u=Object.assign({},h)).initialize()}),3e3)},menu:function(){u.draw(),this.context.font="50px Courier New",this.context.fillStyle=this.color,this.context.fillRect(this.canvas.width/2-350,this.canvas.height/2-48,700,100),this.context.fillStyle="#ffffff",this.context.fillText("Press any key to begin",this.canvas.width/2,this.canvas.height/2+15)},update:function(){this.over||(this.ball.x<=0&&u._resetTurn.call(this,this.paddle,this.player),this.ball.x>=this.canvas.width-this.ball.width&&u._resetTurn.call(this,this.player,this.paddle),this.ball.y<=0&&(this.ball.moveY=a),this.ball.y>=this.canvas.height-this.ball.height&&(this.ball.moveY=s),this.player.move===s?this.player.y-=this.player.speed:this.player.move===a&&(this.player.y+=this.player.speed),u._turnDelayIsOver.call(this)&&this.turn&&(this.ball.moveX=this.turn===this.player?i:l,this.ball.moveY=[s,a][Math.round(Math.random())],this.ball.y=Math.floor(Math.random()*this.canvas.height-200)+200,this.turn=null),this.player.y<=0?this.player.y=0:this.player.y>=this.canvas.height-this.player.height&&(this.player.y=this.canvas.height-this.player.height),this.ball.moveY===s?this.ball.y-=this.ball.speed/1.5:this.ball.moveY===a&&(this.ball.y+=this.ball.speed/1.5),this.ball.moveX===i?this.ball.x-=this.ball.speed:this.ball.moveX===l&&(this.ball.x+=this.ball.speed),this.paddle.y>this.ball.y-this.paddle.height/2&&(this.ball.moveX===l?this.paddle.y-=this.paddle.speed/1.5:this.paddle.y-=this.paddle.speed/4),this.paddle.y<this.ball.y-this.paddle.height/2&&(this.ball.moveX===l?this.paddle.y+=this.paddle.speed/1.5:this.paddle.y+=this.paddle.speed/4),this.paddle.y>=this.canvas.height-this.paddle.height?this.paddle.y=this.canvas.height-this.paddle.height:this.paddle.y<=0&&(this.paddle.y=0),this.ball.x-this.ball.width<=this.player.x&&this.ball.x>=this.player.x-this.player.width&&this.ball.y<=this.player.y+this.player.height&&this.ball.y+this.ball.height>=this.player.y&&(this.ball.x=this.player.x+this.ball.width,this.ball.moveX=l),this.ball.x-this.ball.width<=this.paddle.x&&this.ball.x>=this.paddle.x-this.paddle.width&&this.ball.y<=this.paddle.y+this.paddle.height&&this.ball.y+this.ball.height>=this.paddle.y&&(this.ball.x=this.paddle.x-this.ball.width,this.ball.moveX=i)),this.player.score===c[this.round]?c[this.round+1]?(this.color=this._generateRoundColor(),this.player.score=this.paddle.score=0,this.player.speed+=.5,this.paddle.speed+=1,this.ball.speed+=1,this.round+=1):(this.over=!0,setTimeout((function(){u.endGameMenu("Winner!")}),1e3)):this.paddle.score===c[this.round]&&(this.over=!0,setTimeout((function(){u.endGameMenu("Game Over!")}),1e3))},draw:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.color,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle="#ffffff",this.context.fillRect(this.player.x,this.player.y,this.player.width,this.player.height),this.context.fillRect(this.paddle.x,this.paddle.y,this.paddle.width,this.paddle.height),u._turnDelayIsOver.call(this)&&this.context.fillRect(this.ball.x,this.ball.y,this.ball.width,this.ball.height),this.context.beginPath(),this.context.setLineDash([7,15]),this.context.moveTo(this.canvas.width/2,this.canvas.height-140),this.context.lineTo(this.canvas.width/2,140),this.context.lineWidth=10,this.context.strokeStyle="#ffffff",this.context.stroke(),this.context.font="100px Courier New",this.context.textAlign="center",this.context.fillText(this.player.score.toString(),this.canvas.width/2-300,200),this.context.fillText(this.paddle.score.toString(),this.canvas.width/2+300,200),this.context.font="30px Courier New",this.context.fillText("Round "+(u.round+1),this.canvas.width/2,35),this.context.font="40px Courier",this.context.fillText(c[u.round]?c[u.round]:c[u.round-1],this.canvas.width/2,100)},loop:function(){u.update(),u.draw(),u.over||requestAnimationFrame(u.loop)},listen:function(){document.addEventListener("keydown",(function(e){!1===u.running&&(u.running=!0,window.requestAnimationFrame(u.loop)),38!==e.keyCode&&87!==e.keyCode||(u.player.move=s),40!==e.keyCode&&83!==e.keyCode||(u.player.move=a)})),document.addEventListener("keyup",(function(e){u.player.move=n}))},_resetTurn:function(e,t){this.ball=o.new.call(this,this.ball.speed),this.turn=t,this.timer=(new Date).getTime(),e.score++},_turnDelayIsOver:function(){return(new Date).getTime()-this.timer>=1e3},_generateRoundColor:function(){var e=r[Math.floor(Math.random()*r.length)];return e===this.color?u._generateRoundColor():e}},u=Object.assign({},h);u.initialize()}),[]),Object(f.jsxs)("div",{ref:e,className:"pong-container",children:[Object(f.jsx)("canvas",{}),Object(f.jsxs)("p",{className:"credit",children:["Game Credits ",Object(f.jsx)("a",{href:"https://codepen.io/gdube/pen/JybxxZ",target:"_blank",children:"Pong Game"})]})]})}),le=(n(327),function(){return Object(f.jsx)("div",{className:"dots-bars-5"})});function ce(){var e=Object(s.useState)(!0),t=Object(o.a)(e,2),n=t[0],a=t[1],i=Object(s.useState)(null),l=Object(o.a)(i,2),h=l[0],u=l[1],j=Object(s.useContext)(x),b=j.setWasmInitialized,p=j.setTsneData,m=j.setRedDims,O=j.redDims,v=j.setGenesInfo,g=j.setInitDims,y=j.setQcDims,w=j.defaultRedDims,F=j.setDefaultRedDims,C=j.setQcData,N=j.qcData,k=j.setClusterData,S=j.setFSelectionData,D=j.setUmapData,A=j.setPcaVarExp,T=j.logs,M=j.setLogs,I=j.selectedCluster,R=j.clusterRank,L=j.selectedClusterSummary,B=j.setSelectedClusterSummary,P=j.selectedClusterIndex,_=j.setSelectedClusterIndex,q=j.reqGene,G=j.customSelection,W=j.clusterData,z=j.delCustomSelection,V=j.setDelCustomSelection,Z=j.setReqGene,K=j.setSelectedCluster,X=j.setShowGame,Q=j.showGame,J=j.datasetName,$=j.setExportState,ee=j.setShowAnimation,te=j.triggerAnimation,ne=j.setTriggerAnimation,se=j.params,ce=j.setGeneColSel,re=j.setKanaIDBRecs,oe=j.setLoadParams,de=j.setInitLoadState,he=j.setIndexedDBState,ue=j.setClusterColors,je={1:["#1b9e77"],2:["#1b9e77","#d95f02"],3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]};return Object(s.useEffect)((function(){window.scranWorker.postMessage({type:"INIT",msg:"Initial Load"})}),[]),Object(s.useEffect)((function(){if(null!==I){var e=String(I).startsWith("cs")?"getMarkersForSelection":"getMarkersForCluster";window.scranWorker.postMessage({type:e,payload:{cluster:I,rank_type:R}})}}),[I,R]),Object(s.useEffect)((function(){if(null!==G&&Object.keys(G).length>0){var e="cs".concat(Object.keys(G).length),t=G[e];window.scranWorker.postMessage({type:"computeCustomMarkers",payload:{selection:t,id:e}})}}),[G]),Object(s.useEffect)((function(){null!==z&&(window.scranWorker.postMessage({type:"removeCustomMarkers",payload:{id:z}}),V(null))}),[z]),Object(s.useEffect)((function(){null!==q&&window.scranWorker.postMessage({type:"getGeneExpression",payload:{gene:q}})}),[q]),Object(s.useEffect)((function(){te&&w&&window.scranWorker.postMessage({type:"animate"+w,payload:{params:se[w.toLowerCase()]}})}),[te]),window.scranWorker.onmessage=function(e){var t=e.data;if(null===t||void 0===t?void 0:t.msg){var n=Object(r.a)(T),s=new Date;n.push("".concat(s.getHours()+":"+s.getMinutes()+":"+s.getSeconds()," - ").concat(null===t||void 0===t?void 0:t.type," - ").concat(null===t||void 0===t?void 0:t.msg)),M(n)}if("INIT"===t.type)a(!1),b(!0);else if("KanaDB_store"===t.type){var i=t.resp;void 0!==i&&re(i),he(!1)}else if("inputs_DATA"===t.type)g("".concat(t.resp.dimensions.num_genes," genes, ").concat(t.resp.dimensions.num_cells," cells")),v(t.resp.genes),ce(Object.keys(t.resp.genes)[0]);else if("quality_control_metrics_DATA"===t.type){var l=t.resp;C(l)}else if("quality_control_thresholds_DATA"===t.type){var o=t.resp,d=Object(c.a)({},N);d.thresholds=o,C(d)}else if("quality_control_filtered_DATA"===t.type)y("".concat(t.resp.retained));else if("feature_selection_DATA"===t.type){var h=t.resp;S(h)}else if("pca_DATA"===t.type){var j=t.resp;A(j)}else if("snn_cluster_graph_DATA"===t.type){var f=t.resp,x=Math.max.apply(Math,Object(r.a)(null===f||void 0===f?void 0:f.clusters))+1;G&&(x+=Object.keys(G).length);var E=null;E=x>Object.keys(je).length?Object(U.randomColor)({luminosity:"dark",count:x+1}):je[x.toString()],ue(E),k(f),K(0)}else if("tsne_DATA"===t.type){var I=t.resp;p(I);var R=Object(r.a)(O);R.push("TSNE"),w||F("TSNE"),m(R),X(!1),ee(!1),ne(!1)}else if("tsne_iter"===t.type||"umap_iter"===t.type){var q=t.resp;u(q)}else if("umap_DATA"===t.type){var W=t.resp;D(W);var z=Object(r.a)(O);z.push("UMAP"),m(z),ee(!1),ne(!1)}else if("markerGene_DATA"===t.type);else if("setMarkersForCluster"===t.type||"setMarkersForCustomSelection"===t.type){var V=t.resp,H=[],Q=Array(V.ordering.length);V.means.forEach((function(e,t){var n,s,a,i;Q[V.ordering[t]]=t,H.push({gene:null===V||void 0===V||null===(n=V.ordering)||void 0===n?void 0:n[t],mean:parseFloat(e.toFixed(2)),delta:parseFloat(null===V||void 0===V||null===(s=V.delta_detected)||void 0===s?void 0:s[t].toFixed(2)),lfc:parseFloat(null===V||void 0===V||null===(a=V.lfc)||void 0===a?void 0:a[t].toFixed(2)),detected:parseFloat(null===V||void 0===V||null===(i=V.detected)||void 0===i?void 0:i[t].toFixed(2)),expanded:!1,expr:null})})),_(Q),B(H)}else if("setGeneExpression"===t.type){var Y=t.resp,te=Object(r.a)(L);te[P[Y.gene]].expr=Object.values(Y.expr),B(te),Z(null)}else if("exportState"===t.type){var se=t.resp,ae=document.createElement("a"),ie=new Blob([se],{type:"text/plain"});ae.href=URL.createObjectURL(ie),ae.download=J.split(" ").join("_")+".kana",ae.click(),$(!1)}else if("KanaDB"===t.type)he(!1);else if("loadedParameters"===t.type){var le=t.resp;oe(le.params),setTimeout((function(){de(!1)}),1e3)}},Object(f.jsxs)("div",{className:"App",children:[Object(f.jsx)(E,{}),Object(f.jsxs)("div",{className:"App-content",children:[Object(f.jsx)("div",{className:"plot",children:w&&W?Object(f.jsx)(Y,{animateData:h}):Q?Object(f.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:"50px"},children:[Object(f.jsx)(d.q,{children:"Get some coffee or play pong while you wait for the analysis to finish.."}),Object(f.jsx)(d.a,{onClick:function(){X(!1)},children:"I'm good, go back"}),Object(f.jsx)(ie,{})]}):Object(f.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:"50px"},children:[Object(f.jsx)(le,{}),Object(f.jsx)(d.q,{children:"Get some coffee or play pong while you wait for the analysis to finish.."}),Object(f.jsx)(d.a,{onClick:function(){X(!0)},children:"Play Pong"})]})}),Object(f.jsx)("div",{className:"marker",children:W?Object(f.jsx)(ae,{}):Object(f.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[Object(f.jsx)(le,{}),Object(f.jsx)(d.q,{children:"Generating nearest neighbor graph to compute clusters...."})]})}),Object(f.jsx)("div",{className:"analysis",children:Object(f.jsx)(H,{})})]}),Object(f.jsx)(d.y,Object(c.a)(Object(c.a)({isOpen:n},{autoFocus:!0,canEscapeKeyClose:!1,canOutsideClickClose:!1,enforceFocus:!0,hasBackdrop:!0,usePortal:!0,useTallContent:!1}),{},{children:Object(f.jsxs)("div",{className:"spinner",children:[Object(f.jsx)(d.D,{size:100}),Object(f.jsx)("p",{children:"Initializing kana"})]})}))]})}var re=a.a.memo(ce),oe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,337)).then((function(t){var n=t.getCLS,s=t.getFID,a=t.getFCP,i=t.getLCP,l=t.getTTFB;n(e),s(e),a(e),i(e),l(e)}))};l.a.render(Object(f.jsx)(g,{children:Object(f.jsx)(re,{})}),document.getElementById("root")),oe()}},[[328,1,2]]]);
//# sourceMappingURL=main.0f2600bd.chunk.js.map