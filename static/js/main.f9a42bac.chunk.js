(this["webpackJsonpscran.js"]=this["webpackJsonpscran.js"]||[]).push([[0],{288:function(e,t,a){},289:function(e,t,a){},291:function(e,t,a){},318:function(e,t,a){},319:function(e,t,a){},331:function(e,t,a){},332:function(e,t,a){},333:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a(24),r=a.n(c),l=(a(288),a(9)),s=a(25),i=a(5),o=(a(289),a(341)),d=a(45),u=a(56),j=a(3),b=a(19),h=a(340),O=a(1),m=Object(n.createContext)(null),f=function(e){var t=e.children,a=Object(n.useState)({gene:null,mtx:null,barcode:null}),c=Object(i.a)(a,2),r=c[0],l=c[1],s=Object(n.useState)({qc:{"qc-nmads":3},fSelection:{"fsel-span":.3},pca:{"pca-npc":5},cluster:{"clus-k":10,"clus-res":.5,"clus-scheme":0},tsne:{"tsne-iter":500,"tsne-perp":30},umap:{"umap-nn":15,"umap-epochs":500,"umap-min_dist":.01,"umap-approx_nn":!0},markerGene:{}}),o=Object(i.a)(s,2),d=o[0],u=o[1],j=Object(n.useState)(!1),b=Object(i.a)(j,2),h=b[0],f=b[1],p=Object(n.useState)(null),v=Object(i.a)(p,2),x=v[0],g=v[1],F=Object(n.useState)(null),C=Object(i.a)(F,2),y=C[0],D=C[1],N=Object(n.useState)(null),A=Object(i.a)(N,2),w=A[0],S=A[1],k=Object(n.useState)(null),E=Object(i.a)(k,2),B=E[0],M=E[1],T=Object(n.useState)(null),R=Object(i.a)(T,2),I=R[0],_=R[1],z=Object(n.useState)(null),q=Object(i.a)(z,2),P=q[0],L=q[1],G=Object(n.useState)(null),U=Object(i.a)(G,2),V=U[0],H=U[1],W=Object(n.useState)([]),Q=Object(i.a)(W,2),J=Q[0],K=Q[1],X=Object(n.useState)(null),Y=Object(i.a)(X,2),$=Y[0],Z=Y[1],ee=Object(n.useState)(null),te=Object(i.a)(ee,2),ae=te[0],ne=te[1],ce=Object(n.useState)(null),re=Object(i.a)(ce,2),le=re[0],se=re[1],ie=Object(n.useState)(null),oe=Object(i.a)(ie,2),de=oe[0],ue=oe[1],je=Object(n.useState)({}),be=Object(i.a)(je,2),he=be[0],Oe=be[1],me=Object(n.useState)(null),fe=Object(i.a)(me,2),pe=fe[0],ve=fe[1],xe=Object(n.useState)(null),ge=Object(i.a)(xe,2),Fe=ge[0],Ce=ge[1],ye=Object(n.useState)(null),De=Object(i.a)(ye,2),Ne=De[0],Ae=De[1],we=Object(n.useState)(null),Se=Object(i.a)(we,2),ke=Se[0],Ee=Se[1],Be=Object(n.useState)(null),Me=Object(i.a)(Be,2),Te=Me[0],Re=Me[1],Ie=Object(n.useState)(null),_e=Object(i.a)(Ie,2),ze=_e[0],qe=_e[1],Pe=Object(n.useState)(null),Le=Object(i.a)(Pe,2),Ge=Le[0],Ue=Le[1],Ve=Object(n.useState)(null),He=Object(i.a)(Ve,2),We=He[0],Qe=He[1],Je=Object(n.useState)([]),Ke=Object(i.a)(Je,2),Xe=Ke[0],Ye=Ke[1];return Object(n.useEffect)((function(){h&&null!=r.mtx&&window.Worker.postMessage({type:"RUN",payload:{files:[r.mtx,r.barcode?r.barcode[0]:[],r.gene?r.gene[0]:[]],params:d},msg:"not much to pass"})}),[r,d,h]),Object(O.jsx)(m.Provider,{value:{inputFiles:r,setInputFiles:l,params:d,setParams:u,error:x,setError:g,wasmInitialized:h,setWasmInitialized:f,pcaData:Ne,setPcaData:Ae,pcaVarExp:ke,setPcaVarExp:Ee,tsneData:Te,setTsneData:Re,umapData:ze,setUmapData:qe,initDims:y,setInitDims:D,qcDims:w,setQcDims:S,qcData:I,setQcData:_,qcThreshold:P,setQcThreshold:L,fSelDims:B,setFSelDims:M,redDims:J,setRedDims:K,defaultRedDims:$,setDefaultRedDims:Z,plotRedDims:ae,setPlotRedDims:ne,clusterData:le,setClusterData:se,fSelectionData:V,setFSelectionData:H,logs:Xe,setLogs:Ye,selectedCluster:de,setSelectedCluster:ue,selectedClusterSummary:he,setSelectedClusterSummary:Oe,clusterRank:Fe,setClusterRank:Ce,gene:Ge,setGene:Ue,clusterColors:pe,setClusterColors:ve,reqGene:We,setReqGene:Qe},children:t})},p=(a(291),["buttonText","includeFooter"]);var v=function(e){var t=e.buttonText,a=e.includeFooter,c=Object(u.a)(e,p),r=Object(n.useState)(!1),s=Object(i.a)(r,2),d=s[0],f=s[1],v=Object(n.useCallback)((function(){return f(!d)}),[d]),x=Object(n.useCallback)((function(){return f(!1)}),[]),g=Object(n.useContext)(m),F=g.inputFiles,C=g.setInputFiles,y=g.params,D=g.setParams,N=Object(n.useState)(F),A=Object(i.a)(N,2),w=A[0],S=A[1],k=Object(n.useState)(y),E=Object(i.a)(k,2),B=E[0],M=E[1],T=Object(n.useState)({mtx:"Choose mtx file...",gene:"Choose gene file...",barcode:"Choose barcode file..."}),R=Object(i.a)(T,2),I=R[0],_=R[1];return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(o.a,{onClick:v,icon:"social-media",intent:"primary",text:t}),Object(O.jsxs)(o.g,Object(l.a)(Object(l.a)({className:"analysis-dialog"},c),{},{isOpen:d,onClose:x,children:[Object(O.jsxs)("div",{className:j.a.DIALOG_BODY,children:[Object(O.jsx)("div",{className:"col",children:Object(O.jsxs)("div",{children:[Object(O.jsxs)(o.j,{children:[Object(O.jsx)(o.y,{large:!0,round:!0,children:"1"})," Import Single cell dataset"]}),Object(O.jsxs)("div",{className:"row",children:[Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Choose mtx file"}),Object(O.jsx)(o.i,{text:null===I||void 0===I?void 0:I.mtx,onInputChange:function(e){_(Object(l.a)(Object(l.a)({},I),{},{mtx:e.target.files[0].name})),S(Object(l.a)(Object(l.a)({},w),{},{mtx:e.target.files}))}})]}),Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Choose gene file"}),Object(O.jsx)(o.i,{text:null===I||void 0===I?void 0:I.gene,onInputChange:function(e){_(Object(l.a)(Object(l.a)({},I),{},{gene:e.target.files[0].name})),S(Object(l.a)(Object(l.a)({},w),{},{gene:e.target.files}))}})]}),Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Choose barcode file"}),Object(O.jsx)(o.i,{text:null===I||void 0===I?void 0:I.barcode,onInputChange:function(e){_(Object(l.a)(Object(l.a)({},I),{},{barcode:e.target.files[0].name})),S(Object(l.a)(Object(l.a)({},w),{},{barcode:e.target.files}))}})]})]})]})}),Object(O.jsx)("div",{className:"col",children:Object(O.jsxs)("div",{children:[Object(O.jsxs)(o.j,{children:[Object(O.jsx)(o.y,{large:!0,round:!0,children:"2"})," QC: Generate per cell QC metrics and filter cells"]}),Object(O.jsx)("div",{className:"row",children:Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsxs)(o.z,{className:"text-100",children:["NMADS",Object(O.jsx)(h.a,{className:"row-tooltip",content:"Number of MADs from the median, to use for defining outliers.(defaults to 3)",position:b.a.RIGHT,openOnTargetFocus:!1,children:Object(O.jsx)(o.m,{icon:"help"})})]}),Object(O.jsx)(o.t,{placeholder:"3",value:B.qc["qc-nmads"],onValueChange:function(e,t){M(Object(l.a)(Object(l.a)({},B),{},{qc:{"qc-nmads":e}}))}})]})})]})}),Object(O.jsx)("div",{className:"col",children:Object(O.jsxs)("div",{children:[Object(O.jsxs)(o.j,{children:[Object(O.jsx)(o.y,{large:!0,round:!0,children:"3"})," Feature Selection: Model the variance of the log-expression values for each gene, accounting for the mean-variance trend"]}),Object(O.jsx)("div",{className:"row",children:Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsxs)(o.z,{className:"text-100",children:["Span factor",Object(O.jsx)(h.a,{className:"row-tooltip",content:"The span of the LOWESS smoother for fitting the mean-variance trend.(defaults to 0.3)",position:b.a.RIGHT,openOnTargetFocus:!1,children:Object(O.jsx)(o.m,{icon:"help"})})]}),Object(O.jsx)(o.t,{placeholder:"0.3",value:B.fSelection["fsel-span"],onValueChange:function(e,t){M(Object(l.a)(Object(l.a)({},B),{},{fSelection:{"fsel-span":e}}))}})]})})]})}),Object(O.jsx)("div",{className:"col",children:Object(O.jsxs)("div",{children:[Object(O.jsxs)(o.j,{children:[Object(O.jsx)(o.y,{large:!0,round:!0,children:"4"})," PCA: Perform a principal components analysis to obtain per-cell coordinates in low-dimensional space"]}),Object(O.jsx)("div",{className:"row",children:Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"# of PCs (defaults to 5)"}),Object(O.jsx)(o.t,{placeholder:"5",value:B.pca["pca-npc"],onValueChange:function(e,t){M(Object(l.a)(Object(l.a)({},B),{},{pca:{"pca-npc":e}}))}})]})})]})}),Object(O.jsx)("div",{className:"col",children:Object(O.jsxs)("div",{children:[Object(O.jsxs)(o.j,{children:[Object(O.jsx)(o.y,{large:!0,round:!0,children:"5"})," Cluster Analysis: Generate SNN graph and cluster cells"]}),Object(O.jsxs)("div",{className:"row",children:[Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsxs)(o.z,{className:"text-100",children:["# of neighbors",Object(O.jsx)(h.a,{className:"row-tooltip",content:"Number of neighbors to use to construct the nearest neighbor graph.(defaults to 10)",position:b.a.RIGHT,openOnTargetFocus:!1,children:Object(O.jsx)(o.m,{icon:"help"})})]}),Object(O.jsx)(o.t,{placeholder:"10",value:B.cluster["clus-k"],onValueChange:function(e,t){M(Object(l.a)(Object(l.a)({},B),{},{cluster:{"clus-k":e}}))}})]}),Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsxs)(o.z,{className:"text-100",children:["Scheme",Object(O.jsx)(h.a,{className:"row-tooltip",content:"0 for approx, 1 ..., 2 for jaccard index",position:b.a.RIGHT,openOnTargetFocus:!1,children:Object(O.jsx)(o.m,{icon:"help"})})]}),Object(O.jsxs)(o.l,{onChange:function(e,t){var a;return M(Object(l.a)(Object(l.a)({},B),{},{cluster:{"clus-scheme":parseInt(null===e||void 0===e||null===(a=e.currentTarget)||void 0===a?void 0:a.value)}}))},children:[Object(O.jsx)("option",{children:"0"},"0"),Object(O.jsx)("option",{children:"1"},"1"),Object(O.jsx)("option",{children:"2"},"2")]})]}),Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsxs)(o.z,{className:"text-100",children:["Resolution",Object(O.jsx)(h.a,{className:"row-tooltip",content:"Resolution of the multi-level clustering, used in the modularity calculation.Larger values yield more fine-grained clusters.(defaults to 0.5)",position:b.a.RIGHT,openOnTargetFocus:!1,children:Object(O.jsx)(o.m,{icon:"help"})})]}),Object(O.jsx)(o.t,{placeholder:"0.5",value:B.cluster["clus-res"],onValueChange:function(e,t){M(Object(l.a)(Object(l.a)({},B),{},{cluster:{"clus-res":e}}))}})]})]})]})}),Object(O.jsx)("div",{className:"col",children:Object(O.jsxs)("div",{children:[Object(O.jsxs)(o.j,{children:[Object(O.jsx)(o.y,{large:!0,round:!0,children:"6"})," t-SNE: Compute t-SNE embeddings and Visualize cells"]}),Object(O.jsxs)("div",{className:"row",children:[Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Iterations (defaults to 500)"}),Object(O.jsx)(o.t,{placeholder:"500",value:B.tsne["tsne-iter"],onValueChange:function(e,t){M(Object(l.a)(Object(l.a)({},B),{},{tsne:{"tsne-iter":e}}))}})]}),Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Perplexity (defaults to 30)"}),Object(O.jsx)(o.t,{placeholder:"30",value:B.tsne["tsne-perp"],onValueChange:function(e,t){M(Object(l.a)(Object(l.a)({},B),{},{tsne:{"tsne-perp":e}}))}})]})]})]})}),Object(O.jsx)("div",{className:"col",children:Object(O.jsxs)("div",{children:[Object(O.jsxs)(o.j,{children:[Object(O.jsx)(o.y,{large:!0,round:!0,children:"6"})," UMAP: Compute UMAP embeddings and Visualize cells"]}),Object(O.jsxs)("div",{className:"row",children:[Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Num of Neighbors (defaults to 15)"}),Object(O.jsx)(o.t,{placeholder:"15",value:B.umap["umap-nn"],onValueChange:function(e,t){M(Object(l.a)(Object(l.a)({},B),{},{umap:{"umap-nn":e}}))}})]}),Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Epochs (defaults to 500)"}),Object(O.jsx)(o.t,{placeholder:"500",value:B.umap["umap-epoch"],onValueChange:function(e,t){M(Object(l.a)(Object(l.a)({},B),{},{umap:{"umap-epoch":e}}))}})]}),Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Min Distance (defaults to 0.01)"}),Object(O.jsx)(o.t,{placeholder:"0.01",value:B.umap["umap-min_dist"],onValueChange:function(e,t){M(Object(l.a)(Object(l.a)({},B),{},{umap:{"umap-min_dist":e}}))}})]}),Object(O.jsxs)(o.o,{className:"row-input",children:[Object(O.jsx)(o.z,{className:"text-100",children:"Use Approximate Neighbor Search ? (true for fast UMAP calculation))"}),Object(O.jsx)(o.t,{placeholder:"0.01",value:B.umap["umap-approx_nn"],onValueChange:function(e,t){M(Object(l.a)(Object(l.a)({},B),{},{umap:{"umap-approx_nn":e}}))}})]})]})]})})]}),a?Object(O.jsx)("div",{className:j.a.DIALOG_FOOTER,children:Object(O.jsx)("div",{className:j.a.DIALOG_FOOTER_ACTIONS,children:Object(O.jsx)(h.a,{content:"Run Analysis",children:Object(O.jsx)(o.a,{icon:"function",onClick:function(){D(B),C(w),x()},children:"Analyze"})})})}):Object(O.jsx)("div",{style:{margin:"0 20px"}})]}))]})},x=function(){var e=Object(n.useContext)(m),t=e.initDims,a=e.qcDims;return Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("span",{children:["Dataset Dims: ",t,a?" (After QC: ".concat(a,")"):" (After QC: ??? X ???)"]})})},g=function(){var e=Object(n.useContext)(m).logs,t=Object(n.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!0,enforceFocus:!0,hasBackdrop:!0,isOpen:!1,position:b.a.RIGHT,size:void 0,usePortal:!0}),a=Object(i.a)(t,2),c=a[0],r=a[1];return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(o.a,{onClick:function(){return r({isOpen:!0})},icon:"wrench",outlined:!0,intent:"warning",children:"What's happening ?"}),Object(O.jsx)(o.h,Object(l.a)(Object(l.a)({icon:"info-sign",onClose:function(){return r({isOpen:!1})},title:"What's happening ?"},c),{},{children:Object(O.jsx)("div",{className:j.a.DRAWER_BODY,children:Object(O.jsx)("div",{className:j.a.DIALOG_BODY,children:Object(O.jsx)("ul",{className:"list",children:e.map((function(e,t){return Object(O.jsx)("li",{children:e},t)}))})})})}))]})},F=function(){var e=Object(n.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!0,enforceFocus:!0,shouldReturnFocusOnClose:!0}),t=Object(i.a)(e,1)[0];return Object(O.jsx)(O.Fragment,{children:Object(O.jsx)(o.p,{className:"bp3-dark",children:Object(O.jsxs)(o.r,{align:d.a.LEFT,children:[Object(O.jsx)(o.s,{children:"SCRAN.JS"}),Object(O.jsx)(o.q,{}),Object(O.jsx)("span",{children:"Analyze Single-cell RNA-seq Datasets"}),Object(O.jsx)(o.q,{}),Object(O.jsx)(v,Object(l.a)({icon:"document",title:"Import dataset and update parameters",buttonText:"Start Analysis",includeFooter:!0},t)),Object(O.jsx)(o.q,{}),Object(O.jsx)(x,{}),Object(O.jsx)(o.q,{}),Object(O.jsx)(g,{})]})})})},C=a(12),y=function(e){var t=Object(n.useRef)();return Object(n.useEffect)((function(){var a=null===e||void 0===e?void 0:e.data,n=null===e||void 0===e?void 0:e.width,c=null===e||void 0===e?void 0:e.color,r=null===e||void 0===e?void 0:e.ymax;if(r||(r=Math.max.apply(Math,Object(s.a)(a.map((function(e){return e.value}))))),n||(n=325),c||(c="#00B3A4"),!a)return"";var l=t.current;l.innerHTML="";var i=10,o=30,d=30,u=40,j=n-u-o,b=200-i-d,h=C.n(l).append("svg").attr("width",j+u+o).attr("height",b+i+d).append("g").attr("transform","translate(".concat(u,",").concat(i,")")),O=C.k().range([0,j]).domain(a.map((function(e){return e.key}))).padding(.2);h.append("g").attr("transform","translate(0,"+b+")").call(C.b(O)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");var m=C.l().domain([0,r]).range([b,0]);h.append("g").call(C.c(m)),h.selectAll("bars").data(a).enter().append("rect").attr("x",(function(e){return O(e.key)})).attr("y",(function(e){return m(e.value)})).attr("width",O.bandwidth()).attr("height",(function(e){return b-m(e.value)})).attr("fill",(function(e,t){return Array.isArray(c)?c[t]:c}))}),[]),Object(O.jsx)("div",{ref:t})},D=function(e){var t,a,n=null===e||void 0===e||null===(t=e.pca)||void 0===t?void 0:t.var_exp;if(!n)return"";var c=[];return null===(a=Object.values(n))||void 0===a||a.forEach((function(e,t){c.push({key:t+1,value:100*e})})),Object(O.jsx)(y,{data:c})},N=a(128),A=function(e){var t,a,c=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.clusters,r=Object(n.useContext)(m).setClusterColors,l=Object(n.useState)(null),s=Object(i.a)(l,2),o=s[0],d=s[1];if(Object(n.useEffect)((function(){var e=Object.keys(j).length,t=null;t=e>Object.keys(u).length?Object(N.randomColor)({luminosity:"dark",count:e+1}):u[e.toString()],d(t)}),[]),Object(n.useEffect)((function(){r(o)}),[o]),!c)return"";for(var u={1:["#1b9e77"],2:["#1b9e77","#d95f02"],3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},j={},b=0;b<(null===c||void 0===c?void 0:c.length);b++){var h=c[b];"CLUS_"+h in j?j["CLUS_"+h]++:j["CLUS_"+h]=0}var f=[];return null===(a=Object.values(j))||void 0===a||a.forEach((function(e,t){f.push({key:t+1,value:e})})),o&&Object(O.jsx)(y,{data:f,color:o})},w=a(33),S=function(e){var t=Object(n.useRef)();return Object(n.useEffect)((function(){var a=null===e||void 0===e?void 0:e.rdata,n=null===e||void 0===e?void 0:e.width,c=null===e||void 0===e?void 0:e.color;if(n||(n=275),c||(c="#00B3A4"),!a)return"";var r=t.current;r.innerHTML="";var l=10,s=30,i=30,o=40,d=n-o-s,u=200-l-i,j=C.n(r).append("svg").attr("width",d+o+s).attr("height",u+l+i).append("g").attr("transform","translate(".concat(o,",").concat(l,")")),b=C.l().domain(null===e||void 0===e?void 0:e.range).range([u,0]).nice();j.append("g").call(C.c(b));var h=C.k().range([0,d]).domain([null===e||void 0===e?void 0:e.label]).padding(.05);j.append("g").attr("transform","translate(0,"+u+")").call(C.b(h));var O=C.f().domain(b.domain()).thresholds(b.ticks(20)).value((function(e){return e}))(a),m=C.j(O,(function(e){return e.length})),f=C.l().range([0,h.bandwidth()]).domain([-m,m]),p=C.m().interpolator(C.g).domain(null===e||void 0===e?void 0:e.range);j.selectAll("violins").data([null===e||void 0===e?void 0:e.label]).enter().append("g").attr("transform",(function(e){return"translate("+h(e)+" ,0)"})).append("path").datum((function(){return O})).style("stroke","none").style("fill","#A7B6C2").attr("d",C.a().x0(f(0)).x1((function(e){return f(e.length)})).y((function(e){return b(e.x0)})).curve(C.d));j.selectAll("jitter").data(a).enter().append("circle").attr("cx",(function(t){return h(null===e||void 0===e?void 0:e.label)+h.bandwidth()/2-70*Math.random()})).attr("cy",(function(e){return b(e)})).attr("r",3).style("fill",(function(e){return p(e)})).attr("stroke","white"),j.selectAll("threshold").data([null===e||void 0===e?void 0:e.threshold]).enter().append("line").attr("transform",(function(){return"translate("+h(null===e||void 0===e?void 0:e.label)+" ,0)"})).attr("class","threshold").attr("x1",5).attr("y1",(function(e){return b(e)})).attr("x2",h.bandwidth()-5).attr("y2",(function(e){return b(e)})).attr("stroke-width",2).attr("stroke","Orange").on("mouseover",(function(){var e=C.n(this);e.attr("stroke","black"),e.attr("stroke-width","8")})).on("mouseout",(function(){var e=C.n(this);e.attr("stroke","Orange"),e.attr("stroke-width","5")}))}),[]),Object(O.jsx)("div",{ref:t})},k=(a(318),function(e){var t=e.data;return Object(O.jsx)("div",{className:"qc-plots",children:["sums","detected","proportion"].map((function(e){var a,n,c,r={threshold:null===t||void 0===t||null===(a=t.thresholds)||void 0===a?void 0:a[e],range:null===t||void 0===t||null===(n=t.ranges)||void 0===n?void 0:n[e],label:e,rdata:null===t||void 0===t||null===(c=t.data)||void 0===c?void 0:c[e]};return Object(O.jsx)("div",{children:Object(O.jsx)(S,Object(l.a)({},r))},e)}))})}),E=(a(319),function(){var e=Object(n.useContext)(m),t=e.pcaVarExp,a=e.qcData,c=e.clusterData;return Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("div",{className:"gallery-cont",children:[c?Object(O.jsxs)(o.d,{className:"gallery-elem",elevation:w.a.ONE,children:[Object(O.jsx)("h5",{children:"# of cells per cluster"}),Object(O.jsx)(A,{data:c})]}):"",t?Object(O.jsxs)(o.d,{className:"gallery-elem",elevation:w.a.ONE,children:[Object(O.jsx)("h5",{children:"PCA (% variance explained)"}),Object(O.jsx)(D,{pca:t})]}):"",a&&(null===a||void 0===a?void 0:a.thresholds)?Object(O.jsxs)(o.d,{className:"gallery-elem",elevation:w.a.ONE,children:[Object(O.jsx)("h5",{children:"QC Statistics"}),Object(O.jsx)(k,{data:a})]}):""]})})}),B=a(72),M=function(e){var t=-Number.MAX_VALUE,a=Number.MAX_VALUE;return e.forEach((function(e){t<e&&(t=e),a>e&&(a=e)})),[a,t]};function T(){var e=null,t=0,a=100,n=["ff0000","ffff00","00ff00","0000ff"];function c(c){if(c.length<2)throw new Error("Rainbow must have two or more colours.");var r=(a-t)/(c.length-1),l=new R;l.setGradient(c[0],c[1]),l.setNumberRange(t,t+r),e=[l];for(var s=1;s<c.length-1;s++){var i=new R;i.setGradient(c[s],c[s+1]),i.setNumberRange(t+r*s,t+r*(s+1)),e[s]=i}n=c}c(n),this.setSpectrum=function(){return c(arguments),this},this.setSpectrumByArray=function(e){return c(e),this},this.colourAt=function(n){if(isNaN(n))throw new TypeError(n+" is not a number");if(1===e.length)return e[0].colourAt(n);var c=(a-t)/e.length,r=Math.min(Math.floor((Math.max(n,t)-t)/c),e.length-1);return e[r].colourAt(n)},this.colorAt=this.colourAt,this.setNumberRange=function(e,r){if(!(r>e))throw new RangeError("maxNumber ("+r+") is not greater than minNumber ("+e+")");return t=e,a=r,c(n),this}}function R(){var e="ff0000",t="0000ff",a=0,n=100;function c(e,t,c){var r=e;r<a&&(r=a),r>n&&(r=n);var l,s=n-a,i=parseInt(t,16),o=(parseInt(c,16)-i)/s,d=Math.round(o*(r-a)+i);return 1===(l=d.toString(16)).length?"0"+l:l}function r(e){if(function(e){return/^#?[0-9a-fA-F]{6}$/i.test(e)}(e))return e.substring(e.length-6,e.length);var t=e.toLowerCase();if(l.hasOwnProperty(t))return l[t];throw new Error(e+" is not a valid colour.")}this.setGradient=function(a,n){e=r(a),t=r(n)},this.setNumberRange=function(e,t){if(!(t>e))throw new RangeError("maxNumber ("+t+") is not greater than minNumber ("+e+")");a=e,n=t},this.colourAt=function(a){return c(a,e.substring(0,2),t.substring(0,2))+c(a,e.substring(2,4),t.substring(2,4))+c(a,e.substring(4,6),t.substring(4,6))};var l={aliceblue:"F0F8FF",antiquewhite:"FAEBD7",aqua:"00FFFF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000000",blanchedalmond:"FFEBCD",blue:"0000FF",blueviolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetblue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerblue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"00FFFF",darkblue:"00008B",darkcyan:"008B8B",darkgoldenrod:"B8860B",darkgray:"A9A9A9",darkgreen:"006400",darkgrey:"A9A9A9",darkkhaki:"BDB76B",darkmagenta:"8B008B",darkolivegreen:"556B2F",darkorange:"FF8C00",darkorchid:"9932CC",darkred:"8B0000",darksalmon:"E9967A",darkseagreen:"8FBC8F",darkslateblue:"483D8B",darkslategray:"2F4F4F",darkslategrey:"2F4F4F",darkturquoise:"00CED1",darkviolet:"9400D3",deeppink:"FF1493",deepskyblue:"00BFFF",dimgray:"696969",dimgrey:"696969",dodgerblue:"1E90FF",firebrick:"B22222",floralwhite:"FFFAF0",forestgreen:"228B22",fuchsia:"FF00FF",gainsboro:"DCDCDC",ghostwhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"808080",green:"008000",greenyellow:"ADFF2F",grey:"808080",honeydew:"F0FFF0",hotpink:"FF69B4",indianred:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderblush:"FFF0F5",lawngreen:"7CFC00",lemonchiffon:"FFFACD",lightblue:"ADD8E6",lightcoral:"F08080",lightcyan:"E0FFFF",lightgoldenrodyellow:"FAFAD2",lightgray:"D3D3D3",lightgreen:"90EE90",lightgrey:"D3D3D3",lightpink:"FFB6C1",lightsalmon:"FFA07A",lightseagreen:"20B2AA",lightskyblue:"87CEFA",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"B0C4DE",lightyellow:"FFFFE0",lime:"00FF00",limegreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumaquamarine:"66CDAA",mediumblue:"0000CD",mediumorchid:"BA55D3",mediumpurple:"9370DB",mediumseagreen:"3CB371",mediumslateblue:"7B68EE",mediumspringgreen:"00FA9A",mediumturquoise:"48D1CC",mediumvioletred:"C71585",midnightblue:"191970",mintcream:"F5FFFA",mistyrose:"FFE4E1",moccasin:"FFE4B5",navajowhite:"FFDEAD",navy:"000080",oldlace:"FDF5E6",olive:"808000",olivedrab:"6B8E23",orange:"FFA500",orangered:"FF4500",orchid:"DA70D6",palegoldenrod:"EEE8AA",palegreen:"98FB98",paleturquoise:"AFEEEE",palevioletred:"DB7093",papayawhip:"FFEFD5",peachpuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderblue:"B0E0E6",purple:"800080",red:"FF0000",rosybrown:"BC8F8F",royalblue:"4169E1",saddlebrown:"8B4513",salmon:"FA8072",sandybrown:"F4A460",seagreen:"2E8B57",seashell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyblue:"87CEEB",slateblue:"6A5ACD",slategray:"708090",slategrey:"708090",snow:"FFFAFA",springgreen:"00FF7F",steelblue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFFFFF",whitesmoke:"F5F5F5",yellow:"FFFF00",yellowgreen:"9ACD32"}}a(331);var I=function(){var e,t=Object(n.useRef)(),a=Object(n.useState)(null),c=Object(i.a)(a,2),r=c[0],l=c[1],d=Object(n.useState)(null),u=Object(i.a)(d,2),j=u[0],b=u[1],h=Object(n.useState)(!1),f=Object(i.a)(h,2),p=f[0],v=f[1],x=Object(n.useState)(null),g=Object(i.a)(x,2),F=g[0],C=g[1],y=Object(n.useState)(F),D=Object(i.a)(y,2),N=D[0],A=D[1],w=Object(n.useState)(null),S=Object(i.a)(w,2),k=S[0],E=S[1],R=Object(n.useContext)(m),I=R.plotRedDims,_=R.redDims,z=R.defaultRedDims,q=R.setDefaultRedDims,P=R.clusterData,L=R.tsneData,G=R.umapData,U=R.setPlotRedDims,V=R.clusterColors,H=R.gene,W=R.selectedClusterSummary;Object(n.useEffect)((function(){var e;if(H&&""!=H||v(!1),null===W||void 0===W||null===(e=W[H])||void 0===e?void 0:e.expr){var t,a=M(null===W||void 0===W||null===(t=W[H])||void 0===t?void 0:t.expr),n=0===a[1]?.01:a[1],c=new T;c.setSpectrum("#F5F8FA","#2965CC"),c.setNumberRange(0,n),v(!0),E(c),A([0,n]),C([0,n])}}),[null===W||void 0===W||null===(e=W[H])||void 0===e?void 0:e.expr],H),Object(n.useEffect)((function(){if(Array.isArray(N)){var e=new T;e.setSpectrum("#F5F8FA","#2965CC"),e.setNumberRange.apply(e,Object(s.a)(N)),E(e),v(!0)}}),[N]),Object(n.useEffect)((function(){if(t.current){var e=r;if(!e){var a=t.current;a.style.width="95%",a.style.height="95%";(e=new B.ScatterGL(a,{orbitControls:{zoomSpeed:1.25},styles:{point:{scaleDefault:2.5,scaleSelected:2.5,scaleHover:2.5}}})).setPanMode(),l(e)}if(null===I||void 0===I?void 0:I.plot){var n=null===I||void 0===I?void 0:I.clusters,c=V,s=[];null===I||void 0===I||I.plot.x.forEach((function(e,t){s.push([e,null===I||void 0===I?void 0:I.plot.y[t]])}));var i={clusters:n},o=new B.ScatterGL.Dataset(s,i);e.render(o),e.setPointColorer((function(e,t,a){var r,l,s;return null!=j&&j!==n[e]?"#D3D3D3":H&&Array.isArray(null===W||void 0===W||null===(r=W[H])||void 0===r?void 0:r.expr)?(v(!0),"#"+k.colorAt(null===W||void 0===W||null===(l=W[H])||void 0===l||null===(s=l.expr)||void 0===s?void 0:s[e])):(v(!1),c[n[e]])}))}}}),[I,k,j]),Object(n.useEffect)((function(){Q(z)}),[z]);var Q=function(e){"TSNE"===z?U({plot:L,clusters:null===P||void 0===P?void 0:P.clusters}):"UMAP"===z&&U({plot:G,clusters:null===P||void 0===P?void 0:P.clusters})},J=function(e){"PAN"===e?r.setPanMode():"SELECT"===e&&r.setSelectMode()};return Object(O.jsxs)("div",{className:"scatter-plot",children:[Object(O.jsxs)(o.b,{style:{minWidth:75,minHeight:150},fill:!1,large:!1,minimal:!1,vertical:!0,className:"left-sidebar",children:[Object(O.jsxs)(o.a,{className:"dim-button",disabled:-1===_.indexOf("TSNE"),onClick:function(){return q("TSNE")},intent:"TSNE"===z?"primary":"",children:[Object(O.jsx)(o.m,{icon:"database"}),Object(O.jsx)("br",{}),Object(O.jsx)("span",{children:"TSNE"})]}),Object(O.jsxs)(o.a,{className:"dim-button",disabled:-1===_.indexOf("UMAP"),onClick:function(){return q("UMAP")},intent:"UMAP"===z?"primary":"",children:[Object(O.jsx)(o.m,{icon:"database"}),Object(O.jsx)("br",{}),Object(O.jsx)("span",{children:"UMAP"})]})]}),Object(O.jsxs)(o.f,{className:"top-header",fill:!1,vertical:!1,children:[Object(O.jsx)(o.a,{icon:"hand-up",onClick:function(e){return J("PAN")},children:"Pan"}),Object(O.jsx)(o.a,{icon:"widget",onClick:function(e){return J("SELECT")},children:"Selection"})]}),Object(O.jsx)("div",{className:"dim-plot",children:(null===I||void 0===I?void 0:I.plot)?Object(O.jsx)("div",{ref:t}):"Choose an Embedding... or Embeddings are being computed..."}),Object(O.jsx)("div",{className:"right-sidebar",children:Object(O.jsxs)("div",{children:[Object(O.jsxs)("div",{className:"right-sidebar-cluster",children:[Object(O.jsx)(o.c,{title:"CLUSTERS",icon:"circle-arrow-left"}),Object(O.jsx)("ul",{children:null===V||void 0===V?void 0:V.map((function(e,t){return Object(O.jsxs)("li",{className:j==t?"legend-highlight":"",style:{color:e},onClick:function(){b(t===j?null:t)},children:[" Cluster ",t+1," "]},t)}))})]}),p?Object(O.jsxs)("div",{className:"right-sidebar-slider",children:[Object(O.jsx)(o.c,{intent:"primary",style:{textAlign:"left"},children:"Use the slider to adjust the color gradient of the plot. Useful when data is skewed by either a few lowly or highly expressed cells"}),Object(O.jsxs)("div",{className:"dim-slider-container",children:[Object(O.jsxs)("div",{className:"dim-slider-gradient",children:[Object(O.jsx)("span",{children:Math.round(F[0])}),"\xa0",Object(O.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, #F5F8FA ".concat(100*(N[0]-F[0])/(F[1]-F[0]),"%, ").concat(100*(N[1]+N[0]-2*F[0])/(2*(F[1]-F[0])),"%, #2965CC ").concat(100-100*(F[1]-N[1])/(F[1]-F[0]),"%)"),width:"175px",height:"15px"}}),"\xa0",Object(O.jsx)("span",{children:Math.round(F[1])})]}),Object(O.jsx)("div",{className:"dim-range-slider",children:Object(O.jsx)(o.w,{min:Math.round(F[0]),max:Math.round(F[1]),stepSize:Math.round(F[1]-F[0])/25,onChange:function(e){A(e)},value:[Math.round(N[0]),Math.round(N[1])],vertical:!1})})]})]}):""]})})]})},_=a(129),z=function(e){var t=Object(n.useRef)();return Object(n.useEffect)((function(){var a=null===e||void 0===e?void 0:e.data,n=null===e||void 0===e?void 0:e.width,c=null===e||void 0===e?void 0:e.color,r=null===e||void 0===e?void 0:e.clusters;if(n||(n=325),c||(c="#00B3A4"),!a)return"";var l=t.current;l.innerHTML="";var i=10,o=30,d=30,u=40,j=n-u-o,b=150-i-d,h=C.n(l).append("svg").attr("width",j+u+o).attr("height",b+i+d).append("g").attr("transform","translate(".concat(u,",").concat(i,")")),O=C.l().domain([0,Math.max.apply(Math,Object(s.a)(a))]).range([0,j]);h.append("g").attr("transform","translate(0, ".concat(b,")")).call(C.b(O));var m=C.f().value((function(e){return e})).domain(O.domain()).thresholds(O.ticks(25)),f=m(a),p=m(a.filter((function(e,t){return 0===(null===r||void 0===r?void 0:r[t])}))),v=m(a.filter((function(e,t){return 1===(null===r||void 0===r?void 0:r[t])}))),x=C.l().range([b,0]).domain([0,C.j(f,(function(e){return e.length}))]);h.selectAll("rectAll").data(p).join("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(O(e.x0)," , ").concat(x(e.length),")")})).attr("width",(function(e){return O(e.x1)-O(e.x0)-1})).attr("height",(function(e){return b-x(e.length)})).style("fill","#D3D3D3").style("opacity",.6),h.selectAll("rectCluster").data(v).enter().append("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(O(e.x0),", ").concat(x(e.length),")")})).attr("width",(function(e){return O(e.x1)-O(e.x0)-1})).attr("height",(function(e){return b-x(e.length)})).style("fill",c).style("opacity",.6),h.append("circle").attr("cx",j-50).attr("cy",5).attr("r",3).style("fill","#D3D3D3"),h.append("circle").attr("cx",j-50).attr("cy",15).attr("r",3).style("fill",c),h.append("text").attr("x",j-40).attr("y",5).text("all cells").style("font-size","10px").attr("alignment-baseline","middle"),h.append("text").attr("x",j-40).attr("y",15).text("this cluster").style("font-size","10px").attr("alignment-baseline","middle")}),[]),Object(O.jsx)("div",{ref:t})},q=function(e){var t=Object(n.useRef)();return Object(n.useEffect)((function(){var a=null===e||void 0===e?void 0:e.data,n=null===e||void 0===e?void 0:e.width,c=null===e||void 0===e?void 0:e.height,r=null===e||void 0===e?void 0:e.color;if(n||(n=325),c||(c=150),r||(r="#00B3A4"),!a)return"";var l=t.current;l.innerHTML="";var i=5,o=5,d=5,u=5,j=n-u-o,b=c-i-d,h=C.n(l).append("svg").attr("width",j+u+o).attr("height",b+i+d).append("g").attr("transform","translate(".concat(u,",").concat(i,")")),O=C.l().domain([0,Math.max.apply(Math,Object(s.a)(a))]).range([0,j]);h.append("g").attr("transform","translate(0, ".concat(b,")")).call(C.b(O));var m=C.f().value((function(e){return e})).domain(O.domain()).thresholds(O.ticks(25))(a),f=C.l().range([b,0]);f.domain([0,C.j(m,(function(e){return e.length}))]),h.selectAll("rect").data(m).join("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(O(e.x0)," , ").concat(f(e.length),")")})).attr("width",(function(e){return O(e.x1)-O(e.x0)-1})).attr("height",(function(e){return b-f(e.length)})).style("fill",r)}),[null===e||void 0===e?void 0:e.data]),Object(O.jsx)("div",{ref:t})},P=function(e){var t=Object(n.useRef)(),a=null===e||void 0===e?void 0:e.width,c=null===e||void 0===e?void 0:e.minmax,r=null===e||void 0===e?void 0:e.score,l=null===e||void 0===e?void 0:e.colorscale,s=null===e||void 0===e?void 0:e.colorscore,i=null===e||void 0===e?void 0:e.color,o=(r-c[0])/(c[1]-c[0]);return a||(a="100%"),i||(i="#00B3A4"),Object(O.jsx)("div",{ref:t,style:{width:a,height:"66%",margin:"5px",border:"1px solid gainsboro",alignItems:"center"},children:l?Object(O.jsx)("div",{style:{width:"".concat(100*s,"%"),backgroundColor:l(s),height:"100%"}}):Object(O.jsx)("div",{style:{width:"".concat(100*o,"%"),backgroundColor:i,height:"100%"}})})},L=function(e){var t=Object(n.useRef)(),a=null===e||void 0===e?void 0:e.width,c=(null===e||void 0===e||e.colorscale,null===e||void 0===e?void 0:e.score),r=null===e||void 0===e?void 0:e.minmax,l=C.m(C.i).domain([r[1],r[0]]);return a||(a="100%"),Object(O.jsx)("div",{ref:t,style:{width:a,height:"66%",margin:"5px",border:"1px solid gainsboro",alignItems:"center",backgroundColor:l(c)},children:Object(O.jsx)("div",{style:{width:"100%",backgroundColor:l(c),height:"100%"}})})},G=(a(332),["children"]),U=function(){var e=Object(n.useContext)(m),t=e.clusterData,a=e.selectedClusterSummary,c=e.setSelectedClusterSummary,r=e.selectedCluster,d=e.setSelectedCluster,j=e.setClusterRank,b=e.setReqGene,f=e.clusterColors,p=e.gene,v=e.setGene,x=Object(n.useState)(null),g=Object(i.a)(x,2),F=g[0],y=g[1],D=Object(n.useState)(null),N=Object(i.a)(D,2),A=N[0],w=N[1],S=Object(n.useState)(null),k=Object(i.a)(S,2),E=k[0],B=k[1],M=Object(n.useState)(null),T=Object(i.a)(M,2),R=T[0],I=T[1],U=Object(n.useState)(null),V=Object(i.a)(U,2),H=V[0],W=V[1],Q=Object(n.useState)(null),J=Object(i.a)(Q,2),K=J[0],X=J[1],Y=Object(n.useState)(null),$=Object(i.a)(Y,2),Z=$[0],ee=$[1],te=Object(n.useState)(null),ae=Object(i.a)(te,2),ne=ae[0],ce=ae[1],re=Object(n.useState)(null),le=Object(i.a)(re,2),se=le[0],ie=le[1],oe=Object(n.useState)(null),de=Object(i.a)(oe,2),ue=de[0],je=de[1],be=Object(n.useState)(null),he=Object(i.a)(be,2),Oe=he[0],me=he[1],fe=Object(n.useState)(null),pe=Object(i.a)(fe,2),ve=pe[0],xe=pe[1],ge=Object(n.useState)({}),Fe=Object(i.a)(ge,2),Ce=Fe[0],ye=Fe[1],De=Object(n.useState)(null),Ne=Object(i.a)(De,2),Ae=Ne[0],we=Ne[1],Se=Object(n.useState)(null),ke=Object(i.a)(Se,2),Ee=(ke[0],ke[1],Object(n.useState)(null)),Be=Object(i.a)(Ee,2),Me=(Be[0],Be[1],C.i);Object(n.useEffect)((function(){if(!a)return a;var e=Object.values(a);if(0===e.length)return e;var t=e.map((function(e){return null===e||void 0===e?void 0:e.mean})),n=C.e(t),c=0===n[1]?.01:n[1];I([parseFloat(n[0].toFixed(2)),parseFloat(c.toFixed(2))]),ie(t);var r=e.map((function(e){return null===e||void 0===e?void 0:e.delta})),l=C.e(r),i=0===l[1]?.01:l[1];W([parseFloat(l[0].toFixed(2)),parseFloat(i.toFixed(2))]),je(r);var o=e.map((function(e){return null===e||void 0===e?void 0:e.lfc})),d=C.e(o),u=0===d[1]?.01:d[1];X([parseFloat(d[0].toFixed(2)),parseFloat(u.toFixed(2))]),me(o);var j=e.map((function(e){return null===e||void 0===e?void 0:e.detected})),b=C.e(j),h=0===b[1]?.01:b[1];ee([parseFloat(b[0].toFixed(2)),parseFloat(h.toFixed(2))]),xe(j),ce({lfc:[parseFloat(d[0].toFixed(2)),parseFloat(u.toFixed(2))],mean:[parseFloat(n[0].toFixed(2)),parseFloat(c.toFixed(2))],detected:[parseFloat(b[0].toFixed(2)),parseFloat(h.toFixed(2))],delta:[parseFloat(l[0].toFixed(2)),parseFloat(i.toFixed(2))]});var O=Object(s.a)(e);we(O)}),[a]);var Te=Object(n.useMemo)((function(){if(!Ae)return[];var e=Ae;if(Ce){var t=function(t){var a=Ce[t];if(a[0]==ne[t][0]&&a[1]==ne[t][1])return"continue";e=e.filter((function(e){return e[t]>=a[0]&&e[t]<=a[1]}))};for(var a in Ce)t(a)}return E&&""!==E?e=e.filter((function(e){return-1!==e.gene.toLowerCase().indexOf(E.toLowerCase())})):e}),[Ae,E,Ce]);Object(n.useEffect)((function(){if(null===t||void 0===t?void 0:t.clusters){for(var e,a=Math.max.apply(Math,Object(s.a)(t.clusters)),n=[],c=0;c<a+1;c++)n.push(c+1);y(n),d(0);var r=[];null===t||void 0===t||null===(e=t.clusters)||void 0===e||e.forEach((function(e){return 0===e?r.push(1):r.push(0)})),w(r)}}),[t]),Object(n.useEffect)((function(){var e,a=[];null===t||void 0===t||null===(e=t.clusters)||void 0===e||e.forEach((function(e){return e===r?a.push(1):a.push(0)})),w(a)}),[r]);var Re=function(e,t){var a=Object(l.a)({},Ce);a[t]=e,ye(a)};return Object(O.jsxs)("div",{className:"marker-container",children:[Object(O.jsx)(o.j,{children:"Marker Genes"}),F?Object(O.jsx)("select",{onChange:function(e){var t;d(parseInt(null===(t=e.currentTarget)||void 0===t?void 0:t.value.replace("Cluster ",""))-1),v(null)},children:F.map((function(e,t){return Object(O.jsxs)("option",{children:["Cluster ",e]},t)}))}):"",a?Object(O.jsxs)("div",{className:"marker-table",children:[Object(O.jsxs)("div",{className:"marker-header",children:[Object(O.jsx)(o.n,{leftIcon:"search",small:!0,placeholder:"Search gene...",type:"text",onChange:function(e){return B(e.target.value)}}),Object(O.jsxs)(o.o,{children:["sort by \xa0",Object(O.jsxs)("select",{onChange:function(e){j(e.currentTarget.value)},defaultValue:"cohen-min-rank",children:[Object(O.jsx)("option",{children:"cohen-min"}),Object(O.jsx)("option",{children:"cohen-mean"}),Object(O.jsx)("option",{children:"cohen-min-rank"}),Object(O.jsx)("option",{children:"auc-min"}),Object(O.jsx)("option",{children:"auc-mean"}),Object(O.jsx)("option",{children:"auc-min-rank"}),Object(O.jsx)("option",{children:"lfc-min"}),Object(O.jsx)("option",{children:"lfc-mean"}),Object(O.jsx)("option",{children:"lfc-min-rank"}),Object(O.jsx)("option",{children:"delta-d-min"}),Object(O.jsx)("option",{children:"delta-d-mean"}),Object(O.jsx)("option",{children:"delta-d-min-rank"})]})]})]}),Object(O.jsx)(_.a,{components:{Item:function(e){var t=e.children,a=Object(u.a)(e,G);return Object(O.jsx)("div",Object(l.a)(Object(l.a)({className:"row-card"},a),{},{children:t}))},Header:function(){return Object(O.jsxs)("div",{className:"row-container row-header",children:[Object(O.jsx)("span",{children:"Gene"}),Object(O.jsx)("span",{children:"Log-FC"}),Object(O.jsx)("span",{children:"\u0394-detected"}),Object(O.jsxs)("span",{children:["Expression \xa0",Object(O.jsx)(h.a,{content:"bar represents the mean expression of the gene and the color gradient represents detected.",openOnTargetFocus:!1,children:Object(O.jsx)(o.m,{size:12,icon:"help"})})]}),Object(O.jsx)("span",{})]})}},className:"marker-list",totalCount:Te.length,itemContent:function(e){var t=Te[e],n=t.expanded,s=t.expr;return Object(O.jsxs)("div",{children:[Object(O.jsxs)("div",{className:"row-container",children:[Object(O.jsx)("span",{children:t.gene}),Object(O.jsx)(L,{minmax:K,colorscale:C.h,score:t.lfc}),Object(O.jsx)(L,{minmax:H,colorscale:C.h,score:t.delta}),Object(O.jsx)(P,{minmax:R,colorscale:Me,score:t.mean,colorscore:t.detected}),Object(O.jsxs)("div",{className:"row-action",children:[Object(O.jsx)(o.a,{icon:n?"minus":"plus",small:!0,fill:!1,className:"row-action",onClick:function(){var e=Object(l.a)({},a);e[t.gene].expanded=!e[t.gene].expanded,c(e),s||b(t.gene)}}),Object(O.jsx)(o.a,{small:!0,fill:!1,className:"row-action",onClick:function(){t.gene===p?v(null):(v(t.gene),s||b(t.gene))},children:Object(O.jsx)(o.m,{icon:"tint",color:t.gene===p?f[r]:""})})]})]}),Object(O.jsx)(o.e,{isOpen:n,children:A&&Object(O.jsx)(z,{data:s,color:f[r],clusters:A})})]})}}),Object(O.jsxs)("div",{className:"marker-footer",children:[Object(O.jsx)(o.k,{className:"marker-footer-title",children:"Filter Markers"}),Object(O.jsxs)("div",{className:"marker-filter-container",children:[Object(O.jsx)(o.y,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Log-FC"}),Object(O.jsx)(q,{data:Oe,height:35,color:"#F5498B"}),Object(O.jsx)("div",{className:"marker-filter-slider",children:K&&Object(O.jsx)(o.w,{min:K[0],max:K[1],stepSize:Math.round(K[1]-K[0])/25,onChange:function(e){return Re(e,"lfc")},value:(null===Ce||void 0===Ce?void 0:Ce.lfc)?null===Ce||void 0===Ce?void 0:Ce.lfc:K,vertical:!1})})]}),Object(O.jsxs)("div",{className:"marker-filter-container",children:[Object(O.jsx)(o.y,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"\u0394-detected"}),Object(O.jsx)(q,{data:ue,height:35,color:"#4580E6"}),Object(O.jsx)("div",{className:"marker-filter-slider",children:H&&Object(O.jsx)(o.w,{min:H[0],max:H[1],stepSize:Math.round(H[1]-H[0])/25,onChange:function(e){return Re(e,"delta")},value:(null===Ce||void 0===Ce?void 0:Ce.delta)?null===Ce||void 0===Ce?void 0:Ce.delta:H,vertical:!1})})]}),Object(O.jsxs)("div",{className:"marker-filter-container",children:[Object(O.jsx)(o.y,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Mean"}),Object(O.jsx)(q,{data:se,height:35}),Object(O.jsx)("div",{className:"marker-filter-slider",children:R&&Object(O.jsx)(o.w,{min:R[0],max:R[1],stepSize:Math.round(R[1]-R[0])/25,onChange:function(e){return Re(e,"mean")},value:(null===Ce||void 0===Ce?void 0:Ce.mean)?null===Ce||void 0===Ce?void 0:Ce.mean:R,vertical:!1})})]}),Object(O.jsxs)("div",{className:"marker-filter-container",children:[Object(O.jsx)(o.y,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Detected"}),Object(O.jsx)(q,{data:ve,height:35}),Object(O.jsx)("div",{className:"marker-filter-slider",children:Z&&Object(O.jsx)(o.w,{min:Z[0],max:Z[1],stepSize:Math.round(Z[1]-Z[0])/25,onChange:function(e){return Re(e,"detected")},value:(null===Ce||void 0===Ce?void 0:Ce.detected)?null===Ce||void 0===Ce?void 0:Ce.detected:Z,vertical:!1})})]})]})]}):""]})};var V=function(){var e=Object(n.useState)(!0),t=Object(i.a)(e,2),a=t[0],c=t[1],r=Object(n.useContext)(m),d=r.setWasmInitialized,u=r.setTsneData,j=r.setRedDims,b=r.redDims,h=r.setInitDims,f=r.setQcDims,p=r.defaultRedDims,v=r.setDefaultRedDims,x=r.setQcData,g=r.qcData,C=r.setClusterData,y=r.setFSelectionData,D=r.setUmapData,N=r.setPcaVarExp,A=r.logs,w=r.setLogs,S=r.selectedCluster,k=r.clusterRank,B=r.selectedClusterSummary,M=r.setSelectedClusterSummary,T=r.reqGene;return Object(n.useEffect)((function(){window.Worker.postMessage({type:"INIT",msg:"Initial Load"})}),[]),Object(n.useEffect)((function(){null!==S&&window.Worker.postMessage({type:"getMarkersForCluster",payload:{cluster:S,rank_type:k}})}),[S,k]),Object(n.useEffect)((function(){null!==T&&window.Worker.postMessage({type:"getGeneExpression",payload:{gene:T}})}),[T]),window.Worker.onmessage=function(e){var t=e.data;if(null===t||void 0===t?void 0:t.msg){var a=Object(s.a)(A),n=new Date;a.push("".concat(n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()," - ").concat(null===t||void 0===t?void 0:t.type," - ").concat(null===t||void 0===t?void 0:t.msg)),w(a)}if("INIT"===t.type)c(!1),d(!0);else if("input_DIMS"===t.type)h(t.resp);else if("quality_control_filtered_DIMS"===t.type)f(t.resp);else if("quality_control_metrics_DATA"===t.type){var r=t.resp;x(r)}else if("quality_control_thresholds_DATA"===t.type){var i=t.resp,o=Object(l.a)({},g);o.thresholds=i,x(o)}else if("feature_selection_DIMS"===t.type);else if("feature_selection_DATA"===t.type){var O=t.resp;y(O)}else if("pca_DATA"===t.type){var m=t.resp,F=Object(s.a)(b);F.push("PCA"),j(F),N(m)}else if("snn_cluster_graph_DATA"===t.type){var S=t.resp;C(S)}else if("tsne_DATA"===t.type||"tsne_iter"===t.type){var k=t.resp;u(k);var E=Object(s.a)(b);E.push("TSNE"),p||v("TSNE"),j(E)}else if("umap_DATA"===t.type){var T=t.resp;D(T);var R=Object(s.a)(b);R.push("UMAP"),j(R)}else if("markerGene_DATA"===t.type);else if("setMarkersForCluster"===t.type){var I=t.resp,_={};I.means.forEach((function(e,t){var a,n,c,r,l;_[null===I||void 0===I||null===(a=I.genes)||void 0===a?void 0:a[t]]={gene:null===I||void 0===I||null===(n=I.genes)||void 0===n?void 0:n[t],mean:e,delta:null===I||void 0===I||null===(c=I.delta_d)||void 0===c?void 0:c[t],lfc:null===I||void 0===I||null===(r=I.lfc)||void 0===r?void 0:r[t],detected:null===I||void 0===I||null===(l=I.detected)||void 0===l?void 0:l[t],expanded:!1,expr:null}})),M(_)}else if("setGeneExpression"===t.type){var z=t.resp,q=Object(l.a)({},B);q[z.gene].expr=Object.values(z.expr),M(q)}},Object(O.jsxs)("div",{className:"App",children:[Object(O.jsx)(F,{}),Object(O.jsxs)("div",{className:"App-content",children:[Object(O.jsx)("div",{className:"plot",children:Object(O.jsx)(I,{})}),Object(O.jsx)("div",{className:"marker",children:Object(O.jsx)(U,{})}),Object(O.jsx)("div",{className:"analysis",children:Object(O.jsx)(E,{})})]}),Object(O.jsx)(o.u,Object(l.a)(Object(l.a)({isOpen:a},{autoFocus:!0,canEscapeKeyClose:!1,canOutsideClickClose:!1,enforceFocus:!0,hasBackdrop:!0,usePortal:!0,useTallContent:!1}),{},{children:Object(O.jsxs)("div",{className:"spinner",children:[Object(O.jsx)(o.x,{size:100}),Object(O.jsx)("p",{children:"Initializing SCRAN.JS"})]})}))]})},H=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,342)).then((function(t){var a=t.getCLS,n=t.getFID,c=t.getFCP,r=t.getLCP,l=t.getTTFB;a(e),n(e),c(e),r(e),l(e)}))};r.a.render(Object(O.jsx)(f,{children:Object(O.jsx)(V,{})}),document.getElementById("root")),H()}},[[333,1,2]]]);
//# sourceMappingURL=main.f9a42bac.chunk.js.map