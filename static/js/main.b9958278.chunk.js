(this.webpackJsonpkana=this.webpackJsonpkana||[]).push([[0],{285:function(e,t,n){},286:function(e,t,n){},312:function(e,t,n){},315:function(e,t,n){},316:function(e,t,n){},328:function(e,t,n){},329:function(e,t,n){},330:function(e,t,n){},331:function(e,t,n){},332:function(e,t,n){},333:function(e,t,n){"use strict";n.r(t);var a=n(1),s=n(25),i=n.n(s),c=(n(285),n(4)),l=n(22),r=n(6),o=(n(286),n(341)),d=n(48),u=n(137),h=n(80),j=n(43),b=n(3),p=n(19),O=o.H.create({className:"notifications",position:p.a.TOP_RIGHT,maxToasts:5}),x=n(0),m=Object(a.createContext)(null),f=function(e){var t=e.children,n=Object(a.useState)({format:null,files:null}),s=Object(r.a)(n,2),i=s[0],c=s[1],l=Object(a.useState)({qc:{"qc-nmads":3,"qc-mito":"mt-"},fSelection:{"fsel-span":.3},pca:{"pca-npc":5,"pca-hvg":4e3},cluster:{"clus-k":10,"clus-res":.5,"clus-scheme":0,"clus-approx":!0,"clus-method":"snn_graph"},tsne:{"tsne-iter":500,"tsne-perp":30,animate:!0},umap:{"umap-nn":15,"umap-epochs":500,"umap-min_dist":.01,animate:!1},markerGene:{}}),o=Object(r.a)(l,2),d=o[0],u=o[1],h=Object(a.useState)(!1),j=Object(r.a)(h,2),b=j[0],p=j[1],f=Object(a.useState)(!1),v=Object(r.a)(f,2),g=v[0],y=v[1],w=Object(a.useState)("kana-"+String(Date.now()).slice(0,5)),F=Object(r.a)(w,2),C=F[0],N=F[1],k=Object(a.useState)(!1),S=Object(r.a)(k,2),D=S[0],E=S[1],A=Object(a.useState)(!1),M=Object(r.a)(A,2),T=M[0],L=M[1],I=Object(a.useState)(null),R=Object(r.a)(I,2),q=R[0],_=R[1],B=Object(a.useState)(null),G=Object(r.a)(B,2),P=G[0],W=G[1],z=Object(a.useState)(null),V=Object(r.a)(z,2),U=V[0],H=V[1],X=Object(a.useState)(null),Q=Object(r.a)(X,2),Y=Q[0],Z=Q[1],J=Object(a.useState)(null),K=Object(r.a)(J,2),$=K[0],ee=K[1],te=Object(a.useState)(null),ne=Object(r.a)(te,2),ae=ne[0],se=ne[1],ie=Object(a.useState)(null),ce=Object(r.a)(ie,2),le=ce[0],re=ce[1],oe=Object(a.useState)(null),de=Object(r.a)(oe,2),ue=de[0],he=de[1],je=Object(a.useState)([]),be=Object(r.a)(je,2),pe=be[0],Oe=be[1],xe=Object(a.useState)(null),me=Object(r.a)(xe,2),fe=me[0],ve=me[1],ge=Object(a.useState)(null),ye=Object(r.a)(ge,2),we=ye[0],Fe=ye[1],Ce=Object(a.useState)(null),Ne=Object(r.a)(Ce,2),ke=Ne[0],Se=Ne[1],De=Object(a.useState)(null),Ee=Object(r.a)(De,2),Ae=Ee[0],Me=Ee[1],Te=Object(a.useState)([]),Le=Object(r.a)(Te,2),Ie=Le[0],Re=Le[1],qe=Object(a.useState)(null),_e=Object(r.a)(qe,2),Be=_e[0],Ge=_e[1],Pe=Object(a.useState)(null),We=Object(r.a)(Pe,2),ze=We[0],Ve=We[1],Ue=Object(a.useState)({}),He=Object(r.a)(Ue,2),Xe=He[0],Qe=He[1],Ye=Object(a.useState)(null),Ze=Object(r.a)(Ye,2),Je=Ze[0],Ke=Ze[1],$e=Object(a.useState)(null),et=Object(r.a)($e,2),tt=et[0],nt=et[1],at=Object(a.useState)(null),st=Object(r.a)(at,2),it=st[0],ct=st[1],lt=Object(a.useState)(!1),rt=Object(r.a)(lt,2),ot=rt[0],dt=rt[1],ut=Object(a.useState)(!1),ht=Object(r.a)(ut,2),jt=ht[0],bt=ht[1],pt=Object(a.useState)(null),Ot=Object(r.a)(pt,2),xt=Ot[0],mt=Ot[1],ft=Object(a.useState)(null),vt=Object(r.a)(ft,2),gt=vt[0],yt=vt[1],wt=Object(a.useState)(null),Ft=Object(r.a)(wt,2),Ct=Ft[0],Nt=Ft[1],kt=Object(a.useState)(null),St=Object(r.a)(kt,2),Dt=St[0],Et=St[1],At=Object(a.useState)([]),Mt=Object(r.a)(At,2),Tt=Mt[0],Lt=Mt[1];return Object(a.useEffect)((function(){T&&null!=i.files&&window.scranWorker.postMessage({type:"RUN",payload:{files:i,params:d},msg:"not much to pass"})}),[i,d,T]),Object(a.useEffect)((function(){D?(window.Worker.postMessage({type:"EXPORT",payload:{files:i,params:d},msg:"not much to pass"}),O.show({icon:"download",intent:"primary",message:"Exporting analysis in the background"})):(null===i||void 0===i?void 0:i.files)&&O.show({icon:"download",intent:"primary",message:"Analysis saved. Please check your downloads directory!"})}),[D]),Object(x.jsx)(m.Provider,{value:{inputFiles:i,setInputFiles:c,params:d,setParams:u,error:q,setError:_,wasmInitialized:T,setWasmInitialized:L,pcaData:tt,setPcaData:nt,pcaVarExp:it,setPcaVarExp:ct,tsneData:xt,setTsneData:mt,umapData:gt,setUmapData:yt,genesInfo:$,setGenesInfo:ee,initDims:P,setInitDims:W,qcDims:U,setQcDims:H,qcData:ae,setQcData:se,qcThreshold:le,setQcThreshold:re,fSelDims:Y,setFSelDims:Z,redDims:pe,setRedDims:Oe,defaultRedDims:fe,setDefaultRedDims:ve,plotRedDims:we,setPlotRedDims:Fe,clusterData:ke,setClusterData:Se,fSelectionData:ue,setFSelectionData:he,logs:Tt,setLogs:Lt,selectedCluster:Ae,setSelectedCluster:Me,selectedClusterSummary:Ie,setSelectedClusterSummary:Re,clusterRank:ze,setClusterRank:Ve,gene:Ct,setGene:Nt,clusterColors:Be,setClusterColors:Ge,reqGene:Dt,setReqGene:Et,openInput:b,setOpenInput:p,customSelection:Xe,setCustomSelection:Qe,delCustomSelection:Je,setDelCustomSelection:Ke,showGame:g,setShowGame:y,exportState:D,setExportState:E,datasetName:C,setDatasetName:N,showAnimation:ot,setShowAnimation:dt,triggerAnimation:jt,setTriggerAnimation:bt},children:t})},v=(n(312),["buttonText","includeFooter"]);var g=function(e){var t=e.buttonText,n=e.includeFooter,s=Object(j.a)(e,v),i=Object(a.useState)(!1),l=Object(r.a)(i,2),d=l[0],h=l[1],p=Object(a.useState)(1),O=Object(r.a)(p,2),f=O[0],g=O[1],y=Object(a.useCallback)((function(){return h(!d)}),[d]),w=Object(a.useCallback)((function(){return h(!1)}),[]),F=Object(a.useContext)(m),C=(F.inputFiles,F.setInputFiles),N=F.params,k=F.setParams,S=F.openInput,D=Object(a.useState)({gene:null,mtx:null,barcode:null}),E=Object(r.a)(D,2),A=E[0],M=E[1],T=Object(a.useState)({mtx:"Choose Matrix Market file",gene:"Choose feature/gene annotation",barcode:"Choose barcode annotation"}),L=Object(r.a)(T,2),I=L[0],R=L[1],q=Object(a.useState)(N),_=Object(r.a)(q,2),B=_[0],G=_[1],P=Object(a.useState)(!0),W=Object(r.a)(P,2),z=W[0],V=W[1],U=Object(a.useState)("new"),H=Object(r.a)(U,2),X=H[0],Q=H[1],Y=Object(a.useState)("mtx"),Z=Object(r.a)(Y,2),J=Z[0],K=Z[1];function $(e,t){"mtx"===e?(M({gene:null,mtx:null,barcode:null}),R({mtx:"Choose Matrix Market file",gene:"Choose feature/gene annotation",barcode:"Choose barcode annotation"})):"tenx"===e?(M({file:null}),R({file:"Choose 10x v3 H5 file"})):"h5ad"===e&&(M({file:null}),R({file:"Choose H5ad file"})),K(e)}return Object(a.useEffect)((function(){S&&h(!0)}),[S]),Object(a.useEffect)((function(){A&&("new"===X?"mtx"===J?(null===A||void 0===A?void 0:A.mtx)&&!(null===I||void 0===I?void 0:I.mtx.toLowerCase().endsWith("mtx"))&&!(null===I||void 0===I?void 0:I.mtx.toLowerCase().endsWith("mtx.gz"))||(null===A||void 0===A?void 0:A.gene)&&!(null===I||void 0===I?void 0:I.gene.toLowerCase().endsWith("tsv"))&&!(null===I||void 0===I?void 0:I.gene.toLowerCase().endsWith("tsv.gz"))||(null===A||void 0===A?void 0:A.barcode)&&!(null===I||void 0===I?void 0:I.barcode.toLowerCase().endsWith("tsv"))&&!(null===I||void 0===I?void 0:I.barcode.toLowerCase().endsWith("tsv.gz"))?V(!1):V(!0):"tenx"!==J&&"h5ad"!==J||((null===A||void 0===A?void 0:A.file)&&!((null===I||void 0===I?void 0:I.file.toLowerCase().endsWith("hdf5"))||(null===I||void 0===I?void 0:I.file.toLowerCase().endsWith("h5"))||(null===I||void 0===I?void 0:I.file.toLowerCase().endsWith("h5ad")))?V(!1):V(!0)):"load"===X&&(null===I||void 0===I?void 0:I.file)&&(null==(null===A||void 0===A?void 0:A.file)||(null===I||void 0===I?void 0:I.file.toLowerCase().endsWith("kana"))||(null===I||void 0===I?void 0:I.file.toLowerCase().endsWith("kana.gz"))?V(!0):V(!1)))}),[A]),Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(o.a,{onClick:y,icon:"social-media",intent:"primary",text:t}),Object(x.jsxs)(o.g,Object(c.a)(Object(c.a)({className:"analysis-dialog"},s),{},{isOpen:d,onClose:w,children:[Object(x.jsx)("div",{className:b.a.DIALOG_BODY,children:Object(x.jsxs)(o.E,{animate:!0,renderActiveTabPanelOnly:!0,vertical:!1,onChange:function(e,t){"new"===e?$(J):"load"===e&&(M({file:null}),R({file:"Choose kana analysis file"})),Q(e)},defaultSelectedTabId:X,children:[Object(x.jsx)(o.D,{id:"new",title:"Import new dataset",panel:Object(x.jsxs)("div",{className:"inputs-container",children:[Object(x.jsxs)("div",{className:"row-input",children:[Object(x.jsx)("div",{className:"col",style:{paddingBottom:"15px"},children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(o.m,{children:[Object(x.jsx)(o.F,{round:!0,children:"1"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(1)},onMouseLeave:function(){return g(null)},children:"Load input files"})]}),Object(x.jsxs)(o.E,{animate:!0,renderActiveTabPanelOnly:!0,vertical:!0,onChange:$,defaultSelectedTabId:J,children:[Object(x.jsx)(o.D,{id:"mtx",title:"Matrix Market file",panel:Object(x.jsxs)("div",{className:"row",children:[Object(x.jsx)(o.q,{className:"row-input",children:Object(x.jsx)(o.k,{text:I.mtx,onInputChange:function(e){R(Object(c.a)(Object(c.a)({},I),{},{mtx:e.target.files[0].name})),M(Object(c.a)(Object(c.a)({},A),{},{mtx:e.target.files}))}})}),Object(x.jsx)(o.q,{className:"row-input",children:Object(x.jsx)(o.k,{text:I.gene,onInputChange:function(e){R(Object(c.a)(Object(c.a)({},I),{},{gene:e.target.files[0].name})),M(Object(c.a)(Object(c.a)({},A),{},{gene:e.target.files}))}})})]})}),Object(x.jsx)(o.D,{id:"tenx",title:"10x v3 H5",panel:Object(x.jsx)("div",{className:"row",children:Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.G,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",children:"Choose 10x V3 H5 file"})}),Object(x.jsx)(o.k,{style:{marginTop:"5px"},text:I.file,onInputChange:function(e){R(Object(c.a)(Object(c.a)({},I),{},{file:e.target.files[0].name})),M(Object(c.a)(Object(c.a)({},A),{},{file:e.target.files}))}})]})})}),Object(x.jsx)(o.D,{id:"h5ad",title:"H5ad",panel:Object(x.jsx)("div",{className:"row",children:Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.G,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",children:"Choose H5ad file"})}),Object(x.jsx)(o.k,{style:{marginTop:"5px"},text:I.file,onInputChange:function(e){R(Object(c.a)(Object(c.a)({},I),{},{file:e.target.files[0].name})),M(Object(c.a)(Object(c.a)({},A),{},{file:e.target.files}))}})]})})})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(o.m,{children:[Object(x.jsx)(o.F,{round:!0,children:"2"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(2)},onMouseLeave:function(){return g(null)},children:"Quality control"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.G,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(2)},onMouseLeave:function(){return g(null)},children:"Number of MADs"})}),Object(x.jsx)(o.x,{placeholder:"3",value:B.qc["qc-nmads"],onValueChange:function(e,t){G(Object(c.a)(Object(c.a)({},B),{},{qc:Object(c.a)(Object(c.a)({},B.qc),{},{"qc-nmads":e})}))}})]}),Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.G,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(2)},onMouseLeave:function(){return g(null)},children:"Mitochondrial gene prefix"})}),Object(x.jsx)(o.p,{leftIcon:"filter",onChange:function(e,t){var n;G(Object(c.a)(Object(c.a)({},B),{},{qc:Object(c.a)(Object(c.a)({},B.qc),{},{"qc-mito":null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value})}))},placeholder:"mt-",value:B.qc["qc-mito"]})]})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(o.m,{children:[Object(x.jsx)(o.F,{round:!0,children:"3"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(3)},onMouseLeave:function(){return g(null)},children:"Feature Selection"})]}),Object(x.jsx)("div",{className:"row",children:Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.G,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(3)},onMouseLeave:function(){return g(null)},children:"Lowess span"})}),Object(x.jsx)(o.x,{placeholder:"0.3",value:B.fSelection["fsel-span"],onValueChange:function(e,t){G(Object(c.a)(Object(c.a)({},B),{},{fSelection:Object(c.a)(Object(c.a)({},B.fSelection),{},{"fsel-span":e})}))}})]})})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(o.m,{children:[Object(x.jsx)(o.F,{round:!0,children:"4"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(4)},onMouseLeave:function(){return g(null)},children:"Principal components analysis"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.G,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(4)},onMouseLeave:function(){return g(null)},children:"Number of HVGs"})}),Object(x.jsx)(o.x,{placeholder:"2500",value:B.pca["pca-hvg"],onValueChange:function(e,t){G(Object(c.a)(Object(c.a)({},B),{},{pca:Object(c.a)(Object(c.a)({},B.pca),{},{"pca-hvg":e})}))}})]}),Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.G,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(4)},onMouseLeave:function(){return g(null)},children:"Number of PCs"})}),Object(x.jsx)(o.x,{placeholder:"25",value:B.pca["pca-npc"],onValueChange:function(e,t){G(Object(c.a)(Object(c.a)({},B),{},{pca:Object(c.a)(Object(c.a)({},B.pca),{},{"pca-npc":e})}))}})]})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(o.m,{children:[Object(x.jsx)(o.F,{round:!0,children:"5"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Clustering"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.G,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Method"})}),Object(x.jsx)(o.n,{defaultValue:B.cluster["clus-method"],children:Object(x.jsx)("option",{children:B.cluster["clus-method"]})})]}),Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.G,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Number of neighbors"})}),Object(x.jsx)(o.x,{placeholder:"10",value:B.cluster["clus-k"],onValueChange:function(e,t){G(Object(c.a)(Object(c.a)({},B),{},{cluster:Object(c.a)(Object(c.a)({},B.cluster),{},{"clus-k":e})}))}})]}),Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.G,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Use ANN"})}),Object(x.jsx)(o.C,{style:{marginTop:"10px"},large:!0,checked:B.cluster["clus-approx"],innerLabelChecked:"true",innerLabel:"false",onChange:function(e){G(Object(c.a)(Object(c.a)({},B),{},{cluster:Object(c.a)(Object(c.a)({},B.cluster),{},{"clus-approx":e.target.checked})}))}})]}),Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.G,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Weighting scheme"})}),Object(x.jsxs)(o.n,{onChange:function(e,t){var n;return G(Object(c.a)(Object(c.a)({},B),{},{cluster:Object(c.a)(Object(c.a)({},B.cluster),{},{"clus-scheme":parseInt(null===e||void 0===e||null===(n=e.currentTarget)||void 0===n?void 0:n.value)})}))},children:[Object(x.jsx)("option",{children:"Rank"},"0"),Object(x.jsx)("option",{children:"Number"},"1"),Object(x.jsx)("option",{children:"Jaccard"},"2")]})]}),Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.G,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Resolution"})}),Object(x.jsx)(o.x,{placeholder:"0.5",value:B.cluster["clus-res"],onValueChange:function(e,t){G(Object(c.a)(Object(c.a)({},B),{},{cluster:Object(c.a)(Object(c.a)({},B.cluster),{},{"clus-res":e})}))}})]})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(o.m,{children:[Object(x.jsx)(o.F,{round:!0,children:"6"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(6)},onMouseLeave:function(){return g(null)},children:"t-SNE"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.G,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(6)},onMouseLeave:function(){return g(null)},children:"Perplexity"})}),Object(x.jsx)(o.x,{placeholder:"30",value:B.tsne["tsne-perp"],onValueChange:function(e,t){G(Object(c.a)(Object(c.a)({},B),{},{tsne:Object(c.a)(Object(c.a)({},B.tsne),{},{"tsne-perp":e})}))}})]}),Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.G,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(6)},onMouseLeave:function(){return g(null)},children:"Iterations"})}),Object(x.jsx)(o.x,{placeholder:"500",value:B.tsne["tsne-iter"],onValueChange:function(e,t){G(Object(c.a)(Object(c.a)({},B),{},{tsne:Object(c.a)(Object(c.a)({},B.tsne),{},{"tsne-iter":e})}))}})]})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(o.m,{children:[Object(x.jsx)(o.F,{round:!0,children:"7"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(7)},onMouseLeave:function(){return g(null)},children:"UMAP"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.G,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(7)},onMouseLeave:function(){return g(null)},children:"Number of neighbors"})}),Object(x.jsx)(o.x,{placeholder:"15",value:B.umap["umap-nn"],onValueChange:function(e,t){G(Object(c.a)(Object(c.a)({},B),{},{umap:Object(c.a)(Object(c.a)({},B.umap),{},{"umap-nn":e})}))}})]}),Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.G,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(7)},onMouseLeave:function(){return g(null)},children:"Minimum distance"})}),Object(x.jsx)(o.x,{placeholder:"0.01",value:B.umap["umap-min_dist"],onValueChange:function(e,t){G(Object(c.a)(Object(c.a)({},B),{},{umap:Object(c.a)(Object(c.a)({},B.umap),{},{"umap-min_dist":e})}))}})]}),Object(x.jsxs)(o.q,{className:"row-input",children:[Object(x.jsx)(o.G,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(7)},onMouseLeave:function(){return g(null)},children:"Epochs"})}),Object(x.jsx)(o.x,{placeholder:"500",value:B.umap["umap-epoch"],onValueChange:function(e,t){G(Object(c.a)(Object(c.a)({},B),{},{umap:Object(c.a)(Object(c.a)({},B.umap),{},{"umap-epoch":e})}))}})]})]})]})})]}),Object(x.jsxs)("div",{className:"row-input-tooltips",children:[!z&&Object(x.jsx)(o.c,{intent:"danger",title:"Incorrect file format",style:{marginBottom:"10px"},children:Object(x.jsxs)("p",{children:["Upload files that in one of these formats;",Object(x.jsxs)("ul",{children:[Object(x.jsxs)("li",{children:["Matrix Market - ",Object(x.jsx)("code",{children:"*.mtx"})," or ",Object(x.jsx)("code",{children:"*.mtx.gz"})]}),Object(x.jsxs)("li",{children:["features or genes, ",Object(x.jsx)("code",{children:"*.tsv"})," or ",Object(x.jsx)("code",{children:"*.tsv.gz"})]}),Object(x.jsxs)("li",{children:["HDF5 (10x or h5ad) - ",Object(x.jsx)("code",{children:"*.h5"})," or ",Object(x.jsx)("code",{children:"*.hdf5"})," or ",Object(x.jsx)("code",{children:"*.h5ad"})]})]})]})}),1==f&&Object(x.jsx)(o.c,{intent:"primary",children:Object(x.jsxs)("p",{children:["We currently support files in the Cellranger format - namely, a Matrix Market file containing the count matrix. We also recommend supplying the feature annotation (",Object(x.jsx)("code",{children:"features.tsv.gz"})," or ",Object(x.jsx)("code",{children:"genes.tsv.gz"}),"). Users may also provide a TSV file containing the barcode annotations, if any."]})}),2==f&&Object(x.jsxs)(o.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"At this step, we compute per-cell quality control (QC) metrics such as the total count per cell, the total number of detected features and (if the feature annotation is supplied) the mitochondrial proportion in each cell."}),Object(x.jsx)("p",{children:"We remove low-quality cells based on these metrics - specifically, cells with low total counts/number of detected features or high mitochondrial proportions are filtered out."}),Object(x.jsx)("p",{children:"We use an outlier-based approach to define the filter threshold under the assumption that most cells in the dataset are of acceptable quality."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of MADs"}),": Number of median absolute deviations (MADs) from the median, used to define a filter threshold in the appropriate direction for each QC metric. Increasing this value will reduce the stringency of the filtering."]})]}),3==f&&Object(x.jsxs)(o.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Identify highly variable genes while accounting for the mean-variance relationship. We do so by fitting a mean-dependent trend to the variances, computed from the log-transformed normalized expression values. The residuals from the trend are then used to rank highly variable genes."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Lowess span"}),": The span of the LOWESS smoother for fitting the mean-variance trend. Larger values increase the smoothness of the global trend at the cost of decreasing sensitivity to local variations."]})]}),4==f&&Object(x.jsxs)(o.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Perform a principal components analysis (PCA) to obtain per-cell coordinates in a low-dimensional space. This is used to compact the data for faster downstream computation, as well as to remove uninteresting high-dimensional noise."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of HVGs"}),": Number of highly variable genes to use to perform the PCA. Larger values will capture more biological signal at the cost of increasing noise and computational work."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of PCs"}),": Number of principal components with the highest variance to retain in downstream analyses. Larger values will capture more biological signal at the cost of increasing noise and computational work."]})]}),5==f&&Object(x.jsxs)(o.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Cluster cells into discrete groupings based on their relative similarity in the low-dimensional space. The set of clusters serve as a summary of the cellular heterogeneity in the population, allowing us to easily perform further characterization on subpopulations of interest."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Method"}),": Clustering algorithm to use. Currently, we use multi-level community detection on an shared nearest neighbor (SNN) graph where cells are the nodes and edges are created between neighboring cells."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of neighbors"}),": Number of neighbors to use to construct the shared nearest neighbor graph. Larger values result in broader clusters."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Use ANN ?"}),": Use an approximate method to speed up the nearest neighbor search. This sacrifices some accuracy for speed in larger datasets."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Weighting scheme"}),": Weighting scheme to use for the edges of the shared nearest neighbor graph. The Rank approach derives a weight from the rank of the closest shared neighbor; the Number approach uses the number of shared neighbors; and the Jaccard approach uses the Jaccard index of the neighbor sets."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Resolution"}),": Resolution parameter for the multi-level clustering, used to adjust the modularity calculation during community optimization. Larger values yield more fine-grained clusters."]})]}),6==f&&Object(x.jsxs)(o.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Create a t-SNE plot to visualize cells in two dimensions, because our feeble human minds cannot interpret high-dimensional spaces. Cells that were neighbors in the original space are kept close together in the 2D embedding, while dissimilar cells are placed (arbitrarily) far away."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Perplexity"}),": Perplexity parameter, which determines the size of the neighborhood of each cell. Larger values will favor preservation of global structure in the 2D embedding."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Iterations"}),": Number of t-SNE iterations. Doesn't usually have much of an effect if you leave it as it is."]})]}),7==f&&Object(x.jsxs)(o.c,{title:"Visually important content",intent:"primary",children:[Object(x.jsx)("p",{children:"Create a UMAP plot to visualize cells in two dimensions. Like the t-SNE, this aims to map cells from a high-dimensional space into a 2D embedding, where neighboring cells are kept close together and dissimilar cells are placed far apart."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of neighbors"}),": Number of neighbors to use when defining the size of the local neighborhood. Larger values will favor preservation of global structure."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Minimum distance"}),": Minimum distance between points. Smaller values result in more tightly packed embedding and favor local structure."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Epochs"}),": Number of epochs to use for convergence. This doesn't really change all too much."]})]})]})]})}),Object(x.jsx)(o.D,{id:"load",title:"Load saved analysis",disabled:!0,panel:Object(x.jsxs)("div",{className:"inputs-container",children:[Object(x.jsx)("div",{className:"row-input",children:Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(o.m,{children:[Object(x.jsx)(o.F,{round:!0,children:"1"}),Object(x.jsx)("span",{className:"row-tooltip",children:"Load analysis file"})]}),Object(x.jsx)("div",{className:"row",children:Object(x.jsx)(o.q,{className:"row-input",children:Object(x.jsx)(o.k,{text:I.file,onInputChange:function(e){R(Object(c.a)(Object(c.a)({},I),{},{file:e.target.files[0].name})),M(Object(c.a)(Object(c.a)({},A),{},{file:e.target.files}))}})})})]})})}),Object(x.jsxs)("div",{className:"row-input-tooltips",children:[!z&&Object(x.jsx)(o.c,{intent:"danger",title:"Incorrect file format",style:{marginBottom:"10px"}}),Object(x.jsxs)(o.c,{intent:"primary",children:["Import a saved analysis from ",Object(x.jsx)("strong",{children:"kana"}),". These files are gzipped and are stored as ",Object(x.jsx)("strong",{children:Object(x.jsx)("code",{children:"*.kana.gz"})}),"."]})]})]})})]})}),n?Object(x.jsx)("div",{className:b.a.DIALOG_FOOTER,children:Object(x.jsx)("div",{className:b.a.DIALOG_FOOTER_ACTIONS,children:Object(x.jsx)(u.a,{content:"Run Analysis",children:Object(x.jsx)(o.a,{disabled:!z,icon:"function",onClick:function(){k(B),C({format:"new"==X?J:"kana",files:A}),w()},children:"Analyze"})})})}):Object(x.jsx)("div",{style:{margin:"0 20px"}})]}))]})},y=function(){var e=Object(a.useContext)(m),t=e.initDims,n=e.qcDims;return Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)("span",{children:[": ",t?"".concat(t):" ???",n?" (after QC: ".concat(n,")"):""]})})},w=function(){var e=Object(a.useContext)(m).logs,t=Object(a.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!0,enforceFocus:!0,hasBackdrop:!0,isOpen:!1,position:p.a.RIGHT,size:void 0,usePortal:!0}),n=Object(r.a)(t,2),s=n[0],i=n[1];return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(o.a,{onClick:function(){return i({isOpen:!0})},icon:"wrench",outlined:!0,intent:"warning"}),Object(x.jsx)(o.i,Object(c.a)(Object(c.a)({icon:"info-sign",onClose:function(){return i({isOpen:!1})},title:"What's happening ?"},s),{},{children:Object(x.jsx)("div",{className:b.a.DRAWER_BODY,children:Object(x.jsx)("div",{className:b.a.DIALOG_BODY,children:Object(x.jsx)("ul",{className:"list",children:e.map((function(e,t){return Object(x.jsx)("li",{children:e},t)}))})})})}))]})},F=n(34),C=["buttonText","includeFooter"];var N=function(e){e.buttonText,e.includeFooter;var t=Object(j.a)(e,C),n=Object(a.useContext)(m).setOpenInput,s=Object(a.useState)(!0),i=Object(r.a)(s,2),l=i[0],d=i[1],h=Object(a.useState)(!1),p=Object(r.a)(h,2),O=p[0],f=p[1],v=Object(a.useCallback)((function(){d(!l),f(!0)}),[l]),g=Object(a.useCallback)((function(){return d(!1)}),[]);return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(o.a,{onClick:v,icon:"info-sign",intent:"primary",text:""}),Object(x.jsxs)(o.g,Object(c.a)(Object(c.a)({},t),{},{isOpen:l,onClose:g,children:[Object(x.jsx)("div",{className:b.a.DIALOG_BODY,children:Object(x.jsxs)(o.d,{elevation:F.a.ZERO,children:[Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"kana"})," performs a standard scRNA-seq data analysis directly inside the browser."]}),Object(x.jsxs)("p",{children:["With just a few clicks, you can get a UMAP/t-SNE and marker genes in an intuitive interface for further exploration. No need to transfer data, no need to install software, no need to configure a backend server - just point to a Matrix Market file and we'll analyze ",Object(x.jsx)("em",{children:"your"})," data on ",Object(x.jsx)("em",{children:"your"})," computer, no questions asked."]}),Object(x.jsxs)("p",{children:["Check out our ",Object(x.jsx)("a",{href:"https://github.com/jkanche/scran.js.app",target:"_blank",children:"GitHub page"})," for more details. Or you could just play around with the app to see what it can do - after all, it's totally free!"]}),Object(x.jsx)(o.m,{children:"Authors"}),"Jayaram Kancherla (",Object(x.jsx)("a",{href:"https://github.com/jkanche",target:"_blank",children:Object(x.jsx)("strong",{children:"@jkanche"})}),"), Aaron Lun (",Object(x.jsx)("a",{href:"https://github.com/LTLA",target:"_blank",children:Object(x.jsx)("strong",{children:"@LTLA"})}),")"]})}),Object(x.jsx)("div",{className:b.a.DIALOG_FOOTER,children:Object(x.jsx)("div",{className:b.a.DIALOG_FOOTER_ACTIONS,children:O?Object(x.jsx)(o.a,{icon:"cross",onClick:g,children:"Close"}):Object(x.jsx)(u.a,{content:"\u884c\u304f\u305e!",children:Object(x.jsx)(o.a,{icon:"bring-data",onClick:function(){n(!0),g()},children:"Get started"})})})})]}))]})},k=function(){var e=Object(a.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!1,enforceFocus:!0,shouldReturnFocusOnClose:!0}),t=Object(r.a)(e,1)[0],n=Object(a.useContext)(m),s=n.setExportState,i=n.datasetName,l=n.setDatasetName;return Object(x.jsx)(x.Fragment,{children:Object(x.jsx)(o.t,{className:"bp3-dark",children:Object(x.jsxs)(o.v,{className:"navbar-group",align:d.a.LEFT,children:[Object(x.jsx)(o.w,{children:"kana"}),Object(x.jsx)(o.u,{}),Object(x.jsx)("span",{children:"Single cell RNA-seq analysis in the browser"}),Object(x.jsx)(o.u,{}),Object(x.jsx)(g,Object(c.a)({icon:"document",title:"Import dataset & update parameters (mouseover for info)",buttonText:"Start Analysis",includeFooter:!0},t)),Object(x.jsx)(o.u,{}),Object(x.jsx)(u.a,{content:"Modify dataset title",children:Object(x.jsx)(o.j,{defaultValue:i,intent:"primary",onConfirm:function(e){l(e)}})}),Object(x.jsx)(y,{}),Object(x.jsx)(o.u,{}),Object(x.jsx)(o.b,{children:Object(x.jsx)(h.a,{content:Object(x.jsxs)(o.r,{children:[Object(x.jsx)(o.s,{text:"Save",icon:"floppy-disk",disabled:!0}),Object(x.jsx)(o.s,{text:"Download",icon:"download",onClick:function(){s(!0)}})]}),placement:"bottom-start",children:Object(x.jsx)(o.a,{intent:"warning",rightIcon:"caret-down",text:"Export"})})}),Object(x.jsx)(o.u,{}),Object(x.jsx)(w,{}),Object(x.jsx)(o.u,{}),Object(x.jsx)(N,Object(c.a)({icon:"document",title:"Single-cell RNA-seq analysis in the browser",isOpen:!0},t))]})})})},S=n(15),D=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,a=null===e||void 0===e?void 0:e.width,s=null===e||void 0===e?void 0:e.color,i=null===e||void 0===e?void 0:e.ymax;if(i||(i=Math.max.apply(Math,Object(l.a)(n.map((function(e){return e.value}))))),a||(a=325),s||(s="#00B3A4"),!n)return"";var c=t.current;c.innerHTML="";var r=10,o=30,d=30,u=40,h=a-u-o,j=200-r-d,b=S.m(c).append("svg").attr("width",h+u+o).attr("height",j+r+d).append("g").attr("transform","translate(".concat(u,",").concat(r,")")),p=S.j().range([0,h]).domain(n.map((function(e){return e.key}))).padding(.2);b.append("g").attr("transform","translate(0,"+j+")").call(S.b(p)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");var O=S.k().domain([0,i]).range([j,0]);b.append("g").call(S.c(O)),b.selectAll("bars").data(n).enter().append("rect").attr("x",(function(e){return p(e.key)})).attr("y",(function(e){return O(e.value)})).attr("width",p.bandwidth()).attr("height",(function(e){return j-O(e.value)})).attr("fill",(function(e,t){return Array.isArray(s)?s[t]:s}))}),[]),Object(x.jsx)("div",{ref:t})},E=function(e){var t,n,a=null===e||void 0===e||null===(t=e.pca)||void 0===t?void 0:t.var_exp;if(!a)return"";var s=[];return null===(n=Object.values(a))||void 0===n||n.forEach((function(e,t){s.push({key:t+1,value:100*e})})),Object(x.jsx)(D,{data:s})},A=n(63),M=function(e){var t,n,s=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.clusters,i=Object(a.useContext)(m).setClusterColors,c=Object(a.useState)(null),l=Object(r.a)(c,2),o=l[0],d=l[1];if(Object(a.useEffect)((function(){var e=Object.keys(h).length,t=null;t=e>Object.keys(u).length?Object(A.randomColor)({luminosity:"dark",count:e+1}):u[e.toString()],d(t)}),[]),Object(a.useEffect)((function(){i(o)}),[o]),!s)return"";for(var u={1:["#1b9e77"],2:["#1b9e77","#d95f02"],3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},h={},j=0;j<(null===s||void 0===s?void 0:s.length);j++){var b=s[j];"CLUS_"+b in h?h["CLUS_"+b]++:h["CLUS_"+b]=0}var p=[];return null===(n=Object.values(h))||void 0===n||n.forEach((function(e,t){p.push({key:t+1,value:e})})),o&&Object(x.jsx)(D,{data:p,color:o})},T=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){var n=null===e||void 0===e?void 0:e.rdata,a=null===e||void 0===e?void 0:e.width,s=null===e||void 0===e?void 0:e.color;if(a||(a=200),s||(s="#00B3A4"),!n)return"";var i=t.current;i.innerHTML="";var c=10,l=30,r=30,o=40,d=a-o-l,u=200-c-r,h=S.m(i).append("svg").attr("width",d+o+l).attr("height",u+c+r).append("g").attr("transform","translate(".concat(o,",").concat(c,")")),j=S.k().domain(null===e||void 0===e?void 0:e.range).range([u,0]).nice();h.append("g").call(S.c(j));var b=S.j().range([0,d]).domain([null===e||void 0===e?void 0:e.showLabel]).padding(.05);h.append("g").attr("transform","translate(0,"+u+")").call(S.b(b));var p=S.f().domain(j.domain()).thresholds(j.ticks(20)).value((function(e){return e}))(n),O=S.i(p,(function(e){return e.length})),x=S.k().range([0,b.bandwidth()]).domain([-O,O]);h.selectAll("violins").data([null===e||void 0===e?void 0:e.label]).enter().append("g").attr("transform",(function(e){return"translate("+b(e)+" ,0)"})).append("path").datum((function(){return p})).style("stroke","none").style("fill",s).attr("d",S.a().x0((function(e){return x(-e.length)})).x1((function(e){return x(e.length)})).y((function(e){return j(e.x0)})).curve(S.d)),h.selectAll("threshold").data([null===e||void 0===e?void 0:e.threshold]).enter().append("line").attr("transform",(function(){return"translate("+b(null===e||void 0===e?void 0:e.label)+" ,0)"})).attr("class","threshold").attr("x1",5).attr("y1",(function(e){return j(e)})).attr("x2",b.bandwidth()-5).attr("y2",(function(e){return j(e)})).attr("stroke-width",2).attr("stroke","Orange").on("mouseover",(function(){var e=S.m(this);e.attr("stroke","black"),e.attr("stroke-width","8")})).on("mouseout",(function(){var e=S.m(this);e.attr("stroke","Orange"),e.attr("stroke-width","5")}))}),[]),Object(x.jsx)("div",{ref:t})},L=(n(315),function(e){var t=e.data;return Object(x.jsx)("div",{className:"qc-plots",children:["sums","detected","proportion"].map((function(e){var n,a,s,i,l,r,o={threshold:"proportion"!==e?Math.log2(null===t||void 0===t||null===(n=t.thresholds)||void 0===n?void 0:n[e]):100*(null===t||void 0===t||null===(a=t.thresholds)||void 0===a?void 0:a[e]),range:"proportion"!==e?null===t||void 0===t||null===(s=t.ranges)||void 0===s?void 0:s[e].map((function(e){return Math.log2(e+1)})):null===t||void 0===t||null===(i=t.ranges)||void 0===i?void 0:i[e].map((function(e){return 100*e})),label:e,showLabel:"proportion"!==e?e+" (log)":e+" (%)",rdata:"proportion"!==e?null===t||void 0===t||null===(l=t.data)||void 0===l?void 0:l[e].map((function(e){return Math.log2(e+1)})):null===t||void 0===t||null===(r=t.data)||void 0===r?void 0:r[e].map((function(e){return 100*e}))};return Object(x.jsx)("div",{children:Object(x.jsx)(T,Object(c.a)({},o))},e)}))})}),I=(n(316),function(){var e=Object(a.useContext)(m),t=e.pcaVarExp,n=e.qcData,s=e.clusterData;return Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)("div",{className:"gallery-cont",children:[s?Object(x.jsxs)(o.d,{className:"gallery-elem",elevation:F.a.ONE,children:[Object(x.jsx)("h5",{children:"# of cells per cluster"}),Object(x.jsx)(M,{data:s})]}):"",t?Object(x.jsxs)(o.d,{className:"gallery-elem",elevation:F.a.ONE,children:[Object(x.jsx)("h5",{children:"PCA (% variance explained)"}),Object(x.jsx)(E,{pca:t})]}):"",n&&(null===n||void 0===n?void 0:n.thresholds)?Object(x.jsxs)(o.d,{className:"gallery-elem",elevation:F.a.ONE,children:[Object(x.jsx)("h5",{children:"QC Statistics"}),Object(x.jsx)(L,{data:n})]}):""]})})}),R=n(79),q=function(e){var t=-Number.MAX_VALUE,n=Number.MAX_VALUE;return e.forEach((function(e){t<e&&(t=e),n>e&&(n=e)})),[n,t]};function _(){var e=null,t=0,n=100,a=["ff0000","ffff00","00ff00","0000ff"];function s(s){if(s.length<2)throw new Error("Rainbow must have two or more colours.");var i=(n-t)/(s.length-1),c=new B;c.setGradient(s[0],s[1]),c.setNumberRange(t,t+i),e=[c];for(var l=1;l<s.length-1;l++){var r=new B;r.setGradient(s[l],s[l+1]),r.setNumberRange(t+i*l,t+i*(l+1)),e[l]=r}a=s}s(a),this.setSpectrum=function(){return s(arguments),this},this.setSpectrumByArray=function(e){return s(e),this},this.colourAt=function(a){if(isNaN(a))throw new TypeError(a+" is not a number");if(1===e.length)return e[0].colourAt(a);var s=(n-t)/e.length,i=Math.min(Math.floor((Math.max(a,t)-t)/s),e.length-1);return e[i].colourAt(a)},this.colorAt=this.colourAt,this.setNumberRange=function(e,i){if(!(i>e))throw new RangeError("maxNumber ("+i+") is not greater than minNumber ("+e+")");return t=e,n=i,s(a),this}}function B(){var e="ff0000",t="0000ff",n=0,a=100;function s(e,t,s){var i=e;i<n&&(i=n),i>a&&(i=a);var c,l=a-n,r=parseInt(t,16),o=(parseInt(s,16)-r)/l,d=Math.round(o*(i-n)+r);return 1===(c=d.toString(16)).length?"0"+c:c}function i(e){if(function(e){return/^#?[0-9a-fA-F]{6}$/i.test(e)}(e))return e.substring(e.length-6,e.length);var t=e.toLowerCase();if(c.hasOwnProperty(t))return c[t];throw new Error(e+" is not a valid colour.")}this.setGradient=function(n,a){e=i(n),t=i(a)},this.setNumberRange=function(e,t){if(!(t>e))throw new RangeError("maxNumber ("+t+") is not greater than minNumber ("+e+")");n=e,a=t},this.colourAt=function(n){return s(n,e.substring(0,2),t.substring(0,2))+s(n,e.substring(2,4),t.substring(2,4))+s(n,e.substring(4,6),t.substring(4,6))};var c={aliceblue:"F0F8FF",antiquewhite:"FAEBD7",aqua:"00FFFF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000000",blanchedalmond:"FFEBCD",blue:"0000FF",blueviolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetblue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerblue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"00FFFF",darkblue:"00008B",darkcyan:"008B8B",darkgoldenrod:"B8860B",darkgray:"A9A9A9",darkgreen:"006400",darkgrey:"A9A9A9",darkkhaki:"BDB76B",darkmagenta:"8B008B",darkolivegreen:"556B2F",darkorange:"FF8C00",darkorchid:"9932CC",darkred:"8B0000",darksalmon:"E9967A",darkseagreen:"8FBC8F",darkslateblue:"483D8B",darkslategray:"2F4F4F",darkslategrey:"2F4F4F",darkturquoise:"00CED1",darkviolet:"9400D3",deeppink:"FF1493",deepskyblue:"00BFFF",dimgray:"696969",dimgrey:"696969",dodgerblue:"1E90FF",firebrick:"B22222",floralwhite:"FFFAF0",forestgreen:"228B22",fuchsia:"FF00FF",gainsboro:"DCDCDC",ghostwhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"808080",green:"008000",greenyellow:"ADFF2F",grey:"808080",honeydew:"F0FFF0",hotpink:"FF69B4",indianred:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderblush:"FFF0F5",lawngreen:"7CFC00",lemonchiffon:"FFFACD",lightblue:"ADD8E6",lightcoral:"F08080",lightcyan:"E0FFFF",lightgoldenrodyellow:"FAFAD2",lightgray:"D3D3D3",lightgreen:"90EE90",lightgrey:"D3D3D3",lightpink:"FFB6C1",lightsalmon:"FFA07A",lightseagreen:"20B2AA",lightskyblue:"87CEFA",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"B0C4DE",lightyellow:"FFFFE0",lime:"00FF00",limegreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumaquamarine:"66CDAA",mediumblue:"0000CD",mediumorchid:"BA55D3",mediumpurple:"9370DB",mediumseagreen:"3CB371",mediumslateblue:"7B68EE",mediumspringgreen:"00FA9A",mediumturquoise:"48D1CC",mediumvioletred:"C71585",midnightblue:"191970",mintcream:"F5FFFA",mistyrose:"FFE4E1",moccasin:"FFE4B5",navajowhite:"FFDEAD",navy:"000080",oldlace:"FDF5E6",olive:"808000",olivedrab:"6B8E23",orange:"FFA500",orangered:"FF4500",orchid:"DA70D6",palegoldenrod:"EEE8AA",palegreen:"98FB98",paleturquoise:"AFEEEE",palevioletred:"DB7093",papayawhip:"FFEFD5",peachpuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderblue:"B0E0E6",purple:"800080",red:"FF0000",rosybrown:"BC8F8F",royalblue:"4169E1",saddlebrown:"8B4513",salmon:"FA8072",sandybrown:"F4A460",seagreen:"2E8B57",seashell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyblue:"87CEEB",slateblue:"6A5ACD",slategray:"708090",slategrey:"708090",snow:"FFFAFA",springgreen:"00FF7F",steelblue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFFFFF",whitesmoke:"F5F5F5",yellow:"FFFF00",yellowgreen:"9ACD32"}}n(328);var G=function(){var e,t,n=Object(a.useRef)(),s=Object(a.useState)(null),i=Object(r.a)(s,2),d=i[0],h=i[1],j=Object(a.useState)(null),b=Object(r.a)(j,2),p=b[0],O=b[1],f=Object(a.useState)(!1),v=Object(r.a)(f,2),g=v[0],y=v[1],w=Object(a.useState)(null),F=Object(r.a)(w,2),C=F[0],N=F[1],k=Object(a.useState)(C),S=Object(r.a)(k,2),D=S[0],E=S[1],M=Object(a.useState)(null),T=Object(r.a)(M,2),L=T[0],I=T[1],B=Object(a.useContext)(m),G=(B.plotRedDims,B.redDims),P=B.defaultRedDims,W=B.setDefaultRedDims,z=B.clusterData,V=B.tsneData,U=B.umapData,H=(B.setPlotRedDims,B.clusterColors),X=B.setClusterColors,Q=B.gene,Y=B.selectedClusterSummary,Z=B.customSelection,J=B.setCustomSelection,K=B.setDelCustomSelection,$=B.showAnimation,ee=B.setTriggerAnimation,te=Object(a.useState)(null),ne=Object(r.a)(te,2),ae=ne[0],se=ne[1],ie=Object(a.useState)("PAN"),ce=Object(r.a)(ie,2),le=ce[0],re=ce[1],oe=Math.max.apply(Math,Object(l.a)(null===z||void 0===z?void 0:z.clusters));Object(a.useEffect)((function(){var e;if(null===Q&&(y(!1),I(null)),null===Y||void 0===Y||null===(e=Y[Q])||void 0===e?void 0:e.expr){var t,n=q(null===Y||void 0===Y||null===(t=Y[Q])||void 0===t?void 0:t.expr),a=0===n[1]?.01:n[1],s=new _;s.setSpectrum("#F5F8FA","#2965CC"),s.setNumberRange(0,a),y(!0),I(s),E([0,a]),N([0,a])}}),[null===Y||void 0===Y||null===(e=Y[Q])||void 0===e?void 0:e.expr],Q),Object(a.useEffect)((function(){if(Array.isArray(D)){var e=new _;e.setSpectrum("#F5F8FA","#2965CC"),e.setNumberRange.apply(e,Object(l.a)(D)),I(e),y(!0)}}),[D]),Object(a.useEffect)((function(){if(n.current){var e=d;if(!e){var t=n.current;t.style.width="95%",t.style.height="95%",e=new R.ScatterGL(t,{onSelect:function(e){0!==e.length&&se(e)},orbitControls:{zoomSpeed:1.25},styles:{point:{scaleDefault:.4,scaleSelected:1.25,scaleHover:1.25}}}),e.setPanMode(),h(e)}var a=null;if("TSNE"===P?a=V:"UMAP"===P&&(a=U),a){var s=null===z||void 0===z?void 0:z.clusters,i=H,c=[];a.x.forEach((function(e,t){c.push([e,a.y[t]])}));var l={clusters:s},r=new R.ScatterGL.Dataset(c,l);e.render(r),e.setPointColorer((function(e,t,n){var a,c,l;if(t.has(e))return"#30404D";if(null!=p)if(String(p).startsWith("cs")){if(!Z[p].includes(e))return"#D3D3D3"}else if(p!==s[e])return"#D3D3D3";if(null!==Q&&Array.isArray(null===Y||void 0===Y||null===(a=Y[Q])||void 0===a?void 0:a.expr))return"#"+L.colorAt(null===Y||void 0===Y||null===(c=Y[Q])||void 0===c||null===(l=c.expr)||void 0===l?void 0:l[e]);if(null!=p&&String(p).startsWith("cs")){var r=parseInt(p.replace("cs",""));return i[oe+r]}return i[s[e]]}))}}}),[V,U,P,L,p]);var de=function(e){"PAN"===e?(d.setPanMode(),re("PAN")):"SELECT"===e&&(d.setSelectMode(),re("SELECT"))};return Object(x.jsxs)("div",{className:"scatter-plot",children:[Object(x.jsxs)(o.b,{style:{minWidth:75,minHeight:150},fill:!1,large:!1,minimal:!1,vertical:!0,className:"left-sidebar",children:[Object(x.jsxs)(o.a,{className:"dim-button",disabled:-1===G.indexOf("TSNE"),onClick:function(){return W("TSNE")},intent:"TSNE"===P?"primary":"",children:[Object(x.jsx)(o.o,{icon:"database"}),Object(x.jsx)("br",{}),Object(x.jsx)("span",{children:"TSNE"})]}),Object(x.jsxs)(o.a,{className:"dim-button",disabled:-1===G.indexOf("UMAP"),onClick:function(){return W("UMAP")},intent:"UMAP"===P?"primary":"",children:[Object(x.jsx)(o.o,{icon:"database"}),Object(x.jsx)("br",{}),Object(x.jsx)("span",{children:"UMAP"})]})]}),Object(x.jsxs)("div",{className:"top-header",children:[Object(x.jsxs)(o.f,{fill:!1,vertical:!1,style:{marginRight:"4px"},children:[Object(x.jsx)(u.a,{content:"Interactively visualize embeddings",children:Object(x.jsx)(o.a,{icon:"play",onClick:function(){return ee(!0)},children:"Animate"})}),Object(x.jsx)(u.a,{content:"Save this embedding",children:Object(x.jsx)(o.a,{icon:"inheritance",children:"Save"})})]}),Object(x.jsxs)(o.f,{fill:!1,vertical:!1,children:[Object(x.jsx)(o.a,{active:"PAN"==le,intent:"PAN"===le?"primary":"none",icon:"hand-up",onClick:function(e){return de("PAN")},children:"Pan"}),Object(x.jsx)(o.a,{active:"SELECT"==le,intent:"SELECT"===le?"primary":"none",icon:"widget",onClick:function(e){return de("SELECT")},children:"Selection"})]})]}),$?Object(x.jsxs)(o.q,{className:"iter",children:["Iteration: ","TSNE"===P?null===V||void 0===V?void 0:V.iteration:null===U||void 0===U?void 0:U.iteration]}):"",Object(x.jsx)("div",{className:"dim-plot",children:P?Object(x.jsx)("div",{ref:n}):"Choose an Embedding... or Embeddings are being computed..."}),Object(x.jsx)("div",{className:"right-sidebar",children:Object(x.jsxs)("div",{style:{width:"100%"},children:[Object(x.jsxs)("div",{className:"right-sidebar-cluster",children:[Object(x.jsxs)(o.c,{title:"CLUSTERS",children:[Object(x.jsx)("ul",{children:null===H||void 0===H?void 0:H.map((function(e,t){return t<H.length-Object.keys(Z).length?Object(x.jsxs)("li",{className:p==t?"legend-highlight":"",style:{color:e},onClick:function(){O(t===p?null:t)},children:[" Cluster ",t+1," "]},t):""}))}),Object.keys(Z).length>0?Object(x.jsxs)("div",{style:{paddingTop:"5px"},children:[Object(x.jsxs)("span",{children:["Custom Selection \xa0",Object(x.jsx)(u.a,{content:"Custom selection of cells",openOnTargetFocus:!1,children:Object(x.jsx)(o.o,{icon:"help"})})]}),Object(x.jsx)("ul",{children:null===(t=Object.keys(Z))||void 0===t?void 0:t.map((function(e,t){return Object(x.jsx)("li",{className:p==e?"legend-highlight":"",style:{color:H[Math.max.apply(Math,Object(l.a)(null===z||void 0===z?void 0:z.clusters))+1+t]},children:Object(x.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",flexDirection:"row"},children:[Object(x.jsxs)("span",{style:{alignSelf:"center"},onClick:function(){O(e===p?null:e)},children:["Custom Selection ",e.replace("cs","")]}),Object(x.jsx)(o.o,{size:12,icon:"trash",style:{paddingLeft:"2px"},onClick:function(){var t=Object(c.a)({},Z);delete t[e],J(t);var n=Object(l.a)(H);n=n.slice(0,n.length-1),X(n),K(e),p===e&&O(null)}})]})},e)}))})]}):""]}),ae&&ae.length>0?Object(x.jsxs)("div",{children:[Object(x.jsx)(o.h,{}),Object(x.jsxs)("span",{children:["Selection \xa0",Object(x.jsx)(u.a,{content:"save this selection of cells",openOnTargetFocus:!1,children:Object(x.jsx)(o.o,{icon:"help"})})]}),Object(x.jsxs)("div",{className:"selection-container",children:[Object(x.jsxs)("span",{children:[ae.length," cells selected"]}),Object(x.jsxs)("div",{className:"selection-button-container",children:[Object(x.jsx)(o.a,{small:!0,intent:"primary",onClick:function(){var e=Object(A.randomColor)({luminosity:"dark",count:1}),t=Object(l.a)(H);t.push(e[0]),X(t);var n=Object.keys(Z).length,a=Object(c.a)({},Z);a["cs".concat(n+1)]=ae,J(a),se(null),d.select(null)},children:"Save"}),Object(x.jsx)(o.a,{small:!0,onClick:function(){se(null),d.select(null)},children:"Clear"})]})]})]}):""]}),g?Object(x.jsxs)("div",{className:"right-sidebar-slider",children:[Object(x.jsx)(o.h,{}),Object(x.jsxs)(o.c,{children:[Object(x.jsxs)("span",{children:["Customize Gradient \xa0",Object(x.jsx)(u.a,{content:"Use the slider to adjust the color gradient of the plot. Useful when data is skewed by either a few lowly or highly expressed cells",openOnTargetFocus:!1,children:Object(x.jsx)(o.o,{icon:"help"})})]}),Object(x.jsxs)("div",{className:"dim-slider-container",children:[Object(x.jsxs)("div",{className:"dim-slider-gradient",children:[Object(x.jsx)("span",{children:Math.round(C[0])}),"\xa0",Object(x.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, #F5F8FA ".concat(100*(D[0]-C[0])/(C[1]-C[0]),"%, ").concat(100*(D[1]+D[0]-2*C[0])/(2*(C[1]-C[0])),"%, #2965CC ").concat(100-100*(C[1]-D[1])/(C[1]-C[0]),"%)"),width:"175px",height:"15px"}}),"\xa0",Object(x.jsx)("span",{children:Math.round(C[1])})]}),Object(x.jsx)("div",{className:"dim-range-slider",children:Object(x.jsx)(o.A,{min:Math.round(C[0]),max:Math.round(C[1]),stepSize:Math.round(C[1]-C[0])/25,onChange:function(e){E(e)},value:[Math.round(D[0]),Math.round(D[1])],vertical:!1})})]})]})]}):""]})})]})},P=n(136),W=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,a=null===e||void 0===e?void 0:e.width,s=null===e||void 0===e?void 0:e.color,i=null===e||void 0===e?void 0:e.clusters;if(a||(a=325),s||(s="#00B3A4"),!n)return"";var c=t.current;c.innerHTML="";var r=10,o=30,d=30,u=40,h=a-u-o,j=150-r-d,b=S.m(c).append("svg").attr("width",h+u+o).attr("height",j+r+d).append("g").attr("transform","translate(".concat(u,",").concat(r,")")),p=S.k().domain([0,Math.max.apply(Math,Object(l.a)(n))]).range([0,h]);b.append("g").attr("transform","translate(0, ".concat(j,")")).call(S.b(p));var O=S.f().value((function(e){return e})).domain(p.domain()).thresholds(p.ticks(25)),x=O(n),m=O(n.filter((function(e,t){return 0===(null===i||void 0===i?void 0:i[t])}))),f=O(n.filter((function(e,t){return 1===(null===i||void 0===i?void 0:i[t])}))),v=S.k().range([j,0]).domain([0,S.i(x,(function(e){return e.length}))]);b.selectAll("rectAll").data(m).join("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(p(e.x0)," , ").concat(v(e.length),")")})).attr("width",(function(e){return p(e.x1)-p(e.x0)-1})).attr("height",(function(e){return j-v(e.length)})).style("fill","#D3D3D3").style("opacity",.6),b.selectAll("rectCluster").data(f).enter().append("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(p(e.x0),", ").concat(v(e.length),")")})).attr("width",(function(e){return p(e.x1)-p(e.x0)-1})).attr("height",(function(e){return j-v(e.length)})).style("fill",s).style("opacity",.6),b.append("circle").attr("cx",h-50).attr("cy",5).attr("r",3).style("fill","#D3D3D3"),b.append("circle").attr("cx",h-50).attr("cy",15).attr("r",3).style("fill",s),b.append("text").attr("x",h-40).attr("y",5).text("all cells").style("font-size","10px").attr("alignment-baseline","middle"),b.append("text").attr("x",h-40).attr("y",15).text("this cluster").style("font-size","10px").attr("alignment-baseline","middle")}),[]),Object(x.jsx)("div",{ref:t})},z=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,a=null===e||void 0===e?void 0:e.width,s=null===e||void 0===e?void 0:e.height,i=null===e||void 0===e?void 0:e.color;if(a||(a=325),s||(s=150),i||(i="#00B3A4"),!n)return"";var c=t.current;c.innerHTML="";var r=5,o=5,d=5,u=5,h=a-u-o,j=s-r-d,b=S.m(c).append("svg").attr("width",h+u+o).attr("height",j+r+d).append("g").attr("transform","translate(".concat(u,",").concat(r,")")),p=S.k().domain([0,Math.max.apply(Math,Object(l.a)(n))]).range([0,h]);b.append("g").attr("transform","translate(0, ".concat(j,")")).call(S.b(p));var O=S.f().value((function(e){return e})).domain(p.domain()).thresholds(p.ticks(25))(n),x=S.k().range([j,0]);x.domain([0,S.i(O,(function(e){return e.length}))]),b.selectAll("rect").data(O).join("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(p(e.x0)," , ").concat(x(e.length),")")})).attr("width",(function(e){return p(e.x1)-p(e.x0)-1})).attr("height",(function(e){return j-x(e.length)})).style("fill",i)}),[null===e||void 0===e?void 0:e.data]),Object(x.jsx)("div",{ref:t})},V=function(e){var t=Object(a.useRef)(),n=null===e||void 0===e?void 0:e.width,s=null===e||void 0===e?void 0:e.minmax,i=null===e||void 0===e?void 0:e.score,c=null===e||void 0===e?void 0:e.colorscale,l=null===e||void 0===e?void 0:e.colorscore,r=null===e||void 0===e?void 0:e.color,o=(i-s[0])/(s[1]-s[0]);return n||(n="100%"),r||(r="#00B3A4"),Object(x.jsx)("div",{ref:t,style:{width:n,height:"15px",margin:"5px",border:"1px solid gainsboro",alignItems:"center"},children:c?Object(x.jsx)("div",{style:{width:"".concat(100*l,"%"),backgroundColor:c(l),height:"100%"}}):Object(x.jsx)("div",{style:{width:"".concat(100*o,"%"),backgroundColor:r,height:"100%"}})})},U=function(e){var t=Object(a.useRef)(),n=null===e||void 0===e?void 0:e.width,s=null===e||void 0===e?void 0:e.score,i=null===e||void 0===e?void 0:e.minmax,c=S.l(S.h).domain([i[1],i[0]]);return n||(n="100%"),Object(x.jsx)("div",{ref:t,style:{width:n,height:"15px",margin:"5px",border:"1px solid gainsboro",alignItems:"center",backgroundColor:c(s)},children:Object(x.jsx)("div",{style:{width:"100%",backgroundColor:c(s),height:"100%"}})})},H=(n(329),["children"]),X=function(){var e=Object(a.useContext)(m),t=e.genesInfo,n=e.clusterData,s=e.selectedClusterSummary,i=e.setSelectedClusterSummary,d=e.selectedCluster,p=e.setSelectedCluster,O=e.setClusterRank,f=e.setReqGene,v=e.clusterColors,g=e.gene,y=e.setGene,w=e.customSelection,C=Object(a.useState)(null),N=Object(r.a)(C,2),k=N[0],D=N[1],E=Object(a.useState)(null),A=Object(r.a)(E,2),M=A[0],T=A[1],L=Object(a.useState)(null),I=Object(r.a)(L,2),R=I[0],q=I[1],_=Object(a.useState)(null),B=Object(r.a)(_,2),G=B[0],X=B[1],Q=Object(a.useState)(null),Y=Object(r.a)(Q,2),Z=Y[0],J=Y[1],K=Object(a.useState)(null),$=Object(r.a)(K,2),ee=$[0],te=$[1],ne=Object(a.useState)(null),ae=Object(r.a)(ne,2),se=ae[0],ie=ae[1],ce=Object(a.useState)(null),le=Object(r.a)(ce,2),re=le[0],oe=le[1],de=Object(a.useState)(null),ue=Object(r.a)(de,2),he=ue[0],je=ue[1],be=Object(a.useState)(null),pe=Object(r.a)(be,2),Oe=pe[0],xe=pe[1],me=Object(a.useState)(null),fe=Object(r.a)(me,2),ve=fe[0],ge=fe[1],ye=Object(a.useState)(null),we=Object(r.a)(ye,2),Fe=we[0],Ce=we[1],Ne=Object(a.useState)({}),ke=Object(r.a)(Ne,2),Se=ke[0],De=ke[1],Ee=Object(a.useState)(null),Ae=Object(r.a)(Ee,2),Me=Ae[0],Te=Ae[1],Le=S.h;Object(a.useEffect)((function(){if(!s)return s;var e=s;if(0===e.length)return e;var t=e.map((function(e){return null===e||void 0===e?void 0:e.mean})),n=S.e(t),a=0===n[1]?.01:n[1];X([parseFloat(n[0].toFixed(2)),parseFloat(a.toFixed(2))]),je(t);var i=e.map((function(e){return null===e||void 0===e?void 0:e.delta})),c=S.e(i),r=0===c[1]?.01:c[1];J([parseFloat(c[0].toFixed(2)),parseFloat(r.toFixed(2))]),xe(i);var o=e.map((function(e){return null===e||void 0===e?void 0:e.lfc})),d=S.e(o),u=0===d[1]?.01:d[1];te([parseFloat(d[0].toFixed(2)),parseFloat(u.toFixed(2))]),ge(o);var h=e.map((function(e){return null===e||void 0===e?void 0:e.detected})),j=S.e(h),b=0===j[1]?.01:j[1];ie([parseFloat(j[0].toFixed(2)),parseFloat(b.toFixed(2))]),Ce(h),oe({lfc:[parseFloat(d[0].toFixed(2)),parseFloat(u.toFixed(2))],mean:[parseFloat(n[0].toFixed(2)),parseFloat(a.toFixed(2))],detected:[parseFloat(j[0].toFixed(2)),parseFloat(b.toFixed(2))],delta:[parseFloat(c[0].toFixed(2)),parseFloat(r.toFixed(2))]});var p=Object(l.a)(e);Te(p)}),[s]);var Ie=Object(a.useMemo)((function(){if(!Me)return[];var e=Me;if(Se){var n=function(t){var n=Se[t];if(n[0]==re[t][0]&&n[1]==re[t][1])return"continue";e=e.filter((function(e){return e[t]>=n[0]&&e[t]<=n[1]}))};for(var a in Se)n(a)}return R&&""!==R?e=e.filter((function(e){return-1!==t[e.row].toLowerCase().indexOf(R.toLowerCase())})):e}),[Me,R,Se]);Object(a.useEffect)((function(){if(null===n||void 0===n?void 0:n.clusters){for(var e=Math.max.apply(Math,Object(l.a)(n.clusters)),t=[],a=0;a<e+1;a++)t.push(a+1);t=t.concat(Object.keys(w)),D(t),null==d&&p(0)}}),[n,w,d]),Object(a.useEffect)((function(){var e,t,a=[];String(d).startsWith("cs")?null===n||void 0===n||null===(e=n.clusters)||void 0===e||e.forEach((function(e,t){return w[d].includes(t)?a.push(1):a.push(0)})):null===n||void 0===n||null===(t=n.clusters)||void 0===t||t.forEach((function(e){return e===d?a.push(1):a.push(0)}));T(a)}),[d]);var Re=function(e,t){var n=Object(c.a)({},Se);n[t]=e,De(n)};return Object(x.jsxs)("div",{className:"marker-container",children:[Object(x.jsx)(o.l,{children:"Marker Genes"}),k?Object(x.jsx)(o.n,{onChange:function(e){var t;y(null);var n=null===(t=e.currentTarget)||void 0===t?void 0:t.value;n.startsWith("Cluster")?n=parseInt(n.replace("Cluster ",""))-1:n.startsWith("Custom")&&(n=n.replace("Custom Selection ","")),p(n),De({}),y(null)},children:k.map((function(e,t){return Object(x.jsxs)("option",{children:[String(e).startsWith("cs")?"Custom Selection":"Cluster"," ",e]},t)}))}):"",s?Object(x.jsxs)("div",{className:"marker-table",children:[Object(x.jsxs)("div",{className:"marker-header",children:[Object(x.jsx)(o.p,{leftIcon:"search",small:!0,placeholder:"Search gene...",type:"text",onChange:function(e){return q(e.target.value)}}),Object(x.jsxs)("span",{children:[Object(x.jsx)(o.o,{icon:"sort",style:{paddingRight:"5px"}}),Object(x.jsxs)(o.n,{onChange:function(e){O(e.currentTarget.value)},defaultValue:"cohen-min-rank",children:[Object(x.jsx)("option",{children:"cohen-min"}),Object(x.jsx)("option",{children:"cohen-mean"}),Object(x.jsx)("option",{children:"cohen-min-rank"}),Object(x.jsx)("option",{children:"auc-min"}),Object(x.jsx)("option",{children:"auc-mean"}),Object(x.jsx)("option",{children:"auc-min-rank"}),Object(x.jsx)("option",{children:"lfc-min"}),Object(x.jsx)("option",{children:"lfc-mean"}),Object(x.jsx)("option",{children:"lfc-min-rank"}),Object(x.jsx)("option",{children:"delta-d-min"}),Object(x.jsx)("option",{children:"delta-d-mean"}),Object(x.jsx)("option",{children:"delta-d-min-rank"})]})]})]}),Object(x.jsx)(P.a,{components:{Item:function(e){var t=e.children,n=Object(j.a)(e,H);return Object(x.jsx)("div",Object(c.a)(Object(c.a)({className:"row-card"},n),{},{children:t}))},Header:function(){return Object(x.jsxs)("div",{className:"row-container row-header",children:[Object(x.jsx)("span",{children:"Gene"}),Object(x.jsx)("span",{children:"Log-FC"}),Object(x.jsx)("span",{children:"\u0394-detected"}),Object(x.jsxs)("span",{children:["Expression \xa0",Object(x.jsx)(u.a,{content:"bar represents the mean expression of the gene and the color gradient represents detected.",openOnTargetFocus:!1,children:Object(x.jsx)(o.o,{size:12,icon:"help"})})]}),Object(x.jsx)("span",{})]})}},className:"marker-list",totalCount:Ie.length,itemContent:function(e){var a=Ie[e],c=a.expanded,r=a.expr;return Object(x.jsxs)("div",{children:[Object(x.jsxs)("div",{className:"row-container",children:[Object(x.jsx)("span",{children:t[a.row]}),Object(x.jsx)(h.a,{popoverClassName:b.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(x.jsx)(o.d,{elevation:F.a.ZERO,children:Object(x.jsxs)("table",{children:[Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{}),Object(x.jsx)("th",{scope:"col",children:t[a.row]}),Object(x.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Log-FC"}),Object(x.jsx)("td",{children:a.lfc.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ee[0].toFixed(2),", ",ee[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(x.jsx)("td",{children:a.delta.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",Z[0].toFixed(2),", ",Z[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Detected"}),Object(x.jsx)("td",{children:a.detected.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",se[0].toFixed(2),", ",se[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Expression"}),Object(x.jsx)("td",{children:a.mean.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",G[0].toFixed(2),", ",G[1].toFixed(2),"]"]})]})]})}),children:Object(x.jsx)(U,{minmax:ee,colorscale:S.g,score:a.lfc})}),Object(x.jsx)(h.a,{popoverClassName:b.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(x.jsx)(o.d,{elevation:F.a.ZERO,children:Object(x.jsxs)("table",{children:[Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{}),Object(x.jsx)("th",{scope:"col",children:t[a.row]}),Object(x.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(x.jsx)("td",{children:a.delta.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",Z[0].toFixed(2),", ",Z[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Detected"}),Object(x.jsx)("td",{children:a.detected.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",se[0].toFixed(2),", ",se[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Log-FC"}),Object(x.jsx)("td",{children:a.lfc.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ee[0].toFixed(2),", ",ee[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Expression"}),Object(x.jsx)("td",{children:a.mean.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",G[0].toFixed(2),", ",G[1].toFixed(2),"]"]})]})]})}),children:Object(x.jsx)(U,{minmax:Z,colorscale:S.g,score:a.delta})}),Object(x.jsx)(h.a,{popoverClassName:b.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(x.jsx)(o.d,{elevation:F.a.ZERO,children:Object(x.jsxs)("table",{children:[Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{}),Object(x.jsx)("th",{scope:"col",children:t[a.row]}),Object(x.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Expression"}),Object(x.jsx)("td",{children:a.mean.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",G[0].toFixed(2),", ",G[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Log-FC"}),Object(x.jsx)("td",{children:a.lfc.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ee[0].toFixed(2),", ",ee[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(x.jsx)("td",{children:a.delta.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",Z[0].toFixed(2),", ",Z[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Detected"}),Object(x.jsx)("td",{children:a.detected.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",se[0].toFixed(2),", ",se[1].toFixed(2),"]"]})]})]})}),children:Object(x.jsx)(V,{minmax:G,colorscale:Le,score:a.mean,colorscore:a.detected})}),Object(x.jsxs)("div",{className:"row-action",children:[Object(x.jsx)(o.a,{icon:c?"minus":"plus",small:!0,fill:!1,className:"row-action",onClick:function(){var e=Object(l.a)(s);e[a.index].expanded=!e[a.index].expanded,i(e),r||f(a.row)}}),Object(x.jsx)(o.a,{small:!0,fill:!1,className:"row-action",onClick:function(){a.index===g?y(null):(y(a.index),r||f(a.row))},children:Object(x.jsx)(o.o,{icon:"tint",color:a.index===g&&String(d).startsWith("cs")?v[Math.max.apply(Math,Object(l.a)(null===n||void 0===n?void 0:n.clusters))+parseInt(d.replace("cs",""))]:""})})]})]}),Object(x.jsx)(o.e,{isOpen:c,children:r&&Object(x.jsx)(W,{data:r,color:String(d).startsWith("cs")?v[Math.max.apply(Math,Object(l.a)(null===n||void 0===n?void 0:n.clusters))+parseInt(d.replace("cs",""))]:v[d],clusters:M})})]})}}),Object(x.jsxs)("div",{className:"marker-footer",children:[Object(x.jsx)(o.m,{className:"marker-footer-title",children:"Filter Markers"}),Object(x.jsxs)("div",{className:"marker-filter-container",children:[Object(x.jsx)(o.F,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Log-FC"}),Object(x.jsx)(z,{data:ve,height:35,color:"#F5498B"}),Object(x.jsx)("div",{className:"marker-filter-slider",children:ee&&Object(x.jsx)(o.A,{min:ee[0],max:ee[1],stepSize:parseFloat((Math.abs(ee[1]-ee[0])/20).toFixed(2)),onChange:function(e){return Re(e,"lfc")},value:(null===Se||void 0===Se?void 0:Se.lfc)?null===Se||void 0===Se?void 0:Se.lfc:ee,vertical:!1})})]}),Object(x.jsxs)("div",{className:"marker-filter-container",children:[Object(x.jsx)(o.F,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"\u0394-detected"}),Object(x.jsx)(z,{data:Oe,height:35,color:"#4580E6"}),Object(x.jsx)("div",{className:"marker-filter-slider",children:Z&&Object(x.jsx)(o.A,{min:Z[0],max:Z[1],stepSize:parseFloat((Math.abs(Z[1]-Z[0])/20).toFixed(2)),onChange:function(e){return Re(e,"delta")},value:(null===Se||void 0===Se?void 0:Se.delta)?null===Se||void 0===Se?void 0:Se.delta:Z,vertical:!1})})]}),Object(x.jsxs)("div",{className:"marker-filter-container",children:[Object(x.jsx)(o.F,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Mean"}),Object(x.jsx)(z,{data:he,height:35}),Object(x.jsx)("div",{className:"marker-filter-slider",children:G&&Object(x.jsx)(o.A,{min:G[0],max:G[1],stepSize:parseFloat((Math.abs(G[1]-G[0])/20).toFixed(2)),onChange:function(e){return Re(e,"mean")},value:(null===Se||void 0===Se?void 0:Se.mean)?null===Se||void 0===Se?void 0:Se.mean:G,vertical:!1})})]}),Object(x.jsxs)("div",{className:"marker-filter-container",children:[Object(x.jsx)(o.F,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Detected"}),Object(x.jsx)(z,{data:Fe,height:35}),Object(x.jsx)("div",{className:"marker-filter-slider",children:se&&Object(x.jsx)(o.A,{min:se[0],max:se[1],stepSize:parseFloat((Math.abs(se[1]-se[0])/20).toFixed(2)),onChange:function(e){return Re(e,"detected")},value:(null===Se||void 0===Se?void 0:Se.detected)?null===Se||void 0===Se?void 0:Se.detected:se,vertical:!1})})]})]})]}):""]})},Q=(n(330),n(331),function(){var e=Object(a.useRef)();return Object(a.useEffect)((function(){var t=e.current,n=0,a=1,s=2,i=3,c=4,l=[5,5,3,3,2],r=["#1abc9c","#2ecc71","#3498db","#e74c3c","#9b59b6"],o={new:function(e){return{width:18,height:18,x:this.canvas.width/2-9,y:this.canvas.height/2-9,moveX:n,moveY:n,speed:e||9}}},d={new:function(e){return{width:18,height:70,x:"left"===e?150:this.canvas.width-150,y:this.canvas.height/2-35,score:0,move:n,speed:10}}},u={initialize:function(){this.canvas=t.querySelector("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=1400,this.canvas.height=1e3,this.canvas.style.width=this.canvas.width/2+"px",this.canvas.style.height=this.canvas.height/2+"px",this.player=d.new.call(this,"left"),this.paddle=d.new.call(this,"right"),this.ball=o.new.call(this),this.paddle.speed=8,this.running=this.over=!1,this.turn=this.paddle,this.timer=this.round=0,this.color="#2c3e50",h.menu(),h.listen()},endGameMenu:function(e){h.context.font="50px Courier New",h.context.fillStyle=this.color,h.context.fillRect(h.canvas.width/2-350,h.canvas.height/2-48,700,100),h.context.fillStyle="#ffffff",h.context.fillText(e,h.canvas.width/2,h.canvas.height/2+15),setTimeout((function(){(h=Object.assign({},u)).initialize()}),3e3)},menu:function(){h.draw(),this.context.font="50px Courier New",this.context.fillStyle=this.color,this.context.fillRect(this.canvas.width/2-350,this.canvas.height/2-48,700,100),this.context.fillStyle="#ffffff",this.context.fillText("Press any key to begin",this.canvas.width/2,this.canvas.height/2+15)},update:function(){this.over||(this.ball.x<=0&&h._resetTurn.call(this,this.paddle,this.player),this.ball.x>=this.canvas.width-this.ball.width&&h._resetTurn.call(this,this.player,this.paddle),this.ball.y<=0&&(this.ball.moveY=s),this.ball.y>=this.canvas.height-this.ball.height&&(this.ball.moveY=a),this.player.move===a?this.player.y-=this.player.speed:this.player.move===s&&(this.player.y+=this.player.speed),h._turnDelayIsOver.call(this)&&this.turn&&(this.ball.moveX=this.turn===this.player?i:c,this.ball.moveY=[a,s][Math.round(Math.random())],this.ball.y=Math.floor(Math.random()*this.canvas.height-200)+200,this.turn=null),this.player.y<=0?this.player.y=0:this.player.y>=this.canvas.height-this.player.height&&(this.player.y=this.canvas.height-this.player.height),this.ball.moveY===a?this.ball.y-=this.ball.speed/1.5:this.ball.moveY===s&&(this.ball.y+=this.ball.speed/1.5),this.ball.moveX===i?this.ball.x-=this.ball.speed:this.ball.moveX===c&&(this.ball.x+=this.ball.speed),this.paddle.y>this.ball.y-this.paddle.height/2&&(this.ball.moveX===c?this.paddle.y-=this.paddle.speed/1.5:this.paddle.y-=this.paddle.speed/4),this.paddle.y<this.ball.y-this.paddle.height/2&&(this.ball.moveX===c?this.paddle.y+=this.paddle.speed/1.5:this.paddle.y+=this.paddle.speed/4),this.paddle.y>=this.canvas.height-this.paddle.height?this.paddle.y=this.canvas.height-this.paddle.height:this.paddle.y<=0&&(this.paddle.y=0),this.ball.x-this.ball.width<=this.player.x&&this.ball.x>=this.player.x-this.player.width&&this.ball.y<=this.player.y+this.player.height&&this.ball.y+this.ball.height>=this.player.y&&(this.ball.x=this.player.x+this.ball.width,this.ball.moveX=c),this.ball.x-this.ball.width<=this.paddle.x&&this.ball.x>=this.paddle.x-this.paddle.width&&this.ball.y<=this.paddle.y+this.paddle.height&&this.ball.y+this.ball.height>=this.paddle.y&&(this.ball.x=this.paddle.x-this.ball.width,this.ball.moveX=i)),this.player.score===l[this.round]?l[this.round+1]?(this.color=this._generateRoundColor(),this.player.score=this.paddle.score=0,this.player.speed+=.5,this.paddle.speed+=1,this.ball.speed+=1,this.round+=1):(this.over=!0,setTimeout((function(){h.endGameMenu("Winner!")}),1e3)):this.paddle.score===l[this.round]&&(this.over=!0,setTimeout((function(){h.endGameMenu("Game Over!")}),1e3))},draw:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.color,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle="#ffffff",this.context.fillRect(this.player.x,this.player.y,this.player.width,this.player.height),this.context.fillRect(this.paddle.x,this.paddle.y,this.paddle.width,this.paddle.height),h._turnDelayIsOver.call(this)&&this.context.fillRect(this.ball.x,this.ball.y,this.ball.width,this.ball.height),this.context.beginPath(),this.context.setLineDash([7,15]),this.context.moveTo(this.canvas.width/2,this.canvas.height-140),this.context.lineTo(this.canvas.width/2,140),this.context.lineWidth=10,this.context.strokeStyle="#ffffff",this.context.stroke(),this.context.font="100px Courier New",this.context.textAlign="center",this.context.fillText(this.player.score.toString(),this.canvas.width/2-300,200),this.context.fillText(this.paddle.score.toString(),this.canvas.width/2+300,200),this.context.font="30px Courier New",this.context.fillText("Round "+(h.round+1),this.canvas.width/2,35),this.context.font="40px Courier",this.context.fillText(l[h.round]?l[h.round]:l[h.round-1],this.canvas.width/2,100)},loop:function(){h.update(),h.draw(),h.over||requestAnimationFrame(h.loop)},listen:function(){document.addEventListener("keydown",(function(e){!1===h.running&&(h.running=!0,window.requestAnimationFrame(h.loop)),38!==e.keyCode&&87!==e.keyCode||(h.player.move=a),40!==e.keyCode&&83!==e.keyCode||(h.player.move=s)})),document.addEventListener("keyup",(function(e){h.player.move=n}))},_resetTurn:function(e,t){this.ball=o.new.call(this,this.ball.speed),this.turn=t,this.timer=(new Date).getTime(),e.score++},_turnDelayIsOver:function(){return(new Date).getTime()-this.timer>=1e3},_generateRoundColor:function(){var e=r[Math.floor(Math.random()*r.length)];return e===this.color?h._generateRoundColor():e}},h=Object.assign({},u);h.initialize()}),[]),Object(x.jsxs)("div",{ref:e,className:"pong-container",children:[Object(x.jsx)("canvas",{}),Object(x.jsxs)("p",{className:"credit",children:["Game Credits ",Object(x.jsx)("a",{href:"https://codepen.io/gdube/pen/JybxxZ",target:"_blank",children:"Pong Game"})]})]})}),Y=(n(332),function(){return Object(x.jsx)("div",{className:"dots-bars-5"})});var Z=function(){var e=Object(a.useState)(!0),t=Object(r.a)(e,2),n=t[0],s=t[1],i=Object(a.useContext)(m),d=i.setWasmInitialized,u=i.setTsneData,h=i.setRedDims,j=i.redDims,b=i.setGenesInfo,p=i.setInitDims,O=i.setQcDims,f=i.defaultRedDims,v=i.setDefaultRedDims,g=i.setQcData,y=i.qcData,w=i.setClusterData,F=i.setFSelectionData,C=i.setUmapData,N=i.setPcaVarExp,S=i.logs,D=i.setLogs,E=i.selectedCluster,A=i.clusterRank,M=i.selectedClusterSummary,T=i.setSelectedClusterSummary,L=i.reqGene,R=i.customSelection,q=i.clusterData,_=i.delCustomSelection,B=i.setDelCustomSelection,P=i.setSelectedCluster,W=i.setShowGame,z=i.showGame,V=i.datasetName,U=i.setExportState,H=i.setShowAnimation,Z=i.triggerAnimation,J=i.setTriggerAnimation,K=i.params;return Object(a.useEffect)((function(){window.scranWorker.postMessage({type:"INIT",msg:"Initial Load"})}),[]),Object(a.useEffect)((function(){if(null!==E){var e=String(E).startsWith("cs")?"getMarkersForSelection":"getMarkersForCluster";window.scranWorker.postMessage({type:e,payload:{cluster:E,rank_type:A}})}}),[E,A]),Object(a.useEffect)((function(){if(null!==R&&Object.keys(R).length>0){var e="cs".concat(Object.keys(R).length),t=R[e];window.scranWorker.postMessage({type:"computeCustomMarkers",payload:{selection:t,id:e}})}}),[R]),Object(a.useEffect)((function(){null!==_&&(window.scranWorker.postMessage({type:"removeCustomMarkers",payload:{id:_}}),B(null))}),[_]),Object(a.useEffect)((function(){null!==L&&window.scranWorker.postMessage({type:"getGeneExpression",payload:{gene:L}})}),[L]),Object(a.useEffect)((function(){Z&&f&&window.scranWorker.postMessage({type:"animate"+f,payload:{params:K[f.toLowerCase()]}})}),[Z]),window.scranWorker.onmessage=function(e){var t=e.data;if(null===t||void 0===t?void 0:t.msg){var n=Object(l.a)(S),a=new Date;n.push("".concat(a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()," - ").concat(null===t||void 0===t?void 0:t.type," - ").concat(null===t||void 0===t?void 0:t.msg)),D(n)}if("INIT"===t.type)s(!1),d(!0);else if("inputs_DATA"===t.type)p("".concat(t.resp.dimensions.num_genes," genes, ").concat(t.resp.dimensions.num_cells," cells")),b(t.resp.gene_names);else if("quality_control_metrics_DATA"===t.type){var i=t.resp;g(i)}else if("quality_control_thresholds_DATA"===t.type){var r=t.resp,o=Object(c.a)({},y);o.thresholds=r,g(o)}else if("quality_control_filtered_DATA"===t.type)O("".concat(t.resp.retained," cells"));else if("feature_selection_DATA"===t.type){var x=t.resp;F(x)}else if("pca_DATA"===t.type){var m=t.resp;N(m)}else if("snn_cluster_graph_DATA"===t.type){var k=t.resp;w(k),P(0)}else if("tsne_DATA"===t.type||"tsne_iter"===t.type){var E=t.resp;u(E),H(!0);var A=Object(l.a)(j);A.push("TSNE"),f||v("TSNE"),h(A),W(!1),"tsne_DATA"===t.type&&(H(!1),J(!1))}else if("umap_DATA"===t.type||"umap_iter"===t.type){var L=t.resp;C(L),H(!0);var I=Object(l.a)(j);I.push("UMAP"),h(I),"umap_DATA"===t.type&&(H(!1),J(!1))}else if("markerGene_DATA"===t.type);else if("setMarkersForCluster"===t.type||"setMarkersForCustomSelection"===t.type){var R=t.resp,q=[];R.means.forEach((function(e,t){var n,a,s,i;q.push({index:t,row:null===R||void 0===R||null===(n=R.ordering)||void 0===n?void 0:n[t],mean:e,delta:null===R||void 0===R||null===(a=R.delta_detected)||void 0===a?void 0:a[t],lfc:null===R||void 0===R||null===(s=R.lfc)||void 0===s?void 0:s[t],detected:null===R||void 0===R||null===(i=R.detected)||void 0===i?void 0:i[t],expanded:!1,expr:null})})),T(q)}else if("setGeneExpression"===t.type){for(var _=t.resp,B=Object(l.a)(M),G=0;G<B.length;G++)if(_.gene===B[G].row){B[G].expr=Object.values(_.expr);break}T(B)}else if("exportState"===t.type){var z=t.resp,X=document.createElement("a"),Q=new Blob([z],{type:"text/plain"});X.href=URL.createObjectURL(Q),X.download=V.split(" ").join("_")+".kana.gz",X.click(),U(!1)}},Object(x.jsxs)("div",{className:"App",children:[Object(x.jsx)(k,{}),Object(x.jsxs)("div",{className:"App-content",children:[Object(x.jsx)("div",{className:"plot",children:f?Object(x.jsx)(G,{}):z?Object(x.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:"50px"},children:[Object(x.jsx)(o.q,{children:"Get some coffee or play pong while you wait for the analysis to finish.."}),Object(x.jsx)(o.a,{onClick:function(){W(!1)},children:"I'm good, go back"}),Object(x.jsx)(Q,{})]}):Object(x.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:"50px"},children:[Object(x.jsx)(Y,{}),Object(x.jsx)(o.q,{children:"Get some coffee or play pong while you wait for the analysis to finish.."}),Object(x.jsx)(o.a,{onClick:function(){W(!0)},children:"Play Pong"})]})}),Object(x.jsx)("div",{className:"marker",children:q?Object(x.jsx)(X,{}):Object(x.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[Object(x.jsx)(Y,{}),Object(x.jsx)(o.q,{children:"Generating nearest neighbor graph to compute clusters...."})]})}),Object(x.jsx)("div",{className:"analysis",children:Object(x.jsx)(I,{})})]}),Object(x.jsx)(o.y,Object(c.a)(Object(c.a)({isOpen:n},{autoFocus:!0,canEscapeKeyClose:!1,canOutsideClickClose:!1,enforceFocus:!0,hasBackdrop:!0,usePortal:!0,useTallContent:!1}),{},{children:Object(x.jsxs)("div",{className:"spinner",children:[Object(x.jsx)(o.B,{size:100}),Object(x.jsx)("p",{children:"Initializing kana"})]})}))]})},J=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,342)).then((function(t){var n=t.getCLS,a=t.getFID,s=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),a(e),s(e),i(e),c(e)}))};i.a.render(Object(x.jsx)(f,{children:Object(x.jsx)(Z,{})}),document.getElementById("root")),J()}},[[333,1,2]]]);
//# sourceMappingURL=main.b9958278.chunk.js.map