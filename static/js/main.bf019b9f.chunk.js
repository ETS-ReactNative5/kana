(this.webpackJsonpkana=this.webpackJsonpkana||[]).push([[0],{292:function(e,t,n){},293:function(e,t,n){},295:function(e,t,n){},322:function(e,t,n){},323:function(e,t,n){},335:function(e,t,n){},336:function(e,t,n){},337:function(e,t,n){},338:function(e,t,n){},339:function(e,t,n){},340:function(e,t,n){"use strict";n.r(t);var s=n(1),a=n(26),i=n.n(a),c=(n(292),n(4)),r=n(22),l=n(5),o=(n(293),n(347)),d=n(48),u=n(43),h=n(3),j=n(136),b=n(0),p=Object(s.createContext)(null),O=function(e){var t=e.children,n=Object(s.useState)({gene:null,mtx:null,barcode:null}),a=Object(l.a)(n,2),i=a[0],c=a[1],r=Object(s.useState)({qc:{"qc-nmads":3},fSelection:{"fsel-span":.3},pca:{"pca-npc":5,"pca-hvg":4e3},cluster:{"clus-k":10,"clus-res":.5,"clus-scheme":0,"clus-approx":!0,"clus-method":"snn_graph"},tsne:{"tsne-iter":500,"tsne-perp":30},umap:{"umap-nn":15,"umap-epochs":500,"umap-min_dist":.01},markerGene:{}}),o=Object(l.a)(r,2),d=o[0],u=o[1],h=Object(s.useState)(!1),j=Object(l.a)(h,2),O=j[0],x=j[1],f=Object(s.useState)(!1),m=Object(l.a)(f,2),v=m[0],g=m[1],y=Object(s.useState)(!1),F=Object(l.a)(y,2),w=F[0],C=F[1],N=Object(s.useState)(null),k=Object(l.a)(N,2),S=k[0],D=k[1],E=Object(s.useState)(null),A=Object(l.a)(E,2),M=A[0],T=A[1],L=Object(s.useState)(null),B=Object(l.a)(L,2),R=B[0],I=B[1],_=Object(s.useState)(null),P=Object(l.a)(_,2),G=P[0],W=P[1],q=Object(s.useState)(null),z=Object(l.a)(q,2),V=z[0],U=z[1],H=Object(s.useState)(null),Q=Object(l.a)(H,2),X=Q[0],Y=Q[1],Z=Object(s.useState)(null),J=Object(l.a)(Z,2),K=J[0],$=J[1],ee=Object(s.useState)(null),te=Object(l.a)(ee,2),ne=te[0],se=te[1],ae=Object(s.useState)([]),ie=Object(l.a)(ae,2),ce=ie[0],re=ie[1],le=Object(s.useState)(null),oe=Object(l.a)(le,2),de=oe[0],ue=oe[1],he=Object(s.useState)(null),je=Object(l.a)(he,2),be=je[0],pe=je[1],Oe=Object(s.useState)(null),xe=Object(l.a)(Oe,2),fe=xe[0],me=xe[1],ve=Object(s.useState)(null),ge=Object(l.a)(ve,2),ye=ge[0],Fe=ge[1],we=Object(s.useState)([]),Ce=Object(l.a)(we,2),Ne=Ce[0],ke=Ce[1],Se=Object(s.useState)(null),De=Object(l.a)(Se,2),Ee=De[0],Ae=De[1],Me=Object(s.useState)(null),Te=Object(l.a)(Me,2),Le=Te[0],Be=Te[1],Re=Object(s.useState)({}),Ie=Object(l.a)(Re,2),_e=Ie[0],Pe=Ie[1],Ge=Object(s.useState)(null),We=Object(l.a)(Ge,2),qe=We[0],ze=We[1],Ve=Object(s.useState)(null),Ue=Object(l.a)(Ve,2),He=Ue[0],Qe=Ue[1],Xe=Object(s.useState)(null),Ye=Object(l.a)(Xe,2),Ze=Ye[0],Je=Ye[1],Ke=Object(s.useState)(null),$e=Object(l.a)(Ke,2),et=$e[0],tt=$e[1],nt=Object(s.useState)(null),st=Object(l.a)(nt,2),at=st[0],it=st[1],ct=Object(s.useState)(null),rt=Object(l.a)(ct,2),lt=rt[0],ot=rt[1],dt=Object(s.useState)(null),ut=Object(l.a)(dt,2),ht=ut[0],jt=ut[1],bt=Object(s.useState)([]),pt=Object(l.a)(bt,2),Ot=pt[0],xt=pt[1];return Object(s.useEffect)((function(){w&&null!=i.mtx&&window.Worker.postMessage({type:"RUN",payload:{files:[i.mtx,i.barcode?i.barcode[0]:[],i.gene?i.gene[0]:[]],params:d},msg:"not much to pass"})}),[i,d,w]),Object(b.jsx)(p.Provider,{value:{inputFiles:i,setInputFiles:c,params:d,setParams:u,error:S,setError:D,wasmInitialized:w,setWasmInitialized:C,pcaData:He,setPcaData:Qe,pcaVarExp:Ze,setPcaVarExp:Je,tsneData:et,setTsneData:tt,umapData:at,setUmapData:it,genesInfo:V,setGenesInfo:U,initDims:M,setInitDims:T,qcDims:R,setQcDims:I,qcData:X,setQcData:Y,qcThreshold:K,setQcThreshold:$,fSelDims:G,setFSelDims:W,redDims:ce,setRedDims:re,defaultRedDims:de,setDefaultRedDims:ue,plotRedDims:be,setPlotRedDims:pe,clusterData:fe,setClusterData:me,fSelectionData:ne,setFSelectionData:se,logs:Ot,setLogs:xt,selectedCluster:ye,setSelectedCluster:Fe,selectedClusterSummary:Ne,setSelectedClusterSummary:ke,clusterRank:Le,setClusterRank:Be,gene:lt,setGene:ot,clusterColors:Ee,setClusterColors:Ae,reqGene:ht,setReqGene:jt,openInput:O,setOpenInput:x,customSelection:_e,setCustomSelection:Pe,delCustomSelection:qe,setDelCustomSelection:ze,showGame:v,setShowGame:g},children:t})},x=(n(295),["buttonText","includeFooter"]);var f=function(e){var t=e.buttonText,n=e.includeFooter,a=Object(u.a)(e,x),i=Object(s.useState)(!1),r=Object(l.a)(i,2),d=r[0],O=r[1],f=Object(s.useState)(1),m=Object(l.a)(f,2),v=m[0],g=m[1],y=Object(s.useCallback)((function(){return O(!d)}),[d]),F=Object(s.useCallback)((function(){return O(!1)}),[]),w=Object(s.useContext)(p),C=w.inputFiles,N=w.setInputFiles,k=w.params,S=w.setParams,D=w.openInput,E=Object(s.useState)(C),A=Object(l.a)(E,2),M=A[0],T=A[1],L=Object(s.useState)(k),B=Object(l.a)(L,2),R=B[0],I=B[1],_=Object(s.useState)(!0),P=Object(l.a)(_,2),G=P[0],W=P[1],q=Object(s.useState)({mtx:"Choose Matrix Market file",gene:"Choose feature/gene annotation",barcode:"Choose barcode annotation"}),z=Object(l.a)(q,2),V=z[0],U=z[1];return Object(s.useEffect)((function(){D&&O(!0)}),[D]),Object(s.useEffect)((function(){M&&M.mtx&&(V.mtx.endsWith("mtx")||V.mtx.endsWith("mtx.gz")||V.mtx.endsWith("hdf5")||V.mtx.endsWith("h5")||W(!1))}),[null===M||void 0===M?void 0:M.mtx]),Object(s.useEffect)((function(){M&&M.gene&&(V.gene.endsWith("tsv")||V.gene.endsWith("tsv.gz")||W(!1))}),[null===M||void 0===M?void 0:M.gene]),Object(s.useEffect)((function(){M&&M.barcode&&(V.barcode.endsWith("tsv")||V.barcode.endsWith("tsv.gz")||W(!1))}),[null===M||void 0===M?void 0:M.barcode]),Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(o.a,{onClick:y,icon:"social-media",intent:"primary",text:t}),Object(b.jsxs)(o.g,Object(c.a)(Object(c.a)({className:"analysis-dialog"},a),{},{isOpen:d,onClose:F,children:[Object(b.jsxs)("div",{className:h.a.DIALOG_BODY+" inputs-container",children:[Object(b.jsxs)("div",{className:"row-input",children:[Object(b.jsx)("div",{className:"col",children:Object(b.jsxs)("div",{children:[Object(b.jsxs)(o.l,{children:[Object(b.jsx)(o.A,{round:!0,children:"1"}),Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(1)},onMouseLeave:function(){return g(null)},children:"Load input files"})]}),Object(b.jsxs)("div",{className:"row",children:[Object(b.jsx)(o.p,{className:"row-input",children:Object(b.jsx)(o.j,{text:V.mtx,onInputChange:function(e){U(Object(c.a)(Object(c.a)({},V),{},{mtx:e.target.files[0].name})),T(Object(c.a)(Object(c.a)({},M),{},{mtx:e.target.files}))}})}),Object(b.jsx)(o.p,{className:"row-input",children:Object(b.jsx)(o.j,{text:V.gene,onInputChange:function(e){U(Object(c.a)(Object(c.a)({},V),{},{gene:e.target.files[0].name})),T(Object(c.a)(Object(c.a)({},M),{},{gene:e.target.files}))}})}),Object(b.jsx)(o.p,{className:"row-input",children:Object(b.jsx)(o.j,{text:V.barcode,onInputChange:function(e){U(Object(c.a)(Object(c.a)({},V),{},{barcode:e.target.files[0].name})),T(Object(c.a)(Object(c.a)({},M),{},{barcode:e.target.files}))}})})]})]})}),Object(b.jsx)("div",{className:"col",children:Object(b.jsxs)("div",{children:[Object(b.jsxs)(o.l,{children:[Object(b.jsx)(o.A,{round:!0,children:"2"}),Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(2)},onMouseLeave:function(){return g(null)},children:"Quality control"})]}),Object(b.jsx)("div",{className:"row",children:Object(b.jsxs)(o.p,{className:"row-input",children:[Object(b.jsx)(o.B,{className:"text-100",children:Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(2)},onMouseLeave:function(){return g(null)},children:"Number of MADs"})}),Object(b.jsx)(o.u,{placeholder:"3",value:R.qc["qc-nmads"],onValueChange:function(e,t){I(Object(c.a)(Object(c.a)({},R),{},{qc:Object(c.a)(Object(c.a)({},R.qc),{},{"qc-nmads":e})}))}})]})})]})}),Object(b.jsx)("div",{className:"col",children:Object(b.jsxs)("div",{children:[Object(b.jsxs)(o.l,{children:[Object(b.jsx)(o.A,{round:!0,children:"3"}),Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(3)},onMouseLeave:function(){return g(null)},children:"Feature Selection"})]}),Object(b.jsx)("div",{className:"row",children:Object(b.jsxs)(o.p,{className:"row-input",children:[Object(b.jsx)(o.B,{className:"text-100",children:Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(3)},onMouseLeave:function(){return g(null)},children:"Lowess span"})}),Object(b.jsx)(o.u,{placeholder:"0.3",value:R.fSelection["fsel-span"],onValueChange:function(e,t){I(Object(c.a)(Object(c.a)({},R),{},{fSelection:Object(c.a)(Object(c.a)({},R.fSelection),{},{"fsel-span":e})}))}})]})})]})}),Object(b.jsx)("div",{className:"col",children:Object(b.jsxs)("div",{children:[Object(b.jsxs)(o.l,{children:[Object(b.jsx)(o.A,{round:!0,children:"4"}),Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(4)},onMouseLeave:function(){return g(null)},children:"Principal components analysis"})]}),Object(b.jsxs)("div",{className:"row",children:[Object(b.jsxs)(o.p,{className:"row-input",children:[Object(b.jsx)(o.B,{className:"text-100",children:Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(4)},onMouseLeave:function(){return g(null)},children:"Number of HVGs"})}),Object(b.jsx)(o.u,{placeholder:"2500",value:R.pca["pca-hvg"],onValueChange:function(e,t){I(Object(c.a)(Object(c.a)({},R),{},{pca:Object(c.a)(Object(c.a)({},R.pca),{},{"pca-hvg":e})}))}})]}),Object(b.jsxs)(o.p,{className:"row-input",children:[Object(b.jsx)(o.B,{className:"text-100",children:Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(4)},onMouseLeave:function(){return g(null)},children:"Number of PCs"})}),Object(b.jsx)(o.u,{placeholder:"25",value:R.pca["pca-npc"],onValueChange:function(e,t){I(Object(c.a)(Object(c.a)({},R),{},{pca:Object(c.a)(Object(c.a)({},R.pca),{},{"pca-npc":e})}))}})]})]})]})}),Object(b.jsx)("div",{className:"col",children:Object(b.jsxs)("div",{children:[Object(b.jsxs)(o.l,{children:[Object(b.jsx)(o.A,{round:!0,children:"5"}),Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Clustering"})]}),Object(b.jsxs)("div",{className:"row",children:[Object(b.jsxs)(o.p,{className:"row-input",children:[Object(b.jsx)(o.B,{className:"text-100",children:Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Method"})}),Object(b.jsx)(o.m,{defaultValue:R.cluster["clus-method"],children:Object(b.jsx)("option",{children:R.cluster["clus-method"]})})]}),Object(b.jsxs)(o.p,{className:"row-input",children:[Object(b.jsx)(o.B,{className:"text-100",children:Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Number of neighbors"})}),Object(b.jsx)(o.u,{placeholder:"10",value:R.cluster["clus-k"],onValueChange:function(e,t){I(Object(c.a)(Object(c.a)({},R),{},{cluster:Object(c.a)(Object(c.a)({},R.cluster),{},{"clus-k":e})}))}})]}),Object(b.jsxs)(o.p,{className:"row-input",children:[Object(b.jsx)(o.B,{className:"text-100",children:Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Use ANN"})}),Object(b.jsx)(o.z,{style:{marginTop:"10px"},large:!0,checked:R.cluster["clus-approx"],innerLabelChecked:"true",innerLabel:"false",onChange:function(e){I(Object(c.a)(Object(c.a)({},R),{},{cluster:Object(c.a)(Object(c.a)({},R.cluster),{},{"clus-approx":e.target.checked})}))}})]}),Object(b.jsxs)(o.p,{className:"row-input",children:[Object(b.jsx)(o.B,{className:"text-100",children:Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Weighting scheme"})}),Object(b.jsxs)(o.m,{onChange:function(e,t){var n;return I(Object(c.a)(Object(c.a)({},R),{},{cluster:Object(c.a)(Object(c.a)({},R.cluster),{},{"clus-scheme":parseInt(null===e||void 0===e||null===(n=e.currentTarget)||void 0===n?void 0:n.value)})}))},children:[Object(b.jsx)("option",{children:"Rank"},"0"),Object(b.jsx)("option",{children:"Number"},"1"),Object(b.jsx)("option",{children:"Jaccard"},"2")]})]}),Object(b.jsxs)(o.p,{className:"row-input",children:[Object(b.jsx)(o.B,{className:"text-100",children:Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(5)},onMouseLeave:function(){return g(null)},children:"Resolution"})}),Object(b.jsx)(o.u,{placeholder:"0.5",value:R.cluster["clus-res"],onValueChange:function(e,t){I(Object(c.a)(Object(c.a)({},R),{},{cluster:Object(c.a)(Object(c.a)({},R.cluster),{},{"clus-res":e})}))}})]})]})]})}),Object(b.jsx)("div",{className:"col",children:Object(b.jsxs)("div",{children:[Object(b.jsxs)(o.l,{children:[Object(b.jsx)(o.A,{round:!0,children:"6"}),Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(6)},onMouseLeave:function(){return g(null)},children:"t-SNE"})]}),Object(b.jsxs)("div",{className:"row",children:[Object(b.jsxs)(o.p,{className:"row-input",children:[Object(b.jsx)(o.B,{className:"text-100",children:Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(6)},onMouseLeave:function(){return g(null)},children:"Perplexity"})}),Object(b.jsx)(o.u,{placeholder:"30",value:R.tsne["tsne-perp"],onValueChange:function(e,t){I(Object(c.a)(Object(c.a)({},R),{},{tsne:Object(c.a)(Object(c.a)({},R.tsne),{},{"tsne-perp":e})}))}})]}),Object(b.jsxs)(o.p,{className:"row-input",children:[Object(b.jsx)(o.B,{className:"text-100",children:Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(6)},onMouseLeave:function(){return g(null)},children:"Iterations"})}),Object(b.jsx)(o.u,{placeholder:"500",value:R.tsne["tsne-iter"],onValueChange:function(e,t){I(Object(c.a)(Object(c.a)({},R),{},{tsne:Object(c.a)(Object(c.a)({},R.tsne),{},{"tsne-iter":e})}))}})]})]})]})}),Object(b.jsx)("div",{className:"col",children:Object(b.jsxs)("div",{children:[Object(b.jsxs)(o.l,{children:[Object(b.jsx)(o.A,{round:!0,children:"7"}),Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(7)},onMouseLeave:function(){return g(null)},children:"UMAP"})]}),Object(b.jsxs)("div",{className:"row",children:[Object(b.jsxs)(o.p,{className:"row-input",children:[Object(b.jsx)(o.B,{className:"text-100",children:Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(7)},onMouseLeave:function(){return g(null)},children:"Number of neighbors"})}),Object(b.jsx)(o.u,{placeholder:"15",value:R.umap["umap-nn"],onValueChange:function(e,t){I(Object(c.a)(Object(c.a)({},R),{},{umap:Object(c.a)(Object(c.a)({},R.umap),{},{"umap-nn":e})}))}})]}),Object(b.jsxs)(o.p,{className:"row-input",children:[Object(b.jsx)(o.B,{className:"text-100",children:Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(7)},onMouseLeave:function(){return g(null)},children:"Minimum distance"})}),Object(b.jsx)(o.u,{placeholder:"0.01",value:R.umap["umap-min_dist"],onValueChange:function(e,t){I(Object(c.a)(Object(c.a)({},R),{},{umap:Object(c.a)(Object(c.a)({},R.umap),{},{"umap-min_dist":e})}))}})]}),Object(b.jsxs)(o.p,{className:"row-input",children:[Object(b.jsx)(o.B,{className:"text-100",children:Object(b.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return g(7)},onMouseLeave:function(){return g(null)},children:"Epochs"})}),Object(b.jsx)(o.u,{placeholder:"500",value:R.umap["umap-epoch"],onValueChange:function(e,t){I(Object(c.a)(Object(c.a)({},R),{},{umap:Object(c.a)(Object(c.a)({},R.umap),{},{"umap-epoch":e})}))}})]})]})]})})]}),Object(b.jsxs)("div",{className:"row-input-tooltips",children:[!G&&Object(b.jsx)(o.c,{intent:"danger",title:"Incorrect file format",style:{marginBottom:"10px"},children:Object(b.jsxs)("p",{children:["Upload files that in one of these formats;",Object(b.jsxs)("ul",{children:[Object(b.jsxs)("li",{children:["Matrix Market - ",Object(b.jsx)("code",{children:"*.mtx"})," or ",Object(b.jsx)("code",{children:"*.mtx.gz"})]}),Object(b.jsxs)("li",{children:["features or genes, ",Object(b.jsx)("code",{children:"*.tsv"})," or ",Object(b.jsx)("code",{children:"*.tsv.gz"})]})]})]})}),1==v&&Object(b.jsx)(o.c,{intent:"primary",children:Object(b.jsxs)("p",{children:["We currently support files in the Cellranger format - namely, a Matrix Market file containing the count matrix. We also recommend supplying the feature annotation (",Object(b.jsx)("code",{children:"features.tsv.gz"})," or ",Object(b.jsx)("code",{children:"genes.tsv.gz"}),"). Users may also provide a TSV file containing the barcode annotations, if any."]})}),2==v&&Object(b.jsxs)(o.c,{intent:"primary",children:[Object(b.jsx)("p",{children:"At this step, we compute per-cell quality control (QC) metrics such as the total count per cell, the total number of detected features and (if the feature annotation is supplied) the mitochondrial proportion in each cell."}),Object(b.jsx)("p",{children:"We remove low-quality cells based on these metrics - specifically, cells with low total counts/number of detected features or high mitochondrial proportions are filtered out."}),Object(b.jsx)("p",{children:"We use an outlier-based approach to define the filter threshold under the assumption that most cells in the dataset are of acceptable quality."}),Object(b.jsxs)("p",{children:[Object(b.jsx)("strong",{children:"Number of MADs"}),": Number of median absolute deviations (MADs) from the median, used to define a filter threshold in the appropriate direction for each QC metric. Increasing this value will reduce the stringency of the filtering."]})]}),3==v&&Object(b.jsxs)(o.c,{intent:"primary",children:[Object(b.jsx)("p",{children:"Identify highly variable genes while accounting for the mean-variance relationship. We do so by fitting a mean-dependent trend to the variances, computed from the log-transformed normalized expression values. The residuals from the trend are then used to rank highly variable genes."}),Object(b.jsxs)("p",{children:[Object(b.jsx)("strong",{children:"Lowess span"}),": The span of the LOWESS smoother for fitting the mean-variance trend. Larger values increase the smoothness of the global trend at the cost of decreasing sensitivity to local variations."]})]}),4==v&&Object(b.jsxs)(o.c,{intent:"primary",children:[Object(b.jsx)("p",{children:"Perform a principal components analysis (PCA) to obtain per-cell coordinates in a low-dimensional space. This is used to compact the data for faster downstream computation, as well as to remove uninteresting high-dimensional noise."}),Object(b.jsxs)("p",{children:[Object(b.jsx)("strong",{children:"Number of HVGs"}),": Number of highly variable genes to use to perform the PCA. Larger values will capture more biological signal at the cost of increasing noise and computational work."]}),Object(b.jsxs)("p",{children:[Object(b.jsx)("strong",{children:"Number of PCs"}),": Number of principal components with the highest variance to retain in downstream analyses. Larger values will capture more biological signal at the cost of increasing noise and computational work."]})]}),5==v&&Object(b.jsxs)(o.c,{intent:"primary",children:[Object(b.jsx)("p",{children:"Cluster cells into discrete groupings based on their relative similarity in the low-dimensional space. The set of clusters serve as a summary of the cellular heterogeneity in the population, allowing us to easily perform further characterization on subpopulations of interest."}),Object(b.jsxs)("p",{children:[Object(b.jsx)("strong",{children:"Method"}),": Clustering algorithm to use. Currently, we use multi-level community detection on an shared nearest neighbor (SNN) graph where cells are the nodes and edges are created between neighboring cells."]}),Object(b.jsxs)("p",{children:[Object(b.jsx)("strong",{children:"Number of neighbors"}),": Number of neighbors to use to construct the shared nearest neighbor graph. Larger values result in broader clusters."]}),Object(b.jsxs)("p",{children:[Object(b.jsx)("strong",{children:"Use ANN ?"}),": Use an approximate method to speed up the nearest neighbor search. This sacrifices some accuracy for speed in larger datasets."]}),Object(b.jsxs)("p",{children:[Object(b.jsx)("strong",{children:"Weighting scheme"}),": Weighting scheme to use for the edges of the shared nearest neighbor graph. The Rank approach derives a weight from the rank of the closest shared neighbor; the Number approach uses the number of shared neighbors; and the Jaccard approach uses the Jaccard index of the neighbor sets."]}),Object(b.jsxs)("p",{children:[Object(b.jsx)("strong",{children:"Resolution"}),": Resolution parameter for the multi-level clustering, used to adjust the modularity calculation during community optimization. Larger values yield more fine-grained clusters."]})]}),6==v&&Object(b.jsxs)(o.c,{intent:"primary",children:[Object(b.jsx)("p",{children:"Create a t-SNE plot to visualize cells in two dimensions, because our feeble human minds cannot interpret high-dimensional spaces. Cells that were neighbors in the original space are kept close together in the 2D embedding, while dissimilar cells are placed (arbitrarily) far away."}),Object(b.jsxs)("p",{children:[Object(b.jsx)("strong",{children:"Perplexity"}),": Perplexity parameter, which determines the size of the neighborhood of each cell. Larger values will favor preservation of global structure in the 2D embedding."]}),Object(b.jsxs)("p",{children:[Object(b.jsx)("strong",{children:"Iterations"}),": Number of t-SNE iterations. Doesn't usually have much of an effect if you leave it as it is."]})]}),7==v&&Object(b.jsxs)(o.c,{title:"Visually important content",intent:"primary",children:[Object(b.jsx)("p",{children:"Create a UMAP plot to visualize cells in two dimensions. Like the t-SNE, this aims to map cells from a high-dimensional space into a 2D embedding, where neighboring cells are kept close together and dissimilar cells are placed far apart."}),Object(b.jsxs)("p",{children:[Object(b.jsx)("strong",{children:"Number of neighbors"}),": Number of neighbors to use when defining the size of the local neighborhood. Larger values will favor preservation of global structure."]}),Object(b.jsxs)("p",{children:[Object(b.jsx)("strong",{children:"Minimum distance"}),": Minimum distance between points. Smaller values result in more tightly packed embedding and favor local structure."]}),Object(b.jsxs)("p",{children:[Object(b.jsx)("strong",{children:"Epochs"}),": Number of epochs to use for convergence. This doesn't really change all too much."]})]})]})]}),n?Object(b.jsx)("div",{className:h.a.DIALOG_FOOTER,children:Object(b.jsx)("div",{className:h.a.DIALOG_FOOTER_ACTIONS,children:Object(b.jsx)(j.a,{content:"Run Analysis",children:Object(b.jsx)(o.a,{disabled:!G,icon:"function",onClick:function(){S(R),N(M),F()},children:"Analyze"})})})}):Object(b.jsx)("div",{style:{margin:"0 20px"}})]}))]})},m=function(){var e=Object(s.useContext)(p),t=e.initDims,n=e.qcDims;return Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)("span",{children:["Dataset dimensions: ",t?"".concat(t):" ???",n?" (after QC: ".concat(n,")"):""]})})},v=n(19),g=function(){var e=Object(s.useContext)(p).logs,t=Object(s.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!0,enforceFocus:!0,hasBackdrop:!0,isOpen:!1,position:v.a.RIGHT,size:void 0,usePortal:!0}),n=Object(l.a)(t,2),a=n[0],i=n[1];return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(o.a,{onClick:function(){return i({isOpen:!0})},icon:"wrench",outlined:!0,intent:"warning",children:"What's happening ?"}),Object(b.jsx)(o.i,Object(c.a)(Object(c.a)({icon:"info-sign",onClose:function(){return i({isOpen:!1})},title:"What's happening ?"},a),{},{children:Object(b.jsx)("div",{className:h.a.DRAWER_BODY,children:Object(b.jsx)("div",{className:h.a.DIALOG_BODY,children:Object(b.jsx)("ul",{className:"list",children:e.map((function(e,t){return Object(b.jsx)("li",{children:e},t)}))})})})}))]})},y=n(34),F=["buttonText","includeFooter"];var w=function(e){e.buttonText,e.includeFooter;var t=Object(u.a)(e,F),n=Object(s.useContext)(p).setOpenInput,a=Object(s.useState)(!0),i=Object(l.a)(a,2),r=i[0],d=i[1],O=Object(s.useState)(!1),x=Object(l.a)(O,2),f=x[0],m=x[1],v=Object(s.useCallback)((function(){d(!r),m(!0)}),[r]),g=Object(s.useCallback)((function(){return d(!1)}),[]);return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(o.a,{onClick:v,icon:"info-sign",intent:"primary",text:"Info"}),Object(b.jsxs)(o.g,Object(c.a)(Object(c.a)({},t),{},{isOpen:r,onClose:g,children:[Object(b.jsx)("div",{className:h.a.DIALOG_BODY,children:Object(b.jsxs)(o.d,{elevation:y.a.ZERO,children:[Object(b.jsxs)("p",{children:[Object(b.jsx)("strong",{children:"kana"})," performs a standard scRNA-seq data analysis directly inside the browser."]}),Object(b.jsxs)("p",{children:["With just a few clicks, you can get a UMAP/t-SNE and marker genes in an intuitive interface for further exploration. No need to transfer data, no need to install software, no need to configure a backend server - just point to a Matrix Market file and we'll analyze ",Object(b.jsx)("em",{children:"your"})," data on ",Object(b.jsx)("em",{children:"your"})," computer, no questions asked."]}),Object(b.jsxs)("p",{children:["Check out our ",Object(b.jsx)("a",{href:"https://github.com/jkanche/scran.js.app",target:"_blank",children:"GitHub page"})," for more details. Or you could just play around with the app to see what it can do - after all, it's totally free!"]}),Object(b.jsx)(o.l,{children:"Authors"}),"Jayaram Kancherla (",Object(b.jsx)("a",{href:"https://github.com/jkanche",target:"_blank",children:Object(b.jsx)("strong",{children:"@jkanche"})}),"), Aaron Lun (",Object(b.jsx)("a",{href:"https://github.com/LTLA",target:"_blank",children:Object(b.jsx)("strong",{children:"@LTLA"})}),")"]})}),Object(b.jsx)("div",{className:h.a.DIALOG_FOOTER,children:Object(b.jsx)("div",{className:h.a.DIALOG_FOOTER_ACTIONS,children:f?Object(b.jsx)(o.a,{icon:"cross",onClick:g,children:"Close"}):Object(b.jsx)(j.a,{content:"\u884c\u304f\u305e!",children:Object(b.jsx)(o.a,{icon:"bring-data",onClick:function(){n(!0),g()},children:"Get started"})})})})]}))]})},C=function(){var e=Object(s.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!1,enforceFocus:!0,shouldReturnFocusOnClose:!0}),t=Object(l.a)(e,1)[0];return Object(b.jsx)(b.Fragment,{children:Object(b.jsx)(o.q,{className:"bp3-dark",children:Object(b.jsxs)(o.s,{className:"navbar-group",align:d.a.LEFT,children:[Object(b.jsx)(o.t,{children:"kana"}),Object(b.jsx)(o.r,{}),Object(b.jsx)("span",{children:"Single cell RNA-seq analysis in the browser"}),Object(b.jsx)(o.r,{}),Object(b.jsx)(f,Object(c.a)({icon:"document",title:"Import dataset & update parameters (mouseover for more info)",buttonText:"Start Analysis",includeFooter:!0},t)),Object(b.jsx)(o.r,{}),Object(b.jsx)(m,{}),Object(b.jsx)(o.r,{}),Object(b.jsx)(g,{}),Object(b.jsx)(o.r,{}),Object(b.jsx)(w,Object(c.a)({icon:"document",title:"Single-cell RNA-seq analysis in the browser",isOpen:!0},t))]})})})},N=n(14),k=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color,i=null===e||void 0===e?void 0:e.ymax;if(i||(i=Math.max.apply(Math,Object(r.a)(n.map((function(e){return e.value}))))),s||(s=325),a||(a="#00B3A4"),!n)return"";var c=t.current;c.innerHTML="";var l=10,o=30,d=30,u=40,h=s-u-o,j=200-l-d,b=N.m(c).append("svg").attr("width",h+u+o).attr("height",j+l+d).append("g").attr("transform","translate(".concat(u,",").concat(l,")")),p=N.j().range([0,h]).domain(n.map((function(e){return e.key}))).padding(.2);b.append("g").attr("transform","translate(0,"+j+")").call(N.b(p)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");var O=N.k().domain([0,i]).range([j,0]);b.append("g").call(N.c(O)),b.selectAll("bars").data(n).enter().append("rect").attr("x",(function(e){return p(e.key)})).attr("y",(function(e){return O(e.value)})).attr("width",p.bandwidth()).attr("height",(function(e){return j-O(e.value)})).attr("fill",(function(e,t){return Array.isArray(a)?a[t]:a}))}),[]),Object(b.jsx)("div",{ref:t})},S=function(e){var t,n,s=null===e||void 0===e||null===(t=e.pca)||void 0===t?void 0:t.var_exp;if(!s)return"";var a=[];return null===(n=Object.values(s))||void 0===n||n.forEach((function(e,t){a.push({key:t+1,value:100*e})})),Object(b.jsx)(k,{data:a})},D=n(61),E=function(e){var t,n,a=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.clusters,i=Object(s.useContext)(p).setClusterColors,c=Object(s.useState)(null),r=Object(l.a)(c,2),o=r[0],d=r[1];if(Object(s.useEffect)((function(){var e=Object.keys(h).length,t=null;t=e>Object.keys(u).length?Object(D.randomColor)({luminosity:"dark",count:e+1}):u[e.toString()],d(t)}),[]),Object(s.useEffect)((function(){i(o)}),[o]),!a)return"";for(var u={1:["#1b9e77"],2:["#1b9e77","#d95f02"],3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},h={},j=0;j<(null===a||void 0===a?void 0:a.length);j++){var O=a[j];"CLUS_"+O in h?h["CLUS_"+O]++:h["CLUS_"+O]=0}var x=[];return null===(n=Object.values(h))||void 0===n||n.forEach((function(e,t){x.push({key:t+1,value:e})})),o&&Object(b.jsx)(k,{data:x,color:o})},A=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.rdata,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color;if(s||(s=200),a||(a="#00B3A4"),!n)return"";var i=t.current;i.innerHTML="";var c=10,r=30,l=30,o=40,d=s-o-r,u=200-c-l,h=N.m(i).append("svg").attr("width",d+o+r).attr("height",u+c+l).append("g").attr("transform","translate(".concat(o,",").concat(c,")")),j=N.k().domain(null===e||void 0===e?void 0:e.range).range([u,0]).nice();h.append("g").call(N.c(j));var b=N.j().range([0,d]).domain([null===e||void 0===e?void 0:e.showLabel]).padding(.05);h.append("g").attr("transform","translate(0,"+u+")").call(N.b(b));var p=N.f().domain(j.domain()).thresholds(j.ticks(20)).value((function(e){return e}))(n),O=N.i(p,(function(e){return e.length})),x=N.k().range([0,b.bandwidth()]).domain([-O,O]);h.selectAll("violins").data([null===e||void 0===e?void 0:e.label]).enter().append("g").attr("transform",(function(e){return"translate("+b(e)+" ,0)"})).append("path").datum((function(){return p})).style("stroke","none").style("fill",a).attr("d",N.a().x0((function(e){return x(-e.length)})).x1((function(e){return x(e.length)})).y((function(e){return j(e.x0)})).curve(N.d)),h.selectAll("threshold").data([null===e||void 0===e?void 0:e.threshold]).enter().append("line").attr("transform",(function(){return"translate("+b(null===e||void 0===e?void 0:e.label)+" ,0)"})).attr("class","threshold").attr("x1",5).attr("y1",(function(e){return j(e)})).attr("x2",b.bandwidth()-5).attr("y2",(function(e){return j(e)})).attr("stroke-width",2).attr("stroke","Orange").on("mouseover",(function(){var e=N.m(this);e.attr("stroke","black"),e.attr("stroke-width","8")})).on("mouseout",(function(){var e=N.m(this);e.attr("stroke","Orange"),e.attr("stroke-width","5")}))}),[]),Object(b.jsx)("div",{ref:t})},M=(n(322),function(e){var t=e.data;return Object(b.jsx)("div",{className:"qc-plots",children:["sums","detected","proportion"].map((function(e){var n,s,a,i,r,l,o={threshold:"proportion"!==e?Math.log2(null===t||void 0===t||null===(n=t.thresholds)||void 0===n?void 0:n[e]):100*(null===t||void 0===t||null===(s=t.thresholds)||void 0===s?void 0:s[e]),range:"proportion"!==e?null===t||void 0===t||null===(a=t.ranges)||void 0===a?void 0:a[e].map((function(e){return Math.log2(e+1)})):null===t||void 0===t||null===(i=t.ranges)||void 0===i?void 0:i[e].map((function(e){return 100*e})),label:e,showLabel:"proportion"!==e?e+" (log)":e+" (%)",rdata:"proportion"!==e?null===t||void 0===t||null===(r=t.data)||void 0===r?void 0:r[e].map((function(e){return Math.log2(e+1)})):null===t||void 0===t||null===(l=t.data)||void 0===l?void 0:l[e].map((function(e){return 100*e}))};return Object(b.jsx)("div",{children:Object(b.jsx)(A,Object(c.a)({},o))},e)}))})}),T=(n(323),function(){var e=Object(s.useContext)(p),t=e.pcaVarExp,n=e.qcData,a=e.clusterData;return Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)("div",{className:"gallery-cont",children:[a?Object(b.jsxs)(o.d,{className:"gallery-elem",elevation:y.a.ONE,children:[Object(b.jsx)("h5",{children:"# of cells per cluster"}),Object(b.jsx)(E,{data:a})]}):"",t?Object(b.jsxs)(o.d,{className:"gallery-elem",elevation:y.a.ONE,children:[Object(b.jsx)("h5",{children:"PCA (% variance explained)"}),Object(b.jsx)(S,{pca:t})]}):"",n&&(null===n||void 0===n?void 0:n.thresholds)?Object(b.jsxs)(o.d,{className:"gallery-elem",elevation:y.a.ONE,children:[Object(b.jsx)("h5",{children:"QC Statistics"}),Object(b.jsx)(M,{data:n})]}):""]})})}),L=n(78),B=function(e){var t=-Number.MAX_VALUE,n=Number.MAX_VALUE;return e.forEach((function(e){t<e&&(t=e),n>e&&(n=e)})),[n,t]};function R(){var e=null,t=0,n=100,s=["ff0000","ffff00","00ff00","0000ff"];function a(a){if(a.length<2)throw new Error("Rainbow must have two or more colours.");var i=(n-t)/(a.length-1),c=new I;c.setGradient(a[0],a[1]),c.setNumberRange(t,t+i),e=[c];for(var r=1;r<a.length-1;r++){var l=new I;l.setGradient(a[r],a[r+1]),l.setNumberRange(t+i*r,t+i*(r+1)),e[r]=l}s=a}a(s),this.setSpectrum=function(){return a(arguments),this},this.setSpectrumByArray=function(e){return a(e),this},this.colourAt=function(s){if(isNaN(s))throw new TypeError(s+" is not a number");if(1===e.length)return e[0].colourAt(s);var a=(n-t)/e.length,i=Math.min(Math.floor((Math.max(s,t)-t)/a),e.length-1);return e[i].colourAt(s)},this.colorAt=this.colourAt,this.setNumberRange=function(e,i){if(!(i>e))throw new RangeError("maxNumber ("+i+") is not greater than minNumber ("+e+")");return t=e,n=i,a(s),this}}function I(){var e="ff0000",t="0000ff",n=0,s=100;function a(e,t,a){var i=e;i<n&&(i=n),i>s&&(i=s);var c,r=s-n,l=parseInt(t,16),o=(parseInt(a,16)-l)/r,d=Math.round(o*(i-n)+l);return 1===(c=d.toString(16)).length?"0"+c:c}function i(e){if(function(e){return/^#?[0-9a-fA-F]{6}$/i.test(e)}(e))return e.substring(e.length-6,e.length);var t=e.toLowerCase();if(c.hasOwnProperty(t))return c[t];throw new Error(e+" is not a valid colour.")}this.setGradient=function(n,s){e=i(n),t=i(s)},this.setNumberRange=function(e,t){if(!(t>e))throw new RangeError("maxNumber ("+t+") is not greater than minNumber ("+e+")");n=e,s=t},this.colourAt=function(n){return a(n,e.substring(0,2),t.substring(0,2))+a(n,e.substring(2,4),t.substring(2,4))+a(n,e.substring(4,6),t.substring(4,6))};var c={aliceblue:"F0F8FF",antiquewhite:"FAEBD7",aqua:"00FFFF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000000",blanchedalmond:"FFEBCD",blue:"0000FF",blueviolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetblue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerblue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"00FFFF",darkblue:"00008B",darkcyan:"008B8B",darkgoldenrod:"B8860B",darkgray:"A9A9A9",darkgreen:"006400",darkgrey:"A9A9A9",darkkhaki:"BDB76B",darkmagenta:"8B008B",darkolivegreen:"556B2F",darkorange:"FF8C00",darkorchid:"9932CC",darkred:"8B0000",darksalmon:"E9967A",darkseagreen:"8FBC8F",darkslateblue:"483D8B",darkslategray:"2F4F4F",darkslategrey:"2F4F4F",darkturquoise:"00CED1",darkviolet:"9400D3",deeppink:"FF1493",deepskyblue:"00BFFF",dimgray:"696969",dimgrey:"696969",dodgerblue:"1E90FF",firebrick:"B22222",floralwhite:"FFFAF0",forestgreen:"228B22",fuchsia:"FF00FF",gainsboro:"DCDCDC",ghostwhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"808080",green:"008000",greenyellow:"ADFF2F",grey:"808080",honeydew:"F0FFF0",hotpink:"FF69B4",indianred:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderblush:"FFF0F5",lawngreen:"7CFC00",lemonchiffon:"FFFACD",lightblue:"ADD8E6",lightcoral:"F08080",lightcyan:"E0FFFF",lightgoldenrodyellow:"FAFAD2",lightgray:"D3D3D3",lightgreen:"90EE90",lightgrey:"D3D3D3",lightpink:"FFB6C1",lightsalmon:"FFA07A",lightseagreen:"20B2AA",lightskyblue:"87CEFA",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"B0C4DE",lightyellow:"FFFFE0",lime:"00FF00",limegreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumaquamarine:"66CDAA",mediumblue:"0000CD",mediumorchid:"BA55D3",mediumpurple:"9370DB",mediumseagreen:"3CB371",mediumslateblue:"7B68EE",mediumspringgreen:"00FA9A",mediumturquoise:"48D1CC",mediumvioletred:"C71585",midnightblue:"191970",mintcream:"F5FFFA",mistyrose:"FFE4E1",moccasin:"FFE4B5",navajowhite:"FFDEAD",navy:"000080",oldlace:"FDF5E6",olive:"808000",olivedrab:"6B8E23",orange:"FFA500",orangered:"FF4500",orchid:"DA70D6",palegoldenrod:"EEE8AA",palegreen:"98FB98",paleturquoise:"AFEEEE",palevioletred:"DB7093",papayawhip:"FFEFD5",peachpuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderblue:"B0E0E6",purple:"800080",red:"FF0000",rosybrown:"BC8F8F",royalblue:"4169E1",saddlebrown:"8B4513",salmon:"FA8072",sandybrown:"F4A460",seagreen:"2E8B57",seashell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyblue:"87CEEB",slateblue:"6A5ACD",slategray:"708090",slategrey:"708090",snow:"FFFAFA",springgreen:"00FF7F",steelblue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFFFFF",whitesmoke:"F5F5F5",yellow:"FFFF00",yellowgreen:"9ACD32"}}n(335);var _=function(){var e,t,n=Object(s.useRef)(),a=Object(s.useState)(null),i=Object(l.a)(a,2),d=i[0],u=i[1],h=Object(s.useState)(null),O=Object(l.a)(h,2),x=O[0],f=O[1],m=Object(s.useState)(!1),v=Object(l.a)(m,2),g=v[0],y=v[1],F=Object(s.useState)(null),w=Object(l.a)(F,2),C=w[0],N=w[1],k=Object(s.useState)(C),S=Object(l.a)(k,2),E=S[0],A=S[1],M=Object(s.useState)(null),T=Object(l.a)(M,2),I=T[0],_=T[1],P=Object(s.useContext)(p),G=P.plotRedDims,W=P.redDims,q=P.defaultRedDims,z=P.setDefaultRedDims,V=P.clusterData,U=P.tsneData,H=P.umapData,Q=P.setPlotRedDims,X=P.clusterColors,Y=P.setClusterColors,Z=P.gene,J=P.selectedClusterSummary,K=P.customSelection,$=P.setCustomSelection,ee=P.setDelCustomSelection,te=Object(s.useState)(null),ne=Object(l.a)(te,2),se=ne[0],ae=ne[1],ie=Object(s.useState)("PAN"),ce=Object(l.a)(ie,2),re=ce[0],le=ce[1];Object(s.useEffect)((function(){var e;if(null===Z&&(y(!1),_(null)),null===J||void 0===J||null===(e=J[Z])||void 0===e?void 0:e.expr){var t,n=B(null===J||void 0===J||null===(t=J[Z])||void 0===t?void 0:t.expr),s=0===n[1]?.01:n[1],a=new R;a.setSpectrum("#F5F8FA","#2965CC"),a.setNumberRange(0,s),y(!0),_(a),A([0,s]),N([0,s])}}),[null===J||void 0===J||null===(e=J[Z])||void 0===e?void 0:e.expr],Z),Object(s.useEffect)((function(){if(Array.isArray(E)){var e=new R;e.setSpectrum("#F5F8FA","#2965CC"),e.setNumberRange.apply(e,Object(r.a)(E)),_(e),y(!0)}}),[E]),Object(s.useEffect)((function(){if(n.current){var e=d;if(!e){var t=n.current;t.style.width="95%",t.style.height="95%",e=new L.ScatterGL(t,{onSelect:function(e){0!==e.length&&ae(e)},orbitControls:{zoomSpeed:1.25},styles:{point:{scaleDefault:1.75,scaleSelected:2,scaleHover:2}}}),e.setPanMode(),u(e)}if(null===G||void 0===G?void 0:G.plot){var s=null===G||void 0===G?void 0:G.clusters,a=X,i=[];null===G||void 0===G||G.plot.x.forEach((function(e,t){i.push([e,null===G||void 0===G?void 0:G.plot.y[t]])}));var c={clusters:s},l=new L.ScatterGL.Dataset(i,c),o=Math.max.apply(Math,Object(r.a)(null===V||void 0===V?void 0:V.clusters));e.render(l),e.setPointColorer((function(e,t,n){var i,c,r;if(t.has(e))return"#30404D";if(null!=x)if(String(x).startsWith("cs")){if(!K[x].includes(e))return"#D3D3D3"}else if(x!==s[e])return"#D3D3D3";if(null!==Z&&Array.isArray(null===J||void 0===J||null===(i=J[Z])||void 0===i?void 0:i.expr))return"#"+I.colorAt(null===J||void 0===J||null===(c=J[Z])||void 0===c||null===(r=c.expr)||void 0===r?void 0:r[e]);if(null!=x&&String(x).startsWith("cs")){var l=parseInt(x.replace("cs",""));return a[o+l]}return a[s[e]]}))}}}),[G,I,x]),Object(s.useEffect)((function(){oe(q)}),[q]);var oe=function(e){"TSNE"===q?Q({plot:U,clusters:null===V||void 0===V?void 0:V.clusters}):"UMAP"===q&&Q({plot:H,clusters:null===V||void 0===V?void 0:V.clusters})},de=function(e){"PAN"===e?(d.setPanMode(),le("PAN")):"SELECT"===e&&(d.setSelectMode(),le("SELECT"))};return Object(b.jsxs)("div",{className:"scatter-plot",children:[Object(b.jsxs)(o.b,{style:{minWidth:75,minHeight:150},fill:!1,large:!1,minimal:!1,vertical:!0,className:"left-sidebar",children:[Object(b.jsxs)(o.a,{className:"dim-button",disabled:-1===W.indexOf("TSNE"),onClick:function(){return z("TSNE")},intent:"TSNE"===q?"primary":"",children:[Object(b.jsx)(o.n,{icon:"database"}),Object(b.jsx)("br",{}),Object(b.jsx)("span",{children:"TSNE"})]}),Object(b.jsxs)(o.a,{className:"dim-button",disabled:-1===W.indexOf("UMAP"),onClick:function(){return z("UMAP")},intent:"UMAP"===q?"primary":"",children:[Object(b.jsx)(o.n,{icon:"database"}),Object(b.jsx)("br",{}),Object(b.jsx)("span",{children:"UMAP"})]})]}),Object(b.jsxs)(o.f,{className:"top-header",fill:!1,vertical:!1,children:[Object(b.jsx)(o.a,{active:"PAN"==re,intent:"PAN"===re?"primary":"none",icon:"hand-up",onClick:function(e){return de("PAN")},children:"Pan"}),Object(b.jsx)(o.a,{active:"SELECT"==re,intent:"SELECT"===re?"primary":"none",icon:"widget",onClick:function(e){return de("SELECT")},children:"Selection"})]}),Object(b.jsx)("div",{className:"dim-plot",children:(null===G||void 0===G?void 0:G.plot)?Object(b.jsx)("div",{ref:n}):"Choose an Embedding... or Embeddings are being computed..."}),Object(b.jsx)("div",{className:"right-sidebar",children:Object(b.jsxs)("div",{style:{width:"100%"},children:[Object(b.jsxs)("div",{className:"right-sidebar-cluster",children:[Object(b.jsxs)(o.c,{title:"CLUSTERS",children:[Object(b.jsx)("ul",{children:null===X||void 0===X?void 0:X.map((function(e,t){return t<X.length-Object.keys(K).length?Object(b.jsxs)("li",{className:x==t?"legend-highlight":"",style:{color:e},onClick:function(){f(t===x?null:t)},children:[" Cluster ",t+1," "]},t):""}))}),Object.keys(K).length>0?Object(b.jsxs)("div",{style:{paddingTop:"5px"},children:[Object(b.jsxs)("span",{children:["Custom Selection \xa0",Object(b.jsx)(j.a,{content:"Custom selection of cells",openOnTargetFocus:!1,children:Object(b.jsx)(o.n,{icon:"help"})})]}),Object(b.jsx)("ul",{children:null===(t=Object.keys(K))||void 0===t?void 0:t.map((function(e,t){return Object(b.jsx)("li",{className:x==e?"legend-highlight":"",style:{color:X[Math.max.apply(Math,Object(r.a)(null===V||void 0===V?void 0:V.clusters))+1+t]},children:Object(b.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",flexDirection:"row"},children:[Object(b.jsxs)("span",{style:{alignSelf:"center"},onClick:function(){f(e===x?null:e)},children:["Custom Selection ",e.replace("cs","")]}),Object(b.jsx)(o.n,{size:12,icon:"trash",style:{paddingLeft:"2px"},onClick:function(){var t=Object(c.a)({},K);delete t[e],$(t);var n=Object(r.a)(X);n=n.slice(0,n.length-1),Y(n),ee(e),x===e&&f(null)}})]})},e)}))})]}):""]}),se&&se.length>0?Object(b.jsxs)("div",{children:[Object(b.jsx)(o.h,{}),Object(b.jsxs)("span",{children:["Selection \xa0",Object(b.jsx)(j.a,{content:"save this selection of cells",openOnTargetFocus:!1,children:Object(b.jsx)(o.n,{icon:"help"})})]}),Object(b.jsxs)("div",{className:"selection-container",children:[Object(b.jsxs)("span",{children:[se.length," cells selected"]}),Object(b.jsxs)("div",{className:"selection-button-container",children:[Object(b.jsx)(o.a,{small:!0,intent:"primary",onClick:function(){var e=Object(D.randomColor)({luminosity:"dark",count:1}),t=Object(r.a)(X);t.push(e[0]),Y(t);var n=Object.keys(K).length,s=Object(c.a)({},K);s["cs".concat(n+1)]=se,$(s),ae(null),d.select(null)},children:"Save"}),Object(b.jsx)(o.a,{small:!0,onClick:function(){ae(null),d.select(null)},children:"Clear"})]})]})]}):""]}),g?Object(b.jsxs)("div",{className:"right-sidebar-slider",children:[Object(b.jsx)(o.h,{}),Object(b.jsxs)(o.c,{children:[Object(b.jsxs)("span",{children:["Customize Gradient \xa0",Object(b.jsx)(j.a,{content:"Use the slider to adjust the color gradient of the plot. Useful when data is skewed by either a few lowly or highly expressed cells",openOnTargetFocus:!1,children:Object(b.jsx)(o.n,{icon:"help"})})]}),Object(b.jsxs)("div",{className:"dim-slider-container",children:[Object(b.jsxs)("div",{className:"dim-slider-gradient",children:[Object(b.jsx)("span",{children:Math.round(C[0])}),"\xa0",Object(b.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, #F5F8FA ".concat(100*(E[0]-C[0])/(C[1]-C[0]),"%, ").concat(100*(E[1]+E[0]-2*C[0])/(2*(C[1]-C[0])),"%, #2965CC ").concat(100-100*(C[1]-E[1])/(C[1]-C[0]),"%)"),width:"175px",height:"15px"}}),"\xa0",Object(b.jsx)("span",{children:Math.round(C[1])})]}),Object(b.jsx)("div",{className:"dim-range-slider",children:Object(b.jsx)(o.x,{min:Math.round(C[0]),max:Math.round(C[1]),stepSize:Math.round(C[1]-C[0])/25,onChange:function(e){A(e)},value:[Math.round(E[0]),Math.round(E[1])],vertical:!1})})]})]})]}):""]})})]})},P=n(79),G=n(135),W=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color,i=null===e||void 0===e?void 0:e.clusters;if(s||(s=325),a||(a="#00B3A4"),!n)return"";var c=t.current;c.innerHTML="";var l=10,o=30,d=30,u=40,h=s-u-o,j=150-l-d,b=N.m(c).append("svg").attr("width",h+u+o).attr("height",j+l+d).append("g").attr("transform","translate(".concat(u,",").concat(l,")")),p=N.k().domain([0,Math.max.apply(Math,Object(r.a)(n))]).range([0,h]);b.append("g").attr("transform","translate(0, ".concat(j,")")).call(N.b(p));var O=N.f().value((function(e){return e})).domain(p.domain()).thresholds(p.ticks(25)),x=O(n),f=O(n.filter((function(e,t){return 0===(null===i||void 0===i?void 0:i[t])}))),m=O(n.filter((function(e,t){return 1===(null===i||void 0===i?void 0:i[t])}))),v=N.k().range([j,0]).domain([0,N.i(x,(function(e){return e.length}))]);b.selectAll("rectAll").data(f).join("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(p(e.x0)," , ").concat(v(e.length),")")})).attr("width",(function(e){return p(e.x1)-p(e.x0)-1})).attr("height",(function(e){return j-v(e.length)})).style("fill","#D3D3D3").style("opacity",.6),b.selectAll("rectCluster").data(m).enter().append("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(p(e.x0),", ").concat(v(e.length),")")})).attr("width",(function(e){return p(e.x1)-p(e.x0)-1})).attr("height",(function(e){return j-v(e.length)})).style("fill",a).style("opacity",.6),b.append("circle").attr("cx",h-50).attr("cy",5).attr("r",3).style("fill","#D3D3D3"),b.append("circle").attr("cx",h-50).attr("cy",15).attr("r",3).style("fill",a),b.append("text").attr("x",h-40).attr("y",5).text("all cells").style("font-size","10px").attr("alignment-baseline","middle"),b.append("text").attr("x",h-40).attr("y",15).text("this cluster").style("font-size","10px").attr("alignment-baseline","middle")}),[]),Object(b.jsx)("div",{ref:t})},q=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.height,i=null===e||void 0===e?void 0:e.color;if(s||(s=325),a||(a=150),i||(i="#00B3A4"),!n)return"";var c=t.current;c.innerHTML="";var l=5,o=5,d=5,u=5,h=s-u-o,j=a-l-d,b=N.m(c).append("svg").attr("width",h+u+o).attr("height",j+l+d).append("g").attr("transform","translate(".concat(u,",").concat(l,")")),p=N.k().domain([0,Math.max.apply(Math,Object(r.a)(n))]).range([0,h]);b.append("g").attr("transform","translate(0, ".concat(j,")")).call(N.b(p));var O=N.f().value((function(e){return e})).domain(p.domain()).thresholds(p.ticks(25))(n),x=N.k().range([j,0]);x.domain([0,N.i(O,(function(e){return e.length}))]),b.selectAll("rect").data(O).join("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(p(e.x0)," , ").concat(x(e.length),")")})).attr("width",(function(e){return p(e.x1)-p(e.x0)-1})).attr("height",(function(e){return j-x(e.length)})).style("fill",i)}),[null===e||void 0===e?void 0:e.data]),Object(b.jsx)("div",{ref:t})},z=function(e){var t=Object(s.useRef)(),n=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.minmax,i=null===e||void 0===e?void 0:e.score,c=null===e||void 0===e?void 0:e.colorscale,r=null===e||void 0===e?void 0:e.colorscore,l=null===e||void 0===e?void 0:e.color,o=(i-a[0])/(a[1]-a[0]);return n||(n="100%"),l||(l="#00B3A4"),Object(b.jsx)("div",{ref:t,style:{width:n,height:"15px",margin:"5px",border:"1px solid gainsboro",alignItems:"center"},children:c?Object(b.jsx)("div",{style:{width:"".concat(100*r,"%"),backgroundColor:c(r),height:"100%"}}):Object(b.jsx)("div",{style:{width:"".concat(100*o,"%"),backgroundColor:l,height:"100%"}})})},V=function(e){var t=Object(s.useRef)(),n=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.score,i=null===e||void 0===e?void 0:e.minmax,c=N.l(N.h).domain([i[1],i[0]]);return n||(n="100%"),Object(b.jsx)("div",{ref:t,style:{width:n,height:"15px",margin:"5px",border:"1px solid gainsboro",alignItems:"center",backgroundColor:c(a)},children:Object(b.jsx)("div",{style:{width:"100%",backgroundColor:c(a),height:"100%"}})})},U=(n(336),["children"]),H=function(){var e=Object(s.useContext)(p),t=e.genesInfo,n=e.clusterData,a=e.selectedClusterSummary,i=e.setSelectedClusterSummary,d=e.selectedCluster,O=e.setSelectedCluster,x=e.setClusterRank,f=e.setReqGene,m=e.clusterColors,v=e.gene,g=e.setGene,F=e.customSelection,w=Object(s.useState)(null),C=Object(l.a)(w,2),k=C[0],S=C[1],D=Object(s.useState)(null),E=Object(l.a)(D,2),A=E[0],M=E[1],T=Object(s.useState)(null),L=Object(l.a)(T,2),B=L[0],R=L[1],I=Object(s.useState)(null),_=Object(l.a)(I,2),H=_[0],Q=_[1],X=Object(s.useState)(null),Y=Object(l.a)(X,2),Z=Y[0],J=Y[1],K=Object(s.useState)(null),$=Object(l.a)(K,2),ee=$[0],te=$[1],ne=Object(s.useState)(null),se=Object(l.a)(ne,2),ae=se[0],ie=se[1],ce=Object(s.useState)(null),re=Object(l.a)(ce,2),le=re[0],oe=re[1],de=Object(s.useState)(null),ue=Object(l.a)(de,2),he=ue[0],je=ue[1],be=Object(s.useState)(null),pe=Object(l.a)(be,2),Oe=pe[0],xe=pe[1],fe=Object(s.useState)(null),me=Object(l.a)(fe,2),ve=me[0],ge=me[1],ye=Object(s.useState)(null),Fe=Object(l.a)(ye,2),we=Fe[0],Ce=Fe[1],Ne=Object(s.useState)({}),ke=Object(l.a)(Ne,2),Se=ke[0],De=ke[1],Ee=Object(s.useState)(null),Ae=Object(l.a)(Ee,2),Me=Ae[0],Te=Ae[1],Le=N.h;Object(s.useEffect)((function(){if(!a)return a;var e=a;if(0===e.length)return e;var t=e.map((function(e){return null===e||void 0===e?void 0:e.mean})),n=N.e(t),s=0===n[1]?.01:n[1];Q([parseFloat(n[0].toFixed(2)),parseFloat(s.toFixed(2))]),je(t);var i=e.map((function(e){return null===e||void 0===e?void 0:e.delta})),c=N.e(i),l=0===c[1]?.01:c[1];J([parseFloat(c[0].toFixed(2)),parseFloat(l.toFixed(2))]),xe(i);var o=e.map((function(e){return null===e||void 0===e?void 0:e.lfc})),d=N.e(o),u=0===d[1]?.01:d[1];te([parseFloat(d[0].toFixed(2)),parseFloat(u.toFixed(2))]),ge(o);var h=e.map((function(e){return null===e||void 0===e?void 0:e.detected})),j=N.e(h),b=0===j[1]?.01:j[1];ie([parseFloat(j[0].toFixed(2)),parseFloat(b.toFixed(2))]),Ce(h),oe({lfc:[parseFloat(d[0].toFixed(2)),parseFloat(u.toFixed(2))],mean:[parseFloat(n[0].toFixed(2)),parseFloat(s.toFixed(2))],detected:[parseFloat(j[0].toFixed(2)),parseFloat(b.toFixed(2))],delta:[parseFloat(c[0].toFixed(2)),parseFloat(l.toFixed(2))]});var p=Object(r.a)(e);Te(p)}),[a]);var Be=Object(s.useMemo)((function(){if(!Me)return[];var e=Me;if(Se){var n=function(t){var n=Se[t];if(n[0]==le[t][0]&&n[1]==le[t][1])return"continue";e=e.filter((function(e){return e[t]>=n[0]&&e[t]<=n[1]}))};for(var s in Se)n(s)}return B&&""!==B?e=e.filter((function(e){return-1!==t[e.row].toLowerCase().indexOf(B.toLowerCase())})):e}),[Me,B,Se]);Object(s.useEffect)((function(){if(null===n||void 0===n?void 0:n.clusters){for(var e=Math.max.apply(Math,Object(r.a)(n.clusters)),t=[],s=0;s<e+1;s++)t.push(s+1);t=t.concat(Object.keys(F)),S(t),null==d&&O(0)}}),[n,F,d]),Object(s.useEffect)((function(){var e,t,s=[];String(d).startsWith("cs")?null===n||void 0===n||null===(e=n.clusters)||void 0===e||e.forEach((function(e,t){return F[d].includes(t)?s.push(1):s.push(0)})):null===n||void 0===n||null===(t=n.clusters)||void 0===t||t.forEach((function(e){return e===d?s.push(1):s.push(0)}));M(s)}),[d]);var Re=function(e,t){var n=Object(c.a)({},Se);n[t]=e,De(n)};return Object(b.jsxs)("div",{className:"marker-container",children:[Object(b.jsx)(o.k,{children:"Marker Genes"}),k?Object(b.jsx)(o.m,{onChange:function(e){var t;g(null);var n=null===(t=e.currentTarget)||void 0===t?void 0:t.value;n.startsWith("Cluster")?n=parseInt(n.replace("Cluster ",""))-1:n.startsWith("Custom")&&(n=n.replace("Custom Selection ","")),O(n),De({}),g(null)},children:k.map((function(e,t){return Object(b.jsxs)("option",{children:[String(e).startsWith("cs")?"Custom Selection":"Cluster"," ",e]},t)}))}):"",a?Object(b.jsxs)("div",{className:"marker-table",children:[Object(b.jsxs)("div",{className:"marker-header",children:[Object(b.jsx)(o.o,{leftIcon:"search",small:!0,placeholder:"Search gene...",type:"text",onChange:function(e){return R(e.target.value)}}),Object(b.jsxs)("span",{children:[Object(b.jsx)(o.n,{icon:"sort",style:{paddingRight:"5px"}}),Object(b.jsxs)(o.m,{onChange:function(e){x(e.currentTarget.value)},defaultValue:"cohen-min-rank",children:[Object(b.jsx)("option",{children:"cohen-min"}),Object(b.jsx)("option",{children:"cohen-mean"}),Object(b.jsx)("option",{children:"cohen-min-rank"}),Object(b.jsx)("option",{children:"auc-min"}),Object(b.jsx)("option",{children:"auc-mean"}),Object(b.jsx)("option",{children:"auc-min-rank"}),Object(b.jsx)("option",{children:"lfc-min"}),Object(b.jsx)("option",{children:"lfc-mean"}),Object(b.jsx)("option",{children:"lfc-min-rank"}),Object(b.jsx)("option",{children:"delta-d-min"}),Object(b.jsx)("option",{children:"delta-d-mean"}),Object(b.jsx)("option",{children:"delta-d-min-rank"})]})]})]}),Object(b.jsx)(G.a,{components:{Item:function(e){var t=e.children,n=Object(u.a)(e,U);return Object(b.jsx)("div",Object(c.a)(Object(c.a)({className:"row-card"},n),{},{children:t}))},Header:function(){return Object(b.jsxs)("div",{className:"row-container row-header",children:[Object(b.jsx)("span",{children:"Gene"}),Object(b.jsx)("span",{children:"Log-FC"}),Object(b.jsx)("span",{children:"\u0394-detected"}),Object(b.jsxs)("span",{children:["Expression \xa0",Object(b.jsx)(j.a,{content:"bar represents the mean expression of the gene and the color gradient represents detected.",openOnTargetFocus:!1,children:Object(b.jsx)(o.n,{size:12,icon:"help"})})]}),Object(b.jsx)("span",{})]})}},className:"marker-list",totalCount:Be.length,itemContent:function(e){var s=Be[e],c=s.expanded,l=s.expr;return Object(b.jsxs)("div",{children:[Object(b.jsxs)("div",{className:"row-container",children:[Object(b.jsx)("span",{children:t[s.row]}),Object(b.jsx)(P.a,{popoverClassName:h.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(b.jsx)(o.d,{elevation:y.a.ZERO,children:Object(b.jsxs)("table",{children:[Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{}),Object(b.jsx)("th",{scope:"col",children:t[s.row]}),Object(b.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{scope:"row",children:"Log-FC"}),Object(b.jsx)("td",{children:s.lfc.toFixed(2)}),Object(b.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ee[0].toFixed(2),", ",ee[1].toFixed(2),"]"]})]}),Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(b.jsx)("td",{children:s.delta.toFixed(2)}),Object(b.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",Z[0].toFixed(2),", ",Z[1].toFixed(2),"]"]})]}),Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{scope:"row",children:"Detected"}),Object(b.jsx)("td",{children:s.detected.toFixed(2)}),Object(b.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ae[0].toFixed(2),", ",ae[1].toFixed(2),"]"]})]}),Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{scope:"row",children:"Expression"}),Object(b.jsx)("td",{children:s.mean.toFixed(2)}),Object(b.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",H[0].toFixed(2),", ",H[1].toFixed(2),"]"]})]})]})}),children:Object(b.jsx)(V,{minmax:ee,colorscale:N.g,score:s.lfc})}),Object(b.jsx)(P.a,{popoverClassName:h.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(b.jsx)(o.d,{elevation:y.a.ZERO,children:Object(b.jsxs)("table",{children:[Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{}),Object(b.jsx)("th",{scope:"col",children:t[s.row]}),Object(b.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(b.jsx)("td",{children:s.delta.toFixed(2)}),Object(b.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",Z[0].toFixed(2),", ",Z[1].toFixed(2),"]"]})]}),Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{scope:"row",children:"Detected"}),Object(b.jsx)("td",{children:s.detected.toFixed(2)}),Object(b.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ae[0].toFixed(2),", ",ae[1].toFixed(2),"]"]})]}),Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{scope:"row",children:"Log-FC"}),Object(b.jsx)("td",{children:s.lfc.toFixed(2)}),Object(b.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ee[0].toFixed(2),", ",ee[1].toFixed(2),"]"]})]}),Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{scope:"row",children:"Expression"}),Object(b.jsx)("td",{children:s.mean.toFixed(2)}),Object(b.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",H[0].toFixed(2),", ",H[1].toFixed(2),"]"]})]})]})}),children:Object(b.jsx)(V,{minmax:Z,colorscale:N.g,score:s.delta})}),Object(b.jsx)(P.a,{popoverClassName:h.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(b.jsx)(o.d,{elevation:y.a.ZERO,children:Object(b.jsxs)("table",{children:[Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{}),Object(b.jsx)("th",{scope:"col",children:t[s.row]}),Object(b.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{scope:"row",children:"Expression"}),Object(b.jsx)("td",{children:s.mean.toFixed(2)}),Object(b.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",H[0].toFixed(2),", ",H[1].toFixed(2),"]"]})]}),Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{scope:"row",children:"Log-FC"}),Object(b.jsx)("td",{children:s.lfc.toFixed(2)}),Object(b.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ee[0].toFixed(2),", ",ee[1].toFixed(2),"]"]})]}),Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(b.jsx)("td",{children:s.delta.toFixed(2)}),Object(b.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",Z[0].toFixed(2),", ",Z[1].toFixed(2),"]"]})]}),Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{scope:"row",children:"Detected"}),Object(b.jsx)("td",{children:s.detected.toFixed(2)}),Object(b.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ae[0].toFixed(2),", ",ae[1].toFixed(2),"]"]})]})]})}),children:Object(b.jsx)(z,{minmax:H,colorscale:Le,score:s.mean,colorscore:s.detected})}),Object(b.jsxs)("div",{className:"row-action",children:[Object(b.jsx)(o.a,{icon:c?"minus":"plus",small:!0,fill:!1,className:"row-action",onClick:function(){var e=Object(r.a)(a);e[s.index].expanded=!e[s.index].expanded,i(e),l||f(s.row)}}),Object(b.jsx)(o.a,{small:!0,fill:!1,className:"row-action",onClick:function(){s.index===v?g(null):(g(s.index),l||f(s.row))},children:Object(b.jsx)(o.n,{icon:"tint",color:s.index===v&&String(d).startsWith("cs")?m[Math.max.apply(Math,Object(r.a)(null===n||void 0===n?void 0:n.clusters))+parseInt(d.replace("cs",""))]:""})})]})]}),Object(b.jsx)(o.e,{isOpen:c,children:l&&Object(b.jsx)(W,{data:l,color:String(d).startsWith("cs")?m[Math.max.apply(Math,Object(r.a)(null===n||void 0===n?void 0:n.clusters))+parseInt(d.replace("cs",""))]:m[d],clusters:A})})]})}}),Object(b.jsxs)("div",{className:"marker-footer",children:[Object(b.jsx)(o.l,{className:"marker-footer-title",children:"Filter Markers"}),Object(b.jsxs)("div",{className:"marker-filter-container",children:[Object(b.jsx)(o.A,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Log-FC"}),Object(b.jsx)(q,{data:ve,height:35,color:"#F5498B"}),Object(b.jsx)("div",{className:"marker-filter-slider",children:ee&&Object(b.jsx)(o.x,{min:ee[0],max:ee[1],stepSize:parseFloat((Math.abs(ee[1]-ee[0])/20).toFixed(2)),onChange:function(e){return Re(e,"lfc")},value:(null===Se||void 0===Se?void 0:Se.lfc)?null===Se||void 0===Se?void 0:Se.lfc:ee,vertical:!1})})]}),Object(b.jsxs)("div",{className:"marker-filter-container",children:[Object(b.jsx)(o.A,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"\u0394-detected"}),Object(b.jsx)(q,{data:Oe,height:35,color:"#4580E6"}),Object(b.jsx)("div",{className:"marker-filter-slider",children:Z&&Object(b.jsx)(o.x,{min:Z[0],max:Z[1],stepSize:parseFloat((Math.abs(Z[1]-Z[0])/20).toFixed(2)),onChange:function(e){return Re(e,"delta")},value:(null===Se||void 0===Se?void 0:Se.delta)?null===Se||void 0===Se?void 0:Se.delta:Z,vertical:!1})})]}),Object(b.jsxs)("div",{className:"marker-filter-container",children:[Object(b.jsx)(o.A,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Mean"}),Object(b.jsx)(q,{data:he,height:35}),Object(b.jsx)("div",{className:"marker-filter-slider",children:H&&Object(b.jsx)(o.x,{min:H[0],max:H[1],stepSize:parseFloat((Math.abs(H[1]-H[0])/20).toFixed(2)),onChange:function(e){return Re(e,"mean")},value:(null===Se||void 0===Se?void 0:Se.mean)?null===Se||void 0===Se?void 0:Se.mean:H,vertical:!1})})]}),Object(b.jsxs)("div",{className:"marker-filter-container",children:[Object(b.jsx)(o.A,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Detected"}),Object(b.jsx)(q,{data:we,height:35}),Object(b.jsx)("div",{className:"marker-filter-slider",children:ae&&Object(b.jsx)(o.x,{min:ae[0],max:ae[1],stepSize:parseFloat((Math.abs(ae[1]-ae[0])/20).toFixed(2)),onChange:function(e){return Re(e,"detected")},value:(null===Se||void 0===Se?void 0:Se.detected)?null===Se||void 0===Se?void 0:Se.detected:ae,vertical:!1})})]})]})]}):""]})},Q=(n(337),n(338),function(){var e=Object(s.useRef)();return Object(s.useEffect)((function(){var t=e.current,n=0,s=1,a=2,i=3,c=4,r=[5,5,3,3,2],l=["#1abc9c","#2ecc71","#3498db","#e74c3c","#9b59b6"],o={new:function(e){return{width:18,height:18,x:this.canvas.width/2-9,y:this.canvas.height/2-9,moveX:n,moveY:n,speed:e||9}}},d={new:function(e){return{width:18,height:70,x:"left"===e?150:this.canvas.width-150,y:this.canvas.height/2-35,score:0,move:n,speed:10}}},u={initialize:function(){this.canvas=t.querySelector("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=1400,this.canvas.height=1e3,this.canvas.style.width=this.canvas.width/2+"px",this.canvas.style.height=this.canvas.height/2+"px",this.player=d.new.call(this,"left"),this.paddle=d.new.call(this,"right"),this.ball=o.new.call(this),this.paddle.speed=8,this.running=this.over=!1,this.turn=this.paddle,this.timer=this.round=0,this.color="#2c3e50",h.menu(),h.listen()},endGameMenu:function(e){h.context.font="50px Courier New",h.context.fillStyle=this.color,h.context.fillRect(h.canvas.width/2-350,h.canvas.height/2-48,700,100),h.context.fillStyle="#ffffff",h.context.fillText(e,h.canvas.width/2,h.canvas.height/2+15),setTimeout((function(){(h=Object.assign({},u)).initialize()}),3e3)},menu:function(){h.draw(),this.context.font="50px Courier New",this.context.fillStyle=this.color,this.context.fillRect(this.canvas.width/2-350,this.canvas.height/2-48,700,100),this.context.fillStyle="#ffffff",this.context.fillText("Press any key to begin",this.canvas.width/2,this.canvas.height/2+15)},update:function(){this.over||(this.ball.x<=0&&h._resetTurn.call(this,this.paddle,this.player),this.ball.x>=this.canvas.width-this.ball.width&&h._resetTurn.call(this,this.player,this.paddle),this.ball.y<=0&&(this.ball.moveY=a),this.ball.y>=this.canvas.height-this.ball.height&&(this.ball.moveY=s),this.player.move===s?this.player.y-=this.player.speed:this.player.move===a&&(this.player.y+=this.player.speed),h._turnDelayIsOver.call(this)&&this.turn&&(this.ball.moveX=this.turn===this.player?i:c,this.ball.moveY=[s,a][Math.round(Math.random())],this.ball.y=Math.floor(Math.random()*this.canvas.height-200)+200,this.turn=null),this.player.y<=0?this.player.y=0:this.player.y>=this.canvas.height-this.player.height&&(this.player.y=this.canvas.height-this.player.height),this.ball.moveY===s?this.ball.y-=this.ball.speed/1.5:this.ball.moveY===a&&(this.ball.y+=this.ball.speed/1.5),this.ball.moveX===i?this.ball.x-=this.ball.speed:this.ball.moveX===c&&(this.ball.x+=this.ball.speed),this.paddle.y>this.ball.y-this.paddle.height/2&&(this.ball.moveX===c?this.paddle.y-=this.paddle.speed/1.5:this.paddle.y-=this.paddle.speed/4),this.paddle.y<this.ball.y-this.paddle.height/2&&(this.ball.moveX===c?this.paddle.y+=this.paddle.speed/1.5:this.paddle.y+=this.paddle.speed/4),this.paddle.y>=this.canvas.height-this.paddle.height?this.paddle.y=this.canvas.height-this.paddle.height:this.paddle.y<=0&&(this.paddle.y=0),this.ball.x-this.ball.width<=this.player.x&&this.ball.x>=this.player.x-this.player.width&&this.ball.y<=this.player.y+this.player.height&&this.ball.y+this.ball.height>=this.player.y&&(this.ball.x=this.player.x+this.ball.width,this.ball.moveX=c),this.ball.x-this.ball.width<=this.paddle.x&&this.ball.x>=this.paddle.x-this.paddle.width&&this.ball.y<=this.paddle.y+this.paddle.height&&this.ball.y+this.ball.height>=this.paddle.y&&(this.ball.x=this.paddle.x-this.ball.width,this.ball.moveX=i)),this.player.score===r[this.round]?r[this.round+1]?(this.color=this._generateRoundColor(),this.player.score=this.paddle.score=0,this.player.speed+=.5,this.paddle.speed+=1,this.ball.speed+=1,this.round+=1):(this.over=!0,setTimeout((function(){h.endGameMenu("Winner!")}),1e3)):this.paddle.score===r[this.round]&&(this.over=!0,setTimeout((function(){h.endGameMenu("Game Over!")}),1e3))},draw:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.color,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle="#ffffff",this.context.fillRect(this.player.x,this.player.y,this.player.width,this.player.height),this.context.fillRect(this.paddle.x,this.paddle.y,this.paddle.width,this.paddle.height),h._turnDelayIsOver.call(this)&&this.context.fillRect(this.ball.x,this.ball.y,this.ball.width,this.ball.height),this.context.beginPath(),this.context.setLineDash([7,15]),this.context.moveTo(this.canvas.width/2,this.canvas.height-140),this.context.lineTo(this.canvas.width/2,140),this.context.lineWidth=10,this.context.strokeStyle="#ffffff",this.context.stroke(),this.context.font="100px Courier New",this.context.textAlign="center",this.context.fillText(this.player.score.toString(),this.canvas.width/2-300,200),this.context.fillText(this.paddle.score.toString(),this.canvas.width/2+300,200),this.context.font="30px Courier New",this.context.fillText("Round "+(h.round+1),this.canvas.width/2,35),this.context.font="40px Courier",this.context.fillText(r[h.round]?r[h.round]:r[h.round-1],this.canvas.width/2,100)},loop:function(){h.update(),h.draw(),h.over||requestAnimationFrame(h.loop)},listen:function(){document.addEventListener("keydown",(function(e){!1===h.running&&(h.running=!0,window.requestAnimationFrame(h.loop)),38!==e.keyCode&&87!==e.keyCode||(h.player.move=s),40!==e.keyCode&&83!==e.keyCode||(h.player.move=a)})),document.addEventListener("keyup",(function(e){h.player.move=n}))},_resetTurn:function(e,t){this.ball=o.new.call(this,this.ball.speed),this.turn=t,this.timer=(new Date).getTime(),e.score++},_turnDelayIsOver:function(){return(new Date).getTime()-this.timer>=1e3},_generateRoundColor:function(){var e=l[Math.floor(Math.random()*l.length)];return e===this.color?h._generateRoundColor():e}},h=Object.assign({},u);h.initialize()}),[]),Object(b.jsxs)("div",{ref:e,className:"pong-container",children:[Object(b.jsx)("canvas",{}),Object(b.jsxs)("p",{className:"credit",children:["Game Credits ",Object(b.jsx)("a",{href:"https://codepen.io/gdube/pen/JybxxZ",target:"_blank",children:"Pong Game"})]})]})}),X=(n(339),function(){return Object(b.jsx)("div",{className:"dots-bars-5"})});var Y=function(){var e=Object(s.useState)(!0),t=Object(l.a)(e,2),n=t[0],a=t[1],i=Object(s.useContext)(p),d=i.setWasmInitialized,u=i.setTsneData,h=i.setRedDims,j=i.redDims,O=i.setGenesInfo,x=i.setInitDims,f=i.setQcDims,m=i.defaultRedDims,v=i.setDefaultRedDims,g=i.setQcData,y=i.qcData,F=i.setClusterData,w=i.setFSelectionData,N=i.setUmapData,k=i.setPcaVarExp,S=i.logs,D=i.setLogs,E=i.selectedCluster,A=i.clusterRank,M=i.selectedClusterSummary,L=i.setSelectedClusterSummary,B=i.reqGene,R=i.customSelection,I=i.clusterData,P=i.delCustomSelection,G=i.setDelCustomSelection,W=i.setSelectedCluster,q=i.setShowGame,z=i.showGame;return Object(s.useEffect)((function(){window.Worker.postMessage({type:"INIT",msg:"Initial Load"})}),[]),Object(s.useEffect)((function(){if(null!==E){var e=String(E).startsWith("cs")?"getMarkersForSelection":"getMarkersForCluster";window.Worker.postMessage({type:e,payload:{cluster:E,rank_type:A}})}}),[E,A]),Object(s.useEffect)((function(){if(null!==R&&Object.keys(R).length>0){var e="cs".concat(Object.keys(R).length),t=R[e];window.Worker.postMessage({type:"computeCustomMarkers",payload:{selection:t,id:e}})}}),[R]),Object(s.useEffect)((function(){null!==P&&(window.Worker.postMessage({type:"removeCustomMarkers",payload:{id:P}}),G(null))}),[P]),Object(s.useEffect)((function(){null!==B&&window.Worker.postMessage({type:"getGeneExpression",payload:{gene:B}})}),[B]),window.Worker.onmessage=function(e){var t=e.data;if(null===t||void 0===t?void 0:t.msg){var n=Object(r.a)(S),s=new Date;n.push("".concat(s.getHours()+":"+s.getMinutes()+":"+s.getSeconds()," - ").concat(null===t||void 0===t?void 0:t.type," - ").concat(null===t||void 0===t?void 0:t.msg)),D(n)}if("INIT"===t.type)a(!1),d(!0);else if("inputs_DATA"===t.type)x("".concat(t.resp.dimensions.num_genes," genes, ").concat(t.resp.dimensions.num_cells," cells")),O(t.resp.gene_names);else if("quality_control_metrics_DATA"===t.type){var i=t.resp;g(i)}else if("quality_control_thresholds_DATA"===t.type){var l=t.resp,o=Object(c.a)({},y);o.thresholds=l,g(o)}else if("quality_control_filtered_DATA"===t.type)f("".concat(t.resp.retained," cells"));else if("feature_selection_DATA"===t.type){var b=t.resp;w(b)}else if("pca_DATA"===t.type){var p=t.resp;k(p)}else if("snn_cluster_graph_DATA"===t.type){var C=t.resp;F(C),W(0)}else if("tsne_DATA"===t.type||"tsne_iter"===t.type){var E=t.resp;u(E);var A=Object(r.a)(j);A.push("TSNE"),m||v("TSNE"),h(A),q(!1)}else if("umap_DATA"===t.type){var T=t.resp;N(T);var B=Object(r.a)(j);B.push("UMAP"),h(B)}else if("markerGene_DATA"===t.type);else if("setMarkersForCluster"===t.type||"setMarkersForCustomSelection"===t.type){var R=t.resp,I=[];R.means.forEach((function(e,t){var n,s,a,i;I.push({index:t,row:null===R||void 0===R||null===(n=R.ordering)||void 0===n?void 0:n[t],mean:e,delta:null===R||void 0===R||null===(s=R.delta_detected)||void 0===s?void 0:s[t],lfc:null===R||void 0===R||null===(a=R.lfc)||void 0===a?void 0:a[t],detected:null===R||void 0===R||null===(i=R.detected)||void 0===i?void 0:i[t],expanded:!1,expr:null})})),L(I)}else if("setGeneExpression"===t.type){for(var _=t.resp,P=Object(r.a)(M),G=0;G<P.length;G++)if(_.gene===P[G].row){P[G].expr=Object.values(_.expr);break}L(P)}},Object(b.jsxs)("div",{className:"App",children:[Object(b.jsx)(C,{}),Object(b.jsxs)("div",{className:"App-content",children:[Object(b.jsx)("div",{className:"plot",children:m?Object(b.jsx)(_,{}):z?Object(b.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:"50px"},children:[Object(b.jsx)(o.p,{children:"Get some coffee or play pong while you wait for the analysis to finish.."}),Object(b.jsx)(o.a,{onClick:function(){q(!1)},children:"I'm good, go back"}),Object(b.jsx)(Q,{})]}):Object(b.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:"50px"},children:[Object(b.jsx)(X,{}),Object(b.jsx)(o.p,{children:"Get some coffee or play pong while you wait for the analysis to finish.."}),Object(b.jsx)(o.a,{onClick:function(){q(!0)},children:"Play Pong"})]})}),Object(b.jsx)("div",{className:"marker",children:I?Object(b.jsx)(H,{}):Object(b.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[Object(b.jsx)(X,{}),Object(b.jsx)(o.p,{children:"Generating nearest neighbor graph to compute clusters...."})]})}),Object(b.jsx)("div",{className:"analysis",children:Object(b.jsx)(T,{})})]}),Object(b.jsx)(o.v,Object(c.a)(Object(c.a)({isOpen:n},{autoFocus:!0,canEscapeKeyClose:!1,canOutsideClickClose:!1,enforceFocus:!0,hasBackdrop:!0,usePortal:!0,useTallContent:!1}),{},{children:Object(b.jsxs)("div",{className:"spinner",children:[Object(b.jsx)(o.y,{size:100}),Object(b.jsx)("p",{children:"Initializing kana"})]})}))]})},Z=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,348)).then((function(t){var n=t.getCLS,s=t.getFID,a=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),s(e),a(e),i(e),c(e)}))};i.a.render(Object(b.jsx)(O,{children:Object(b.jsx)(Y,{})}),document.getElementById("root")),Z()}},[[340,1,2]]]);
//# sourceMappingURL=main.bf019b9f.chunk.js.map