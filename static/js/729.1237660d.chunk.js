!function(){"use strict";var e={7729:function(e,n,r){var t={};r.r(t),r.d(t,{changed:function(){return F},compute:function(){return V},fetchAnnotations:function(){return ne},fetchCountMatrix:function(){return Y},fetchDimensions:function(){return $},fetchGenes:function(){return ee},results:function(){return Q},serialize:function(){return X},unserialize:function(){return H}});var a={};r.r(a),r.d(a,{changed:function(){return se},compute:function(){return ue},fetchQCMetrics:function(){return de},fetchSums:function(){return me},results:function(){return ce},serialize:function(){return le},unserialize:function(){return fe}});var s={};r.r(s),r.d(s,{changed:function(){return ve},compute:function(){return ye},fetchDiscards:function(){return xe},fetchDiscardsAsWasmArray:function(){return Se},results:function(){return ge},serialize:function(){return be},unserialize:function(){return we}});var o={};r.r(o),r.d(o,{changed:function(){return Ee},compute:function(){return Ne},fetchFilteredMatrix:function(){return Ge},fetchRetained:function(){return ze},results:function(){return Te},serialize:function(){return Ae},unserialize:function(){return Oe}});var i={};r.r(i),r.d(i,{changed:function(){return Ce},compute:function(){return Ze},fetchExpression:function(){return Ie},fetchNormalizedMatrix:function(){return Be},results:function(){return De},serialize:function(){return Pe},unserialize:function(){return Fe}});var u={};r.r(u),r.d(u,{changed:function(){return We},compute:function(){return Le},fetchResiduals:function(){return He},fetchSortedResiduals:function(){return Xe},results:function(){return Je},serialize:function(){return Ve},unserialize:function(){return Qe}});var c={};r.r(c),r.d(c,{changed:function(){return en},compute:function(){return rn},fetchPCs:function(){return on},results:function(){return tn},serialize:function(){return an},unserialize:function(){return sn}});var l={};r.r(l),r.d(l,{changed:function(){return ln},compute:function(){return dn},fetchIndex:function(){return vn},rawCompute:function(){return fn},results:function(){return mn},serialize:function(){return pn},unserialize:function(){return hn}});var f={};r.r(f),r.d(f,{changed:function(){return bn},compute:function(){return Sn},fetchNeighbors:function(){return En},rawCompute:function(){return wn},results:function(){return xn},serialize:function(){return _n},unserialize:function(){return Mn}});var d={};r.r(d),r.d(d,{changed:function(){return Tn},compute:function(){return On},fetchGraph:function(){return Rn},results:function(){return Gn},serialize:function(){return zn},unserialize:function(){return Un}});var m={};r.r(m),r.d(m,{changed:function(){return Zn},compute:function(){return Pn},fetchClustersAsWasmArray:function(){return Dn},results:function(){return Fn},serialize:function(){return Bn},unserialize:function(){return In}});var p={};r.r(p),r.d(p,{changed:function(){return Wn},compute:function(){return Jn},fetchClustersAsWasmArray:function(){return Ln},results:function(){return Vn},serialize:function(){return Qn},unserialize:function(){return Xn}});var h={};r.r(h),r.d(h,{changed:function(){return $n},compute:function(){return er},fetchClustersAsWasmArray:function(){return ar},results:function(){return nr},serialize:function(){return rr},unserialize:function(){return tr}});var v={};r.r(v),r.d(v,{animate:function(){return Sr},changed:function(){return pr},compute:function(){return vr},initialize:function(){return mr},results:function(){return yr},serialize:function(){return gr},unserialize:function(){return wr}});var y={};r.r(y),r.d(y,{animate:function(){return Ur},changed:function(){return kr},compute:function(){return Tr},initialize:function(){return Er},results:function(){return Ar},serialize:function(){return Or},unserialize:function(){return zr}});var g={};r.r(g),r.d(g,{changed:function(){return Dr},compute:function(){return Pr},fetchGroupResults:function(){return Kr},results:function(){return Fr},serialize:function(){return Br},unserialize:function(){return Ir}});var b={};r.r(b),r.d(b,{addSelection:function(){return Yr},changed:function(){return Jr},compute:function(){return Vr},fetchResults:function(){return et},removeSelection:function(){return $r},results:function(){return Qr},serialize:function(){return Xr},unserialize:function(){return Hr}});var w=r(5861),S=r(3324),x=r(7757),_=r.n(x),M=r(9451),E=r(1413),k=r(7762),N=r(6737);function T(e){if(void 0!==e&&null!==e)try{e.free()}catch(n){}}function A(e){if("reloaded"in e){for(var n=0,r=Object.entries(e.reloaded);n<r.length;n++){var t=(0,S.Z)(r[n],2),a=(t[0],t[1]);a instanceof N.PQ&&a.free()}delete e.reloaded}}function O(e,n){return JSON.stringify(e)!=JSON.stringify(n)}function G(e){var n=-1/0,r=1/0;return e.forEach((function(e){n<e&&(n=e),r>e&&(r=e)})),[r,n]}function z(e,n,r){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"buffer",a=!0;if(t in r){var s=r[t];s.size!=e||s.constructor.className!=n?s.free():a=!1}if(a)switch(n){case"Uint8Array":r[t]=M.TS(e);break;case"Int32Array":r[t]=M.Wf(e);break;case"Float64Array":r[t]=M.RJ(e);break;default:throw"allocating '"+n+"' not yet supported"}return r[t]}function U(e,n){if(Array.isArray(e)){var r,t=(0,k.Z)(e);try{for(t.s();!(r=t.n()).done;){U(r.value,n)}}catch(i){t.e(i)}finally{t.f()}}else if(e.constructor==Object)for(var a=0,s=Object.entries(e);a<s.length;a++){var o=(0,S.Z)(s[a],2);o[0];U(o[1],n)}else if(ArrayBuffer.isView(e)){if(!(e.buffer instanceof ArrayBuffer))throw"only ArrayBuffers should be in the message payload";n.push(e.buffer)}}function R(e){return"object"===typeof e&&!1===Array.isArray(e)}var C=r(1414),j=r(8308),Z={},D={},P={},F=!1;function B(e){for(var n=[],r=0;r<e;r++)n.push("Gene ".concat(r+1));return{id:n}}function I(){for(var e={},n=ee(),r=0,t=Object.entries(n);r<t.length;r++){var a=(0,S.Z)(t[r],2),s=a[0],o=a[1];e[s]=M.gn(o)}Z.gene_types=e}function K(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"\t",t=n.name.split(".").pop();"gz"==t&&(e=j.ec(e));var a=new TextDecoder,s=a.decode(e),o=C.Z(r),i=o.parseRows(s);return i}function q(e){T(Z.matrix);var n=e.filter((function(e){return"mtx"==e.type}))[0],r=new Uint8Array(n.buffer),t="gz"==n.name.split(".").pop();if(Z.matrix=M.DK(r,{compressed:t}),1==(a=e.filter((function(e){return"genes"==e.type}))).length){var a=a[0],s=K(new Uint8Array(a.buffer),a);if(s.length!=Z.matrix.numberOfRows())throw"number of matrix rows is not equal to the number of genes in '"+a.name+"'";var o=[],i=[];s.forEach((function(e){o.push(e[0]),i.push(e[1])})),Z.genes={id:o,symbol:i}}else Z.genes=B(Z.matrix.numberOfRows());if(M.dc(Z.matrix,Z.genes),1==(u=e.filter((function(e){return"annotations"==e.type}))).length){var u=u[0],c=K(new Uint8Array(u.buffer),u),l=Z.matrix.numberOfColumns()-c.length,f=!1;if(0===l)f=!1;else{if(-1!==l)throw"number of annotations rows is not equal to the number of cells in '"+u.name+"'";f=!0}var d=[];f?d=c.shift():c[0].forEach((function(e,n){d.push("Column_".concat(n+1))})),Z.annotations={},d.forEach((function(e,n){Z.annotations[e]=c.map((function(e){return e[n]}))}))}else Z.annotations=null;"reloaded"in Z&&delete Z.reloaded}function W(e){T(Z.matrix);var n=e[0],r=n.name;M.NC(r,new Uint8Array(n.buffer));try{Z.matrix=M.EF(r,"matrix"),Z.genes=null;var t=M.JM(r);if("features"in t.matrix){var a=t.matrix.features;"id"in a&&"string dataset"===a.id&&(Z.genes={id:M.dO(r,"matrix/features/id").contents},"name"in a&&"string dataset"===a.name&&(Z.genes.names=M.dO(r,"matrix/features/name").contents))}Z.annotations=null}finally{M.Yd(r)}null===Z.genes&&(Z.genes=B(Z.matrix.numberOfRows())),M.dc(Z.matrix,Z.genes),"reloaded"in Z&&delete Z.reloaded}function L(e,n){T(Z.matrix);var r=e[0],t=r.name;M.NC(t,new Uint8Array(r.buffer));try{Z.matrix=M.EF(t,"X");var a=M.JM(t);if(Z.genes=null,"var"in a){var s=a.var;if(R(s)&&"_index"in s&&"string dataset"==s._index){Z.genes={_index:M.dO(t,"var/_index").contents};for(var o=0,i=Object.entries(s);o<i.length;o++){var u=(0,S.Z)(i[o],2),c=u[0];"string dataset"===u[1]&&(c.match(/name/i)||c.match(/symb/i))&&(Z.genes[c]=M.dO(t,"var/".concat(c)).contents)}}}if(Z.annotations=null,"obs"in a){var l=a.obs;if(Z.annotations={},R(l)){"_index"in l&&"string dataset"==l._index&&(Z.annotations._index=M.dO(t,"obs/_index").contents);for(var f=0,d=Object.entries(l);f<d.length;f++){var m=(0,S.Z)(d[f],2),p=m[0],h=m[1];if("string dataset"===h||"integer dataset"===h||"float dataset"===h){var v=M.dO(t,"obs/".concat(p)).contents;if("__categories"in l&&"string dataset"==l.__categories[p]){var y=M.dO(t,"obs/__categories/".concat(p)).contents;Z.annotations[p]={type:"factor",index:y,factor:v}}else Z.annotations[p]=v}}}}}finally{M.Yd(t)}null===Z.genes&&(Z.genes=B(Z.matrix.numberOfRows())),M.dc(Z.matrix,Z.genes),"reloaded"in Z&&delete Z.reloaded}function J(e,n){for(var r=new FileReaderSync,t=0;t<2;t++){var a,s={type:n,files:[]};a=0==t?function(e){return e.size}:function(e){return r.readAsArrayBuffer(e)};var o,i=(0,k.Z)(e.file);try{for(i.s();!(o=i.n()).done;){var u=o.value;s.files.push({type:"h5",name:u.name,buffer:a(u)})}}catch(c){i.e(c)}finally{i.f()}if(0==t){if(!O(P,s))return void(F=!1);P=s,F=!0}else D=s,"10X"==n?W(s.files):L(s.files)}}function V(e){switch(e.format){case"mtx":!function(e){for(var n=new FileReaderSync,r=0;r<2;r++){var t,a={type:"MatrixMarket",files:[]};t=0==r?function(e){return e.size}:function(e){return n.readAsArrayBuffer(e)};var s,o=(0,k.Z)(e.mtx);try{for(o.s();!(s=o.n()).done;){var i=s.value;a.files.push({type:"mtx",name:i.name,buffer:t(i)})}}catch(l){o.e(l)}finally{o.f()}if(null!==e.gene){if(1!==e.gene.length)throw"expected no more than one gene file";var u=e.gene[0];a.files.push({type:"genes",name:u.name,buffer:t(u)})}if(null!==e.barcode){if(1!==e.barcode.length)throw"expected no more than one cell annotation file";var c=e.barcode[0];a.files.push({type:"annotations",name:c.name,buffer:t(c)})}if(0==r){if(!O(P,a))return void(F=!1);P=a,F=!0}else D=a,q(a.files)}}(e.files);break;case"hdf5":case"tenx":J(e.files,"10X");break;case"h5ad":J(e.files,"H5AD");break;case"kana":break;default:throw"unknown matrix file extension: '"+e.format+"'"}I()}function Q(){var e={dimensions:$()};return"reloaded"in Z?(e.genes=(0,E.Z)({},Z.reloaded.genes),Z.annotations&&(e.annotations=Object.keys(Z.reloaded.annotations))):(e.genes=(0,E.Z)({},Z.genes),Z.annotations&&(e.annotations=Object.keys(Z.annotations))),e}function X(){var e={};"reloaded"in Z?(e.genes=(0,E.Z)({},Z.reloaded.genes),e.num_cells=Z.reloaded.num_cells,Z.reloaded.annotations&&(e.annotations=Z.reloaded.annotations)):(e.genes=(0,E.Z)({},Z.genes),e.num_cells=Z.matrix.numberOfColumns(),Z.annotations&&(e.annotations=Z.annotations));var n=(0,E.Z)({},D);return n.files=D.files.map((function(e){return(0,E.Z)({},e)})),{parameters:n,contents:e}}function H(e){D=e.parameters,Z.reloaded=e.contents,I()}function Y(){if("reloaded"in Z)if("MatrixMarket"==D.type)q(D.files);else if("H5AD"==D.type)L(D.files);else if("10X"==D.type)W(D.files);else{if("HDF5"!=D.type)throw"unrecognized count matrix format, ".concat(D.type);D.files[0].name.match(/h5ad$/i)?L(D.files):W(D.files)}return Z.matrix}function $(){return"reloaded"in Z?{num_genes:Object.values(Z.reloaded.genes)[0].length,num_cells:Z.reloaded.num_cells}:{num_genes:Z.matrix.numberOfRows(),num_cells:Z.matrix.numberOfColumns()}}function ee(){return"reloaded"in Z?Z.reloaded.genes:Z.genes}function ne(e){var n,r;if("reloaded"in Z?(n=Z.reloaded.annotations,r=Z.reloaded.matrix.numberOfColumns()):(n=Z.annotations,r=Z.matrix.numberOfColumns()),!(e in n))throw"column ".concat(e," does not exist in col.tsv");if(R(n[e])&&"type"in n[e])return n[e];var t={},a=new Uint8Array(r);return n[e].map((function(e,n){e in t||(t[e]=Object.keys(t).length),a[n]=t[e]})),{index:Object.keys(t),factor:a}}var re={};re.ensembl=new Set(["ENSMUSG00000064336","ENSMUSG00000064337","ENSMUSG00000064338","ENSMUSG00000064339","ENSMUSG00000064340","ENSMUSG00000064341","ENSMUSG00000064342","ENSMUSG00000064343","ENSMUSG00000064344","ENSMUSG00000064345","ENSMUSG00000064346","ENSMUSG00000064347","ENSMUSG00000064348","ENSMUSG00000064349","ENSMUSG00000064350","ENSMUSG00000064351","ENSMUSG00000064352","ENSMUSG00000064353","ENSMUSG00000064354","ENSMUSG00000064355","ENSMUSG00000064356","ENSMUSG00000064357","ENSMUSG00000064358","ENSMUSG00000064359","ENSMUSG00000064360","ENSMUSG00000064361","ENSMUSG00000064363","ENSMUSG00000064364","ENSMUSG00000064365","ENSMUSG00000064366","ENSMUSG00000064367","ENSMUSG00000064368","ENSMUSG00000064369","ENSMUSG00000064370","ENSMUSG00000064371","ENSMUSG00000064372","ENSMUSG00000065947","ENSG00000198695","ENSG00000198712","ENSG00000198727","ENSG00000198763","ENSG00000198786","ENSG00000198804","ENSG00000198840","ENSG00000198886","ENSG00000198888","ENSG00000198899","ENSG00000198938","ENSG00000209082","ENSG00000210049","ENSG00000210077","ENSG00000210082","ENSG00000210100","ENSG00000210107","ENSG00000210112","ENSG00000210117","ENSG00000210127","ENSG00000210135","ENSG00000210140","ENSG00000210144","ENSG00000210151","ENSG00000210154","ENSG00000210156","ENSG00000210164","ENSG00000210174","ENSG00000210176","ENSG00000210184","ENSG00000210191","ENSG00000210194","ENSG00000210195","ENSG00000210196","ENSG00000211459","ENSG00000212907","ENSG00000228253"]),re.symbol=new Set(["mt-Tf","mt-Rnr1","mt-Tv","mt-Rnr2","mt-Tl1","mt-Nd1","mt-Ti","mt-Tq","mt-Tm","mt-Nd2","mt-Tw","mt-Ta","mt-Tn","mt-Tc","mt-Ty","mt-Co1","mt-Ts1","mt-Td","mt-Co2","mt-Tk","mt-Atp8","mt-Atp6","mt-Co3","mt-Tg","mt-Nd3","mt-Tr","mt-Nd4","mt-Th","mt-Ts2","mt-Tl2","mt-Nd5","mt-Nd6","mt-Te","mt-Cytb","mt-Tt","mt-Tp","mt-Nd4l","MT-ND6","MT-CO2","MT-CYB","MT-ND2","MT-ND5","MT-CO1","MT-ND3","MT-ND4","MT-ND1","MT-ATP6","MT-CO3","MT-TL1","MT-TF","MT-TV","MT-RNR2","MT-TI","MT-TQ","MT-TM","MT-TW","MT-TA","MT-TN","MT-TC","MT-TY","MT-TS1","MT-TD","MT-TK","MT-TG","MT-TR","MT-TH","MT-TS2","MT-TL2","MT-TE","MT-TT","MT-TP","MT-RNR1","MT-ND4L","MT-ATP8"]);var te={},ae={},se=!1;function oe(e){T(te.raw);var n=z(1*(c=Y()).numberOfRows(),"Uint8Array",te);n.fill(0);for(var r=ee(),t=n.array(),a=0,s=Object.entries(r);a<s.length;a++){var o=(0,S.Z)(s[a],2),i=(o[0],o[1]);if(e.use_mito_default)i.forEach((function(e,n){(re.symbol.has(e)||re.ensembl.has(e))&&(t[n]=1)}));else{var u=e.mito_prefix.toLowerCase();i.forEach((function(e,n){e.toLowerCase().startsWith(u)&&(t[n]=1)}))}}var c=Y();te.raw=M.i4(c,n),delete te.reloaded}function ie(){var e={};if("reloaded"in te){var n=te.reloaded;e.sums=n.sums.slice(),e.detected=n.detected.slice(),e.proportion=n.proportion.slice()}else{n=te.raw;e.sums=n.sums(),e.detected=n.detected(),e.proportion=n.subsetProportions(0)}return e}function ue(e){F||O(ae,e)?(oe(e),ae=e,se=!0):se=!1}function ce(){var e=ie(),n={};return n.sums=G(e.sums),n.detected=G(e.detected),n.proportion=G(e.proportion),{data:e,ranges:n}}function le(){return{parameters:ae,contents:ie()}}function fe(e){ae=e.parameters,te.reloaded=e.contents}function de(){return"reloaded"in te&&oe(),te.raw}function me(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.unsafe,r=void 0===n||n;return"reloaded"in te?te.reloaded.sums:te.raw.sums({copy:!r})}var pe={},he={},ve=!1;function ye(e){if(se||O(he,e)){T(pe.raw);var n=de();pe.raw=M.rU(n,{numberOfMADs:e.nmads}),A(pe),ve=!0,he=e}else ve=!1}function ge(){var e;if("reloaded"in pe)e={sums:pe.reloaded.sums,detected:pe.reloaded.detected,proportion:pe.reloaded.proportion};else{var n=pe.raw;e={sums:n.thresholdsSums()[0],detected:n.thresholdsDetected()[0],proportion:n.thresholdsSubsetProportions(0)[0]}}return e}function be(){var e=ge();return e.discards=xe(),{parameters:he,contents:e}}function we(e){he=e.parameters,A(pe),pe.reloaded=e.contents;var n=M.TS(pe.reloaded.discards.length);n.set(pe.reloaded.discards),pe.reloaded.discards=n}function Se(){return"reloaded"in pe?pe.reloaded.discards:pe.raw.discardOverall({copy:"view"})}function xe(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.unsafe,t=void 0!==r&&r;return e="reloaded"in pe?pe.reloaded.discards.array():pe.raw.discardOverall(),t?e:e.slice()}var _e={},Me={},Ee=!1;function ke(){T(_e.matrix);var e=Y(),n=Se();_e.matrix=M.b_(e,n),delete _e.reloaded}function Ne(e){F||ve||O(Me,e)?(ke(),Me=e,Ee=!0):Ee=!1}function Te(){return{retained:ze()}}function Ae(){return{parameters:Me,contents:Te()}}function Oe(e){Me=e.parameters,_e.reloaded=e.contents;var n,r=xe({unsafe:!0}),t=0,a=(0,k.Z)(r);try{for(a.s();!(n=a.n()).done;){0==n.value&&t++}}catch(s){a.e(s)}finally{a.f()}_e.reloaded.retained=t}function Ge(){return"reloaded"in _e&&ke(),_e.matrix}function ze(){return"reloaded"in _e?_e.reloaded.retained:_e.matrix.numberOfColumns()}var Ue={},Re={},Ce=!1;function je(){for(var e=Ge(),n=z(e.numberOfColumns(),"Float64Array",Ue),r=me({unsafe:!0}),t=xe({unsafe:!0}),a=n.array(),s=0,o=0;o<t.length;++o)t[o]||(a[s]=r[o],s++);if(s!=e.numberOfColumns())throw"normalization and filtering are not in sync";T(Ue.matrix),Ue.matrix=M.gk(e,{sizeFactors:n}),delete Ue.reloaded}function Ze(e){se||Ee||O(Re,e)?(je(),Re=e,Ce=!0):Ce=!1}function De(){return{}}function Pe(){return{parameters:Re,contents:{}}}function Fe(e){Re=e.parameters,Ue.reloaded=e.contents}function Be(){return"reloaded"in Ue&&je(),Ue.matrix}function Ie(e){var n=Be(),r=z(n.numberOfColumns(),"Float64Array",Ue);return n.row(e,{buffer:r}),r.slice()}var Ke={},qe={},We=!1;function Le(e){if(Ce||O(qe,e)){var n=Be();Ke.raw=M.rY(n,{span:e.span}),Ke.sorted_residuals=Ke.raw.residuals().slice(),Ke.sorted_residuals.sort(),qe=e,delete Ke.reloaded,We=!0}else We=!1}function Je(){return"reloaded"in Ke?{means:Ke.reloaded.means.slice(),vars:Ke.reloaded.vars.slice(),fitted:Ke.reloaded.fitted.slice(),resids:Ke.reloaded.resids.slice()}:function(){var e=Ke.raw;return{means:e.means(),vars:e.variances(),fitted:e.fitted(),resids:e.residuals()}}()}function Ve(){return{parameters:qe,contents:Je()}}function Qe(e){qe=e.parameters,Ke.reloaded=e.contents,Ke.sorted_residuals=Ke.reloaded.resids.slice(),Ke.sorted_residuals.sort()}function Xe(){return Ke.sorted_residuals}function He(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.unsafe,r=void 0!==n&&n;return"reloaded"in Ke?Ke.reloaded.resids:Ke.raw.residuals({copy:!r})}var Ye={},$e={},en=!1;function nn(){return"reloaded"in Ye?Ye.reloaded.pcs:Ye.raw.principalComponents({copy:"view"})}function rn(e){if(Ce||We||O($e,e)){var n=Xe(),r=n[n.length-e.num_hvgs],t=Be(),a=z(t.numberOfRows(),"Uint8Array",Ye),s=He({unsafe:!0});a.array().forEach((function(e,n,t){t[n]=s[n]>=r})),T(Ye.raw),Ye.raw=M.a9(t,{features:a,numberOfPCs:e.num_pcs}),A(Ye),en=!0,$e=e}else en=!1}function tn(){var e;if("reloaded"in Ye)e=Ye.reloaded.var_exp.slice();else{var n=Ye.raw;e=n.varianceExplained();var r=n.totalVariance();e.forEach((function(n,t){e[t]=n/r}))}return{var_exp:e}}function an(){var e=tn();return e.pcs=nn().slice(),{parameters:$e,contents:e}}function sn(e){$e=e.parameters,A(Ye),Ye.reloaded=e.contents;var n=M.RJ(Ye.reloaded.pcs.length);n.set(Ye.reloaded.pcs),Ye.reloaded.pcs=n}function on(){var e=nn();return{pcs:e,num_pcs:$e.num_pcs,num_obs:e.length/$e.num_pcs}}var un={},cn={},ln=!1;function fn(e){T(un.raw);var n=on();un.raw=M.Fu(n.pcs,{numberOfDims:n.num_pcs,numberOfCells:n.num_obs}),delete un.reloaded}function dn(e){en||O(cn,e)?(fn(),cn=e,ln=!0):ln=!1}function mn(){return{}}function pn(){return{parameters:cn,contents:{}}}function hn(e){cn=e.parameters,un.reloaded=e.contents}function vn(){return"reloaded"in un&&fn(),un.raw}var yn={},gn={},bn=!1;function wn(e){T(yn.raw);var n=vn();yn.raw=M.wf(n,e.k),delete yn.reloaded}function Sn(e){var n=e.cluster_method;delete e.cluster_method,null===bn||ln||O(gn,e)?n.startsWith("snn_")?(wn(e),gn=e,bn=!0):(bn=null,T(yn.raw),delete yn.reloaded,gn=e):bn=!1}function xn(){return{}}function _n(){var e={parameters:gn};return e.contents=null===bn?null:{},e}function Mn(e){gn=e.parameters,null!==e.contents?yn.reloaded=e.contents:bn=null}function En(){return"reloaded"in yn&&wn(gn),yn.raw}var kn={},Nn={},Tn=!1;function An(e){T(kn.raw);var n=En();kn.raw=M.bD(n,{scheme:e.scheme}),delete kn.reloaded}function On(e){null===bn?(Tn=null,T(kn.raw),delete kn.reloaded,Nn=e):null===Tn||bn||O(Nn,e)?(An(e),Nn=e,Tn=!0):Tn=!1}function Gn(){return{}}function zn(){var e={parameters:Nn};return e.contents=null===Tn?null:{},e}function Un(e){Nn=e.parameters,void 0!==e?kn.reloaded=e.contents:Tn=null}function Rn(){return"reloaded"in kn&&An(Nn),kn.raw}var Cn={},jn={},Zn=!1;function Dn(){return"reloaded"in Cn?Cn.reloaded.clusters:Cn.raw.membership({copy:"view"})}function Pn(e){if(null===Tn)Zn=null,T(Cn.raw),A(Cn),jn=e;else if(null===Zn||Tn||O(jn,e)){T(Cn.raw);var n=Rn();Cn.raw=M.ZI(n,{resolution:e.resolution}),jn=e,Zn=!0,A(Cn)}else Zn=!1}function Fn(){return{}}function Bn(){var e={parameters:jn};return e.contents=null===Zn?null:{clusters:Dn().slice()},e}function In(e){if(jn=e.parameters,null!==e.contents){A(Cn),Cn.reloaded=e.contents;var n=M.Wf(Cn.reloaded.clusters.length);n.set(Cn.reloaded.clusters),Cn.reloaded.clusters=n}else Zn=null}var Kn={},qn={},Wn=!1;function Ln(){return"reloaded"in Kn?Kn.reloaded.clusters:Kn.raw.clusters({copy:"view"})}function Jn(e){var n=e.cluster_method;if(delete e.cluster_method,null===Wn||en||O(qn,e))if("kmeans"!==n)Wn=null,T(Kn.raw),A(Kn),qn=e;else{T(Kn.raw);var r=on();Kn.raw=M.eu(r.pcs,e.k,{numberOfDims:r.num_pcs,numberOfCells:r.num_obs,initMethod:"pca-part"}),qn=e,Wn=!0,A(Kn)}else Wn=!1}function Vn(){return{}}function Qn(){var e={parameters:qn};return e.contents=null===Wn?null:{clusters:Ln().slice()},e}function Xn(e){if(qn=e.parameters,null!==e.contents){A(Kn),Kn.reloaded=e.contents;var n=M.Wf(Kn.reloaded.clusters.length);n.set(Kn.reloaded.clusters),Kn.reloaded.clusters=n}else Wn=null}var Hn={},Yn={},$n=!1;function er(e){$n=!0,O(Yn,e)||("snn_graph"==e.method?Zn||($n=!1):"kmeans"==e.method&&(Wn||($n=!1))),$n&&(delete Hn.reloaded,Yn=e,$n=!0)}function nr(){return{clusters:ar().slice()}}function rr(){return{parameters:Yn,contents:{}}}function tr(e){Yn=e.parameters,Hn.reloaded=e.contents}function ar(){return"snn_graph"==Yn.method?Dn():"kmeans"==Yn.method?Ln():void 0}function sr(e){var n=vn(),r={num_obs:n.numberOfCells()},t=null,a=null,s=null,o=null;try{t=M.wf(n,e),a=M.Wf(t.numberOfCells()),s=M.Wf(t.size()),o=M.RJ(t.size()),t.serialize({runs:a,indices:s,distances:o}),r.size=t.size(),r.runs=a.array().slice(),r.indices=s.array().slice(),r.distances=o.array().slice()}finally{null!==t&&t.free(),null!==a&&a.free(),null!==s&&s.free(),null!==o&&o.free()}return r}function or(e,n,r){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=r.counter,s=new Promise((function(e,n){r.promises[a]={resolve:e,reject:n}}));return r.counter++,n.id=a,e.postMessage(n,t),s}function ir(e,n){return e.onmessage=function(e){var r=e.data.type;if(r.endsWith("_iter"))postMessage({type:r,resp:{x:e.data.x,y:e.data.y,iteration:e.data.iteration}},[e.data.x.buffer,e.data.y.buffer]);else{var t=e.data.id,a=n.promises[t];"error"==r?a.reject(e.data.error):a.resolve(e.data.data),delete n.promises[t]}},or(e,{cmd:"INIT"},n)}function ur(e,n,r,t){var a={cmd:"RUN",params:n},s=[];return null!==r&&(a.neighbors=r,U(r,s)),or(e,a,t,s)}function cr(e,n){if("reloaded"in n){var r=(0,E.Z)({},n.reloaded);return r.x=r.x.slice(),r.y=r.y.slice(),new Promise((function(e){return e(r)}))}return n.run.then((function(r){return or(e,{cmd:"FETCH"},n)}))}var lr={counter:0,promises:{}},fr={},dr=null;function mr(){return ir(dr=new Worker(new URL(r.p+r.u(139),r.b),{type:void 0}),lr)}var pr=!1;function hr(e,n){var r=null;n&&(r=sr(M.Tk(e.perplexity)));lr.run=ur(dr,e,r,lr)}function vr(e){ln||O(fr,e)?(hr(e,ln||O(fr.perplexity,e.perplexity)),fr=e,delete lr.reloaded,pr=!0):pr=!1}function yr(){return cr(dr,lr)}function gr(){return br.apply(this,arguments)}function br(){return(br=(0,w.Z)(_().mark((function e(){var n;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,cr(dr,lr);case 2:return n=e.sent,e.abrupt("return",{parameters:fr,contents:n});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wr(e){fr=e.parameters,lr.reloaded=e.contents}function Sr(){if("reloaded"in lr){var e=(0,E.Z)({},fr);return e.animate=!0,hr(e,!0),delete lr.reloaded,lr.run.then((function(e){return{type:"tsne_rerun",data:{status:"SUCCESS"}}}))}return or(dr,{cmd:"RERUN"},lr)}var xr={counter:0,promises:{}},_r={},Mr=null;function Er(){Mr=new Worker(new URL(r.p+r.u(653),r.b),{type:void 0}),xr.initialized=ir(Mr,xr)}var kr=!1;function Nr(e,n){var r=null;n&&(r=sr(e.num_neighbors)),xr.run=ur(Mr,e,r,xr)}function Tr(e){ln||O(_r,e)?(Nr(e,ln||O(_r.num_neighbors,e.num_neighbors)),_r=e,delete xr.reloaded,kr=!0):kr=!1}function Ar(){return cr(Mr,xr)}function Or(){return Gr.apply(this,arguments)}function Gr(){return(Gr=(0,w.Z)(_().mark((function e(){var n;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,cr(Mr,xr);case 2:return n=e.sent,e.abrupt("return",{parameters:_r,contents:n});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zr(e){_r=e.parameters,xr.reloaded=e.contents}function Ur(){if("reloaded"in xr){var e=(0,E.Z)({},_r);return e.animate=!0,Nr(e,!0),delete xr.reloaded,xr.run.then((function(e){return{type:"umap_rerun",data:{status:"SUCCESS"}}}))}return or(Mr,{cmd:"RERUN"},xr)}function Rr(e,n){return{means:e.means(n),detected:e.detected(n),lfc:{min:e.lfc(n,{summary:0}),mean:e.lfc(n,{summary:1}),"min-rank":e.lfc(n,{summary:4})},delta_detected:{min:e.deltaDetected(n,{summary:0}),mean:e.deltaDetected(n,{summary:1}),"min-rank":e.deltaDetected(n,{summary:4})},cohen:{min:e.cohen(n,{summary:0}),mean:e.cohen(n,{summary:1}),"min-rank":e.cohen(n,{summary:4})},auc:{min:e.auc(n,{summary:0}),mean:e.auc(n,{summary:1}),"min-rank":e.auc(n,{summary:4})}}}function Cr(e,n,r,t){r&&void 0!==r||(r="cohen-min-rank");var a,s,o=void 0!==n,i=!1;if(o){var u,c="mean";if(r.match(/-min$/)?c="min":r.match(/-min-rank$/)&&(i=!0,c="min-rank"),r.match(/^cohen-/))u="cohen";else if(r.match(/^auc-/))u="auc";else if(r.match(/^lfc-/))u="lfc";else{if(!r.match(/^delta-d-/))throw"unknown rank type '"+r+"'";u="delta_detected"}s=n[t][u][c]}else{var l=1;if(r.match(/-min$/)?l=0:r.match(/-min-rank$/)&&(i=!0,l=4),r.match(/^cohen-/))s=e.cohen(t,{summary:l,copy:!1});else if(r.match(/^auc-/))s=e.auc(t,{summary:l,copy:!1});else if(r.match(/^lfc-/))s=e.lfc(t,{summary:l,copy:!1});else{if(!r.match(/^delta-d-/))throw"unknown rank type '"+r+"'";s=e.deltaDetected(t,{summary:l,copy:!1})}}a=new Int32Array(s.length);for(var f=0;f<a.length;f++)a[f]=f;i?a.sort((function(e,n){return s[e]-s[n]})):a.sort((function(e,n){return s[n]-s[e]}));var d,m,p,h,v=function(e){for(var n=new Float64Array(e.length),r=0;r<a.length;r++)n[r]=e[a[r]];return n};if(o){var y=n[t];m=v(y.means),d=v(y.detected),p=v(y.lfc.mean),h=v(y.delta_detected.mean)}else d=v(e.detected(t,{copy:!1})),m=v(e.means(t,{copy:!1})),p=v(e.lfc(t,{summary:1,copy:!1})),h=v(e.deltaDetected(t,{summary:1,copy:!1}));return{ordering:a,means:m,detected:d,lfc:p,delta_detected:h}}var jr={},Zr={},Dr=!1;function Pr(e){if(Ce||$n||O(Zr,e)){T(jr.raw);var n=Be(),r=ar();jr.raw=M.y5(n,r),Zr=e,delete jr.reloaded,Dr=!0}else Dr=!1}function Fr(){return{}}function Br(){if("reloaded"in jr)e=jr.reloaded;else for(var e=[],n=jr.raw.numberOfGroups(),r=0;r<n;r++)e.push(Rr(jr.raw,r));return{parameters:Zr,contents:e}}function Ir(e){Zr=e.parameters,jr.reloaded=e.contents}function Kr(e,n){return Cr(jr.raw,jr.reloaded,e,n)}var qr,Wr={results:{}},Lr={selections:{}},Jr=!1;function Vr(e){if(Ee){Lr.selections={};for(var n=0,r=Object.entries(Wr.results);n<r.length;n++){var t=(0,S.Z)(r[n],2);t[0];T(t[1].raw)}Wr.results={}}Jr=!0}function Qr(){return{}}function Xr(){for(var e={},n=0,r=Object.entries(Wr.results);n<r.length;n++){var t=(0,S.Z)(r[n],2),a=t[0],s=t[1];e[a]="reloaded"in s?s.reloaded:Rr(s.raw,1)}return{parameters:Lr,contents:{results:e}}}function Hr(e){Lr=e.parameters;for(var n=0,r=Object.entries(e.contents);n<r.length;n++){var t=(0,S.Z)(r[n],2),a=t[0],s=t[1];Wr.results[a]={reloaded:s}}}function Yr(e,n){var r=Be(),t=z(r.numberOfColumns(),"Int32Array",Wr);t.fill(0);var a=t.array();n.forEach((function(e){a[e]=1}));var s=M.y5(r,t);e in Wr.results&&(T(Wr.results[e].raw),delete Wr.results[e]),Wr.results[e]={raw:s},Lr.selections[e]=n}function $r(e){T(Wr.results[e].raw),delete Wr.results[e],delete Lr.selections[e]}function et(e,n){var r=Wr.results[e];return Cr(r.raw,r.reloaded,n,1)}var nt=null;function rt(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===n&&(n=qr.result.transaction(["analysis_meta"],"readonly").objectStore("analysis_meta"));var r=n.getAll();r.onsuccess=function(){var n=r.result;n.forEach((function(e){delete e.files})),e(n)},r.onerror=function(){e(null)}}function tt(e,n){return at.apply(this,arguments)}function at(){return(at=(0,w.Z)(_().mark((function e(n,r){return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var t=r.get(n);t.onsuccess=function(){void 0!==t.result?e(t.result):e(null)},t.onerror=function(){e(null)}})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function st(e){return Promise.allSettled(e).then((function(e){var n,r=(0,k.Z)(e);try{for(r.s();!(n=r.n()).done;){if(!n.value)return!1}}catch(t){r.e(t)}finally{r.f()}return!0}))}function ot(){return it.apply(this,arguments)}function it(){return(it=(0,w.Z)(_().mark((function e(){return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt;case 2:return e.abrupt("return",new Promise((function(e){rt(e)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ut(e,n){return ct.apply(this,arguments)}function ct(){return(ct=(0,w.Z)(_().mark((function e(n,r){var t,a,s,o,i,u,c;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt;case 2:return t=qr.result.transaction(["file","file_meta"],"readwrite"),a=t.objectStore("file"),s=t.objectStore("file_meta"),e.next=7,tt(n,s);case 7:return o=e.sent,i=null===o?0:o.count,i++,u=new Promise((function(e){var t=a.put({id:n,payload:r});t.onsuccess=function(n){e(!0)},t.onerror=function(n){e(!1)}})),c=new Promise((function(e){o.count=i;var n=s.put(o);n.onsuccess=function(n){e(!0)},n.onerror=function(n){e(!1)}})),e.abrupt("return",st([u,c]));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lt(e,n,r,t){return ft.apply(this,arguments)}function ft(){return(ft=(0,w.Z)(_().mark((function e(n,r,t,a){var s,o,i,u,c,l;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt;case 2:if(s=qr.result.transaction(["analysis","analysis_meta"],"readwrite"),o=s.objectStore("analysis"),i=s.objectStore("analysis_meta"),null!=n){e.next=10;break}return e.next=8,new Promise((function(e){return rt(e,i)}));case 8:u=e.sent,n=String(u.length);case 10:return c=new Promise((function(e){var t=o.put({id:n,payload:r});t.onsuccess=function(n){e(!0)},t.onerror=function(n){e(!1)}})),l=new Promise((function(e){var r=i.put({id:n,files:t,time:Number(new Date),title:a});r.onsuccess=function(n){e(!0)},r.onerror=function(n){e(!1)}})),e.next=14,st([c,l]);case 14:if(!e.sent){e.next=18;break}return e.abrupt("return",n);case 18:return e.abrupt("return",null);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dt(e){return mt.apply(this,arguments)}function mt(){return(mt=(0,w.Z)(_().mark((function e(n){var r,t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt;case 2:return r=qr.result.transaction(["file"],"readonly").objectStore("file"),e.next=5,tt(n,r);case 5:return t=e.sent,e.abrupt("return",t.payload);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pt(){return(pt=(0,w.Z)(_().mark((function e(n){var r,t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt;case 2:return r=qr.result.transaction(["analysis"],"readonly").objectStore("analysis"),e.next=5,tt(n,r);case 5:return t=e.sent,e.abrupt("return",t.payload);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ht(e){return vt.apply(this,arguments)}function vt(){return(vt=(0,w.Z)(_().mark((function e(n){var r,t,a,s,o,i;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt;case 2:return r=qr.result.transaction(["file","file_meta"],"readwrite"),t=r.objectStore("file"),a=r.objectStore("file_meta"),e.next=7,tt(n,a);case 7:return s=e.sent,o=s.count,o--,i=[],0==o?(i.push(new Promise((function(e){var r=t.remove(n);r.onerror=function(n){e(!1)},r.onsuccess=function(n){e(!0)}}))),i.push(new Promise((function(e){var r=a.delete(n);r.onerror=function(n){e(!1)},r.onsuccess=function(n){e(!0)}})))):i.push(new Promise((function(e){s.count=o;var n=a.put(s);n.onsuccess=function(n){e(!0)},n.onerror=function(n){e(!1)}}))),e.abrupt("return",st(i));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function yt(){return(yt=(0,w.Z)(_().mark((function e(n){var r,t,a,s,o,i,u,c;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt;case 2:return r=qr.result.transaction(["analysis","analysis_meta"],"readwrite"),t=r.objectStore("analysis"),a=r.objectStore("analysis_meta"),(s=[]).push(new Promise((function(e){var r=t.delete(n);r.onsuccess=function(n){e(!0)},r.onerror=function(n){e(!1)}}))),e.next=9,tt(n,a);case 9:o=e.sent,i=(0,k.Z)(o.files);try{for(i.s();!(u=i.n()).done;)c=u.value,s.push(ht(c))}catch(l){i.e(l)}finally{i.f()}return s.push(new Promise((function(e){var r=a.delete(n);r.onsuccess=function(n){e(!0)},r.onerror=function(n){e(!1)}}))),e.abrupt("return",st(s));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var gt,bt=r(8109);function wt(e){if(Array.isArray(e))for(var n=0;n<e.length;n++)e[n]=wt(e[n]);else if(ArrayBuffer.isView(e))e={_TypedArray_class:e.constructor.name,_TypedArray_values:Array.from(e)};else if(e instanceof Object)for(var r=0,t=Object.entries(e);r<t.length;r++){var a=(0,S.Z)(t[r],2),s=a[0],o=a[1];e[s]=wt(o)}return e}function St(e){if(Array.isArray(e))for(var n=0;n<e.length;n++)e[n]=St(e[n]);else if(e instanceof Object)if("_TypedArray_class"in e){var r=e[["_TypedArray_class"]],t=e[["_TypedArray_values"]];switch(r){case"Uint8Array":case"Uint8Array":e=new Uint8Array(t.length);break;case"Int8Array":e=new Int8Array(t.length);break;case"Uint16Array":e=new Uint16Array(t.length);break;case"Int16Array":e=new Int16Array(t.length);break;case"Uint32Array":e=new Uint32Array(t.length);break;case"Int32Array":e=new Int32Array(t.length);break;case"Uint64Array":e=new Uint64Array(t.length);break;case"Int64Array":e=new Int64Array(t.length);break;case"Float32Array":e=new Float32Array(t.length);break;case"Float64Array":e=new Float64Array(t.length);break;default:throw"unrecognized TypedArray class '"+r}e.set(t)}else for(var a=0,s=Object.entries(e);a<s.length;a++){var o=(0,S.Z)(s[a],2),i=o[0],u=o[1];e[i]=St(u)}return e}function xt(e){for(var n=new Uint8Array(8),r=0;e>0;)n[r]=e%256,e=Math.floor(e/256),r++;return n}function _t(e){var n,r=0,t=1,a=(0,k.Z)(e);try{for(a.s();!(n=a.n()).done;){r+=t*n.value,t*=256}}catch(s){a.e(s)}finally{a.f()}return r}function Mt(e){return Et.apply(this,arguments)}function Et(){return Et=(0,w.Z)(_().mark((function e(n){var r,t,a,s,o,i,u,c,l,f,d,m,p,h,v,y,g,b,w,S,x,M,E=arguments;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=E.length>1&&void 0!==E[1]?E[1]:"full",t=n.inputs.parameters.files,a=[],s=0,"full"!=r){e.next=9;break}o=0,t.forEach((function(e,n){var r=e.buffer;a.push(r),t[n].buffer={offset:s,size:r.byteLength},s+=r.byteLength})),e.next=40;break;case 9:if("KanaDB"!=r){e.next=39;break}o=1,i=(0,k.Z)(t),e.prev=12,i.s();case 14:if((u=i.n()).done){e.next=29;break}return c=u.value,e.next=18,bt.FB(new Uint8Array(c.buffer));case 18:return l=e.sent,f=c.type+"_"+c.name+"_"+c.buffer.byteLength+"_"+l,e.next=22,ut(f,c.buffer);case 22:if(e.sent){e.next=25;break}throw"failed to save file '"+f+"' to KanaDB";case 25:c.buffer=f,a.push(f);case 27:e.next=14;break;case 29:e.next=34;break;case 31:e.prev=31,e.t0=e.catch(12),i.e(e.t0);case 34:return e.prev=34,i.f(),e.finish(34);case 37:e.next=40;break;case 39:throw"unsupported mode "+r;case 40:if(n=wt(n),d=JSON.stringify(n),m=j.iv(d),p=new ArrayBuffer(24+m.length+s),h=new Uint8Array(p),v=0,y=xt(o),h.set(y,v),v+=y.length,g=xt(0),h.set(g,v),v+=g.length,b=xt(m.length),h.set(b,v),24==(v+=b.length)){e.next=57;break}throw"oops - accounting error in the serialization code!";case 57:if(h.set(m,v),v+=m.length,"full"!=r){e.next=65;break}w=(0,k.Z)(a);try{for(w.s();!(S=w.n()).done;)x=S.value,M=new Uint8Array(x),h.set(M,v),v+=M.length}catch(_){w.e(_)}finally{w.f()}return e.abrupt("return",p);case 65:if("KanaDB"!=r){e.next=69;break}return e.abrupt("return",{file_ids:a,state:p});case 69:throw"unsupported mode "+r;case 70:case"end":return e.stop()}}),e,null,[[12,31,34,37]])}))),Et.apply(this,arguments)}function kt(e){return Nt.apply(this,arguments)}function Nt(){return(Nt=(0,w.Z)(_().mark((function e(n){var r,t,a,s,o,i,u;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=0,t=_t(new Uint8Array(n,r,8)),r+=8,_t(new Uint8Array(n,r,8)),r+=8,a=_t(new Uint8Array(n,r,8)),r+=8,s=j.ec(new Uint8Array(n,r,a),{to:"string"}),s=St(s=JSON.parse(s)),r+=a,o=s.inputs.parameters.files,0!=t){e.next=16;break}o.forEach((function(e,t){var a=e.buffer,s=new Uint8Array(n,r+a.offset,a.size),i=new ArrayBuffer(a.size);new Uint8Array(i).set(s),o[t].buffer=i})),e.next=26;break;case 16:if(1!=t){e.next=25;break}return i=[],o.forEach((function(e,n){var r=e.buffer;i.push(dt(r))})),e.next=21,Promise.all(i);case 21:u=e.sent,o.forEach((function(e,n){if(null===u[n])throw"KanaDB loading failed for file ID '"+e.buffer+"'";e.buffer=u[n]})),e.next=26;break;case 25:throw"unsupported format type";case 26:return e.abrupt("return",s);case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Tt(e,n,r){var t=[];U(e,t),postMessage({type:"".concat(n,"_DATA"),resp:e,msg:"Success: "+r},t)}function At(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"run",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("serialize"===n)e={};else{if(null==r)throw"'state' must be supplied if 'mode' is not 'serialize'";"unserialize"===n&&(console.log(r),e={params:{}})}var w=function(e,r,t){(e.changed||"unserialize"==n)&&Tt(e.results(),r,t)},x=function(e,r,t){(e.changed||"unserialize"==n)&&e.results().then((function(e){Tt(e,r,t)}))},_=function(n,r){var t=r.serialize();null!==t&&(e[n]=t)},M=function(n,r,t){var a=e.params;if(n in a)for(var s=0,o=Object.entries(r);s<o.length;s++){var i=(0,S.Z)(o[s],2),u=i[0],c=i[1];a[n][u]=c}else a[n]=r},E="inputs";"serialize"===n?_(E,t):("run"==n?V({format:r.files.format,files:r.files.files}):(H(r[E]),e.files={format:"kana",files:[]}),w(t,E,"Count matrix loaded"));var k="quality_control_metrics";"serialize"===n?_(k,a):("run"==n?ue({use_mito_default:r.params.qc["qc-usemitodefault"],mito_prefix:r.params.qc["qc-mito"]}):(fe(r[k]),M("qc",{"qc-usemitodefault":r[k].parameters.use_mito_default,"qc-mito":r[k].parameters.mito_prefix})),w(a,k,"QC metrics computed"));var N="quality_control_thresholds";"serialize"===n?_(N,s):("run"==n?ye({nmads:r.params.qc["qc-nmads"]}):(we(r[N]),M("qc",{"qc-nmads":r[N].parameters.nmads})),w(s,N,"QC thresholds computed"));var T="quality_control_filtered";"serialize"==n?_(T,o):("run"==n?Ne({}):Oe(r[T]),w(o,T,"QC filtering completed"));var A="normalization";"serialize"==n?_(A,i):("run"==n?Ze({}):Fe(r[A]),w(i,A,"Log-normalization completed"));var O="feature_selection";"serialize"==n?_(O,u):("run"==n?Le({span:r.params.fSelection["fsel-span"]}):(Qe(r[O]),M("fSelection",{"fsel-span":r[O].parameters.span})),w(u,O,"Variance modelling completed"));var G="pca";"serialize"==n?_(G,c):("run"==n?rn({num_hvgs:r.params.pca["pca-hvg"],num_pcs:r.params.pca["pca-npc"]}):(sn(r[G]),M("pca",{"pca-hvg":r[G].parameters.num_hvgs,"pca-npc":r[G].parameters.num_pcs})),w(c,G,"Principal components analysis completed"));var z,U="neighbor_index";"serialize"==n?_(U,l):("run"==n?dn({approximate:r.params.cluster["clus-approx"]}):(hn(r[U]),M("cluster",{"clus-approx":r[U].parameters.approximate})),w(l,U,"Neighbor search index constructed"));var R,C="tsne";"serialize"==n?z=gr():("run"==n?vr({perplexity:r.params.tsne["tsne-perp"],iterations:r.params.tsne["tsne-iter"],animate:r.params.tsne.animate}):(wr(r[C]),M("tsne",{"tsne-perp":r[C].parameters.perplexity,"tsne-iter":r[C].parameters.iterations,animate:r[C].parameters.animate})),x(v,C,"t-SNE completed"));var j="umap";"serialize"==n?R=Or():("run"==n?Tr({num_epochs:r.params.umap["umap-epochs"],num_neighbors:r.params.umap["umap-nn"],min_dist:r.params.umap["umap-min_dist"],animate:r.params.umap.animate}):(zr(r[j]),M("umap",{"umap-epochs":r[j].parameters.num_epochs,"umap-nn":r[j].parameters.num_neighbors,"umap-min_dist":r[j].parameters.min_dist,animate:r[j].parameters.animate})),x(y,j,"UMAP completed"));var Z="kmeans_cluster";"serialize"==n?_(Z,p):("run"==n?Jn({k:r.params.cluster["kmeans-k"],cluster_method:r.params.cluster["clus-method"]}):Z in r&&(Xn(r[Z]),M("cluster",{"kmeans-k":r[Z].parameters.k})),w(p,Z,"K-means clustering completed"));var D="snn_find_neighbors";"serialize"==n?_(D,f):("run"==n?Sn({k:r.params.cluster["clus-k"],cluster_method:r.params.cluster["clus-method"]}):(Mn(r[D]),M("cluster",{"clus-k":r[D].parameters.k})),w(f,D,"Shared nearest neighbor search completed"));var P="snn_build_graph";"serialize"==n?_(P,d):("run"==n?On({scheme:r.params.cluster["clus-scheme"]}):(Un(r[P]),M("cluster",{"clus-scheme":r[P].parameters.scheme})),w(d,P,"Shared nearest neighbor graph constructed"));var F="snn_cluster_graph";"serialize"==n?_(F,m):("run"==n?Pn({resolution:r.params.cluster["clus-res"]}):(In(r[F]),M("cluster",{"clus-res":r[F].parameters.resolution})),w(m,F,"Community detection from SNN graph complete"));var B="choose_clustering";"serialize"==n?_(B,h):("run"==n?er({method:r.params.cluster["clus-method"]}):(tr(r[B]),M("cluster",{"clus-method":r[B].parameters.method})),w(h,B,"Clustering of interest chosen"));var I="marker_detection";"serialize"==n?_(I,g):("run"==n?Pr({}):Ir(r[I]),w(g,I,"Marker detection complete"));var K="custom_marker_management";return"serialize"==n?_(K,b):("run"==n?Vr():Hr(r[K]),w(b,K,"Pruning of custom markers finished")),"serialize"==n?(console.log(e),Promise.all([z,R]).then((function(n){return e.tsne=n[0],e.umap=n[1],e}))):e}onmessage=function(e){var n=e.data;if("INIT"==n.type){var r=Math.round(2*navigator.hardwareConcurrency/3),t=M.j2({numberOfThreads:r});t.then((function(e){postMessage({type:n.type,msg:"Success: ScranJS/WASM initialized"})}));var a=nt=new Promise((function(e){(qr=indexedDB.open("KanaDB",2)).onupgradeneeded=function(e){var n=e.target.result;try{n.deleteObjectStore("analysis")}catch(e){}try{n.deleteObjectStore("analysis_meta")}catch(e){}try{n.deleteObjectStore("file")}catch(e){}try{n.deleteObjectStore("file_meta")}catch(e){}n.createObjectStore("analysis",{keyPath:"id"}),n.createObjectStore("analysis_meta",{keyPath:"id"}),n.createObjectStore("file",{keyPath:"id"}),n.createObjectStore("file_meta",{keyPath:"id"})},qr.onsuccess=function(){rt(e)},qr.onerror=function(){e(null)}}));a.then((function(e){null!==e?postMessage({type:"KanaDB_store",resp:e,msg:"Success"}):(console.error(error),postMessage({type:"KanaDB_ERROR",msg:"Fail: Cannot initialize DB"}))}));var s=mr(),o=Er();gt=Promise.all([t,a,s,o])}else if("RUN"==n.type)gt.then((function(e){At("run",n.payload)})).catch((function(e){console.error(e),postMessage({type:"run_ERROR",msg:e.toString()})}));else if("LOAD"==n.type){if("kana"==n.payload.files.format){var i=new FileReaderSync,u=n.payload.files.files.file[0];gt.then(function(){var e=(0,w.Z)(_().mark((function e(n){var r,t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,kt(i.readAsArrayBuffer(u));case 2:r=e.sent,t=At("unserialize",r),postMessage({type:"loadedParameters",resp:t});case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),postMessage({type:"load_ERROR",msg:e.toString()})}))}else if("kanadb"==n.payload.files.format){(function(e){return pt.apply(this,arguments)})(l=n.payload.files.files.file).then(function(){var e=(0,w.Z)(_().mark((function e(n){var r,t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n){e.next=4;break}postMessage({type:"KanaDB_ERROR",msg:"Fail: cannot load analysis ID '".concat(l,"'")}),e.next=11;break;case 4:return e.next=6,kt(n);case 6:return r=e.sent,e.next=9,At("unserialize",r);case 9:t=e.sent,postMessage({type:"loadedParameters",resp:t});case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),postMessage({type:"load_ERROR",msg:e.toString()})}))}}else if("EXPORT"==n.type)gt.then(function(){var e=(0,w.Z)(_().mark((function e(n){var r,t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,At("serialize");case 2:return r=e.sent,e.next=5,Mt(r,"full");case 5:t=e.sent,postMessage({type:"exportState",resp:t,msg:"Success: application state exported"},[t]);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),postMessage({type:"export_ERROR",msg:e.toString()})}));else if("SAVEKDB"==n.type){var c=n.payload.title;gt.then(function(){var e=(0,w.Z)(_().mark((function e(n){var r,t,a,s;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,At("serialize");case 2:return r=e.sent,e.next=5,Mt(r,"KanaDB");case 5:return t=e.sent,e.next=8,lt(null,t.state,t.file_ids,c);case 8:if(null===(a=e.sent)){e.next=16;break}return e.next=12,ot();case 12:s=e.sent,postMessage({type:"KanaDB_store",resp:s,msg:"Success: Saved analysis to cache (".concat(a,")")}),e.next=18;break;case 16:console.error(error),postMessage({type:"KanaDB_ERROR",msg:"Fail: Cannot save analysis to cache (".concat(a,")")});case 18:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),postMessage({type:"export_ERROR",msg:e.toString()})}))}else if("REMOVEKDB"==n.type){var l;(function(e){return yt.apply(this,arguments)})(l=n.payload.id).then(function(){var e=(0,w.Z)(_().mark((function e(n){var r;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=7;break}return e.next=3,ot();case 3:r=e.sent,postMessage({type:"KanaDB_store",resp:r,msg:"Success: Removed file from cache (".concat(l,")")}),e.next=9;break;case 7:console.error(error),postMessage({type:"KanaDB_ERROR",msg:"fail: cannot remove file from cache (".concat(l,")")});case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())}else"getMarkersForCluster"==n.type?gt.then((function(e){var r=n.payload.cluster,t=Kr(n.payload.rank_type,r),a=[];U(t,a),postMessage({type:"setMarkersForCluster",resp:t,msg:"Success: GET_MARKER_GENE done"},a)})):"getGeneExpression"==n.type?gt.then((function(e){var r=n.payload.gene,t=Ie(r);postMessage({type:"setGeneExpression",resp:{gene:r,expr:t},msg:"Success: GET_GENE_EXPRESSION done"},[t.buffer])})):"computeCustomMarkers"==n.type?gt.then((function(e){Yr(n.payload.id,n.payload.selection),postMessage({type:"computeCustomMarkers",msg:"Success: COMPUTE_CUSTOM_MARKERS done"})})):"getMarkersForSelection"==n.type?gt.then((function(e){var r=et(n.payload.cluster,n.payload.rank_type),t=[];U(r,t),postMessage({type:"setMarkersForCustomSelection",resp:r,msg:"Success: GET_MARKER_GENE done"},t)})):"removeCustomMarkers"==n.type?gt.then((function(e){$r(n.payload.id)})):"animateTSNE"==n.type?gt.then(function(){var e=(0,w.Z)(_().mark((function e(n){return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Sr();case 2:return e.next=4,yr();case 4:Tt(e.sent,"tsne","Resending t-SNE coordinates");case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()):"animateUMAP"==n.type?gt.then(function(){var e=(0,w.Z)(_().mark((function e(n){return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ur();case 2:return e.next=4,Ar();case 4:Tt(e.sent,"umap","Resending UMAP coordinates");case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()):"getAnnotation"==n.type?gt.then((function(e){var r=n.payload.annotation,t=ne(r);postMessage({type:"setAnnotation",resp:{annotation:r,values:{index:t.index,factor:t.factor}},msg:"Success: GET_ANNOTATION done"},[t.factor.buffer])})):console.error("MIM:::msg type incorrect")}}},n={};function r(t){var a=n[t];if(void 0!==a)return a.exports;var s=n[t]={exports:{}};return e[t](s,s.exports,r),s.exports}r.m=e,r.x=function(){var e=r.O(void 0,[5,555],(function(){return r(7729)}));return e=r.O(e)},function(){var e=[];r.O=function(n,t,a,s){if(!t){var o=1/0;for(l=0;l<e.length;l++){t=e[l][0],a=e[l][1],s=e[l][2];for(var i=!0,u=0;u<t.length;u++)(!1&s||o>=s)&&Object.keys(r.O).every((function(e){return r.O[e](t[u])}))?t.splice(u--,1):(i=!1,s<o&&(o=s));if(i){e.splice(l--,1);var c=a();void 0!==c&&(n=c)}}return n}s=s||0;for(var l=e.length;l>0&&e[l-1][2]>s;l--)e[l]=e[l-1];e[l]=[t,a,s]}}(),r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,{a:n}),n},r.d=function(e,n){for(var t in n)r.o(n,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},r.f={},r.e=function(e){return Promise.all(Object.keys(r.f).reduce((function(n,t){return r.f[t](e,n),n}),[]))},r.u=function(e){return"static/js/"+e+"."+{5:"b33c5a86",139:"c0062d85",495:"6e174be4",555:"860011ac",653:"2b6f1043"}[e]+".chunk.js"},r.miniCssF=function(e){},r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="/kana/",function(){r.b=self.location+"/../../../";var e={729:1};r.f.i=function(n,t){e[n]||importScripts(r.p+r.u(n))};var n=self.webpackChunkkana=self.webpackChunkkana||[],t=n.push.bind(n);n.push=function(n){var a=n[0],s=n[1],o=n[2];for(var i in s)r.o(s,i)&&(r.m[i]=s[i]);for(o&&o(r);a.length;)e[a.pop()]=1;t(n)}}(),function(){var e=r.x;r.x=function(){return Promise.all([r.e(5),r.e(555)]).then(e)}}();r.x()}();
//# sourceMappingURL=729.1237660d.chunk.js.map